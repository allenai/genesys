{"paperId": "3ea28675f2573e3c1f7e936a2776a5edf9e1434b", "abstract": "This paper is the first to assess the state of existing sparse matrix multiplication algorithms on GPU for the butterfly structure, a promising form of sparsity. This is achieved through a comprehensive benchmark that can be easily modified to add a new implementation. The goal is to provide a simple tool for users to select the optimal implementation based on their settings. Using this benchmark, we find that existing implementations spend up to 50% of their total runtime on memory rewriting operations. We show that these memory operations can be optimized by introducing a new CUDA kernel that minimizes the transfers between the different levels of GPU memory, achieving a median speed-up factor of x1.4 while also reducing energy consumption (median of x0.85). We also demonstrate the broader significance of our results by showing how the new kernel can speed up the inference of neural networks.", "venue": "arXiv.org", "year": 2024, "citationCount": 0, "influentialCitationCount": 0, "openAccessPdf": null, "tldr": {"model": "tldr@v2.0.0", "text": "This paper is the first to assess the state of existing sparse matrix multiplication algorithms on GPU for the butterfly structure through a comprehensive benchmark that can be easily modified to add a new implementation, and shows how the new kernel can speed up the inference of neural networks."}, "embedding": {"model": "specter_v2", "vector": [0.23575255274772644, 0.39881619811058044, -0.24339325726032257, 0.002057210309430957, 0.21700191497802734, 0.5235287547111511, 0.38637953996658325, -0.3833746910095215, -0.3966313302516937, -0.027478225529193878, 0.4870454668998718, 0.08147768676280975, 0.45617565512657166, -0.3370966613292694, -0.2805849313735962, -0.43180400133132935, -0.7935751676559448, -0.18889272212982178, 0.1711392104625702, -0.2644825279712677, 0.12323497235774994, -0.22594837844371796, -1.58845055103302, 0.2669154703617096, -0.09414603561162949, 1.4713054895401, -0.2002275288105011, 0.5096070766448975, -0.373060405254364, 0.6307916045188904, 0.9032045006752014, -0.29258236289024353, 0.6747507452964783, -0.01880551502108574, -0.1271519511938095, -0.3323277533054352, 0.6655492186546326, -0.4034503698348999, -0.41902434825897217, 0.8306271433830261, -0.37424996495246887, 0.6534146666526794, 0.41197505593299866, -0.6382395029067993, 0.22786514461040497, 0.0536225326359272, -0.11666545271873474, 1.084790825843811, -0.5075934529304504, -0.25264352560043335, 0.7796688079833984, -1.0978738069534302, 0.2656724750995636, 0.9465148448944092, 0.8939211368560791, -0.24410441517829895, -0.4827318489551544, -0.6923416256904602, -0.005465792026370764, 0.08348346501588821, -0.6964463591575623, -0.5265147089958191, -0.1636013686656952, -0.45717212557792664, 1.8783655166625977, -0.04821327328681946, -0.16998474299907684, 0.4031987488269806, 0.1764921247959137, 0.6560624837875366, 0.19091761112213135, -0.9005496501922607, 0.058813199400901794, 0.010523966513574123, 0.6262236833572388, 0.8763279914855957, 0.020218437537550926, 0.1862417459487915, -1.5130527019500732, -0.3736937344074249, 0.7674002647399902, -0.10488450527191162, 0.6792254447937012, -0.10637888312339783, -0.12233984470367432, 1.032817006111145, 0.20488564670085907, 0.2239987999200821, -0.2913379967212677, 0.9932956695556641, 0.7390473484992981, 0.11996902525424957, -0.017203690484166145, 0.2472071498632431, 0.5170252919197083, 0.6279477477073669, -0.9400457143783569, 0.026569116860628128, 0.351756751537323, 0.5988951921463013, 0.07766539603471756, 0.6531209349632263, -0.746009111404419, 0.11496731638908386, 0.8768330812454224, 0.010096068494021893, 0.1767636090517044, -0.6650915145874023, 0.12483040988445282, -0.8488733172416687, -0.23686465620994568, -1.379157304763794, 0.09811247140169144, -0.28445562720298767, -1.4166032075881958, -0.5448110699653625, -0.45287415385246277, -0.3574618697166443, -0.3762551546096802, 0.2038484364748001, 0.012993854470551014, 0.6647462248802185, -0.037926118820905685, 0.591934323310852, 0.9898925423622131, 0.7143487334251404, -0.03080633655190468, 0.36923548579216003, 1.1564120054244995, -1.2968803644180298, -0.33605626225471497, -0.6399937272071838, 0.023648275062441826, -0.33810362219810486, -0.39552193880081177, -0.061561159789562225, -1.2680625915527344, -1.0675954818725586, -0.9824705719947815, -0.12032051384449005, -0.3354250490665436, 0.3000667989253998, 1.6717538833618164, 0.01799914985895157, -0.6322965025901794, 0.7916610836982727, -0.5484163761138916, -0.22571700811386108, 0.26523348689079285, 0.360411673784256, 0.4302532374858856, 0.1183214783668518, -0.9245598912239075, 0.3857158124446869, 0.18803821504116058, -0.6050242781639099, 0.0471389964222908, -0.4946649968624115, -0.709224283695221, 0.45654982328414917, 0.16150490939617157, -0.8998816609382629, 0.6099981665611267, -0.20952999591827393, -1.0433119535446167, 0.673244833946228, -0.19424352049827576, -0.3872753977775574, 0.1569339483976364, 0.4494217336177826, -0.5817416906356812, -0.36802056431770325, -0.2774509787559509, 0.44104382395744324, 0.7457125186920166, 0.10104982554912567, 0.06807514280080795, 0.319068044424057, -0.32549840211868286, -0.32887622714042664, -0.4962877333164215, 0.8747981786727905, -0.36099496483802795, -0.4401389956474304, 0.36928796768188477, 0.4266439974308014, -0.1335774064064026, 0.20816141366958618, -0.5079503655433655, -0.3584614396095276, 0.48790156841278076, 0.40749692916870117, 1.0756226778030396, -0.9036486148834229, -0.9301359057426453, 0.5597966909408569, 0.16808156669139862, -0.18699166178703308, -0.44229093194007874, 0.5202854871749878, -0.47907304763793945, -0.27217918634414673, -0.035501670092344284, -0.43905705213546753, -0.41820308566093445, -0.17021356523036957, -0.8461587429046631, -0.03558448702096939, -0.08631516993045807, 0.6145691871643066, -0.45486897230148315, 0.17293699085712433, -0.08381068706512451, 0.3930222988128662, -1.2557239532470703, 0.8834044933319092, 0.08298134058713913, -0.000709127401933074, 0.030388904735445976, -0.3941306471824646, 0.2997671663761139, -0.7132419943809509, 0.4951132535934448, -0.9194958209991455, -0.31136777997016907, 0.20491157472133636, -1.0370908975601196, 1.0324134826660156, -0.15695109963417053, 0.45942866802215576, 0.3962610065937042, -0.9181663393974304, 0.4986899793148041, -0.0030949157662689686, -0.10393592715263367, -0.2430788278579712, 0.5340664386749268, 0.17046894133090973, -0.37753403186798096, 0.07153318077325821, 0.42960530519485474, 1.180361032485962, 0.09814780205488205, 0.3105357587337494, 0.48847371339797974, -0.34691277146339417, 0.6839569211006165, 0.22443383932113647, 0.6602732539176941, -0.004038836807012558, 0.3035174012184143, -0.42120981216430664, 0.236027330160141, -0.6234837770462036, -0.4729746878147125, 0.7859090566635132, 1.2472401857376099, 0.662074625492096, 0.41788995265960693, -1.079835057258606, -0.2613120377063751, 0.0019128619460389018, 0.3382416367530823, 1.3888788223266602, -0.335579514503479, -0.04147148132324219, -0.6581109166145325, 0.1022648960351944, 0.21397288143634796, -0.4143519103527069, -0.42420536279678345, -0.020731782540678978, -0.3995664715766907, -1.6828769445419312, 0.5500938296318054, 0.14924614131450653, 1.0311418771743774, -0.23242196440696716, -0.6108741760253906, -0.7381846308708191, 0.6450481414794922, -0.5886992812156677, -0.1804742068052292, 0.5135993957519531, -0.6982994675636292, -0.15774346888065338, 0.39633908867836, -0.10162226855754852, 0.2751462161540985, -0.34297269582748413, 0.7817111611366272, 0.005309028550982475, -0.7098720669746399, -0.10325190424919128, 0.6936380863189697, -0.46541228890419006, -0.05401242524385452, 0.06746982783079147, 0.04858190566301346, 0.1810230016708374, 0.24820148944854736, -0.32255879044532776, -0.08952268958091736, -0.19892291724681854, -0.3700028955936432, 0.30389276146888733, -0.09933900088071823, 0.07030999660491943, 0.7904310822486877, -0.35481807589530945, 0.07468082010746002, -0.9746404886245728, 0.8491198420524597, -0.4329465925693512, -0.5393401980400085, -0.28909146785736084, -0.4296095669269562, 0.14602358639240265, 0.3365650773048401, -0.4376811683177948, -0.31103163957595825, -0.47634363174438477, -0.05410857871174812, -0.4897006154060364, -0.18928532302379608, 0.1594487875699997, 1.1537587642669678, -0.8947978019714355, 0.6548833847045898, 0.04513978958129883, 0.78219074010849, -0.10420732200145721, 0.20299050211906433, -0.9721656441688538, 0.6584095358848572, 0.037066955119371414, -0.06045913323760033, 0.41378673911094666, 0.5970176458358765, -1.0822724103927612, -0.6857157349586487, -0.005979939363896847, -0.28436896204948425, -0.17749370634555817, 0.22807107865810394, -0.39025643467903137, -1.023210883140564, -0.344304621219635, -0.6518411636352539, 0.023205015808343887, 0.2239609956741333, 0.045881714671850204, -0.02801636978983879, -0.5954552888870239, -1.1655598878860474, -0.32292667031288147, -1.1125344038009644, -1.181334376335144, 0.18685762584209442, -0.09438637644052505, -0.3969060182571411, -0.4875265955924988, -0.2561085820198059, -0.6297839283943176, 1.2167303562164307, 0.05528348684310913, 0.6853057742118835, 0.11039629578590393, -0.08559879660606384, 0.06799998134374619, -0.310748428106308, 0.3157601058483124, -0.5370021462440491, 0.46661141514778137, -0.3492265045642853, 0.5306838154792786, -0.036079924553632736, -0.5408315658569336, 0.43433964252471924, 0.2750222086906433, 1.2522687911987305, -0.05670234560966492, -0.4326460063457489, 0.8202127814292908, 1.2917516231536865, -1.0067018270492554, 0.07708816975355148, -0.14389416575431824, 0.6614872217178345, 0.04859708622097969, -0.6020132899284363, 1.1487576961517334, -0.21499620378017426, 0.5784727931022644, 0.29776743054389954, -0.06895802915096283, -0.4449722468852997, 0.04272657632827759, -0.23482055962085724, 1.5288281440734863, 0.09630685299634933, 0.4109862446784973, -0.6355370283126831, -0.09791696071624756, -1.0521142482757568, -0.7329741716384888, -0.1514790654182434, 0.6556934118270874, 0.4918801486492157, -0.3047616183757782, -0.40599748492240906, -0.2379453033208847, 0.3525560200214386, 0.3469763398170471, -0.44843947887420654, -0.7668301463127136, -0.04919997230172157, 0.8427743911743164, 0.44132110476493835, 0.44004926085472107, -0.4936705231666565, 0.06157591566443443, 15.250603675842285, 1.0023365020751953, -0.30771517753601074, 0.39700767397880554, 0.7297769784927368, -0.06528192013502121, 0.1948878914117813, -0.3794705867767334, -1.4036394357681274, 0.24215944111347198, 0.7670441269874573, 0.5413128733634949, 0.5785698294639587, 0.6193211078643799, -0.3112139105796814, -0.36363276839256287, -0.16900590062141418, 1.2561414241790771, 0.6085208654403687, -1.874489426612854, -0.046657271683216095, -0.1358768790960312, 0.6834759712219238, 0.6275752782821655, 0.5164996385574341, 0.21564020216464996, 0.3091955780982971, -0.4936191737651825, -0.15431445837020874, 0.601548433303833, 0.8967403769493103, -0.06782492995262146, 0.4221549332141876, 0.22654655575752258, -0.8942221403121948, 0.36935028433799744, -0.5312945246696472, -1.494788646697998, -0.12267933785915375, 0.5121021270751953, -0.42731773853302, -0.554157018661499, 0.09749827533960342, 0.7687638401985168, 0.19409812986850739, 0.4372479021549225, 0.1992868334054947, 0.35485154390335083, -0.3066764771938324, -0.053273119032382965, 0.21491891145706177, 0.1745366007089615, -0.2676834166049957, 0.22575412690639496, 0.15131548047065735, 0.07552832365036011, 0.09767220914363861, 0.467410147190094, -0.23667357861995697, -0.14826785027980804, -0.016525771468877792, 0.04344276711344719, -0.2260083109140396, 1.2156646251678467, 0.28113487362861633, 0.07763758301734924, -0.3077548146247864, 0.1365654021501541, 0.7649391293525696, -0.15297189354896545, -0.32709771394729614, -0.28528472781181335, 0.6540029048919678, -0.32579106092453003, 0.19048775732517242, 0.30576184391975403, -0.9663448929786682, -0.6787497997283936, -1.0001291036605835, -0.31662774085998535, 0.5603304505348206, -0.7654801607131958, -1.1619923114776611, 0.7306235432624817, -0.18403637409210205, 0.066829614341259, 0.5914608836174011, -1.2380777597427368, -0.5108006596565247, 0.49243614077568054, -0.9471814036369324, 0.09400026500225067, -0.07514292746782303, -0.16372565925121307, -0.5589995384216309, -0.05282774567604065, 1.1821000576019287, -0.021444395184516907, -0.4762727916240692, -0.07729701697826385, 0.2953796684741974, -0.07713867723941803, -0.243587926030159, -0.02589406818151474, 0.6855815052986145, 0.17601047456264496, -0.2121887356042862, 0.369329571723938, -0.05838168412446976, -0.06116146221756935, -1.0864508152008057, 0.042395446449518204, 0.047365520149469376, -0.3469166159629822, 0.4186593294143677, -0.48916012048721313, -0.7651332020759583, 0.21435050666332245, 0.5356724262237549, 0.1626150757074356, 0.5731174945831299, 0.044281162321567535, -0.549311637878418, -0.3718916177749634, -0.7087098360061646, -0.014171797782182693, 0.5438796281814575, -0.2818656861782074, -0.2106473743915558, 0.11367347091436386, -0.4623551666736603, -1.0821536779403687, -0.8558792471885681, 0.1499767303466797, 0.26890864968299866, -0.5232439041137695, 1.3412187099456787, -0.5287879109382629, 1.0556148290634155, 0.7466127276420593, -0.21768158674240112, -0.3389270603656769, 0.13881996273994446, -0.5181818008422852, -0.3591151535511017, -0.489076167345047, 0.3261023461818695, -0.5053479671478271, 0.6577709317207336, 0.6855008006095886, 0.3674605190753937, -0.5827991366386414, -0.6431781053543091, -0.0869833379983902, -0.5485454201698303, -0.2297336608171463, 0.0965847596526146, 0.12017882615327835, -0.07211210578680038, 0.04084598645567894, 0.1384705752134323, 0.26562488079071045, -0.024603070691227913, -0.14713124930858612, 0.5016018748283386, -0.27872419357299805, -0.5794357061386108, -0.6239279508590698, -0.5426508188247681, -1.3216017484664917, -0.197596475481987, -1.528696894645691, -0.4440399408340454, -0.5213627219200134, -0.6181809306144714, -0.006902527529746294, -0.03110821545124054, 0.338520348072052, 0.5890939235687256, 0.328495055437088, -0.8801769018173218, -0.5410304665565491, -0.46076998114585876, 0.5036432147026062, 0.6039311289787292, -0.2687470316886902, 0.14187836647033691, -0.32219842076301575, 0.24663428962230682, 0.690065860748291, 0.596295952796936, -0.2783578336238861, -0.35484129190444946, -1.3258492946624756, 0.477900892496109, -0.11150746047496796, -0.14922964572906494, -1.1490538120269775, 0.9327157139778137, 0.3819378912448883, 0.2963486909866333, 0.2035456746816635, 0.6664974093437195, -0.6737170219421387, 0.022526724264025688, 0.5198066830635071, -0.38593587279319763, -0.015814611688256264, 0.29872041940689087, -0.7345046401023865, -0.06255722790956497, 0.35786768794059753, 0.11800462752580643, -0.5645313858985901, -0.5344783663749695, 0.26185497641563416, -0.5858033895492554, 0.28413403034210205, -0.13369637727737427, -0.21946026384830475, -1.0703593492507935, -0.014689602889120579, -0.22606799006462097, 0.023983165621757507, -0.6474493741989136, 0.5271807312965393, 0.0685509666800499, -1.1641318798065186, 0.45446285605430603, 0.581150472164154, -0.6043420433998108, -0.534453272819519, 0.6363754868507385, 0.6802158355712891, -0.7691304087638855, -0.1712648570537567, -0.3454131782054901, 0.33287209272384644, -0.7010250687599182, -0.07744545489549637, 0.41560813784599304, -0.18575738370418549, -0.279747873544693, 1.065246343612671, -0.3433305025100708, -0.3320993483066559, 0.12692230939865112, -0.9177438616752625, -0.3672703206539154, -0.12960748374462128, 0.8384166359901428, 0.7134354710578918, 0.4238571226596832, 0.14206108450889587, -0.2760654389858246, 0.14234551787376404, 0.24175912141799927, 0.12997034192085266, 0.3041543960571289, 0.03354032337665558, -0.8724158406257629, 0.15144233405590057, 0.6235476732254028, -0.2548682987689972, -0.7054756879806519, -0.632448136806488, -0.5854488015174866, -0.40120193362236023, 0.23304156959056854, -0.18493545055389404, -1.1782431602478027, 0.7774437069892883, 0.23073482513427734, 0.31824177503585815, 0.14969167113304138, -0.43191400170326233, 0.2825795114040375, 1.0423814058303833, -0.0590730682015419, -0.5766851305961609, -0.6524582505226135, 1.3781239986419678, 1.0430054664611816, -0.6592960953712463, 0.7157865762710571, -0.7711277008056641, -0.5861605405807495, 1.1861499547958374, 0.5482562780380249, -0.6567057967185974, 1.3786942958831787, 0.28679123520851135, -0.4614237844944, -0.05079749971628189, -0.6433641314506531, -0.12099836766719818, 0.7799955606460571, 0.6197183132171631, 0.47292155027389526, -0.1444798856973648, -0.08947732299566269, 1.0604212284088135, -0.19961562752723694, -0.002039045561105013, 0.26398444175720215, 0.4382113218307495, -0.11655101925134659, 0.3891332447528839, -0.1825619339942932, 1.238130807876587, -0.7249569892883301, -0.8857976198196411, 0.38358670473098755, 0.7135190367698669, 0.2654290497303009, 0.3023725748062134, 0.9948281049728394, 0.14581355452537537, 0.4279581904411316, -0.107569620013237, 0.4890226721763611, -0.4300924837589264, -0.46903130412101746, -0.2800827622413635, -0.273264616727829, -0.2641878128051758, -0.13206514716148376, -0.1948467344045639, -0.36959749460220337, -0.6089569926261902, 0.6321435570716858, -0.013675004243850708, 0.4689255952835083, 0.5909203290939331, 1.0066519975662231, 0.5177744030952454, -0.44239217042922974, -0.9208466410636902, -0.24803774058818817, -0.480858713388443, -0.05065380409359932, -0.7027547955513, -0.6947506666183472, -0.5919014811515808, -0.28109046816825867, -0.1269272118806839]}, "authors": [{"authorId": "1379513736", "name": "Antoine Gonon"}, {"authorId": "2214552527", "name": "L\u00e9on Zheng"}, {"authorId": "2303257759", "name": "Pascal Carrivain"}, {"authorId": "2118307255", "name": "Quoc-Tung Le"}], "references": [{"paperId": "c85268696fe1435605ae66a18653cfdcf8153753", "title": "Monarch Mixer: A Simple Sub-Quadratic GEMM-Based Architecture"}, {"paperId": "87c5b281fa43e6f27191b20a8dd694eda1126336", "title": "FlashAttention: Fast and Memory-Efficient Exact Attention with IO-Awareness"}, {"paperId": "67904b80a33bc09a5b2b1db296faea1b79fa80e9", "title": "Fast Learning of Fast Transforms, with Guarantees"}, {"paperId": "8326dba15f6b8ee6e43c23eea3265a05e59e8135", "title": "Monarch: Expressive Structured Matrices for Efficient and Accurate Training"}, {"paperId": "fbaa944e73644ce12ea4a0ac8ffb64c3280f3aff", "title": "Deformable Butterfly: A Highly Structured and Sparse Linear Transform"}, {"paperId": "90b21dbad8969b74d704eed15a3d98722a88e464", "title": "Pixelated Butterfly: Simple and Efficient Sparse training for Neural Network Models"}, {"paperId": "5a4efa0f5a5576c78e536903ae86b693466fb30a", "title": "Efficient Identification of Butterfly Sparse Matrix Factorizations"}, {"paperId": "2a805d0e1b067444a554c5169d189fa1f649f411", "title": "Scaling Vision Transformers"}, {"paperId": "268d347e8a55b5eb82fb5e7d2f800e33c75ab18a", "title": "An Image is Worth 16x16 Words: Transformers for Image Recognition at Scale"}, {"paperId": "b1ac64438608aac1a8dfd0adf8fec8c6220f6bfd", "title": "Butterfly Transform: An Efficient FFT Based Neural Architecture Design"}, {"paperId": "a6e92f6fa9e91b7e869562a63b30a9a56cf14582", "title": "Learning Fast Algorithms for Linear Transforms Using Butterfly Factorizations"}, {"paperId": "c50b39fc5aa79075931e19e260339d62b59d2ba1", "title": "A coordinated tiling and batching framework for efficient GEMM on GPUs"}, {"paperId": "ab99f17bd4eb895ee0b8c71161248744fd8ed41b", "title": "SIDUS\u2014the solution for extreme deduplication of an operating system"}, {"paperId": "d506c529cf94b186525101c8098130771742bce8", "title": "The ubiquitous Kronecker product"}, {"paperId": null, "title": "Scaled dot-product attention implementation"}, {"paperId": "b18cb9536f8282bb3dc33587582dc954dda1e321", "title": "Algorithmic and theoretical aspects of sparse deep neural networks. (Aspects algorithmiques et th 'eoriques des r 'eseaux de neurones profonds parcimonieux)"}, {"paperId": "9be30e4ac55794e74914426c437410719af6a18e", "title": "Optimal quantization of rank-one matrices in floating-point arithmetic\u2014with applications to butterfly factorizations"}, {"paperId": "8a85ef6a7ebcd8735b868bf9c4a77e6a3c195caa", "title": "Einops: Clear and Reliable Tensor Manipulations with Einstein-like Notation"}, {"paperId": null, "title": "Amazon EC2 Update \u2013 Inf1 Instances with AWS Inferentia Chips for High Performance Cost-Effective Inferencing"}, {"paperId": null, "title": "HPCwire"}, {"paperId": null, "title": "Efficient GEMM in CUDA: documentation, 2023a"}, {"paperId": null, "title": "Matrix multiplication background"}, {"paperId": null, "title": "How to optimize a CUDA matmul kernel for cuBLAS-like performance: A worklog"}]}