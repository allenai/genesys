{"paperId": "47f5f75d392efe1d075bf3f91818f0cb05ddbc1c", "abstract": "We study how information propagates in decoder-only Transformers, which are the architectural backbone of most existing frontier large language models (LLMs). We rely on a theoretical signal propagation analysis -- specifically, we analyse the representations of the last token in the final layer of the Transformer, as this is the representation used for next-token prediction. Our analysis reveals a representational collapse phenomenon: we prove that certain distinct sequences of inputs to the Transformer can yield arbitrarily close representations in the final token. This effect is exacerbated by the low-precision floating-point formats frequently used in modern LLMs. As a result, the model is provably unable to respond to these sequences in different ways -- leading to errors in, e.g., tasks involving counting or copying. Further, we show that decoder-only Transformer language models can lose sensitivity to specific tokens in the input, which relates to the well-known phenomenon of over-squashing in graph neural networks. We provide empirical evidence supporting our claims on contemporary LLMs. Our theory also points to simple solutions towards ameliorating these issues.", "venue": "arXiv.org", "year": 2024, "citationCount": 3, "influentialCitationCount": 0, "openAccessPdf": null, "tldr": {"model": "tldr@v2.0.0", "text": "It is proved that certain distinct sequences of inputs to the Transformer can yield arbitrarily close representations in the final token, which relates to the well-known phenomenon of over-squashing in graph neural networks."}, "embedding": {"model": "specter_v2", "vector": [0.5552379488945007, 0.9351161122322083, -0.29274943470954895, 0.2748437821865082, -0.3467094302177429, 0.038374461233615875, 0.6131517887115479, 0.001784113235771656, -0.24763283133506775, -0.23397858440876007, 0.5837412476539612, -0.24935618042945862, 0.24055658280849457, -0.12352271378040314, -0.5541040301322937, 0.09648089110851288, -1.088912844657898, 0.22287626564502716, 0.16280147433280945, -0.2677050232887268, -0.01013118214905262, -0.5710234045982361, -1.114530086517334, 0.4258093237876892, 0.2416314035654068, 0.3493688404560089, 0.06618708372116089, 1.0011749267578125, -0.253444641828537, 0.979050874710083, 0.4203604459762573, -0.9199596047401428, 0.28090789914131165, 0.08203902095556259, -0.25119277834892273, -0.26845860481262207, 0.19520094990730286, -0.3151959180831909, -0.8003049492835999, 1.043263554573059, -0.46995067596435547, -0.10080234706401825, 0.2536510229110718, -0.8463206887245178, -0.42873725295066833, 1.3816286325454712, 0.5187976360321045, 0.6365967988967896, 0.06827063113451004, -0.5671782493591309, 1.4931873083114624, -1.179638385772705, 0.37181293964385986, 1.6674139499664307, 0.6526784300804138, 0.17730647325515747, -0.31366243958473206, -0.599723219871521, 0.8516883254051208, 0.0937471017241478, -0.9706773161888123, -0.5733436346054077, -0.09574258327484131, -0.025416921824216843, 1.4904552698135376, -0.5800154209136963, 0.044433582574129105, 0.2853398621082306, 0.10889489203691483, 1.4877220392227173, -0.004691441077739, -0.7436581254005432, -0.3082183599472046, -0.11301962286233902, 0.16492046415805817, 1.1040465831756592, 0.08207613229751587, 0.3122367858886719, -1.1787999868392944, -0.006882902234792709, 0.5411471724510193, -0.11344049870967865, -0.041301097720861435, -0.16689541935920715, -0.03881444036960602, 0.344944566488266, 0.24732796847820282, 0.7384174466133118, -0.08629123866558075, 1.1082912683486938, 0.5072473287582397, 0.7323392033576965, 0.20000740885734558, -0.21241724491119385, 0.23355942964553833, 0.1423007845878601, -0.7702800631523132, 0.26113930344581604, 0.2678585648536682, 0.8375410437583923, -0.17426148056983948, 0.1210930272936821, -0.6711974740028381, -0.14273232221603394, 1.516078233718872, -0.15028142929077148, 0.32971715927124023, -0.5761137008666992, 0.6178768277168274, -0.7694435119628906, 0.028570067137479782, -0.7179086208343506, -0.0835181176662445, -0.34631508588790894, -0.690599799156189, -1.218783974647522, 0.17595891654491425, 0.5737661123275757, -0.6300722360610962, 0.8104592561721802, -0.9076707363128662, 0.20015431940555573, -0.24242620170116425, 0.36448344588279724, 0.12326392531394958, 0.5067174434661865, 0.2090694159269333, 0.12888562679290771, 0.7864776253700256, -0.3004334270954132, -0.39254218339920044, -1.1333279609680176, 0.7658244967460632, -0.2399672418832779, 0.3944210410118103, -0.05497562512755394, -1.4668735265731812, -0.8011215329170227, -0.9912160038948059, 0.15237945318222046, -0.4152962863445282, 0.051173556596040726, 0.9697375893592834, 0.5670608282089233, -1.335028052330017, 1.0437167882919312, -0.29703086614608765, 0.11852576583623886, 0.6949730515480042, 0.46030187606811523, 0.3071058690547943, -0.7978689670562744, -1.0181790590286255, 0.4396977126598358, 0.11523626744747162, -0.5954775810241699, -0.19051846861839294, -0.2748446762561798, -1.2238717079162598, 0.24176709353923798, 0.4598635733127594, -0.49748146533966064, 1.3376305103302002, 0.37121668457984924, -1.1021385192871094, 0.47084206342697144, -0.4146495759487152, 0.18905918300151825, 0.210597962141037, 0.06825516372919083, -0.18861135840415955, -0.33905094861984253, -0.25960928201675415, 0.03510722145438194, 0.38926568627357483, -0.6956576108932495, 0.2104020118713379, -0.14653047919273376, -0.4650816321372986, -0.32658007740974426, 0.26071393489837646, 0.5977240800857544, -0.277416855096817, -0.0174171794205904, 0.38956308364868164, 0.7422847151756287, -0.043139245361089706, -0.2510625422000885, -0.5658228397369385, -1.097732663154602, 0.0773419439792633, -0.004072543699294329, 0.9466862678527832, -0.8527565002441406, -0.8135760426521301, -0.014225062914192677, 0.4161890149116516, -0.335701048374176, -0.6089140176773071, 0.6464694142341614, -0.2167227864265442, 0.6339852213859558, -0.05437012016773224, -1.143921136856079, 0.2683320939540863, -0.20476476848125458, -0.6611485481262207, 0.10963045060634613, 0.04644493758678436, 0.9884411692619324, -1.1174722909927368, -0.02244284190237522, -0.11194290965795517, 0.08899150788784027, -0.9472160935401917, 0.8290687203407288, -0.22862876951694489, -0.06404278427362442, 0.05509351193904877, -0.407844215631485, 0.17597851157188416, -0.43142491579055786, 0.30687597393989563, -0.2176702469587326, 0.12163091450929642, 0.6663225889205933, -0.027751805260777473, 1.2274538278579712, -0.16546110808849335, 0.587310791015625, -0.2172810435295105, -0.8490229845046997, 0.017367970198392868, 0.3159240186214447, -0.3651236891746521, -0.3134712874889374, 0.3860471248626709, 0.18459609150886536, -0.19905740022659302, 0.5719060897827148, 0.7759557366371155, 0.4591726064682007, -0.5712838172912598, 0.1863245815038681, 0.39147865772247314, -0.29076072573661804, 0.5666207075119019, 0.6454579830169678, 0.8194751143455505, 0.35589879751205444, 0.24598631262779236, 0.31041213870048523, 0.15340732038021088, -1.007632851600647, -0.27475327253341675, 0.8122984766960144, 0.6252137422561646, 0.7799710631370544, 0.6911442875862122, -0.592512309551239, -0.37286731600761414, -0.5134084820747375, 0.696492612361908, 1.391694188117981, -0.2382664531469345, -0.5274383425712585, -0.5585010647773743, 0.19161298871040344, -0.1821252554655075, 0.12520161271095276, -0.2922149896621704, -0.6246724128723145, -0.2529175579547882, -1.001078724861145, 1.240126609802246, 0.11828728765249252, 0.6877040863037109, -0.2493802011013031, -0.0749378427863121, -0.07517994940280914, 0.36711713671684265, -0.8388363122940063, -0.46984541416168213, 0.21407222747802734, -0.3558821976184845, 0.0073912073858082294, -0.10823355615139008, -0.1365536004304886, 0.13731977343559265, -0.759980320930481, 0.7268813252449036, -0.18971820175647736, -0.05759183689951897, 0.13855856657028198, 0.8094462752342224, -0.554499089717865, -1.1466805934906006, 0.03739496320486069, -0.04840940982103348, -0.11666781455278397, 0.18443074822425842, 0.44617635011672974, 0.1111326515674591, -0.31928688287734985, -0.3345237672328949, 0.18537932634353638, 0.3093910813331604, -0.2036226987838745, -0.20463956892490387, -0.28887125849723816, 0.10187683999538422, -1.0443156957626343, 1.1440852880477905, 0.1179451271891594, -0.3706115186214447, 0.30406618118286133, -0.7777374982833862, 0.0751098170876503, 0.7770053148269653, -0.48452067375183105, 0.009686444886028767, -1.0057896375656128, 0.40116623044013977, -0.12547361850738525, 0.12183951586484909, 0.24018098413944244, 0.3517768383026123, 0.2348472625017166, -0.14104612171649933, 0.7028676271438599, 0.5032562613487244, -0.11522048711776733, 0.5532951951026917, -0.9620815515518188, 0.578920304775238, -0.011594201438128948, 0.02125409059226513, -0.023210322484374046, 0.11050131171941757, -0.5522358417510986, -0.10654135048389435, -0.09195803850889206, 0.07651690393686295, -0.5266422629356384, -0.11251387745141983, -0.480793833732605, -1.184045672416687, 0.2320547103881836, -1.2019041776657104, -0.2112196832895279, 0.12031994760036469, -0.37172043323516846, -0.358271062374115, -0.8566591143608093, -1.7835880517959595, -0.6338889002799988, 0.004822496324777603, -1.1829651594161987, 0.3015962243080139, -0.11619331687688828, -0.300864577293396, -0.3515875041484833, -0.2630852162837982, -0.4468354880809784, 0.836651623249054, -0.9186549782752991, 0.9466414451599121, -0.11363047361373901, -0.6479223370552063, -0.05643772706389427, -0.03945987671613693, -0.034298188984394073, -0.5415734648704529, 0.04190097376704216, -0.8475470542907715, 0.11313748359680176, -0.6563478112220764, -0.1638038009405136, 0.30041664838790894, 0.2752518355846405, 0.5636271834373474, -0.25934040546417236, -0.7822608947753906, 0.11107515543699265, 1.234200358390808, -0.6475385427474976, 0.2597814202308655, 0.05411720648407936, 0.8877933025360107, 0.2152816653251648, -0.7116122245788574, 0.516804575920105, 0.48238497972488403, 0.07637542486190796, 0.03307388350367546, 0.2815403640270233, -0.3121107220649719, -1.1442822217941284, 0.7052403688430786, 1.7212331295013428, 0.2786988317966461, -0.29376769065856934, -0.9534202814102173, 0.4774681627750397, -1.4007676839828491, -0.7044357657432556, 0.6716107726097107, 1.0456397533416748, 0.11998359113931656, -0.004069829359650612, -0.4285717010498047, 0.12082351744174957, 0.5116487741470337, 0.40271446108818054, -0.07838556170463562, -0.56197190284729, 0.13490019738674164, 0.44335848093032837, 0.6344336867332458, 0.8340417146682739, 0.3687846064567566, 0.7623239755630493, 15.111403465270996, 0.7793186902999878, 0.11521141976118088, 0.7044366598129272, 0.6077404618263245, 0.4313841760158539, -0.491433322429657, 0.22757723927497864, -1.029044270515442, 0.0015797181986272335, 1.2817026376724243, -0.05414758250117302, 0.6714839339256287, -0.34773582220077515, -0.05590624362230301, 0.058922167867422104, -0.3877553343772888, 0.603474497795105, 0.37525054812431335, -1.3565596342086792, 0.6524518728256226, 0.2538236975669861, -0.08136926591396332, 0.5075379014015198, 0.8637056946754456, 0.6953465938568115, 1.1048730611801147, -0.6666408181190491, 0.8038187623023987, 0.23273657262325287, 1.000988483428955, -0.01764236018061638, -0.0020283088088035583, 0.6033889055252075, -1.0171643495559692, -0.08849097788333893, -0.6945353150367737, -1.497734546661377, 0.1296045333147049, 0.33576202392578125, -0.7596226334571838, -0.592704713344574, -0.5661861300468445, 0.662539005279541, 0.1263578236103058, 0.44166967272758484, -0.05632564797997475, 0.7109348177909851, -0.36085960268974304, -0.04497759789228439, -0.10582207143306732, 0.5572323799133301, 0.2630592882633209, -0.0894966647028923, 0.30393287539482117, -0.4477677643299103, 0.04099683836102486, 0.4384734332561493, -0.5846654176712036, -0.3165556490421295, -0.7701756954193115, -0.3010687530040741, 0.12184154987335205, 0.06290575116872787, 0.275191992521286, 0.012835062108933926, -0.39885637164115906, 0.3457992970943451, 0.8047873377799988, 0.19440977275371552, 0.12077922374010086, 0.10264046490192413, 0.27323079109191895, -0.20575591921806335, 0.018881307914853096, 0.4069787263870239, -0.12503843009471893, -0.6029356718063354, -0.7333579063415527, -0.25332921743392944, 0.3207467794418335, -0.8203199505805969, -0.47070416808128357, 0.5532952547073364, -0.1670220047235489, -0.15842102468013763, 0.3726728558540344, -0.6370985507965088, -0.04738306999206543, 0.011054093949496746, -1.2624454498291016, -0.687900960445404, 0.61053866147995, -0.03384380787611008, -0.4925234615802765, 0.16664351522922516, 0.8072390556335449, 0.2547851502895355, 0.05589680001139641, 0.30270519852638245, 0.09823006391525269, 0.2684045732021332, -0.6166841387748718, -0.6704318523406982, 1.033664345741272, 0.3661072254180908, 0.17923255264759064, 0.32518407702445984, 0.12171764671802521, 0.2751798927783966, -0.8822759985923767, 0.4155028164386749, 1.049691915512085, -1.0073527097702026, -0.25832921266555786, -0.7233209013938904, -0.5441356897354126, 0.6317912936210632, 0.19823244214057922, -0.25629812479019165, -0.019254928454756737, -0.010885341092944145, -0.633918821811676, -0.16851364076137543, -0.4285922348499298, 0.24552389979362488, 0.7683143019676208, -1.0754828453063965, -0.285926878452301, -0.47030436992645264, 0.07326604425907135, -0.8947141766548157, -0.20413151383399963, -0.488448828458786, 0.27701956033706665, -0.2602372467517853, 0.8456118702888489, -0.37859928607940674, 0.6737645268440247, 0.6384503841400146, -0.057781949639320374, -0.9439511299133301, -0.45133352279663086, -1.1620856523513794, 0.17558568716049194, 0.01708894968032837, 0.4181826710700989, -0.44905760884284973, 0.2702464461326599, 0.7157862782478333, 0.087744802236557, -0.019608745351433754, -0.93766850233078, -0.1921636015176773, 0.0793699324131012, -0.9419986605644226, 0.3703160583972931, -0.4063006639480591, 0.3597739636898041, 0.23032870888710022, 0.32092273235321045, 0.552716851234436, 0.0805414542555809, -0.976286768913269, 0.05997670069336891, -0.19345635175704956, 0.11102462559938431, -0.8912205696105957, -0.8041474223136902, -1.6206672191619873, -0.05387018993496895, -1.3508223295211792, 0.09782763570547104, -1.1219189167022705, -0.43986770510673523, 0.18091854453086853, -0.17552761733531952, -0.12994016706943512, 0.7033465504646301, -0.24047736823558807, -0.06226406991481781, -0.47812989354133606, -0.6590330600738525, 0.6190105676651001, 1.0262573957443237, -0.7380850315093994, 0.5842345356941223, -0.05355146527290344, -0.22296111285686493, 0.3483369052410126, 0.24936842918395996, -0.757429838180542, -0.7183361649513245, -1.281609296798706, 0.8658156991004944, 0.14734244346618652, 0.06704860180616379, -0.6541154980659485, 0.9272710680961609, 0.5036706328392029, -0.3025689721107483, 0.1435922533273697, 0.43924304842948914, -0.8114939332008362, -0.480619877576828, 0.7888891696929932, -0.9787304401397705, 0.14060896635055542, -0.011023858562111855, -0.21067340672016144, 0.016058463603258133, 0.5488181710243225, -0.3952924609184265, -1.3353016376495361, -0.3743857741355896, 0.3021431267261505, -0.9730799794197083, 0.23663902282714844, -0.3795584440231323, -0.27911919355392456, -1.0893527269363403, -0.6017963290214539, -0.12985742092132568, -0.0957050696015358, -0.20982655882835388, 0.9304699301719666, 0.38161009550094604, -0.790561854839325, 0.019711874425411224, 0.41188108921051025, -0.07887434214353561, 0.15934103727340698, 0.17075610160827637, 0.1063460186123848, -0.2460707426071167, 0.34997010231018066, 0.4901178777217865, 0.37422841787338257, -0.6518818736076355, -0.13688400387763977, 0.3827393651008606, -0.7994685173034668, -0.388901948928833, 0.8127313852310181, -0.3414449989795685, -1.004817008972168, -0.06284434348344803, -1.6372500658035278, -0.15231497585773468, -0.49927979707717896, 0.2154618501663208, 0.1671600639820099, -0.16609394550323486, 0.09550043195486069, -0.5429778099060059, 0.22131912410259247, -0.04759284108877182, -0.4606635272502899, 0.16765351593494415, -0.31474295258522034, -0.2956616282463074, 0.6303228139877319, 0.7807363867759705, -0.32770001888275146, -0.6000717878341675, -0.8817058205604553, -0.2833806574344635, -0.2511146366596222, 0.2306286245584488, 0.03759068250656128, -0.3733891248703003, 0.9458019137382507, 0.09117469191551208, 0.4131491482257843, -0.4465586543083191, -0.007172557525336742, 0.10343288630247116, 0.36800017952919006, 0.48871105909347534, -0.36970579624176025, -0.6626894474029541, 1.3305344581604004, 0.8144684433937073, -0.291122168302536, 0.34680086374282837, -0.2874763309955597, -0.4194558262825012, 0.6121682524681091, 0.062291260808706284, -0.12841291725635529, 0.9224905967712402, 0.530228316783905, -0.08039526641368866, 0.0916014164686203, -1.2109066247940063, -0.15096305310726166, 0.5555609464645386, 1.0177738666534424, 0.6606151461601257, 0.28035303950309753, 0.1399112194776535, 1.0370582342147827, -0.15050728619098663, 0.6386610269546509, 0.7833921313285828, 0.4961332678794861, -0.1934325098991394, 0.13778837025165558, -0.08801505714654922, 0.695615828037262, -0.8421393632888794, -0.9111813902854919, 0.18954133987426758, 0.4817725121974945, -0.011251112446188927, 0.507339358329773, 0.8971593379974365, -0.17693085968494415, 0.18281278014183044, 0.3982689082622528, 0.9050817489624023, -0.199849471449852, -0.22278089821338654, -0.5229922533035278, -0.42356789112091064, 0.37926924228668213, -0.1429867148399353, -0.40077465772628784, -0.4852360188961029, -0.5747252702713013, 0.235826313495636, -0.0341477245092392, -0.1758386790752411, 1.243750810623169, 0.6240399479866028, 0.596483588218689, -0.5086598992347717, -0.4367123246192932, -0.4054437279701233, -0.6637134552001953, -0.036589041352272034, -0.37725335359573364, -0.030446168035268784, -0.11967963725328445, -0.4185802936553955, -0.1980023980140686]}, "authors": [{"authorId": "2304952564", "name": "Federico Barbero"}, {"authorId": "4194027", "name": "Andrea Banino"}, {"authorId": "67007190", "name": "Steven Kapturowski"}, {"authorId": "2106164", "name": "D. Kumaran"}, {"authorId": "2287269187", "name": "J. G. Ara'ujo"}, {"authorId": "1492155662", "name": "Alex Vitvitskyi"}, {"authorId": "1996134", "name": "Razvan Pascanu"}, {"authorId": "1742197495", "name": "Petar Velivckovi'c"}], "references": [{"paperId": "b842b83a7ff5dff8e3b83915d8c15423b6085728", "title": "Gemma: Open Models Based on Gemini Research and Technology"}, {"paperId": "75c19f3249f644f5cb2182282fc117c089fd3f65", "title": "The Expressive Power of Transformers with Chain of Thought"}, {"paperId": "55991bbd457ca5d50bee5c2d6ab540cd42ad7d7d", "title": "Locality-Aware Graph-Rewiring in GNNs"}, {"paperId": "1733eb7792f7a43dd21f51f4d1017a1bffd217b5", "title": "Lost in the Middle: How Language Models Use Long Contexts"}, {"paperId": "dba5c601222fef5b1b459c1019a76c448ec2b777", "title": "Asynchronous Algorithmic Alignment with Cocycles"}, {"paperId": "dc8f407e9eae9ff2383c4d6d8325bbf9d5c6a5b0", "title": "How does over-squashing affect the power of GNNs?"}, {"paperId": "385c363ea8e450f362d389f401beaeb5b42a0022", "title": "Stabilizing Transformer Training by Preventing Attention Entropy Collapse"}, {"paperId": "53d128ea815bcc0526856eb5a9c42cc977cb36a7", "title": "Toolformer: Language Models Can Teach Themselves to Use Tools"}, {"paperId": "c64e878be5705fafb200c6bfa0c8f1764c49608f", "title": "On Over-Squashing in Message Passing Neural Networks: The Impact of Width, Depth, and Topology"}, {"paperId": "dac3a172b504f4e33c029655e9befb3386e5f63a", "title": "Emergent Abilities of Large Language Models"}, {"paperId": "26218bdcc3945c7edae7aa2adbfba4cd820a2df3", "title": "Flamingo: a Visual Language Model for Few-Shot Learning"}, {"paperId": "5cbe278b65a81602a864184bbca37de91448a5f5", "title": "Competition-level code generation with AlphaCode"}, {"paperId": "04ac11f8db83406b03d92aa4571fc3e6c176c1e3", "title": "Understanding over-squashing and bottlenecks on graphs via curvature"}, {"paperId": "0735fb79bf34698c1df4461a05ed51c232c412e4", "title": "Thinking Like Transformers"}, {"paperId": "66c10bf1f11bc1b2d92204d8f8391d087f6de1c4", "title": "RoFormer: Enhanced Transformer with Rotary Position Embedding"}, {"paperId": "3bfa808ce20b2736708c3fc0b9443635e3f133a7", "title": "On the Bottleneck of Graph Neural Networks and its Practical Implications"}, {"paperId": "b45d656ac8cc2e940609580cf291ee76ffcac20a", "title": "On Layer Normalization in the Transformer Architecture"}, {"paperId": "b3564be8b79f25585acb035f3deaf4ae93c26d8f", "title": "Theoretical Limitations of Self-Attention in Neural Sequence Models"}, {"paperId": "204e3073870fae3d05bcbc2f6a8e263d9b72e776", "title": "Attention is All you Need"}, {"paperId": "84069287da0a6b488b8c933f3cb5be759cb6237e", "title": "On the difficulty of training recurrent neural networks"}, {"paperId": "04e456b03b4d13cc22042917fc65fb80ef8a5017", "title": "The Perron-Frobenius theorem: some of its applications"}, {"paperId": "2e9d221c206e9503ceb452302d68d10e293f2a10", "title": "Long Short-Term Memory"}, {"paperId": "d0be39ee052d246ae99c082a565aba25b811be2d", "title": "Learning long-term dependencies with gradient descent is difficult"}, {"paperId": "c4cb90a67f45e7cbacb5286e934b309e89843922", "title": "Attention is Turing-Complete"}, {"paperId": "a2d31ff074be4b5d080f2774dfadd3bd5051bf2a", "title": "Gradients"}, {"paperId": null, "title": "Gemini: a family of highly capable multimodal models"}, {"paperId": null, "title": "Gpt-4 technical report. arxiv 2303.08774"}]}