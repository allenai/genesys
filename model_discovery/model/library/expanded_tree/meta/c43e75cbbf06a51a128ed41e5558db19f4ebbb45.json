{"paperId": "c43e75cbbf06a51a128ed41e5558db19f4ebbb45", "abstract": "The quadratic complexity of the attention module makes it gradually become the bulk of compute in Transformer-based LLMs during generation. Moreover, the excessive key-value cache that arises when dealing with long inputs also brings severe issues on memory footprint and inference latency. In this work, we propose a plug-and-play approach that is able to incrementally compress the intermediate activation of a specified span of tokens into compact ones, thereby reducing both memory and computational cost when processing subsequent context. Experiments on both in-domain language modeling and zero-shot open-ended document generation demonstrate the advantage of our approach over sparse attention baselines in terms of fluency, n-gram matching, and semantic similarity. At last, we comprehensively profile the benefit of context compression on improving the system throughout. Code is available at https://github.com/DRSY/KV_Compression.", "venue": "Conference on Empirical Methods in Natural Language Processing", "year": 2023, "citationCount": 8, "influentialCitationCount": 1, "openAccessPdf": {"url": "https://arxiv.org/pdf/2310.08152", "status": "CLOSED"}, "tldr": {"model": "tldr@v2.0.0", "text": "This work proposes a plug-and-play approach that is able to incrementally compress the intermediate activation of a specified span of tokens into compact ones, thereby reducing both memory and computational cost when processing subsequent context."}, "embedding": {"model": "specter_v2", "vector": [0.41043224930763245, 0.574667751789093, -0.16126593947410583, 0.1518559753894806, -0.44797417521476746, -0.4261632561683655, 0.7766043543815613, 0.042976684868335724, -0.046999864280223846, -0.0649467185139656, 0.6674341559410095, -0.1805088222026825, 0.33839020133018494, -0.28025636076927185, -0.06409074366092682, 0.0862794816493988, -0.6510932445526123, 0.233804389834404, 0.0024758221115916967, -0.5312200784683228, -0.018417146056890488, -0.9736425876617432, -1.1334033012390137, 0.3267022669315338, 0.7117684483528137, 0.41599273681640625, 0.23562133312225342, 0.771377444267273, -0.7549794316291809, 0.46997272968292236, 0.3451463282108307, -0.5155379772186279, 0.16460679471492767, -0.02930455468595028, -0.39507484436035156, -0.27680498361587524, 0.2904402017593384, -0.18876495957374573, -0.10342830419540405, 0.403046190738678, -0.04998652637004852, 0.25152161717414856, 0.35173559188842773, -0.6121782064437866, -0.552011251449585, 1.3250356912612915, 0.6416394710540771, 0.6013906002044678, -0.03870517387986183, -0.5500403642654419, 1.5774624347686768, -1.5940663814544678, 0.24475078284740448, 1.2238166332244873, 0.32406219840049744, 0.44005993008613586, -0.09025969356298447, -0.12117693573236465, 0.9356018304824829, 0.2457578033208847, -0.9164302349090576, -0.4363171458244324, 0.2491166740655899, 0.11364375799894333, 2.020299196243286, -0.07124855369329453, 0.4418708384037018, 0.6680572032928467, -0.19418887794017792, 1.35132896900177, -0.2976533770561218, -1.034502387046814, 0.03433828800916672, -0.0949169397354126, -0.05466252937912941, 0.9019293785095215, -0.3854038119316101, 0.15483973920345306, -0.714353621006012, -0.1280849725008011, 0.5292397141456604, -0.03257892653346062, 0.19683437049388885, -0.3167060911655426, -0.2440318614244461, 0.5263855457305908, -0.10061512142419815, 0.9554076790809631, -0.1766798049211502, 0.6756386756896973, 0.6129990220069885, 0.3174301087856293, 0.10097953677177429, 0.4695403575897217, 0.006474485620856285, 0.2029326856136322, -1.1636592149734497, 0.6461182236671448, -0.14150772988796234, 0.7305340766906738, -0.3263450860977173, 0.5986838340759277, -1.3343297243118286, 0.30851590633392334, 1.075506567955017, 0.18178261816501617, 0.5896390080451965, -0.8901242613792419, 0.2234232872724533, -0.7131709456443787, 0.04686335474252701, -0.3698000907897949, 0.6214293837547302, -0.165236234664917, -0.5077459812164307, -1.3405476808547974, -0.52211993932724, 0.06471558660268784, -0.9528892636299133, 0.8417954444885254, -0.3233463168144226, 0.4145375192165375, 0.2344028502702713, 0.4420050084590912, 0.23352162539958954, 0.45505791902542114, 0.22957684099674225, -0.0866176038980484, 0.7592478394508362, -0.6748834252357483, -0.5840774178504944, -1.1724917888641357, 0.5551179051399231, -0.2804737985134125, 0.5017553567886353, -0.15752120316028595, -1.655963659286499, -0.7884737253189087, -0.8881881237030029, -0.024906745180487633, -0.5258373618125916, 0.06675072759389877, 1.0402584075927734, 0.5439373254776001, -1.3263368606567383, 0.6973388195037842, -0.11664485186338425, 0.04567832127213478, 0.1434013545513153, 0.11325684934854507, 0.5590147376060486, -0.4489597678184509, -1.80461585521698, -0.0002933279611170292, -0.1524263173341751, -0.7249879240989685, -0.13950982689857483, -0.8879173994064331, -1.3083149194717407, 0.0437716580927372, 0.6010616421699524, -0.6035911440849304, 1.4659206867218018, 0.07519327849149704, -1.390053629875183, 0.3276363015174866, -0.4779953956604004, 0.17075790464878082, -0.15273728966712952, -0.2701990604400635, -0.2779693305492401, -0.46139028668403625, 0.07576733827590942, 0.43117043375968933, 0.6784823536872864, 0.009017462842166424, -0.2004052847623825, 0.16538658738136292, -0.11279591917991638, 0.21832552552223206, 0.009778933599591255, 0.5720203518867493, -0.46164289116859436, -0.31227076053619385, 0.31129470467567444, 0.8635798692703247, -0.2915223240852356, -0.8259093165397644, -0.283365398645401, -1.036954402923584, 0.6360908150672913, -0.06190600246191025, 1.3594828844070435, -0.5193551778793335, -0.8376172780990601, -0.13044233620166779, -0.30910560488700867, -0.10566017776727676, -0.7518496513366699, 0.7225704789161682, -0.4661814570426941, 0.4188346266746521, -0.06593328714370728, -0.8657280802726746, 0.14273017644882202, -0.46157535910606384, -1.1713377237319946, -0.7648586630821228, 0.1356022208929062, 1.1677926778793335, -1.0192729234695435, -0.058265313506126404, 0.05393125116825104, 0.30785006284713745, -0.9824703931808472, 1.1346310377120972, -0.4973292648792267, -0.11774473637342453, -0.016227902844548225, 0.09227924048900604, -0.2717050611972809, -0.051361482590436935, 0.5556057691574097, -0.17788530886173248, -0.08118420094251633, 0.6047564148902893, -0.32676365971565247, 1.4691892862319946, -0.5314140915870667, 0.26483583450317383, -0.466696172952652, -0.5115289688110352, 0.20310737192630768, 0.6980672478675842, -0.20882239937782288, -0.3281171917915344, -0.04711969569325447, 0.5016947984695435, -0.5212354063987732, 0.4635374844074249, 1.2059739828109741, 0.8786265850067139, -0.6710396409034729, 0.024921294301748276, 0.6184303164482117, -0.4564644396305084, 0.7588161826133728, 0.6462745666503906, 0.7395079731941223, 0.4920065701007843, 0.40433332324028015, 0.10412970185279846, 0.6527777910232544, -0.7095296382904053, -0.03398294746875763, 0.5893442630767822, 0.9921633005142212, 0.8458024263381958, 0.4610779881477356, -0.5131505131721497, -0.5142232179641724, 0.18682895600795746, 1.0684927701950073, 1.5023105144500732, -0.18142616748809814, -0.6686826348304749, -1.0187525749206543, -0.2460191249847412, -0.5929924845695496, 0.5348630547523499, -0.13734693825244904, -0.10862648487091064, -0.6359238028526306, -0.5355620384216309, 0.9328194856643677, 0.563659131526947, 0.7857987880706787, -0.40432485938072205, -0.14148595929145813, -0.13798777759075165, -0.009609641507267952, -0.6785074472427368, -0.6586586236953735, 0.18966782093048096, -0.3067878782749176, -0.054288458079099655, 0.04761699214577675, -0.13440898060798645, 0.09337948262691498, -0.7199063301086426, 0.924258828163147, -0.3754402697086334, -0.468437522649765, 0.2853010296821594, 0.4883190989494324, -0.46501293778419495, -0.6720877885818481, 0.14469347894191742, -0.0538763701915741, -0.541741132736206, 0.5758851170539856, 0.2925104796886444, -0.1463652104139328, -0.28084656596183777, -0.1052849292755127, 0.02336793579161167, -0.13133619725704193, -0.03195821866393089, 0.798883855342865, -0.664696991443634, -0.3146406412124634, -1.0374785661697388, 1.045989990234375, 0.2998013198375702, -0.55837082862854, 0.3804321885108948, -0.8155297040939331, -0.3637666404247284, 0.7788716554641724, -0.49914801120758057, -0.40417227149009705, -1.0199815034866333, 0.3870624899864197, -0.4633871018886566, -0.11754200607538223, 0.10675867646932602, 0.034134116023778915, 0.5758417248725891, 0.1584431231021881, 0.7199105024337769, 0.06636060029268265, 0.1667713224887848, 1.2145365476608276, -0.9571802616119385, 0.5246923565864563, -0.13371756672859192, 0.07401704043149948, -0.37047091126441956, -0.03971637785434723, -0.29231345653533936, -0.0646214559674263, -0.1555916666984558, -0.060283251106739044, -0.26574572920799255, 0.07914528995752335, -0.6840847134590149, -0.6842336058616638, -0.22434940934181213, -1.2251948118209839, -0.3026907742023468, -0.25485938787460327, -0.7124792337417603, -0.26507389545440674, -0.7600591778755188, -1.133445143699646, -0.6779496669769287, -0.7501679062843323, -0.9007527828216553, 0.5106204748153687, -0.3066777288913727, -0.4028271734714508, -0.587275505065918, 0.2818432152271271, -0.4671315848827362, 0.9457880258560181, -0.6715025901794434, 0.8768810629844666, -0.08758053928613663, -0.5285416841506958, -0.09561917185783386, 0.7229023575782776, 0.26754122972488403, -0.047976054251194, 0.2129049003124237, -0.7386133670806885, 0.30396324396133423, -0.35352665185928345, -0.13379794359207153, 0.15089051425457, 0.4516763687133789, 0.625482976436615, -0.16047930717468262, -0.6563273072242737, 0.23828591406345367, 1.3835628032684326, -0.2946593165397644, 0.2580149173736572, -0.1273825615644455, 0.8745701909065247, 0.1672583967447281, 0.20656514167785645, 0.5903534293174744, 0.19521160423755646, 0.4394947290420532, 0.17637349665164948, -0.12416297942399979, 0.0667349323630333, -0.48082435131073, 0.8121022582054138, 1.6880695819854736, -0.11119044572114944, -0.11633023619651794, -0.997234046459198, 0.9117850661277771, -1.2549716234207153, -0.8905568718910217, 0.7672900557518005, 0.6126509308815002, 0.5161733031272888, -0.8168894052505493, -0.5376026034355164, 0.025042755529284477, 0.6514347195625305, 0.6259365081787109, -0.01613025553524494, -0.9459091424942017, 0.22794166207313538, 0.7188958525657654, -0.030019981786608696, 0.8397371172904968, -0.11566874384880066, 0.9773388504981995, 14.825204849243164, 0.9728211164474487, 0.055608563125133514, 0.42092910408973694, 0.7714425325393677, 0.03282836824655533, -0.6746606230735779, 0.1150735393166542, -1.146628737449646, -0.3218598961830139, 1.1139898300170898, -0.17417724430561066, 0.6076079607009888, 0.46873366832733154, -0.05767565593123436, 0.45781272649765015, -0.6768028140068054, 0.3093319237232208, 0.5664132833480835, -1.5408679246902466, 0.48159974813461304, 0.16116566956043243, 0.3639587461948395, 0.08003261685371399, 0.8589894771575928, 1.021852731704712, 0.5395814180374146, -0.3818141520023346, 0.4176766276359558, 0.0454234778881073, 1.2779077291488647, -0.3238039016723633, 0.24460238218307495, 0.08084641396999359, -1.0639864206314087, -0.26685380935668945, -0.7105780839920044, -1.0336190462112427, 0.16447599232196808, 0.11676008254289627, -1.0123010873794556, -0.34462985396385193, -0.48363015055656433, 0.322501003742218, 0.2428620159626007, -0.10085505992174149, -0.43852701783180237, 0.7159909605979919, 0.2768250107765198, 0.06941217184066772, 0.2361512929201126, 0.18869395554065704, 0.3363964557647705, -0.05516092851758003, 0.6034981608390808, 0.052945252507925034, -0.0753173828125, 0.7026720643043518, -0.27015432715415955, -0.03386058285832405, -0.5835769772529602, -0.30650395154953003, 0.29593625664711, 0.8021653890609741, 0.4982556998729706, 0.14474351704120636, -0.34502536058425903, 0.3118411898612976, 0.44177740812301636, 0.1010025292634964, -0.33835458755493164, -0.40036875009536743, 0.48692160844802856, -0.13469788432121277, 0.3751596510410309, 0.768206775188446, -0.14056456089019775, -0.42985156178474426, -0.8507250547409058, -0.458259642124176, 0.1381365805864334, -0.7761088609695435, -0.46463561058044434, 0.8706287145614624, -0.1070171445608139, -0.4953731596469879, -0.5605048537254333, -0.4535863995552063, -0.5489422082901001, 0.42061516642570496, -1.2108290195465088, -0.7931039929389954, 0.425700843334198, -0.24091404676437378, -0.19085639715194702, -0.3086744248867035, 1.3171486854553223, -0.1922079473733902, -0.04560008645057678, 0.13569922745227814, -0.10569053143262863, -0.20750579237937927, -0.224636510014534, -1.0443320274353027, 1.0977752208709717, 0.6755443215370178, 0.06403814256191254, 0.6479368209838867, -0.0687534362077713, -0.017976684495806694, -0.6639491319656372, -0.22952401638031006, 0.9710311889648438, -0.7488064765930176, -0.7196269631385803, -1.0921680927276611, -0.7716735601425171, 0.18452195823192596, 0.851967990398407, -0.44374966621398926, 0.38662660121917725, 0.18931375443935394, -0.2176026850938797, -0.18266431987285614, -0.7279000282287598, 0.4369420111179352, 0.675171971321106, -0.792233943939209, -0.3038322925567627, -0.30394643545150757, 0.7034191489219666, -1.1956114768981934, -0.3355460464954376, -0.28407809138298035, -0.10219579935073853, -0.06371399760246277, 1.1171438694000244, -0.14741866290569305, 0.8873905539512634, 0.7149845957756042, -0.11824232339859009, -0.7745693922042847, -0.28364282846450806, -1.082431674003601, -0.14822939038276672, 0.5905380249023438, 0.5617072582244873, -0.050889816135168076, 0.24779199063777924, 0.9152567982673645, 0.2043638825416565, -0.521733283996582, -0.4647150933742523, -0.021736687049269676, 0.11838899552822113, -0.7592872381210327, 0.9058524370193481, -0.18708835542201996, 0.3158438503742218, 0.17185071110725403, 0.6669119000434875, 0.4491688907146454, -0.4536215364933014, -0.6961979866027832, 0.05126131698489189, 0.3288670778274536, 0.14293675124645233, -0.31440213322639465, -0.2756110429763794, -0.9957176446914673, -0.14939408004283905, -0.9936151504516602, 0.12217950075864792, -1.0253539085388184, -0.6403603553771973, 0.08911866694688797, -0.4777403771877289, 0.15894538164138794, 0.16982191801071167, -0.3951031267642975, -0.4607437551021576, -0.9354099631309509, -0.5173817873001099, 0.7577524781227112, 0.33988088369369507, -0.7828402519226074, 0.0183175727725029, -0.16969160735607147, -0.2188270092010498, 0.011780246160924435, 0.3387513756752014, -0.16665507853031158, -1.203242540359497, -1.168782114982605, 0.4880813658237457, 0.17651742696762085, -0.19320474565029144, -0.5924335718154907, 0.42059236764907837, 0.2834933400154114, -0.053389616310596466, -0.08300470560789108, 0.3223743736743927, -0.5043309330940247, -0.5060122013092041, 0.011546923778951168, -0.7918928861618042, 0.28673332929611206, 0.06758289784193039, -0.8037638068199158, -0.3518126904964447, 0.6765190958976746, -0.39701327681541443, -1.3091148138046265, -0.7930231094360352, 0.46094822883605957, -0.7190032005310059, 0.18725690245628357, -0.42266014218330383, -0.2649940550327301, -1.021673560142517, -0.3945595622062683, 0.1754022240638733, 0.09998730570077896, -0.27606603503227234, 1.0415964126586914, 0.7523623108863831, -1.169244408607483, 0.15723346173763275, 0.4493274986743927, -0.32432323694229126, -0.07214712351560593, 0.4072265923023224, 0.2918235957622528, 0.09040310978889465, 0.5952949523925781, 0.3233533203601837, 0.3488614559173584, -1.0328871011734009, -0.0725153461098671, 0.5487760901451111, -0.8851950764656067, 0.11777384579181671, 0.9962950944900513, -0.5698804259300232, -0.7488254904747009, -0.2864045798778534, -1.3326605558395386, -0.5822060704231262, -0.5836291909217834, 0.5607768297195435, 0.27295106649398804, 0.05373619124293327, 0.16820301115512848, -0.5793891549110413, -1.7512109479866922e-05, -0.23663224279880524, -0.9172115921974182, 0.37705695629119873, -0.0619111992418766, -0.4657263159751892, 0.3215259611606598, 0.15625682473182678, -0.277636855840683, -0.36484354734420776, -0.3466010093688965, -0.6092515587806702, -0.16633723676204681, 0.28898218274116516, -0.3977282643318176, -0.3175583779811859, 0.8911213874816895, 0.30501869320869446, 0.33754128217697144, -0.04512355104088783, -0.23837663233280182, 0.31545835733413696, 0.5049136281013489, 0.10741155594587326, -0.9950207471847534, -0.37116119265556335, 1.3665082454681396, 1.1519405841827393, -0.4616367518901825, 0.17112964391708374, -0.15930716693401337, -0.9862102270126343, 0.7127865552902222, 0.4886353015899658, 0.14689041674137115, 0.23902301490306854, -0.019070744514465332, 0.14343520998954773, 0.37614381313323975, -1.558078646659851, -0.4302922189235687, 0.505104660987854, 1.5578333139419556, 0.9282970428466797, -0.04323001205921173, 0.08784113079309464, 1.2338650226593018, 0.20646746456623077, 0.154859259724617, 0.48877811431884766, 0.29220348596572876, -0.07255854457616806, -0.4705885946750641, -0.021100759506225586, 0.5586382150650024, -0.8728640675544739, -1.1363534927368164, 0.17334945499897003, 0.43882864713668823, 0.28430992364883423, 0.6602644920349121, 0.9000494480133057, 0.13822467625141144, 0.3472256660461426, 0.4809250831604004, 0.6746634840965271, -0.5873380303382874, -0.35326066613197327, -0.059483520686626434, -0.748972475528717, -0.22357210516929626, 0.1918291449546814, -0.5998111367225647, -0.48789554834365845, 0.13335394859313965, 0.3637022078037262, 0.13101358711719513, 0.2162773311138153, 1.012178659439087, 0.7422387599945068, 0.5394419431686401, -0.19601912796497345, -0.23089343309402466, -0.461886465549469, -0.6758151054382324, 0.22664795815944672, -0.3099226653575897, -0.44341620802879333, 0.0263748187571764, 0.30962952971458435, -0.18641844391822815]}, "authors": [{"authorId": "1642328639", "name": "Siyu Ren"}, {"authorId": "2056108122", "name": "Qi Jia"}, {"authorId": "2256992964", "name": "Kenny Q. Zhu"}], "references": [{"paperId": "b9870e130f61ff900fe00dbcc5782c9b31773d32", "title": "Learning to Compress Prompts with Gist Tokens"}, {"paperId": "be55e8ec4213868db08f2c3168ae666001bea4b8", "title": "Pythia: A Suite for Analyzing Large Language Models Across Training and Scaling"}, {"paperId": "57e849d0de13ed5f91d086936296721d4ff75a75", "title": "LLaMA: Open and Efficient Foundation Language Models"}, {"paperId": "13a0d8bb38f739990c8cd65a44061c6534f17221", "title": "OPT: Open Pre-trained Transformer Language Models"}, {"paperId": "a8ca46b171467ceb2d7652fbfb67fe701ad86092", "title": "LoRA: Low-Rank Adaptation of Large Language Models"}, {"paperId": "66c10bf1f11bc1b2d92204d8f8391d087f6de1c4", "title": "RoFormer: Enhanced Transformer with Rotary Position Embedding"}, {"paperId": "4a54d58a4b20e4f3af25cea3c188a12082a95e02", "title": "Transformer Feed-Forward Layers Are Key-Value Memories"}, {"paperId": "044e13d7dd4e0655eb76f0bd00b2c1bdb44e2be3", "title": "Big Bird: Transformers for Longer Sequences"}, {"paperId": "6f68e1bb253925d8431588555d3010419f322e04", "title": "Transformers are RNNs: Fast Autoregressive Transformers with Linear Attention"}, {"paperId": "925ad2897d1b5decbea320d07e99afa9110e09b2", "title": "Longformer: The Long-Document Transformer"}, {"paperId": "055fd6a9f7293269f1b22c1470e63bd02d8d9500", "title": "Reformer: The Efficient Transformer"}, {"paperId": "6c4b76232bb72897685d19b3d264c6ee3005bc2b", "title": "Exploring the Limits of Transfer Learning with a Unified Text-to-Text Transformer"}, {"paperId": "c95383f251a62c63217586059c67f63507c3e839", "title": "HuggingFace's Transformers: State-of-the-art Natural Language Processing"}, {"paperId": "21da617a0f79aabf94272107184606cefe90ab75", "title": "Generating Long Sequences with Sparse Transformers"}, {"paperId": "cf4aa38ae31b43fd07abe13b4ffdb265babb7be1", "title": "The Curious Case of Neural Text Degeneration"}, {"paperId": "295065d942abca0711300b2b4c39829551060578", "title": "BERTScore: Evaluating Text Generation with BERT"}, {"paperId": "29de7c0fb3c09eaf55b20619bceaeafe72fd87a6", "title": "Hierarchical Neural Story Generation"}, {"paperId": "45dfef0cc1ed96558c1c650432ce39d6a1050b6a", "title": "Fixing Weight Decay Regularization in Adam"}, {"paperId": "204e3073870fae3d05bcbc2f6a8e263d9b72e776", "title": "Attention is All you Need"}, {"paperId": "efbd381493bb9636f489b965a2034d529cd56bcd", "title": "Pointer Sentinel Mixture Models"}, {"paperId": "60b05f32c32519a809f21642ef1eb3eaf3848008", "title": "ROUGE: A Package for Automatic Evaluation of Summaries"}, {"paperId": null, "title": "2020) library and all experiments are conducted using a single RTX 3090 GPU. Open-ended Document Generation For openended document generation, we use nucleus"}, {"paperId": "df2b0e26d0599ce3e70df8a9da02e51594e0e992", "title": "BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding"}, {"paperId": "9405cc0d6169988371b2755e573cc28650d14dfe", "title": "Language Models are Unsupervised Multitask Learners"}, {"paperId": null, "title": "2017) optimizer with a 2e-5 learning rate. The batch size is set to 12 and the maximum sequence length during training is set to 256 due to the limited computation budget"}, {"paperId": null, "title": "Together Computer. 2023. Redpajama: An open source recipe to reproduce llama training dataset"}]}