{"paperId": "2dfb9171e180dcb0af23d305e024d43d311708ab", "abstract": "Modern large language models (LLMs) that rely on attention mechanisms are typically trained with fixed context lengths which enforce upper limits on the length of input sequences that they can handle at evaluation time. To use these models on sequences longer than the train-time context length, one might employ techniques from the growing family of context length extrapolation methods -- most of which focus on modifying the system of positional encodings used in the attention mechanism to indicate where tokens or activations are located in the input sequence. We conduct a wide survey of existing methods of context length extrapolation on a base LLaMA or LLaMA 2 model, and introduce some of our own design as well -- in particular, a new truncation strategy for modifying the basis for the position encoding. We test these methods using three new evaluation tasks (FreeFormQA, AlteredNumericQA, and LongChat-Lines) as well as perplexity, which we find to be less fine-grained as a measure of long context performance of LLMs. We release the three tasks publicly as datasets on HuggingFace. We discover that linear scaling is the best method for extending context length, and show that further gains can be achieved by using longer scales at evaluation time. We also discover promising extrapolation capabilities in the truncated basis. To support further research in this area, we release three new 13B parameter long-context models which we call Giraffe: 4k and 16k context models trained from base LLaMA-13B, and a 32k context model trained from base LLaMA2-13B. We also release the code to replicate our results.", "venue": "arXiv.org", "year": 2023, "citationCount": 22, "influentialCitationCount": 3, "openAccessPdf": {"url": "https://arxiv.org/pdf/2308.10882", "status": "CLOSED"}, "tldr": {"model": "tldr@v2.0.0", "text": "It is discovered that linear scaling is the best method for extending context length, and further gains can be achieved by using longer scales at evaluation time."}, "embedding": {"model": "specter_v2", "vector": [0.1141347736120224, 0.2791023254394531, -0.13591957092285156, -0.5022031664848328, -0.31683871150016785, -0.2884332239627838, 0.47789445519447327, -0.28343144059181213, -0.7538649439811707, -0.11401767283678055, 0.8898562788963318, 0.040648359805345535, 0.7718392610549927, 0.20756758749485016, -0.14557142555713654, -0.08679914474487305, -1.0702587366104126, -0.2557842433452606, -0.2827644348144531, -0.3711913526058197, -0.10720180720090866, -0.5753772854804993, -0.7592532634735107, 0.6347048878669739, 0.039010606706142426, 0.34793394804000854, 0.2645208537578583, 1.2635234594345093, -0.6649821996688843, 0.1673104166984558, 0.17988355457782745, -0.37507566809654236, 0.31175076961517334, -0.2590482234954834, -0.3219432532787323, -0.4077838063240051, 0.6147489547729492, -0.5506250262260437, -0.3384208083152771, 0.3561597168445587, -0.029742585495114326, 0.47583869099617004, 0.005446161143481731, -0.48472702503204346, -0.16313260793685913, 1.0792194604873657, 0.5177384614944458, 0.6640159487724304, 0.010485358536243439, -0.355612188577652, 1.5413768291473389, -1.4907656908035278, 0.3378945291042328, 1.6431419849395752, 0.6329458355903625, 0.32772088050842285, -0.1629926711320877, -0.2845805883407593, 1.0692386627197266, 0.307317852973938, -0.4997875690460205, -0.40570390224456787, 0.008760998025536537, 0.15339167416095734, 1.8414359092712402, -0.14957650005817413, 0.1825305074453354, 0.9267690181732178, -0.061567436903715134, 1.4549740552902222, -0.31039583683013916, -1.3097585439682007, -0.2710954248905182, -0.2987164556980133, 0.3520434498786926, 0.3588721752166748, -0.7638587951660156, 0.39359068870544434, -0.5938068628311157, -0.33765119314193726, 0.4681631624698639, -0.24335497617721558, 0.367952436208725, 0.22757843136787415, -0.49604904651641846, 0.6140028834342957, 0.4291815161705017, 0.9658281803131104, -0.1357109099626541, 0.965147078037262, 0.5504440665245056, 0.13818296790122986, -0.1211681142449379, 0.08681908249855042, -0.12142067402601242, 0.204633891582489, -0.8973836898803711, 0.3911885917186737, -0.13534539937973022, 0.8673476576805115, -0.3137074410915375, 0.16569042205810547, -0.9077062010765076, 0.397169828414917, 1.2814010381698608, -0.22774918377399445, 0.37261611223220825, -0.9337536096572876, 0.2714955508708954, -0.8437640070915222, 0.025962214916944504, -0.23601286113262177, -0.19718562066555023, -0.23046629130840302, -0.2915831208229065, -1.0679998397827148, 0.03243528679013252, -0.1944032609462738, -0.38616546988487244, 1.0565927028656006, -0.11800138652324677, 0.3321533501148224, 0.09909273684024811, 0.567279040813446, 0.23004919290542603, 0.8627523183822632, 0.5012221336364746, 0.21286918222904205, 0.6963368654251099, -1.005565881729126, -0.5168145895004272, -0.9893574714660645, 0.8804011344909668, -0.28083232045173645, 0.8210674524307251, -0.13260671496391296, -1.0198150873184204, -0.8820757269859314, -0.9896551966667175, -0.3263053894042969, -0.5489956140518188, 0.4087078273296356, 1.0286691188812256, 0.29836076498031616, -0.9181141257286072, 0.8216453790664673, -0.16816328465938568, -0.10393933206796646, 0.07963267713785172, -0.15185412764549255, 0.15130861103534698, -0.48269739747047424, -1.5119363069534302, -0.04808300733566284, 0.31509217619895935, -0.3145885467529297, 0.3870760202407837, -0.4197467565536499, -1.1534377336502075, -0.13252310454845428, 0.3110807538032532, -0.2574484944343567, 1.3991177082061768, -0.3561915159225464, -1.045613408088684, 0.4453519582748413, -0.20246605575084686, 0.20532596111297607, 0.26643484830856323, -0.5512398481369019, -0.7245407700538635, -0.7723991870880127, -0.4847072660923004, 0.8816975951194763, 0.1982044130563736, 0.04204941168427467, -0.20804153382778168, 0.07061056047677994, -0.1094214990735054, 0.0671972706913948, -0.09107428044080734, 0.7975595593452454, -0.25929054617881775, -0.4860941171646118, 0.18155954778194427, 0.5215238928794861, -0.028586773201823235, -0.29134616255760193, -0.21575629711151123, -0.866529107093811, 0.8077046275138855, -0.01711960695683956, 1.340399980545044, -0.8980252742767334, -0.8784967660903931, -0.3488364517688751, -0.7559635639190674, -0.19761483371257782, -1.0423674583435059, 0.6654180884361267, -0.1847396194934845, 0.19240082800388336, -0.3150636553764343, -1.1549222469329834, 0.03227037936449051, 0.06676172465085983, -0.5928049087524414, -0.23756979405879974, -0.028665004298090935, 1.1717901229858398, -1.0431649684906006, -0.023079203441739082, -0.20392586290836334, 0.38322341442108154, -0.9737189412117004, 0.9982780814170837, -0.7775925993919373, 0.12334049493074417, 0.32077834010124207, -0.008426271378993988, -0.16940751671791077, -0.03454902023077011, 0.3362671136856079, 0.10757455229759216, -0.1553724855184555, 0.4863766133785248, -0.5415170788764954, 1.7886672019958496, -0.4559628665447235, 0.6126863360404968, 0.033861350268125534, -0.16581366956233978, -0.07501739263534546, 0.14544270932674408, -0.4136037826538086, 0.01796542853116989, -0.07459559291601181, 0.32797354459762573, -0.466766357421875, 0.1744583249092102, 0.9084843993186951, 1.022031307220459, -0.484384685754776, -0.09887075424194336, 0.3646048605442047, 0.13833686709403992, 0.26725664734840393, 0.42148450016975403, 0.3900034725666046, 0.8876689076423645, 0.4757997989654541, 0.041844937950372696, 0.2617532014846802, -0.9478663802146912, -0.11597637832164764, 0.4015752673149109, 0.589156448841095, 0.8187824487686157, 0.39308351278305054, -0.7333230376243591, -0.6558594107627869, 0.14127221703529358, 0.5407411456108093, 1.8903248310089111, -0.3483826220035553, -0.16835090517997742, -0.7999424934387207, -0.3160463869571686, -0.17931726574897766, 0.19515185058116913, -0.48816463351249695, 0.2793912887573242, -0.9416638612747192, -0.6368971467018127, 0.892101526260376, 0.5166693329811096, 0.5724713206291199, -1.0546565055847168, -0.2549414336681366, 0.001232022070325911, 0.1918620765209198, -0.6301181316375732, -0.9423287510871887, 0.060892585664987564, -0.5748772025108337, 0.16863448917865753, 0.07054028660058975, -0.10394136607646942, -0.29643312096595764, -0.9923590421676636, 0.9717993140220642, -0.38553616404533386, -0.29867565631866455, -0.03606512397527695, 0.19408008456230164, -0.5131785273551941, -0.637046754360199, 0.3389606475830078, 0.06643179059028625, -0.3034537136554718, 0.4121132493019104, 0.46925002336502075, -0.1450508087873459, -0.21741977334022522, -0.4468371570110321, 0.10130517929792404, 0.3598363995552063, 0.09663596004247665, 0.8090276718139648, -1.1030170917510986, 0.44527769088745117, -1.2219494581222534, 0.7372605204582214, 0.2963545024394989, -0.32509568333625793, 0.2084077149629593, -0.45354607701301575, -0.37835538387298584, 0.2731434106826782, -0.7122645974159241, -0.22601915895938873, -0.7066152095794678, -0.14277595281600952, -0.32035550475120544, -0.6181623339653015, 0.1384841799736023, -0.02018464356660843, 0.5734327435493469, 0.3792515695095062, 0.053914111107587814, 0.16839243471622467, -0.2779403626918793, 1.0739448070526123, -0.5749846696853638, 0.8392388820648193, 0.04480262100696564, -0.6716829538345337, -0.24051126837730408, -0.16045205295085907, -0.8745154142379761, -0.17758873105049133, -0.5353025197982788, -0.5018567442893982, -0.1536439061164856, 0.08374238014221191, -0.20210856199264526, -0.7242059111595154, -0.06307706981897354, -1.0192562341690063, -0.3951880633831024, 0.07785207778215408, -0.283195823431015, -0.2562504708766937, -0.8079095482826233, -1.2963083982467651, -0.5809134244918823, -0.5827820897102356, -0.7496188282966614, 0.39362990856170654, -0.036022212356328964, -0.5324621200561523, -0.5790150165557861, 0.19163833558559418, -0.6916046142578125, 0.7898542881011963, -0.28188154101371765, 0.622639000415802, 0.1984679251909256, -0.048882219940423965, -0.27151036262512207, 0.6900733709335327, 0.5730962157249451, -0.2614873945713043, 0.3797553777694702, -0.9843789935112, 0.3194034695625305, -0.4208828806877136, -0.1795460283756256, 0.34585583209991455, 0.43826165795326233, 0.5698596835136414, -0.2522388994693756, -0.3724321722984314, 0.33897635340690613, 1.2006752490997314, -0.5359865427017212, 0.26408302783966064, -0.0020546959713101387, 0.7158879041671753, 0.334250271320343, 0.005295068025588989, 0.7321119904518127, -0.162591814994812, 0.30135706067085266, 0.23091363906860352, 0.23858830332756042, -0.2232617288827896, -0.5930885076522827, 0.6524111032485962, 1.2796276807785034, 0.4842625558376312, 0.0490005761384964, -0.9747886657714844, 0.5755210518836975, -1.3587925434112549, -0.876254677772522, 0.7390949130058289, 0.6690168976783752, 0.6159667372703552, -0.5884004235267639, -0.15020707249641418, -0.36229634284973145, 0.2550397217273712, 0.4457409679889679, -0.4537694454193115, -0.8453759551048279, -0.25848057866096497, 0.035331398248672485, -0.3881951868534088, 0.9503428936004639, -0.5052265524864197, 0.6920963525772095, 15.125600814819336, 0.6669867634773254, -0.08653595298528671, 0.3864078223705292, 1.0492408275604248, -0.2637092173099518, -0.3404374420642853, -0.028938118368387222, -1.3510123491287231, 0.04584610089659691, 1.198240876197815, 0.6170985102653503, 0.7391886115074158, 0.14148513972759247, 0.08415031433105469, -0.0006227738340385258, -0.8627727627754211, 0.7357811331748962, 0.4457106590270996, -1.1135746240615845, 0.04172643646597862, -0.06426231563091278, 0.3562057912349701, 0.35442832112312317, 0.6448199152946472, 0.7580538988113403, 0.08804145455360413, -0.3529810607433319, 0.5844078660011292, 0.5206317901611328, 1.0294994115829468, -0.14132583141326904, 0.3132952153682709, 0.24847063422203064, -0.6327298283576965, -0.4254114329814911, -0.5204864144325256, -1.1260790824890137, 0.275566428899765, 0.053052376955747604, -0.58826744556427, -0.44662392139434814, -0.2274329960346222, 0.3731769323348999, 0.01898764632642269, 0.38962361216545105, -0.1805526167154312, 0.6917645335197449, 0.034793999046087265, -0.17950445413589478, 0.699378252029419, 0.19164322316646576, 0.531426191329956, 0.5123642683029175, 0.004352806601673365, 0.21543101966381073, 0.1290862113237381, 0.3736925423145294, -0.5324259996414185, 0.30979761481285095, -0.239604651927948, -0.2254733443260193, -0.060322657227516174, 0.8798744082450867, 0.6565799713134766, 0.2258063554763794, -0.3955080807209015, 0.3740447461605072, 0.5782352685928345, 0.3453851640224457, -0.17018626630306244, -0.306686133146286, 0.573200523853302, -0.4432682693004608, -0.02641068398952484, 0.29386594891548157, -0.3327551782131195, -0.3072746694087982, -0.5741641521453857, -0.15157002210617065, 0.531604528427124, -0.846032977104187, -0.6677884459495544, 0.844173014163971, -0.15587258338928223, -0.27780961990356445, -0.16720101237297058, -0.9230400919914246, -0.2683877944946289, 0.7190456986427307, -1.0952025651931763, -0.6453575491905212, 0.2503151297569275, -0.5360415577888489, -0.1461394727230072, 0.19619204103946686, 1.196688175201416, -0.03958888724446297, -0.256902813911438, 0.1786208599805832, 0.19554917514324188, 0.13660281896591187, 0.24470505118370056, -0.9486565589904785, 0.9216364622116089, 0.37687915563583374, 0.06521078199148178, 0.21088920533657074, -0.13215841352939606, 0.24865823984146118, -0.3148272633552551, 0.10282614827156067, 0.5740123987197876, -0.9727088212966919, -0.5768712759017944, -0.961064338684082, -0.8682326674461365, 0.43859046697616577, 0.7166207432746887, -0.1442275047302246, 0.4923713803291321, 0.2428293526172638, -0.5533850789070129, -0.2124210149049759, -0.550415575504303, 0.19408532977104187, 0.6802735328674316, -0.5760644674301147, -0.32819461822509766, -0.34265533089637756, 0.7123273015022278, -1.1006330251693726, -0.3598456382751465, -0.39800015091896057, 0.3460102677345276, -0.14244341850280762, 0.7902093529701233, -0.761587381362915, 0.7319389581680298, 0.9664583802223206, -0.5853499174118042, -0.7830249667167664, 0.007949459366500378, -0.8394111394882202, -0.13982194662094116, 0.16903235018253326, 0.6552214026451111, -0.19790537655353546, 0.1853523999452591, 0.5701408982276917, 0.09220541268587112, -0.9353706240653992, -0.5967320203781128, -0.31581056118011475, 0.47114139795303345, -0.6658080816268921, 0.5746139883995056, -0.04340266436338425, 0.1313275396823883, 0.217251256108284, 0.6057741641998291, 0.34831109642982483, -0.6036151647567749, -0.5852169990539551, 0.1415870189666748, 0.2599448263645172, -0.32568880915641785, -0.6955470442771912, -0.5309808850288391, -1.3923768997192383, -0.06771568208932877, -0.8004199862480164, -0.03286039084196091, -0.5644314289093018, -0.6372803449630737, -0.12790775299072266, -0.2984575033187866, 0.3656570017337799, 0.08012815564870834, -0.64206862449646, -0.3634454309940338, -0.7406285405158997, -0.37081286311149597, 0.6284642815589905, 0.606430172920227, -0.42058679461479187, -0.1434818059206009, -0.1061113178730011, 0.27040520310401917, 0.03585775941610336, 0.4816860556602478, 0.11854654550552368, -0.6596793532371521, -1.389529824256897, 0.48360422253608704, -0.11676531285047531, -0.13175684213638306, -0.7424206137657166, 0.28694865107536316, 0.22746846079826355, 0.24507752060890198, -0.2017960250377655, 0.41473907232284546, -0.5623307228088379, -0.6463058590888977, 0.0023033323232084513, -0.9507403373718262, 0.37958553433418274, 0.398325651884079, -0.6342473030090332, 0.006645828951150179, 0.40892720222473145, -0.27222877740859985, -0.9898874759674072, -1.1003390550613403, 0.19929787516593933, -0.19708916544914246, 0.03716277703642845, -0.41128987073898315, 0.026859214529395103, -0.9142857789993286, -0.35611414909362793, -0.3131861090660095, 0.23192264139652252, -0.16915446519851685, 1.181747555732727, 0.41721856594085693, -1.2632334232330322, -0.07246831059455872, 0.22396408021450043, -0.06472090631723404, 0.10920482873916626, 0.6176053285598755, 0.3158103823661804, -0.2939591705799103, 0.43341580033302307, 0.19282802939414978, 0.1834699660539627, -1.1324018239974976, 0.053466860204935074, 0.6550268530845642, -0.2512649893760681, -0.11478433758020401, 1.2621052265167236, -0.5198869705200195, -0.952754020690918, 0.2650977075099945, -1.4383453130722046, -0.2595106363296509, -0.3340144753456116, 0.9382453560829163, 0.28891894221305847, 0.15818987786769867, -0.20153141021728516, -0.46781373023986816, -0.17201708257198334, -0.11055000126361847, -0.7559780478477478, 0.3426145613193512, -0.1380482167005539, -0.19304804503917694, 0.8717228770256042, 0.8632706999778748, -0.39934152364730835, -1.0364832878112793, -0.5215327739715576, -0.26798444986343384, -0.2469378411769867, -0.06758387386798859, -0.7145160436630249, -0.016317307949066162, 0.9245734214782715, 0.4010956585407257, -0.007172984071075916, -0.020439809188246727, -0.06631147861480713, 0.24602638185024261, 0.8085047006607056, -0.12136593461036682, -0.7331531643867493, -0.5056102275848389, 1.3802661895751953, 1.6639745235443115, -0.7397490739822388, 0.06554146111011505, 0.0270797461271286, -0.6137074828147888, 0.7369381189346313, 0.5211514234542847, 0.07261908799409866, 0.7131105661392212, -0.18103954195976257, 0.4015112519264221, 0.6016607880592346, -0.9715081453323364, 0.1553366780281067, 0.6331358551979065, 0.7470075488090515, 0.9551582932472229, 0.4597046673297882, 0.010314756073057652, 1.071284532546997, -0.12163877487182617, -0.2503913640975952, 0.3471029996871948, 0.7056393623352051, -0.060858990997076035, -0.3834231197834015, -0.23718062043190002, 0.4804064631462097, -0.5996957421302795, -0.6148841381072998, 0.011897945776581764, 0.5787888169288635, 0.3511747717857361, 0.4071827232837677, 0.8954596519470215, 0.3546993136405945, 0.5049057006835938, 0.6956098675727844, 0.6511837244033813, -0.3931143283843994, -0.32626721262931824, -0.01865965873003006, -0.6808347702026367, -0.4128069281578064, 0.18654309213161469, -0.9548723697662354, -0.5255974531173706, -0.15053515136241913, 0.38752928376197815, -0.3090035915374756, 0.2754942774772644, 0.9313545823097229, 0.7589641809463501, 0.32960495352745056, -0.5399938225746155, -0.6149002909660339, -0.4732685089111328, -1.3254354000091553, 0.035855572670698166, -0.2963433265686035, -0.08970589190721512, 0.19870193302631378, 0.31140652298927307, -0.11551015079021454]}, "authors": [{"authorId": "3422676", "name": "Arka Pal"}, {"authorId": "1740653882", "name": "Deep Karkhanis"}, {"authorId": "2179329459", "name": "Manley Roberts"}, {"authorId": "2066631240", "name": "Samuel Dooley"}, {"authorId": "2064292137", "name": "Arvind Sundararajan"}, {"authorId": "2060450397", "name": "Siddartha Naidu"}], "references": [{"paperId": "104b0bb1da562d53cbda87aec79ef6a2827d191a", "title": "Llama 2: Open Foundation and Fine-Tuned Chat Models"}, {"paperId": "1733eb7792f7a43dd21f51f4d1017a1bffd217b5", "title": "Lost in the Middle: How Language Models Use Long Contexts"}, {"paperId": "f5afaccfe90268485a9961c5771ec5e71e9b806c", "title": "Extending Context Window of Large Language Models via Positional Interpolation"}, {"paperId": "a0a79dad89857a96f8f71b14238e5237cbfc4787", "title": "Judging LLM-as-a-judge with MT-Bench and Chatbot Arena"}, {"paperId": "af385c0fdd0eda2bbf429bea6fedffc327c8a180", "title": "Randomized Positional Encodings Boost Length Generalization of Transformers"}, {"paperId": "57e849d0de13ed5f91d086936296721d4ff75a75", "title": "LLaMA: Open and Efficient Foundation Language Models"}, {"paperId": "9ca329408813d209b1dcb36936f7f9cba82506bd", "title": "Train Short, Test Long: Attention with Linear Biases Enables Input Length Extrapolation"}, {"paperId": "acbdbf49f9bc3f151b93d9ca9a06009f4f6eb269", "title": "Evaluating Large Language Models Trained on Code"}, {"paperId": "a8ca46b171467ceb2d7652fbfb67fe701ad86092", "title": "LoRA: Low-Rank Adaptation of Large Language Models"}, {"paperId": "66c10bf1f11bc1b2d92204d8f8391d087f6de1c4", "title": "RoFormer: Enhanced Transformer with Rotary Position Embedding"}, {"paperId": "db1afe3b3cd4cd90e41fbba65d3075dd5aebb61e", "title": "The Pile: An 800GB Dataset of Diverse Text for Language Modeling"}, {"paperId": "6b989b8327db3a7212141c59c1569f0219775058", "title": "How Neural Networks Extrapolate: From Feedforward to Graph Neural Networks"}, {"paperId": "814a4f680b9ba6baba23b93499f4b48af1a27678", "title": "Measuring Massive Multitask Language Understanding"}, {"paperId": "17dbd7b72029181327732e4d11b52a08ed4630d0", "title": "Natural Questions: A Benchmark for Question Answering Research"}, {"paperId": "f82cb5c1ab74176f1b2d38fe9410c612ea76008b", "title": "Things"}, {"paperId": "c8efcc854d97dfc2a42b83316a2109f9d166e43f", "title": "Self-Attention with Relative Position Representations"}, {"paperId": null, "title": "Attention is all you need, 2023"}, {"paperId": null, "title": "Together Computer"}, {"paperId": null, "title": "How long can open-source llms truly promise on context length"}, {"paperId": null, "title": "A length-extrapolatable transformer, 2022"}, {"paperId": null, "title": "Alon Benhaim, Vishrav Chaudhary, Xia Song, and Furu Wei. A length-extrapolatable transformer"}, {"paperId": null, "title": "A little retrieval test for large language models, May 2023"}, {"paperId": null, "title": "Armand"}, {"paperId": null, "title": "Section 5 of the main text, we found that instruction-fine-tuning with the Vicuna dataset did improve accuracies on LongChat-Lines, but did not change the span of non-zero contexts for a given model"}, {"paperId": null, "title": "Redpajama: An open source recipe to reproduce llama training dataset"}]}