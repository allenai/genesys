{"paperId": "d7b3e795d657ccf1562053f47ce1ff81044fc2a0", "abstract": "Self-attention and position embedding are two key modules in Transformer based LLMs. The potential relationship among them are far from well studied, especially for context window extending. In this paper, we introduce collinear constrained relationship to fuse RoPE and self-attention, and name it as Collinear Constrained Attention (CoCA). We\u2019ve analyzed the computational and spatial complexity of CoCA and have determined that it adds only minimal additional overhead compared to the original Transformer-based models. We provide an efficient implementation of CoCA, and make it drop-in replacement for any existing position embedding and attention modules in Transformer based models. Experiments show that CoCA performs extraordinary well on context window extending. For instance, a CoCA based GPT model trained with 512 context length can extend the context window up to 8K without perplexity diverging. This indicates more than 16x context window extending without any fine-tuning. Our code is released here: https://github.com/codefuse-ai/Collinear-Constrained-Attention", "venue": "", "year": null, "citationCount": 0, "influentialCitationCount": 0, "openAccessPdf": null, "tldr": {"model": "tldr@v2.0.0", "text": "This paper introduces collinear constrained relationship to fuse RoPE and self-attention, and name it as Collinear Constrained Attention (CoCA), and analyzes the computational and spatial complexity of CoCA to determine that it adds only minimal additional overhead compared to the original Transformer-based models."}, "embedding": {"model": "specter_v2", "vector": [0.49682143330574036, 0.7594202160835266, -0.5450032353401184, 0.025771696120500565, -0.4161722958087921, -0.2548666000366211, 0.528839111328125, -0.30290159583091736, -0.4513533115386963, -0.3511207103729248, 0.5091044306755066, 0.2474360466003418, 0.5754014253616333, 0.0023987155873328447, -0.12303698062896729, -0.07612324506044388, -0.8644626140594482, -0.1853429675102234, 0.4416924715042114, -0.5576456189155579, 0.06470562517642975, -0.6691949963569641, -0.8485408425331116, 0.33846914768218994, 0.6311749219894409, 0.8091992139816284, 0.6765070557594299, 0.9284979104995728, -0.39736753702163696, 0.12442633509635925, 0.3409072756767273, -0.2902655601501465, 0.13523203134536743, 0.12170889228582382, 0.16777437925338745, -0.22515493631362915, 0.4150216281414032, -0.030675332993268967, -0.5195613503456116, 0.6862048506736755, -0.08610383421182632, 0.17383185029029846, -0.15825380384922028, -0.9579212665557861, -0.5218883752822876, 0.7205219864845276, 0.5381860136985779, 0.7350091934204102, -0.46126019954681396, -0.8152875304222107, 1.5942416191101074, -1.4120290279388428, 0.21126282215118408, 1.4036821126937866, 0.47395676374435425, 0.46326255798339844, -0.08842410892248154, -0.37513819336891174, 1.0780903100967407, 0.352044016122818, -0.40502747893333435, -0.22735780477523804, 0.33120131492614746, 0.2901478707790375, 2.083573579788208, -0.3005306124687195, 0.2690650224685669, 0.7376714944839478, 0.4178774058818817, 1.3960391283035278, -0.10664664953947067, -1.1547815799713135, -0.399578720331192, 0.2855904996395111, 0.2342672049999237, 0.8287205696105957, -0.756706953048706, 0.39622774720191956, -0.6664291024208069, -0.20722457766532898, 0.38381531834602356, 0.06597361713647842, 0.2572972774505615, -0.15563878417015076, -0.28330087661743164, 0.61980801820755, 0.5976906418800354, 0.9000856280326843, 0.2637372314929962, 1.0205990076065063, 0.33182233572006226, 0.010866557247936726, 0.06955860555171967, 0.2501600980758667, -0.23688708245754242, 0.5820193886756897, -0.9384760856628418, 0.23299551010131836, -0.47381794452667236, 1.2041840553283691, -0.3042243421077728, 0.005620442796498537, -0.8182228207588196, 0.14167363941669464, 1.2400829792022705, 0.20971445739269257, 0.5945470333099365, -0.7062302231788635, 0.21100251376628876, -0.4422374665737152, -0.2904161810874939, -0.7630137801170349, 0.06725873798131943, -0.48912563920021057, -0.3818429410457611, -1.193861484527588, -0.6187534332275391, 0.09594497084617615, -0.7601032257080078, 0.8533730506896973, -0.30868685245513916, 0.19819067418575287, -0.14979225397109985, -0.050943948328495026, 0.21348826587200165, 0.6271855235099792, 0.27451568841934204, 0.16039621829986572, 0.9438106417655945, -1.330424427986145, -0.7405129075050354, -1.1269654035568237, 0.5431686639785767, -0.24532634019851685, 0.4071439206600189, -0.2511140704154968, -0.910950243473053, -0.9617927670478821, -1.2710126638412476, -0.26239001750946045, -0.8132584691047668, 0.37105080485343933, 0.8352152109146118, 0.5094491243362427, -0.9957367777824402, 0.8961856365203857, -0.43505334854125977, -0.2839876711368561, 0.5065726041793823, 0.08593274652957916, 0.21901485323905945, -0.16961650550365448, -1.6249737739562988, 0.21719323098659515, 0.3875770568847656, -0.33265504240989685, 0.034983329474925995, -0.7319878339767456, -0.9150295853614807, 0.2208697348833084, 0.7806376218795776, -0.26989346742630005, 1.0069853067398071, -0.4178366959095001, -1.0029635429382324, 0.47899022698402405, -0.466743528842926, -0.10188062489032745, 0.27152374386787415, -0.33759766817092896, -0.7963548898696899, -0.5335800051689148, -0.0775611400604248, 0.7413054704666138, 0.77129727602005, 0.027255989611148834, -0.6631475687026978, -0.05508037656545639, -0.22623369097709656, 0.23211924731731415, -0.43480291962623596, 0.8791795372962952, -0.6504380106925964, -0.3296540379524231, 0.3064342141151428, 0.4111156165599823, 0.014393792487680912, 0.14333222806453705, -0.1107332706451416, -1.1161407232284546, 1.1458877325057983, 0.4904254376888275, 1.215226173400879, -0.9486868381500244, -0.7640923857688904, -0.2951940596103668, -0.08214367181062698, -0.23207804560661316, -0.9547479152679443, 0.47495636343955994, -0.5360989570617676, 0.3025922477245331, 0.1315390020608902, -0.9973727464675903, 0.272984117269516, -0.09506690502166748, -0.7616686820983887, -0.5205130577087402, 0.17515748739242554, 1.2087552547454834, -0.8502347469329834, -0.12536020576953888, -0.33633074164390564, 0.4777860939502716, -0.9928808212280273, 0.9561474323272705, -0.6279497742652893, -0.19993019104003906, -0.02231857366859913, -0.06389778852462769, -0.3327852189540863, -0.22213415801525116, 0.42287930846214294, -0.2627338767051697, -0.021462516859173775, 0.32395482063293457, -0.29136109352111816, 1.4179701805114746, -0.3617771565914154, 0.8242734670639038, -0.17860770225524902, -0.20871871709823608, 0.2572360932826996, 0.15918706357479095, -0.20560424029827118, -0.31086021661758423, 0.09627394378185272, 0.23874151706695557, -0.6126023530960083, 0.19814707338809967, 0.9108585715293884, 0.997557520866394, -0.19686859846115112, -0.2127062976360321, 0.3739003837108612, -0.10795154422521591, 0.009702769108116627, 0.36139020323753357, 0.3039134442806244, 0.785986065864563, 0.46479326486587524, -0.2767906188964844, 0.17080681025981903, -0.8463287949562073, 0.15657363831996918, 0.3347682058811188, 0.20164066553115845, 0.7337892055511475, 0.7166305184364319, -0.5682626962661743, -0.5190379023551941, 0.317135751247406, 0.35928356647491455, 1.78024160861969, -0.48571500182151794, -0.2721579074859619, -0.6981892585754395, -0.4114950895309448, -0.33394888043403625, -0.04764814302325249, -0.6767840385437012, -0.1065271645784378, -0.5511767268180847, -1.0779345035552979, 0.5694004893302917, 0.582589864730835, 1.0769881010055542, -0.48188474774360657, -0.5383061170578003, 0.04971944913268089, 0.17818434536457062, -1.1119675636291504, -1.0495375394821167, 0.5708045959472656, -0.5314232707023621, -0.1605469137430191, 0.12051208317279816, -0.23481297492980957, -0.03239027410745621, -0.75291508436203, 0.4854109287261963, -0.5812229514122009, -0.10351604223251343, 0.2302924245595932, 0.20027746260166168, -0.9146445393562317, -0.09868830442428589, 0.6650652885437012, 0.11624039709568024, -0.0998164564371109, 0.5485522150993347, 0.533647894859314, -0.1992301344871521, 0.0892120897769928, -0.20878274738788605, 0.027981948107481003, -0.0056716869585216045, 0.055563297122716904, 0.7784952521324158, -0.21654421091079712, 0.18424394726753235, -1.2727513313293457, 0.7695491909980774, 0.3765615224838257, -0.4147297441959381, 0.23708884418010712, -0.8133199214935303, -0.5950669646263123, 0.008457929827272892, -0.8469771146774292, -0.1093534305691719, -0.8629533052444458, 0.38310346007347107, -0.29331398010253906, -0.024356745183467865, -0.013986966572701931, -0.1369093358516693, 0.19012483954429626, 0.3381434381008148, 0.2709086537361145, 0.10755368322134018, 0.3317822813987732, 0.708562970161438, -0.9541261196136475, 0.5755048394203186, 0.06994055211544037, -0.07019784301519394, -0.124234139919281, -0.052862752228975296, -0.6465582251548767, -0.4602319896221161, -0.16278178989887238, -0.6776043176651001, -0.0892932340502739, 0.446557879447937, -0.41207054257392883, -0.6359676122665405, -0.2156180739402771, -0.6213754415512085, -0.2405330240726471, 0.1329837590456009, -0.6419474482536316, -0.11443129181861877, -1.1686996221542358, -0.7170326709747314, -0.43274083733558655, -0.6172502636909485, -0.9729164242744446, 0.4000686705112457, 0.19897058606147766, -0.07765594124794006, -0.9566109776496887, -0.21199661493301392, -0.642122745513916, 1.2546569108963013, -0.08600760996341705, 0.7585164904594421, -0.15803398191928864, -0.4164429306983948, -0.546352744102478, 0.1783718317747116, 0.5151613354682922, -0.0046075256541371346, 0.13171786069869995, -1.142762541770935, 0.2798299193382263, -0.14240971207618713, 0.24228288233280182, 0.3283461928367615, 0.306849867105484, 0.8001956343650818, 0.18075378239154816, -1.0554753541946411, 0.5820651054382324, 1.480425477027893, -0.30264437198638916, 0.39841365814208984, 0.27444759011268616, 0.8813892006874084, 0.07590445876121521, 0.0277988463640213, 0.16228684782981873, 0.39284849166870117, 0.464712917804718, 0.3033563196659088, -0.10161789506673813, 0.08029647916555405, -0.704203188419342, 0.47341418266296387, 1.1096234321594238, 0.2949356138706207, 0.03218989074230194, -0.9240439534187317, 0.6522326469421387, -1.2151939868927002, -0.679672360420227, 0.9243603348731995, 0.39174750447273254, 0.17601360380649567, -0.16885130107402802, -0.4910605251789093, -0.23646613955497742, 0.43355414271354675, 0.5568440556526184, -0.6049728989601135, -0.48756033182144165, -0.13251271843910217, 0.33007267117500305, 0.06975222378969193, 1.0092905759811401, -0.6199033856391907, 0.8938573598861694, 14.926061630249023, 0.725655198097229, -0.08882907778024673, 0.42603418231010437, 0.644925057888031, 0.21131977438926697, -0.14760027825832367, 0.02951209433376789, -1.4591079950332642, -0.021542629227042198, 0.9089171290397644, 0.30684328079223633, 0.32447707653045654, 0.17211587727069855, -0.09331018477678299, 0.3226032853126526, -0.7740849852561951, 0.517198383808136, 0.8345019817352295, -1.0289733409881592, -0.18557767570018768, 0.24356971681118011, 0.3000601828098297, 0.4311946928501129, 0.9873239398002625, 0.8046018481254578, 0.26672497391700745, -0.2951745390892029, 0.2858469784259796, 0.41404950618743896, 1.0012356042861938, 0.022500844672322273, 0.14810621738433838, 0.11599623411893845, -0.9782595634460449, -0.5204616785049438, -0.869477391242981, -0.8878426551818848, -0.1181187778711319, 0.17055833339691162, -0.031089521944522858, -0.5130783319473267, 0.01334535051137209, 0.7684273719787598, -0.10219601541757584, 0.1122656986117363, -0.23972682654857635, 0.13595470786094666, 0.1453123837709427, -0.09299168735742569, 0.5307119488716125, 0.6139596104621887, 0.4215218126773834, -0.1614057570695877, 0.34824487566947937, 0.1591472327709198, 0.15912112593650818, 0.4633099436759949, -0.42130354046821594, -0.12214135378599167, -0.06905827671289444, -0.016836339607834816, -0.021311352029442787, 1.1743659973144531, 0.5951645374298096, 0.3689773976802826, -0.2991389334201813, 0.47267940640449524, 0.46697500348091125, 0.3502436876296997, -0.8286794424057007, -0.39108869433403015, 0.37591925263404846, -0.21620652079582214, 0.18322628736495972, 0.5481281876564026, 0.11573439091444016, -0.7013512849807739, -0.7159969806671143, -0.19029603898525238, 0.16189514100551605, -0.854068398475647, -0.44531798362731934, 1.2293864488601685, -0.27411481738090515, -0.4533056914806366, 0.44042688608169556, -1.0689525604248047, -0.5426142811775208, 0.408121794462204, -1.7445167303085327, -0.913928747177124, 0.2680666148662567, -0.4230925738811493, -0.3491705060005188, -0.16264985501766205, 1.0057363510131836, 0.03277554363012314, -0.5598946213722229, 0.2828117609024048, -0.1417284458875656, -0.10984302312135696, 0.19286999106407166, -1.1007601022720337, 0.9598836302757263, 0.14181755483150482, -0.20088648796081543, 0.1876491755247116, -0.247979536652565, 0.3144761323928833, -0.42231065034866333, -0.15514102578163147, 0.7345421314239502, -1.127327561378479, -0.15962490439414978, -1.0340707302093506, -0.7022480368614197, 0.6014337539672852, 0.9889734387397766, 0.03146878629922867, 0.36747002601623535, 0.054992496967315674, -0.41629886627197266, -0.4279061257839203, -0.6868860721588135, 0.20917145907878876, 0.5231350660324097, -0.5755771994590759, -0.2912851870059967, -0.2220296859741211, 0.7111185193061829, -1.205908179283142, -0.6869140863418579, -0.26186344027519226, 0.22292231023311615, -0.07254689931869507, 1.0145772695541382, -0.3150610327720642, 0.6176449060440063, 0.9917274117469788, -0.5369243621826172, -0.6866081357002258, -0.12812259793281555, -0.8919523358345032, -0.028650106862187386, 0.42676395177841187, 0.7163944244384766, -0.5910488367080688, 0.4457647502422333, 0.7997636198997498, 0.29433900117874146, -0.9549387693405151, -0.3152746558189392, -0.2017931342124939, 0.5964304804801941, -0.5997032523155212, 0.671772837638855, 0.14697617292404175, 0.11651989817619324, -0.03317832946777344, 0.5293357372283936, 0.5353123545646667, -0.19602558016777039, -0.7373198866844177, -0.015323769301176071, -0.2067004293203354, -0.04045161232352257, -0.4784597158432007, -0.488932341337204, -1.4944170713424683, -0.047857169061899185, -1.2866929769515991, -0.29756131768226624, -0.7240192294120789, -0.46839383244514465, -0.1219581738114357, -0.48321273922920227, 0.1367661952972412, -0.1059693694114685, -0.4401343762874603, -0.1269240826368332, -0.7134571671485901, -0.21039973199367523, 0.7905720472335815, 1.0094977617263794, -0.5612589120864868, 0.15696769952774048, -0.10779347270727158, -0.2870360016822815, 0.19687531888484955, 0.4665980041027069, -0.29137763381004333, -0.7799817323684692, -1.2780678272247314, 0.5070112347602844, -0.27763816714286804, -0.185991108417511, -0.6836837530136108, 0.8302364945411682, 0.3830355405807495, 0.2393103390932083, -0.018502037972211838, 0.4340357482433319, -1.1212759017944336, -1.0063835382461548, 0.061433423310518265, -0.750292181968689, 0.39316636323928833, 0.3440192639827728, -0.31881600618362427, -0.1681351661682129, 0.7071473598480225, -0.1160757839679718, -0.9952076077461243, -0.8810924291610718, 0.5529797077178955, -0.3414897620677948, 0.03813978284597397, -0.12461050599813461, -0.2620300054550171, -1.4439055919647217, -0.17812347412109375, -0.41058337688446045, 0.6500881910324097, -0.3997534215450287, 1.1485044956207275, 0.31845518946647644, -1.5012059211730957, 0.23515459895133972, 0.4610885977745056, 0.016873769462108612, -0.09206262975931168, 0.4042828679084778, 0.2586285173892975, -0.19214610755443573, 0.7116848230361938, 0.2544652223587036, 0.12182706594467163, -0.9433690905570984, 0.2858900725841522, 0.9215186238288879, -0.4978369176387787, -0.1252952665090561, 1.0295002460479736, -0.22063030302524567, -1.1282873153686523, 0.2772237956523895, -1.4532476663589478, -0.511357843875885, -0.056112729012966156, 0.594916820526123, 0.1947472244501114, -0.37307456135749817, -0.01628868281841278, -0.547421395778656, 0.543770968914032, -0.10888434201478958, -0.5874523520469666, 0.4292319118976593, -0.18037785589694977, -0.32899224758148193, 0.44939860701560974, 0.8509026765823364, -0.7161364555358887, -0.9969937801361084, -0.8731812834739685, -0.22644895315170288, -0.3256550431251526, 0.27174708247184753, -0.3308268189430237, -0.46317359805107117, 0.7918602824211121, 0.8875030875205994, 0.3227737843990326, 0.29758352041244507, -0.3195798397064209, 0.046523142606019974, 0.5999293327331543, -0.05310812592506409, -0.6454511880874634, -0.1949356645345688, 1.1477190256118774, 1.3466688394546509, -0.8401265144348145, 0.1941530853509903, -0.27905893325805664, -0.792080283164978, 0.7798837423324585, 0.533698320388794, -0.19243715703487396, 1.0872372388839722, -0.16390953958034515, 0.19632521271705627, 0.5706139206886292, -1.3984417915344238, -0.15035869181156158, 0.8624964356422424, 1.1924188137054443, 0.6145934462547302, 0.057935930788517, 0.377429723739624, 0.6861351728439331, -0.08525370061397552, -0.3244110941886902, 0.26854050159454346, 0.30644452571868896, -0.35794904828071594, -0.41787734627723694, -0.16690963506698608, 0.4411277770996094, -0.8007862567901611, -0.5205678939819336, 0.19369831681251526, 0.6751424670219421, 0.3681698441505432, 0.6600147485733032, 0.8964377045631409, 0.1395004540681839, 0.5376774668693542, 0.37918078899383545, 0.5481665730476379, -0.4814574718475342, -0.22732676565647125, 0.0905570238828659, -0.9926339983940125, -0.2734127342700958, 0.021911028772592545, -0.7504211664199829, -0.2584493160247803, 0.29442471265792847, 0.14783093333244324, -0.5084891319274902, 0.3332473337650299, 0.6366010904312134, 0.5793559551239014, 0.9603435397148132, -0.2861025035381317, -0.25473278760910034, 0.09458103775978088, -0.9483437538146973, 0.235884889960289, -0.9134682416915894, -0.08629437536001205, 0.09390009194612503, 0.1284996122121811, -0.3766286373138428]}, "authors": [{"authorId": "2243808364", "name": "Shiyi Zhu"}, {"authorId": "2260831276", "name": "Jingting Ye"}, {"authorId": "2243775310", "name": "Wei Jiang"}, {"authorId": "2256972664", "name": "Qi Zhang"}, {"authorId": "2243304520", "name": "Yifan Wu"}, {"authorId": "2223080664", "name": "Jianguo Li"}], "references": [{"paperId": "b069c32fcd77160f944ab3ba71ab6f0cfb782c68", "title": "Focused Transformer: Contrastive Training for Context Scaling"}, {"paperId": "f5afaccfe90268485a9961c5771ec5e71e9b806c", "title": "Extending Context Window of Large Language Models via Positional Interpolation"}, {"paperId": "60b35c6d68acced19b0c66edcfc0ee0a2c11efed", "title": "Landmark Attention: Random-Access Infinite Context Length for Transformers"}, {"paperId": "a0e7c31d723608e03f30fc92ffc2a604a7a039da", "title": "PyTorch FSDP: Experiences on Scaling Fully Sharded Data Parallel"}, {"paperId": "57e849d0de13ed5f91d086936296721d4ff75a75", "title": "LLaMA: Open and Efficient Foundation Language Models"}, {"paperId": "9575afb5702bc33d7df14c48feeee5901ea00369", "title": "A Length-Extrapolatable Transformer"}, {"paperId": "d6c5aab433d9871cabc01ffb1e5e1ea89141155b", "title": "KERPLE: Kernelized Relative Positional Embedding for Length Extrapolation"}, {"paperId": "e37018d3cfab9cfc29a7b78404e6c86ea18a907e", "title": "GPT-NeoX-20B: An Open-Source Autoregressive Language Model"}, {"paperId": "9ca329408813d209b1dcb36936f7f9cba82506bd", "title": "Train Short, Test Long: Attention with Linear Biases Enables Input Length Extrapolation"}, {"paperId": "66c10bf1f11bc1b2d92204d8f8391d087f6de1c4", "title": "RoFormer: Enhanced Transformer with Rotary Position Embedding"}, {"paperId": "50796b0f3edf9cb5ff1e447c298b33755378aa4f", "title": "GLM: General Language Model Pretraining with Autoregressive Blank Infilling"}, {"paperId": "db1afe3b3cd4cd90e41fbba65d3075dd5aebb61e", "title": "The Pile: An 800GB Dataset of Diverse Text for Language Modeling"}, {"paperId": "3c8a456509e6c0805354bd40a35e3f2dbf8069b1", "title": "PyTorch: An Imperative Style, High-Performance Deep Learning Library"}, {"paperId": "f51497f463566581874c941353dd9d80069c5b77", "title": "Compressive Transformers for Long-Range Sequence Modelling"}, {"paperId": "d3ecb512bc5c91fccfb50003b5094ad1e043b5bb", "title": "opt\\_einsum - A Python package for optimizing contraction order for einsum-like expressions"}, {"paperId": "45dfef0cc1ed96558c1c650432ce39d6a1050b6a", "title": "Fixing Weight Decay Regularization in Adam"}, {"paperId": "204e3073870fae3d05bcbc2f6a8e263d9b72e776", "title": "Attention is All you Need"}, {"paperId": "df2b0e26d0599ce3e70df8a9da02e51594e0e992", "title": "BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding"}, {"paperId": null, "title": "bloc97. Ntk-aware scaled rope allows llama models to have extended (8k+) context size without any fine-tuning and minimal perplexity degradation"}, {"paperId": null, "title": "Fusing position embedding with Collinear Constrained Attention"}]}