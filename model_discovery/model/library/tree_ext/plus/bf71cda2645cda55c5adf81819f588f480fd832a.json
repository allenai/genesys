{
    "paperId": "bf71cda2645cda55c5adf81819f588f480fd832a",
    "externalIds": {
        "ArXiv": "2408.04093",
        "CorpusId": 271769078
    },
    "title": "Tree Attention: Topology-aware Decoding for Long-Context Attention on GPU clusters",
    "abstract": "Self-attention is the core mathematical operation of modern transformer architectures and is also a significant computational bottleneck due to its quadratic complexity in the sequence length. In this work, we derive the scalar energy function whose gradient computes the self-attention block, thus elucidating the theoretical underpinnings of self-attention, providing a Bayesian interpretation of the operation and linking it closely with energy-based models such as Hopfield Networks. Our formulation reveals that the reduction across the sequence axis can be efficiently computed in parallel through a tree reduction. Our algorithm, for parallelizing attention computation across multiple GPUs enables cross-device decoding to be performed asymptotically faster (up to 8x faster in our experiments) than alternative approaches such as Ring Attention, while also requiring significantly less communication volume and incurring 2x less peak memory. Our code is publicly available here: \\url{https://github.com/Zyphra/tree_attention}.",
    "venue": "",
    "year": 2024,
    "referenceCount": 11,
    "citationCount": 0,
    "influentialCitationCount": 0,
    "openAccessPdf": null,
    "tldr": {
        "model": "tldr@v2.0.0",
        "text": "This work derives the scalar energy function whose gradient computes the self-attention block, thus elucidating the theoretical underpinnings of self-attention, providing a Bayesian interpretation of the operation and linking it closely with energy-based models such as Hopfield Networks."
    },
    "embedding": {
        "model": "specter_v1",
        "vector": [
            -4.124392032623291,
            -0.15103769302368164,
            1.0659534931182861,
            4.635083198547363,
            0.32884538173675537,
            1.742438793182373,
            3.0712811946868896,
            1.5576870441436768,
            1.1758067607879639,
            -1.3418062925338745,
            -0.07094642519950867,
            2.1491916179656982,
            1.1867154836654663,
            -1.008580207824707,
            -4.1430253982543945,
            -0.889104425907135,
            -3.169130563735962,
            0.8856985569000244,
            6.5993146896362305,
            1.6168591976165771,
            -0.7298072576522827,
            -1.559483289718628,
            -2.9509711265563965,
            -0.4435290992259979,
            0.318606972694397,
            0.9073156714439392,
            1.3622297048568726,
            -0.9388008713722229,
            -1.8266257047653198,
            1.6931686401367188,
            -1.4262712001800537,
            -5.526474952697754,
            7.84472131729126,
            -3.469364881515503,
            5.531287670135498,
            -2.2457454204559326,
            -5.262418270111084,
            5.236235618591309,
            -3.27862548828125,
            -1.9956297874450684,
            2.9841160774230957,
            0.574885368347168,
            -0.6483539342880249,
            1.1185545921325684,
            -1.4645425081253052,
            3.9791741371154785,
            0.327356219291687,
            3.590634346008301,
            -0.7598013281822205,
            4.2317399978637695,
            2.8636627197265625,
            0.5072687268257141,
            -0.7853331565856934,
            1.2650679349899292,
            -2.097773551940918,
            -1.718585729598999,
            4.112720489501953,
            -0.3653950095176697,
            2.4116897583007812,
            -1.1938356161117554,
            4.533230781555176,
            2.511286973953247,
            1.2397899627685547,
            1.5975143909454346,
            3.2534899711608887,
            0.292751282453537,
            -0.8823581337928772,
            7.664597511291504,
            1.9092800617218018,
            0.2730790376663208,
            -1.1100049018859863,
            -5.421395301818848,
            4.170389652252197,
            -2.6855649948120117,
            -5.8682966232299805,
            1.102394938468933,
            -1.0335602760314941,
            -4.584534645080566,
            1.406644344329834,
            -5.462142467498779,
            -0.660232663154602,
            3.509540319442749,
            0.5827316045761108,
            1.5090017318725586,
            3.601792097091675,
            -2.308518648147583,
            -2.3970541954040527,
            -0.4886147379875183,
            1.3151369094848633,
            -1.4564080238342285,
            1.0132132768630981,
            2.0610642433166504,
            0.2761746644973755,
            1.1754275560379028,
            -5.354583740234375,
            -1.3496793508529663,
            2.1687049865722656,
            0.555535078048706,
            -2.766066312789917,
            0.5199987292289734,
            1.3302578926086426,
            -1.7290118932724,
            1.1641490459442139,
            -2.538912296295166,
            1.3619647026062012,
            -4.761898517608643,
            -2.4798293113708496,
            2.5870702266693115,
            -1.9130191802978516,
            -0.8739843368530273,
            -4.11075496673584,
            0.7752338647842407,
            0.762738049030304,
            -1.4899168014526367,
            -3.326263666152954,
            -4.876899719238281,
            -0.9300664067268372,
            -1.8684483766555786,
            -0.9582197070121765,
            2.7428832054138184,
            -1.1287281513214111,
            0.7912440299987793,
            -1.8779493570327759,
            0.3656708002090454,
            2.8201351165771484,
            0.15686368942260742,
            -1.4494386911392212,
            -0.7690175771713257,
            0.7569296360015869,
            -5.093915939331055,
            -0.5555561780929565,
            -0.5465490221977234,
            0.1699746549129486,
            -0.4823990762233734,
            1.1281428337097168,
            -0.6515535116195679,
            -1.9956727027893066,
            0.6804113388061523,
            -3.510866403579712,
            1.840122103691101,
            0.02383582293987274,
            2.0109970569610596,
            1.517775535583496,
            -0.33632299304008484,
            0.49803608655929565,
            3.7036986351013184,
            1.7465676069259644,
            5.874220848083496,
            2.283297061920166,
            4.889394760131836,
            3.868481159210205,
            -4.423064231872559,
            -0.5111517310142517,
            4.529433250427246,
            1.7254836559295654,
            3.629059314727783,
            -2.4550909996032715,
            0.7897883653640747,
            -0.6284323930740356,
            0.8231908082962036,
            -0.7891845703125,
            -0.9501967430114746,
            -8.747214317321777,
            -2.2454211711883545,
            1.5767712593078613,
            -4.365099906921387,
            -4.84058952331543,
            1.0434776544570923,
            -2.433255672454834,
            5.222426414489746,
            -0.7838953733444214,
            3.002476215362549,
            2.3970162868499756,
            5.320141315460205,
            6.4232635498046875,
            4.582465648651123,
            0.5200538039207458,
            -3.3231256008148193,
            -0.6873396635055542,
            1.8205796480178833,
            -0.7048840522766113,
            1.090857982635498,
            -5.705007076263428,
            2.220834970474243,
            -5.288177967071533,
            -2.983699321746826,
            -2.3118855953216553,
            0.10297209024429321,
            -1.6217427253723145,
            -0.6650987267494202,
            3.3272838592529297,
            -2.2031068801879883,
            5.323805809020996,
            6.170873641967773,
            2.4865546226501465,
            -4.235898494720459,
            2.57769775390625,
            -0.2609437108039856,
            -0.9065195322036743,
            0.6290823817253113,
            0.6617043018341064,
            2.4632277488708496,
            0.21422278881072998,
            0.8947649598121643,
            0.9069494605064392,
            1.1783599853515625,
            -0.8481808304786682,
            3.8424925804138184,
            0.5719142556190491,
            -0.0834057629108429,
            0.44505107402801514,
            1.7068228721618652,
            -0.364430695772171,
            2.058598041534424,
            -4.691610336303711,
            -4.286041259765625,
            -5.823353290557861,
            1.2184085845947266,
            2.7121169567108154,
            -0.4172794818878174,
            1.734209656715393,
            -1.7822456359863281,
            -2.073869466781616,
            -3.8617358207702637,
            1.8244340419769287,
            1.211174488067627,
            2.6532697677612305,
            2.9836483001708984,
            1.7772634029388428,
            1.915758728981018,
            -1.5541834831237793,
            -6.198816299438477,
            0.9952541589736938,
            -2.0816760063171387,
            -3.6333866119384766,
            -2.245755910873413,
            -1.5538668632507324,
            -2.1558871269226074,
            1.0511775016784668,
            -0.4515976011753082,
            5.622895240783691,
            1.9031356573104858,
            1.8579987287521362,
            3.9738333225250244,
            -1.1478992700576782,
            -1.009615182876587,
            -1.7031071186065674,
            3.2899887561798096,
            2.4800314903259277,
            -0.514863133430481,
            0.7817763090133667,
            -2.8158106803894043,
            3.974179744720459,
            0.29419654607772827,
            1.7161455154418945,
            3.7571096420288086,
            1.7784206867218018,
            -3.1809611320495605,
            1.5016950368881226,
            0.6859278678894043,
            -5.092803955078125,
            2.3090732097625732,
            3.5401883125305176,
            5.151498794555664,
            -0.9810751676559448,
            -4.669011116027832,
            -4.156413555145264,
            -0.3953869938850403,
            1.3324956893920898,
            2.3477067947387695,
            1.6063220500946045,
            4.226611137390137,
            -2.316265344619751,
            -5.024129867553711,
            -1.3565596342086792,
            -3.8569562435150146,
            -0.9167870879173279,
            -1.0954389572143555,
            -0.6684883832931519,
            4.802696228027344,
            2.180393695831299,
            -3.9953322410583496,
            -2.3450918197631836,
            1.290457844734192,
            -3.462754011154175,
            -1.632375955581665,
            0.708148181438446,
            0.09237681329250336,
            1.186301589012146,
            2.5283894538879395,
            -2.831454277038574,
            1.6840349435806274,
            -4.638827323913574,
            -0.0470767617225647,
            -3.9843266010284424,
            1.2753064632415771,
            6.037977695465088,
            -0.5338166952133179,
            -2.7464239597320557,
            0.12558871507644653,
            -1.8419842720031738,
            1.9903550148010254,
            2.87608003616333,
            1.6698771715164185,
            2.0050501823425293,
            4.273012638092041,
            -0.2941238284111023,
            -3.038379669189453,
            -1.782099723815918,
            -4.2435102462768555,
            0.5890838503837585,
            -1.0147311687469482,
            5.152784824371338,
            -3.532088279724121,
            -1.3286230564117432,
            -0.950031042098999,
            4.368648052215576,
            0.4674212634563446,
            -1.972094178199768,
            3.9296393394470215,
            -2.2059872150421143,
            1.4637850522994995,
            -4.770868301391602,
            -0.3638128638267517,
            -2.5897412300109863,
            -0.16224992275238037,
            2.709542751312256,
            2.313060998916626,
            -2.2928881645202637,
            5.009711742401123,
            -0.7106592059135437,
            4.612760066986084,
            3.2981677055358887,
            3.7886316776275635,
            -0.14163488149642944,
            -3.295473098754883,
            -3.1787843704223633,
            1.2875969409942627,
            -2.5871987342834473,
            -2.162975311279297,
            -2.4368033409118652,
            6.980020523071289,
            0.30539166927337646,
            2.382852554321289,
            -2.2663161754608154,
            -3.3098695278167725,
            -2.87136173248291,
            -4.524584770202637,
            0.8793488144874573,
            -0.07331490516662598,
            1.0729881525039673,
            -1.0704172849655151,
            1.5060381889343262,
            -1.8450887203216553,
            -0.2421654313802719,
            1.4989484548568726,
            -0.584194004535675,
            0.3832210302352905,
            3.6472580432891846,
            0.4026283621788025,
            -1.310598373413086,
            2.012688636779785,
            -0.9611250758171082,
            -2.65710186958313,
            0.7183222770690918,
            -2.5748634338378906,
            11.727556228637695,
            -3.1229381561279297,
            -0.11202150583267212,
            -0.4079478085041046,
            -6.218003273010254,
            -2.1151487827301025,
            -1.078802466392517,
            1.0673068761825562,
            -2.4394781589508057,
            1.0791923999786377,
            -1.8215252161026,
            -0.6330990195274353,
            0.6991060376167297,
            -0.10614490509033203,
            1.8766443729400635,
            1.7483863830566406,
            0.8046305179595947,
            5.1190056800842285,
            -0.7975789904594421,
            -0.33102795481681824,
            -1.0809575319290161,
            2.472367286682129,
            3.1022214889526367,
            1.7333160638809204,
            -2.5854504108428955,
            1.714284896850586,
            1.33146071434021,
            2.0799641609191895,
            -0.4273713529109955,
            -4.490215301513672,
            1.0038686990737915,
            -4.6148200035095215,
            1.7278186082839966,
            1.2977924346923828,
            0.5402138233184814,
            -0.019325554370880127,
            6.115383148193359,
            4.355377674102783,
            -2.435962438583374,
            2.1375374794006348,
            4.192316055297852,
            -0.10451066493988037,
            -0.474395215511322,
            -0.8628612160682678,
            -5.650152683258057,
            -2.1309220790863037,
            -1.5497050285339355,
            -4.217414379119873,
            1.637137770652771,
            -2.536423921585083,
            -1.0157452821731567,
            1.41231107711792,
            1.86496102809906,
            -0.3981385827064514,
            -0.07244890928268433,
            3.918376922607422,
            1.9872487783432007,
            2.8093302249908447,
            -3.3982057571411133,
            1.836422085762024,
            6.055567741394043,
            2.912001848220825,
            2.1851534843444824,
            3.055814266204834,
            -3.0430610179901123,
            2.3609230518341064,
            -3.7783150672912598,
            1.6621668338775635,
            -0.8570775985717773,
            4.987554550170898,
            -3.27412748336792,
            -1.9205219745635986,
            -0.2814282178878784,
            4.396890640258789,
            2.353950023651123,
            4.872470855712891,
            -6.328588485717773,
            1.5543336868286133,
            -0.13484352827072144,
            1.6812069416046143,
            -1.8965058326721191,
            -2.8174281120300293,
            -2.7307276725769043,
            -2.5885746479034424,
            1.3041776418685913,
            -3.6964311599731445,
            -1.8617286682128906,
            -2.20841121673584,
            1.4736580848693848,
            0.446282297372818,
            -3.746185779571533,
            -1.7345037460327148,
            -0.5068055987358093,
            -0.9351702928543091,
            -4.0697126388549805,
            3.5228848457336426,
            -0.904823362827301,
            2.1190457344055176,
            3.570037603378296,
            1.9158563613891602,
            -1.0820499658584595,
            -4.260109901428223,
            0.4696391820907593,
            3.826294422149658,
            3.451338291168213,
            -1.2835545539855957,
            -0.3860743045806885,
            -2.222559928894043,
            0.4424360692501068,
            -2.328608989715576,
            2.2320809364318848,
            2.7711997032165527,
            -0.20824193954467773,
            -3.9850943088531494,
            -0.971764326095581,
            -0.1474456787109375,
            3.8966217041015625,
            -2.2374935150146484,
            -1.308281660079956,
            6.91867733001709,
            6.198172569274902,
            1.017616629600525,
            1.452004313468933,
            2.7629427909851074,
            2.401383638381958,
            -4.133264541625977,
            4.162993431091309,
            -5.565670967102051,
            3.786780834197998,
            2.390462875366211,
            -3.736438035964966,
            -0.7343134880065918,
            2.171036720275879,
            -0.6246607899665833,
            -1.968662977218628,
            -1.107224464416504,
            -2.705599784851074,
            -4.454995632171631,
            -1.584787368774414,
            4.083498954772949,
            -0.5388821363449097,
            2.071056365966797,
            2.4080851078033447,
            2.885546922683716,
            -1.2735588550567627,
            1.4819722175598145,
            -3.8378593921661377,
            1.7615385055541992,
            -1.6069238185882568,
            0.4804781377315521,
            4.068382740020752,
            1.0318646430969238,
            2.021164655685425,
            1.5848829746246338,
            -4.877542495727539,
            2.095242738723755,
            -1.8740803003311157,
            1.0155164003372192,
            0.7653107047080994,
            1.4418377876281738,
            -2.7046244144439697,
            2.8481099605560303,
            0.1197243332862854,
            5.126238822937012,
            3.8002848625183105,
            5.004677772521973,
            -0.7761346697807312,
            -1.626610279083252,
            -2.8294339179992676,
            -4.6477885246276855,
            1.5172696113586426,
            2.7961456775665283,
            -2.164264678955078,
            -2.6025919914245605,
            -1.6915981769561768,
            -0.8730409145355225,
            1.7084693908691406,
            0.1231338381767273,
            -3.5978732109069824,
            4.939956188201904,
            -1.987736701965332,
            0.8413857817649841,
            -4.263789176940918,
            2.3852081298828125,
            1.349186658859253,
            1.0376676321029663,
            -2.022437334060669,
            -3.3790817260742188,
            -3.804640531539917,
            -0.4547451138496399,
            -3.509129285812378,
            -2.5218701362609863,
            -0.9965819716453552,
            4.123172283172607,
            3.373711585998535,
            -2.6081252098083496,
            -1.9484115839004517,
            4.836266040802002,
            -4.110492706298828,
            -4.611388683319092,
            -0.8850361704826355,
            2.3496172428131104,
            -0.24563661217689514,
            -1.5904347896575928,
            -0.5915910005569458,
            -3.8809638023376465,
            1.8737483024597168,
            -1.4095208644866943,
            2.7193384170532227,
            2.9458794593811035,
            0.6138063073158264,
            3.5142550468444824,
            -2.3126964569091797,
            -1.4197391271591187,
            -2.1297783851623535,
            -3.012488842010498,
            -3.384876012802124,
            -4.1428303718566895,
            0.3137766122817993,
            -3.2929399013519287,
            -4.369624137878418,
            1.447525978088379,
            -1.2504521608352661,
            -3.935887098312378,
            2.8901352882385254,
            -0.3591230511665344,
            -1.8725987672805786,
            -5.411675453186035,
            -0.6594008207321167,
            -2.7747642993927,
            2.5629639625549316,
            -0.0943453311920166,
            -0.02842235565185547,
            -0.16578564047813416,
            1.7446908950805664,
            3.2538857460021973,
            2.508089303970337,
            1.638441562652588,
            -2.979887008666992,
            -1.37460196018219,
            3.6542341709136963,
            3.3554019927978516,
            3.2500247955322266,
            -3.6725406646728516,
            1.1916923522949219,
            -1.6387146711349487,
            13.686993598937988,
            -2.298542022705078,
            -0.025858551263809204,
            -4.566668510437012,
            -0.7982242107391357,
            -2.7983779907226562,
            1.3956228494644165,
            2.8682329654693604,
            1.6503076553344727,
            3.109790325164795,
            -1.519396185874939,
            -3.6878037452697754,
            1.071272850036621,
            -1.448325276374817,
            -5.891643047332764,
            1.284508228302002,
            -1.34280526638031,
            4.51375675201416,
            -2.527372360229492,
            -0.40700647234916687,
            -1.2193282842636108,
            0.9397589564323425,
            0.863331139087677,
            0.23607942461967468,
            -0.6484548449516296,
            4.463083744049072,
            1.0775761604309082,
            2.35101318359375,
            -2.630530834197998,
            2.700364589691162,
            2.7739968299865723,
            1.3664917945861816,
            0.9296535849571228,
            -0.87270188331604,
            -2.774941921234131,
            4.520987510681152,
            3.952958583831787,
            1.714224934577942,
            0.9926093220710754,
            0.5380685329437256,
            -0.6891133785247803,
            1.0289708375930786,
            -3.799990653991699,
            -1.0421909093856812,
            -2.5805606842041016,
            -1.8428692817687988,
            0.882188081741333,
            -3.262687921524048,
            -5.3270978927612305,
            2.11253023147583,
            -1.5028812885284424,
            -1.3378559350967407,
            -4.872644424438477,
            1.170514702796936,
            5.283633232116699,
            7.815872669219971,
            -0.28555864095687866,
            -0.2427968978881836,
            1.1238043308258057,
            -2.2652029991149902,
            2.572049379348755,
            0.24317777156829834,
            0.3669019937515259,
            -4.741288185119629,
            -1.092172384262085,
            4.0418701171875,
            -2.264115333557129,
            3.665344476699829,
            1.0465166568756104,
            1.9268842935562134,
            2.0508804321289062,
            -0.3895840048789978,
            3.189777374267578,
            -3.752490997314453,
            -0.5822622776031494,
            -0.6129016876220703,
            4.0087809562683105,
            1.3199511766433716,
            2.379380464553833,
            6.833670616149902,
            -4.537178993225098,
            -1.0580072402954102,
            -3.553652763366699,
            -0.6247861385345459,
            6.100205898284912,
            -1.6848583221435547,
            4.942128658294678,
            1.242256999015808,
            -1.7444772720336914,
            0.04404282569885254,
            -1.5969020128250122,
            -0.8767648935317993,
            3.7393369674682617,
            0.6193397641181946,
            6.977452278137207,
            -2.255764961242676,
            -1.3566999435424805,
            -3.821270227432251,
            -1.3338775634765625,
            -1.8954328298568726,
            5.619605541229248,
            2.6631975173950195,
            -2.632678508758545,
            1.6775797605514526,
            -1.6031608581542969,
            -2.244178533554077,
            -0.9758923649787903,
            -3.681986093521118,
            -2.3800783157348633,
            -3.0014450550079346,
            4.759570121765137,
            -7.399601936340332,
            -3.7735254764556885,
            -1.229561686515808,
            -2.05149507522583,
            -4.417001724243164,
            0.6469846963882446,
            3.658400058746338,
            2.038733720779419,
            2.735154628753662,
            1.6394047737121582,
            0.9861128330230713,
            2.021301746368408,
            -2.401909828186035,
            0.07385654747486115,
            2.75866436958313,
            1.5642772912979126,
            1.1745398044586182,
            -3.488809108734131,
            1.3497934341430664,
            2.3386318683624268,
            -2.532740831375122,
            -3.4421629905700684,
            1.6685996055603027,
            -2.8053743839263916,
            -2.053243398666382,
            0.3307453989982605,
            -1.0828102827072144,
            -4.504220962524414,
            0.8569879531860352,
            3.8846447467803955,
            -1.4418928623199463,
            1.045426845550537,
            7.534783840179443,
            -1.4417484998703003,
            1.1863577365875244,
            -0.867518424987793,
            -4.389474868774414,
            2.042501211166382,
            0.8087537288665771,
            0.48527973890304565,
            -2.146123170852661,
            3.255733013153076,
            -1.2458468675613403,
            -0.05701887607574463,
            -3.1585214138031006
        ]
    },
    "authors": [
        {
            "authorId": "144082611",
            "name": "Vasudev Shyam"
        },
        {
            "authorId": "2303399767",
            "name": "Jonathan Pilault"
        },
        {
            "authorId": "2315298030",
            "name": "Emily Shepperd"
        },
        {
            "authorId": "2282542187",
            "name": "Quentin Anthony"
        },
        {
            "authorId": "150045277",
            "name": "Beren Millidge"
        }
    ],
    "references": [
        {
            "paperId": "d372fb69c485472385f152bc832bf1d35e223324",
            "title": "MiniCache: KV Cache Compression in Depth Dimension for Large Language Models"
        },
        {
            "paperId": "e9576198e9ee767ede4b1ac6a739267aa52a9832",
            "title": "Dynamic Memory Compression: Retrofitting LLMs for Accelerated Inference"
        },
        {
            "paperId": "7a54aad06171f59149aca5380863c62729c70b41",
            "title": "GEAR: An Efficient KV Cache Compression Recipe for Near-Lossless Generative Inference of LLM"
        },
        {
            "paperId": null,
            "title": "\u201cEvaluating \u2207 \ud835\udc53 ( \ud835\udc65 ) is as fast as \ud835\udc53 ( \ud835\udc65 ) ,\u201d"
        },
        {
            "paperId": "00cf63a7926a826f7cf73c1d5edb117f98d70c2c",
            "title": "Variational algorithms for approximate Bayesian inference"
        },
        {
            "paperId": null,
            "title": "arXiv e-prints"
        },
        {
            "paperId": null,
            "title": "\u201cNvidia hopper architecture in-depth,\u201d"
        },
        {
            "paperId": null,
            "title": "\u201cOptimizing inference,\u201d"
        },
        {
            "paperId": null,
            "title": "\u201cThings i\u2019m learning while training superhot,\u201d"
        },
        {
            "paperId": null,
            "title": "\u201cFlash-decoding for long-context inference,\u201d"
        },
        {
            "paperId": null,
            "title": "\u201cHelmholtz free energy \u2014 Wikipedia, the free encyclopedia,\u201d"
        }
    ]
}