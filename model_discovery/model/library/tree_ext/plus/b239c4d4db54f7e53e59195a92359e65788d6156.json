{
    "paperId": "b239c4d4db54f7e53e59195a92359e65788d6156",
    "externalIds": {
        "ArXiv": "2408.15237",
        "CorpusId": 271963049
    },
    "title": "The Mamba in the Llama: Distilling and Accelerating Hybrid Models",
    "abstract": "Linear RNN architectures, like Mamba, can be competitive with Transformer models in language modeling while having advantageous deployment characteristics. Given the focus on training large-scale Transformer models, we consider the challenge of converting these pretrained models for deployment. We demonstrate that it is feasible to distill large Transformers into linear RNNs by reusing the linear projection weights from attention layers with academic GPU resources. The resulting hybrid model, which incorporates a quarter of the attention layers, achieves performance comparable to the original Transformer in chat benchmarks and outperforms open-source hybrid Mamba models trained from scratch with trillions of tokens in both chat benchmarks and general benchmarks. Moreover, we introduce a hardware-aware speculative decoding algorithm that accelerates the inference speed of Mamba and hybrid models. Overall we show how, with limited computation resources, we can remove many of the original attention layers and generate from the resulting model more efficiently. Our top-performing model, distilled from Llama3-8B-Instruct, achieves a 29.61 length-controlled win rate on AlpacaEval 2 against GPT-4 and 7.35 on MT-Bench, surpassing the best instruction-tuned linear RNN model.",
    "venue": "",
    "year": 2024,
    "referenceCount": 0,
    "citationCount": 0,
    "influentialCitationCount": 0,
    "openAccessPdf": null,
    "tldr": {
        "model": "tldr@v2.0.0",
        "text": "It is demonstrated that it is feasible to distill large Transformers into linear RNNs by reusing the linear projection weights from attention layers with academic GPU resources, and how, with limited computation resources, many of the original attention layers can be removed and generate from the resulting model more efficiently."
    },
    "embedding": {
        "model": "specter_v1",
        "vector": [
            -5.832705497741699,
            2.2169189453125,
            -0.5434378981590271,
            4.910447120666504,
            1.7629868984222412,
            2.3892979621887207,
            3.4415860176086426,
            -2.2789039611816406,
            -1.001420259475708,
            -1.0102341175079346,
            1.0747754573822021,
            4.425453186035156,
            2.7229597568511963,
            -0.4505843222141266,
            -2.145254611968994,
            -0.516243577003479,
            0.8194978833198547,
            1.7802069187164307,
            3.5826282501220703,
            2.0810487270355225,
            -1.2008965015411377,
            3.0954277515411377,
            -2.608151912689209,
            1.393067717552185,
            -0.8165208101272583,
            -0.21729353070259094,
            5.541186332702637,
            1.5608549118041992,
            -0.6531164646148682,
            2.937678813934326,
            0.28333741426467896,
            -5.670817852020264,
            4.675887107849121,
            -7.628722190856934,
            3.0820960998535156,
            -3.6457509994506836,
            -4.9420881271362305,
            7.6412224769592285,
            -4.849390983581543,
            -0.03156021237373352,
            -2.912936210632324,
            -1.8321171998977661,
            0.6086299419403076,
            -0.840015709400177,
            0.4236428141593933,
            1.9550762176513672,
            4.501499652862549,
            -1.3940138816833496,
            1.628554105758667,
            3.2801406383514404,
            2.051163673400879,
            0.5592265129089355,
            -2.378488779067993,
            0.9719595909118652,
            -1.2503403425216675,
            -0.14396458864212036,
            -0.04740831255912781,
            -0.9141107201576233,
            1.7543015480041504,
            -0.3977862596511841,
            4.269068717956543,
            4.483226776123047,
            -1.0009560585021973,
            4.02714729309082,
            2.764756202697754,
            -3.5796103477478027,
            -0.450153648853302,
            3.204195261001587,
            0.3470764458179474,
            2.505958318710327,
            1.1467947959899902,
            -6.071778774261475,
            -0.3597937226295471,
            1.4842312335968018,
            -6.082160472869873,
            0.7243678569793701,
            -5.502228260040283,
            -6.95253849029541,
            0.42288345098495483,
            -4.0392889976501465,
            0.6647803783416748,
            2.8004229068756104,
            -1.0440466403961182,
            2.009830951690674,
            4.3616838455200195,
            -1.2151366472244263,
            -1.9841477870941162,
            -0.6508371829986572,
            4.753053665161133,
            -2.31245493888855,
            -0.7255343198776245,
            0.3430589735507965,
            -2.0814032554626465,
            3.8055498600006104,
            -2.9056029319763184,
            0.10047543048858643,
            -0.8261328935623169,
            0.23576627671718597,
            -2.5478873252868652,
            1.2378530502319336,
            -0.9016166925430298,
            0.9455962777137756,
            1.3134602308273315,
            1.4641667604446411,
            3.731869697570801,
            -3.582439422607422,
            -2.5279510021209717,
            3.5871620178222656,
            -0.6323036551475525,
            -1.7509145736694336,
            -5.498802185058594,
            4.400664329528809,
            -1.5485440492630005,
            -0.49758195877075195,
            -2.857147216796875,
            -1.77426016330719,
            -1.9496231079101562,
            2.033784866333008,
            -0.3769253194332123,
            3.382798671722412,
            -0.639704167842865,
            -0.06771835684776306,
            -1.992720365524292,
            0.36418333649635315,
            1.9943174123764038,
            3.399583339691162,
            -1.2409725189208984,
            0.2525659203529358,
            -0.5201928019523621,
            -2.6025736331939697,
            2.550589084625244,
            -2.7004640102386475,
            3.919874668121338,
            -3.2781851291656494,
            -0.08629792928695679,
            2.254112958908081,
            -5.091181755065918,
            1.7260462045669556,
            -3.2292637825012207,
            -1.286325454711914,
            0.25011372566223145,
            4.8285417556762695,
            1.4221516847610474,
            0.13220979273319244,
            2.9195311069488525,
            0.736311137676239,
            1.291623830795288,
            -1.06709885597229,
            -2.8197693824768066,
            4.213454246520996,
            4.075479030609131,
            -3.1068735122680664,
            1.509616732597351,
            -0.19725704193115234,
            0.049235984683036804,
            4.731245040893555,
            -3.1605796813964844,
            3.144927978515625,
            -2.774174213409424,
            2.274853229522705,
            0.3488641381263733,
            2.3106722831726074,
            -8.62197494506836,
            -2.7150516510009766,
            4.139347076416016,
            -3.3376221656799316,
            0.144217386841774,
            3.037187099456787,
            0.2171999216079712,
            2.8900418281555176,
            -0.23823986947536469,
            3.459129810333252,
            1.9492223262786865,
            5.024336338043213,
            2.592456340789795,
            3.661607503890991,
            1.707633376121521,
            -2.093853235244751,
            -1.0422896146774292,
            -0.5178849101066589,
            -3.290952682495117,
            -0.46049630641937256,
            -3.138741970062256,
            3.2333030700683594,
            -2.470571517944336,
            -3.081000804901123,
            -7.058396339416504,
            -3.746567964553833,
            -0.7565080523490906,
            1.904958963394165,
            -1.823472261428833,
            -0.10251574218273163,
            4.499245643615723,
            3.8052313327789307,
            5.06015682220459,
            0.38001424074172974,
            5.0469770431518555,
            4.248997688293457,
            -5.4253435134887695,
            1.0200313329696655,
            4.542275428771973,
            0.5703225135803223,
            1.4592970609664917,
            -1.1410837173461914,
            2.757880687713623,
            1.1046247482299805,
            -1.8918533325195312,
            5.313924312591553,
            0.5288020372390747,
            -0.38757801055908203,
            0.33835479617118835,
            1.2146732807159424,
            -1.8458399772644043,
            0.661670446395874,
            -2.2267699241638184,
            -4.355274200439453,
            -8.466588973999023,
            3.699814796447754,
            1.7824558019638062,
            2.6018080711364746,
            -1.426673173904419,
            0.47612303495407104,
            -0.45454153418540955,
            -5.320549488067627,
            -0.8061686158180237,
            -0.9152861833572388,
            1.7464185953140259,
            -0.7261433601379395,
            2.579341411590576,
            3.0106306076049805,
            -1.6822443008422852,
            -5.10097599029541,
            -1.339531660079956,
            -2.6894052028656006,
            -5.16409969329834,
            -2.211533308029175,
            -5.9701128005981445,
            1.815622329711914,
            -2.427473545074463,
            -2.6313552856445312,
            5.959283828735352,
            0.559527575969696,
            -1.6933685541152954,
            3.560122013092041,
            4.506983757019043,
            -3.617225170135498,
            0.3467686176300049,
            0.3411620855331421,
            -1.9216078519821167,
            -0.20237809419631958,
            -0.6200465559959412,
            -2.717926502227783,
            4.8411993980407715,
            -2.1389365196228027,
            1.6660465002059937,
            3.1452951431274414,
            2.324244976043701,
            -2.007991075515747,
            1.7649718523025513,
            -0.2161831259727478,
            -2.3044352531433105,
            4.12206506729126,
            2.96445894241333,
            5.726367950439453,
            -2.2162349224090576,
            -0.795708417892456,
            -2.19960880279541,
            1.4099221229553223,
            -1.7964273691177368,
            4.48443603515625,
            2.588244915008545,
            2.09348726272583,
            -4.856136322021484,
            -4.1338887214660645,
            -0.5064949989318848,
            -5.820889472961426,
            -1.5677545070648193,
            -0.5691829919815063,
            1.7380905151367188,
            4.256099700927734,
            -0.699081301689148,
            -3.170592784881592,
            -0.7761090397834778,
            -0.2853613793849945,
            -0.4833068549633026,
            -1.5270702838897705,
            -3.89623761177063,
            0.0854724645614624,
            -0.7267928123474121,
            -0.4135669469833374,
            -3.4216320514678955,
            1.6674649715423584,
            -6.309401035308838,
            -3.4412682056427,
            -2.1145191192626953,
            -0.9523582458496094,
            3.095698833465576,
            -1.5374565124511719,
            -1.867725133895874,
            -2.5785834789276123,
            -2.0973081588745117,
            -0.15457457304000854,
            4.081211090087891,
            0.952705442905426,
            2.352785348892212,
            7.257651329040527,
            0.8303722143173218,
            -2.930368423461914,
            -2.070995569229126,
            -3.8786158561706543,
            -2.299797773361206,
            -0.08018037676811218,
            3.1949386596679688,
            -3.9596633911132812,
            3.157299518585205,
            0.3900749087333679,
            2.8854384422302246,
            0.4084203243255615,
            -3.629483222961426,
            2.740687370300293,
            -1.9101042747497559,
            -0.4867725372314453,
            -6.767638206481934,
            -5.578874588012695,
            -0.06231731176376343,
            -0.8624868392944336,
            2.7547035217285156,
            3.412881851196289,
            -3.586660146713257,
            4.0266876220703125,
            1.146921157836914,
            3.4494128227233887,
            2.5797884464263916,
            2.2572293281555176,
            -1.8483850955963135,
            -3.5403695106506348,
            1.1755815744400024,
            -1.9452052116394043,
            0.7885648012161255,
            1.5764262676239014,
            0.9149447679519653,
            7.808398246765137,
            1.0947414636611938,
            2.010850191116333,
            0.787140429019928,
            0.11815036833286285,
            0.008163988590240479,
            -1.9902807474136353,
            -0.3609972596168518,
            -1.448777675628662,
            0.055109165608882904,
            0.9777366518974304,
            1.1830800771713257,
            -3.031308650970459,
            -0.13044506311416626,
            3.976989984512329,
            1.5574381351470947,
            -0.10102623701095581,
            -0.4926995038986206,
            4.011473655700684,
            -1.4088749885559082,
            -0.7168156504631042,
            3.3915514945983887,
            -1.4172965288162231,
            4.194123268127441,
            -0.9717229604721069,
            12.570028305053711,
            -4.028775691986084,
            -0.06668615341186523,
            -7.415223598480225,
            -1.6876099109649658,
            -3.0100839138031006,
            -2.519035816192627,
            2.834484577178955,
            -2.2088632583618164,
            -1.3702620267868042,
            0.9515241980552673,
            -4.276055812835693,
            -1.017855167388916,
            0.671625018119812,
            -1.1095789670944214,
            0.6547492742538452,
            0.04310329258441925,
            4.53518009185791,
            -2.1787548065185547,
            2.396346092224121,
            -0.9197062253952026,
            2.2602553367614746,
            -0.10862705111503601,
            0.01282346248626709,
            -0.9284363985061646,
            1.4253184795379639,
            1.1246980428695679,
            0.6269001364707947,
            -3.906581401824951,
            -1.8050036430358887,
            -3.7059426307678223,
            -4.086055755615234,
            -1.024936318397522,
            3.6978182792663574,
            -0.6442574262619019,
            0.5844324231147766,
            3.2601780891418457,
            4.963101387023926,
            -7.686928749084473,
            -0.6154710650444031,
            4.0653252601623535,
            0.31215840578079224,
            -1.5079646110534668,
            0.06830386817455292,
            -3.806964635848999,
            -2.200042486190796,
            -2.525883197784424,
            -4.46647834777832,
            -0.40426045656204224,
            -4.916351318359375,
            4.617994785308838,
            0.6203396320343018,
            4.712316989898682,
            1.37630033493042,
            -0.008090436458587646,
            2.3797335624694824,
            5.442375183105469,
            5.229215145111084,
            -3.0666251182556152,
            2.2209548950195312,
            4.07082462310791,
            3.163036823272705,
            -0.2988128066062927,
            3.1244163513183594,
            0.24649590253829956,
            5.811723709106445,
            -4.575878143310547,
            0.049704134464263916,
            2.6281166076660156,
            1.7429136037826538,
            0.7545772194862366,
            0.6453622579574585,
            0.18367546796798706,
            -1.7944839000701904,
            3.709561824798584,
            2.104030132293701,
            -1.1462130546569824,
            3.0784049034118652,
            -0.8037115335464478,
            0.9414483308792114,
            2.2946114540100098,
            2.1886796951293945,
            -3.94958233833313,
            -2.168508529663086,
            2.912839412689209,
            -4.484307289123535,
            -2.8286495208740234,
            -2.185082197189331,
            2.525252342224121,
            1.343996286392212,
            -2.082580804824829,
            -0.2746797204017639,
            -1.9835412502288818,
            0.12596163153648376,
            -3.163799285888672,
            1.1811186075210571,
            -0.6565888524055481,
            1.2939207553863525,
            0.3257961869239807,
            0.9281322360038757,
            -1.7957351207733154,
            -3.5975770950317383,
            1.7273964881896973,
            -0.14146390557289124,
            1.2248073816299438,
            -4.158510208129883,
            -1.3243521451950073,
            2.543184280395508,
            -2.1431753635406494,
            -1.4879554510116577,
            2.2497568130493164,
            3.1570935249328613,
            0.8332783579826355,
            -2.661637783050537,
            -2.299182653427124,
            -0.8646905422210693,
            2.374711513519287,
            -2.092459201812744,
            -1.417987585067749,
            3.151089668273926,
            5.243483066558838,
            -0.8078171014785767,
            1.0520107746124268,
            0.9047092795372009,
            -0.32121241092681885,
            0.8204678297042847,
            3.52178955078125,
            -0.9493832588195801,
            1.7750256061553955,
            0.7411631345748901,
            -5.355252742767334,
            2.969982862472534,
            1.9385294914245605,
            -0.881191611289978,
            -3.2909536361694336,
            -3.896923303604126,
            0.20159655809402466,
            -3.3063454627990723,
            -3.523090362548828,
            4.7951250076293945,
            5.420648574829102,
            1.4080262184143066,
            -5.135820388793945,
            1.5918457508087158,
            -0.32304030656814575,
            2.479975700378418,
            -4.273179531097412,
            3.8997602462768555,
            -0.010768413543701172,
            1.2530893087387085,
            2.9569005966186523,
            0.1710263192653656,
            0.49929100275039673,
            -0.17627382278442383,
            -1.8712252378463745,
            -0.8132033348083496,
            0.8895793557167053,
            0.5062676668167114,
            -0.6945434808731079,
            0.10016322135925293,
            -1.9228206872940063,
            3.035047769546509,
            0.6386889219284058,
            5.3321027755737305,
            6.788521766662598,
            4.526376724243164,
            1.7748572826385498,
            -4.285688400268555,
            -0.7127655148506165,
            0.02528625726699829,
            2.229844331741333,
            3.5697720050811768,
            -5.755304336547852,
            -2.5423495769500732,
            2.0358452796936035,
            3.347499370574951,
            -0.20251283049583435,
            -0.16148586571216583,
            -2.4014382362365723,
            4.007599830627441,
            -4.378100395202637,
            2.181734085083008,
            -3.488757610321045,
            0.58090740442276,
            1.183967113494873,
            -2.1091318130493164,
            1.40315842628479,
            -2.6387646198272705,
            -4.6491498947143555,
            -1.4337247610092163,
            -2.491786479949951,
            -1.4616929292678833,
            -1.0800189971923828,
            3.6750638484954834,
            1.5570412874221802,
            1.5838500261306763,
            -3.040229320526123,
            2.3411014080047607,
            -1.823682427406311,
            0.3072628974914551,
            -2.9104671478271484,
            3.2042675018310547,
            0.8322266340255737,
            -0.6315634846687317,
            -0.895970344543457,
            -0.6295520067214966,
            0.6745803952217102,
            -0.968713641166687,
            -0.24938279390335083,
            3.4580628871917725,
            3.4690237045288086,
            1.5955501794815063,
            -2.326683521270752,
            0.0074307918548583984,
            -2.505418062210083,
            -5.011527061462402,
            -1.0275235176086426,
            -5.804786682128906,
            1.212441086769104,
            -4.3101887702941895,
            -3.758300304412842,
            3.20487642288208,
            -4.9345622062683105,
            0.9357770085334778,
            1.5045719146728516,
            -2.9699103832244873,
            0.8351622223854065,
            -3.064701557159424,
            1.6363521814346313,
            -3.895643472671509,
            4.640528678894043,
            -0.1432112455368042,
            -0.09749859571456909,
            1.2071213722229004,
            -0.07994860410690308,
            5.850589752197266,
            2.782151937484741,
            1.1792036294937134,
            -2.4617295265197754,
            -3.4161338806152344,
            0.7902990579605103,
            0.6548132300376892,
            -1.1398476362228394,
            0.9472742080688477,
            0.2510201334953308,
            2.1192593574523926,
            16.712406158447266,
            -0.808102548122406,
            -1.6103107929229736,
            -0.21559172868728638,
            -1.4330302476882935,
            -4.05440616607666,
            -3.70509672164917,
            1.4192256927490234,
            2.2763071060180664,
            0.07944636046886444,
            -0.6843647360801697,
            -1.4005672931671143,
            1.2779717445373535,
            1.2196648120880127,
            -0.4857533276081085,
            0.4118694067001343,
            -2.685506582260132,
            2.308973789215088,
            -1.6838676929473877,
            -0.25806567072868347,
            0.2824433743953705,
            2.9249768257141113,
            0.9440358877182007,
            -1.1644047498703003,
            1.3301037549972534,
            5.131645679473877,
            4.803543567657471,
            3.255911350250244,
            -1.9813048839569092,
            -0.48975563049316406,
            2.8435440063476562,
            2.956233024597168,
            0.48668134212493896,
            3.026033401489258,
            -3.7715587615966797,
            5.210386276245117,
            2.041254758834839,
            -1.1078977584838867,
            4.746035575866699,
            4.084144592285156,
            -0.4211992025375366,
            0.6477994918823242,
            -2.1380109786987305,
            -0.7794629335403442,
            -0.6688702702522278,
            3.5992162227630615,
            0.05447053909301758,
            -2.751436471939087,
            -2.729382276535034,
            4.177192687988281,
            0.5344703197479248,
            -5.405698776245117,
            -0.33949732780456543,
            -1.5795845985412598,
            2.380467414855957,
            4.183034896850586,
            1.4309122562408447,
            -3.2829408645629883,
            3.7397522926330566,
            -2.1763362884521484,
            0.7882966995239258,
            0.41077420115470886,
            -1.7260923385620117,
            -3.3883609771728516,
            -0.95295649766922,
            -0.08706247806549072,
            -6.206331253051758,
            3.5165340900421143,
            1.7372870445251465,
            3.1685829162597656,
            1.7554984092712402,
            1.9196728467941284,
            -0.5081973075866699,
            -0.3750527501106262,
            -0.847518265247345,
            -3.910478115081787,
            2.5311341285705566,
            -1.9055984020233154,
            -1.134041666984558,
            9.673013687133789,
            -3.2496249675750732,
            2.4824635982513428,
            -1.65768301486969,
            -0.5089298486709595,
            5.0169677734375,
            -4.004483699798584,
            7.147143363952637,
            1.4411811828613281,
            -1.2272071838378906,
            2.5263524055480957,
            -0.649389922618866,
            -1.3908579349517822,
            2.087834358215332,
            4.114812850952148,
            1.69466233253479,
            -4.119309902191162,
            -3.8910229206085205,
            -4.177980422973633,
            -2.9089770317077637,
            -5.3837080001831055,
            4.200240135192871,
            3.684570074081421,
            2.7712607383728027,
            -1.9163882732391357,
            -1.2138787508010864,
            3.527219772338867,
            0.006383612751960754,
            -9.285587310791016,
            -4.54961633682251,
            -3.2545254230499268,
            2.3462555408477783,
            -6.246823310852051,
            -1.3704376220703125,
            1.845899224281311,
            1.2146847248077393,
            -0.34190869331359863,
            0.4329858422279358,
            4.688563346862793,
            0.21137580275535583,
            5.001435279846191,
            -0.11868437379598618,
            -1.5288234949111938,
            -1.0174317359924316,
            -1.7301894426345825,
            -1.089152455329895,
            -0.48442700505256653,
            0.655438244342804,
            -2.2371230125427246,
            2.0968334674835205,
            0.4972723126411438,
            3.8083648681640625,
            -4.953150749206543,
            -2.98345947265625,
            -1.641226053237915,
            -1.7973867654800415,
            -3.886470317840576,
            2.994508743286133,
            0.48241472244262695,
            -2.2550740242004395,
            3.8822476863861084,
            5.679927825927734,
            0.3671383261680603,
            -2.289720058441162,
            8.498567581176758,
            0.46630778908729553,
            0.2761499881744385,
            -0.41777265071868896,
            -2.4367411136627197,
            0.2796398997306824,
            -0.4253762364387512,
            2.5019874572753906,
            -4.0411481857299805,
            5.727415084838867,
            -0.7580026388168335,
            -1.0017510652542114,
            -3.453817129135132
        ]
    },
    "authors": [
        {
            "authorId": "2280932302",
            "name": "Junxiong Wang"
        },
        {
            "authorId": "2317010734",
            "name": "Daniele Paliotta"
        },
        {
            "authorId": "2317009122",
            "name": "Avner May"
        },
        {
            "authorId": "2261743768",
            "name": "Alexander M. Rush"
        },
        {
            "authorId": "2317009261",
            "name": "Tri Dao"
        }
    ],
    "references": []
}