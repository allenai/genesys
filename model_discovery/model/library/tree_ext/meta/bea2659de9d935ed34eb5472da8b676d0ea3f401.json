{"paperId": "bea2659de9d935ed34eb5472da8b676d0ea3f401", "title": "Cure the headache of Transformers via Collinear Constrained Attention", "abstract": "As the rapid progression of practical applications based on Large Language Models continues, the importance of extrapolating performance has grown exponentially in the research domain. In our study, we identified an anomalous behavior in Transformer models that had been previously overlooked, leading to a chaos around closest tokens which carried the most important information. We've coined this discovery the\"headache of Transformers\". To address this at its core, we introduced a novel self-attention structure named Collinear Constrained Attention (CoCA). This structure can be seamlessly integrated with existing extrapolation, interpolation methods, and other optimization strategies designed for traditional Transformer models. We have achieved excellent extrapolating performance even for 16 times to 24 times of sequence lengths during inference without any fine-tuning on our model. We have also enhanced CoCA's computational and spatial efficiency to ensure its practicality. We plan to open-source CoCA shortly. In the meantime, we've made our code available in the appendix for reappearing experiments.", "venue": "arXiv.org", "year": 2023, "citationCount": 0, "influentialCitationCount": 0, "openAccessPdf": {"url": "https://arxiv.org/pdf/2309.08646", "status": "CLOSED"}, "tldr": {"model": "tldr@v2.0.0", "text": "This study has introduced a novel self-attention structure named Collinear Constrained Attention (CoCA), which can be seamlessly integrated with existing extrapolation, interpolation methods, and other optimization strategies designed for traditional Transformer models."}, "embedding": {"model": "specter_v2", "vector": [0.17199337482452393, 0.6862786412239075, -0.5274038910865784, -0.12063393741846085, -0.6926297545433044, -0.20321810245513916, 0.4201371669769287, -0.017293158918619156, -0.3543510138988495, -0.19742520153522491, 0.5171283483505249, 0.010832278057932854, 0.5127984285354614, 0.4060930907726288, -0.19719424843788147, 0.11284414678812027, -0.9905402064323425, 0.4845305383205414, 0.1545596718788147, -0.32777345180511475, -0.07275933772325516, -0.746785581111908, -0.9258788824081421, 0.34249237179756165, 0.9908888339996338, 0.5294389724731445, 0.21439532935619354, 0.6612756252288818, -0.5594844222068787, 0.3010050654411316, 0.3873470723628998, -0.40841013193130493, 0.09015130251646042, -0.07955259829759598, -0.16942083835601807, -0.3883958160877228, 0.2585255801677704, -0.06634830683469772, -0.3761216104030609, 0.90296471118927, -0.29681873321533203, -0.08098922669887543, 0.43678519129753113, -1.0036576986312866, -0.6683228611946106, 1.384545922279358, 0.7489673495292664, 1.0401527881622314, -0.08194135129451752, -0.7773560285568237, 1.3325624465942383, -1.4880366325378418, 0.08365406095981598, 1.6262338161468506, 0.7565073370933533, 0.0805353969335556, -0.18847179412841797, -0.5560697913169861, 0.8161695003509521, 0.3298704922199249, -1.0007456541061401, -0.48481422662734985, -0.08831567317247391, 0.03694874420762062, 1.8743547201156616, -0.3085229992866516, 0.01927797682583332, 0.4011009931564331, -0.2097453624010086, 1.608405590057373, -0.03986135497689247, -0.9413109421730042, -0.2285565882921219, 0.24422265589237213, 0.12838193774223328, 0.7765682339668274, -0.7427311539649963, 0.40332648158073425, -1.0620588064193726, -0.22005945444107056, -0.06356438249349594, -0.11669521033763885, 0.27734723687171936, 0.1291225254535675, 0.01359472144395113, 0.508907675743103, 0.21091756224632263, 0.8694831728935242, -0.09424035996198654, 0.6014479398727417, 0.5314628481864929, 0.18826891481876373, 0.17915575206279755, 0.17871513962745667, -0.12749111652374268, 0.11439943313598633, -0.9817213416099548, 0.23768723011016846, 0.0354926623404026, 1.3812466859817505, -0.3511325716972351, 0.4093918204307556, -0.7649886012077332, 0.4178990125656128, 1.141255497932434, 0.07643189281225204, 0.46270135045051575, -0.6888400316238403, 0.1297103613615036, -0.44883689284324646, 0.05749359726905823, -0.4057224690914154, 0.07213328778743744, -0.33808842301368713, -0.38138216733932495, -1.5290942192077637, -0.28501176834106445, 0.1170598641037941, -0.46871888637542725, 0.47644150257110596, -0.4077446460723877, -0.04059384763240814, -0.2683587074279785, 0.541437029838562, 0.10641796886920929, 0.29581373929977417, 0.3296809792518616, -0.05034492909908295, 0.8972790241241455, -0.7974241375923157, -0.7865393161773682, -0.9154415726661682, 0.6338828802108765, -0.2682327628135681, 0.3448496460914612, -0.16499243676662445, -1.1730692386627197, -0.7889755368232727, -0.840059220790863, 0.04469707980751991, -0.653500497341156, 0.010147293098270893, 0.8364931344985962, 0.16946876049041748, -1.0172877311706543, 0.9190934300422668, -0.3567005693912506, 0.13517779111862183, 0.6926708221435547, -0.08493616431951523, 0.5647551417350769, -0.38738560676574707, -1.4355828762054443, 0.28203681111335754, 0.32697412371635437, -0.6322617530822754, -0.2011030912399292, -0.8088062405586243, -1.0200927257537842, 0.08147741854190826, 0.5107574462890625, 0.1585366427898407, 1.195092797279358, -0.17038494348526, -0.9897552132606506, 0.5094040632247925, -0.7910733819007874, -0.008712789975106716, 0.5682145953178406, -0.4428901672363281, -0.5968518853187561, -0.596802294254303, 0.3097108006477356, 0.4162311255931854, 0.3319515585899353, -0.3205798864364624, -0.3349619507789612, 0.06843814253807068, -0.559551477432251, -0.2853671908378601, -0.24519534409046173, 0.9685302972793579, -0.2500455379486084, -0.36360010504722595, 0.2805679738521576, 0.6049253940582275, -0.08858992904424667, -0.16131649911403656, -0.6640157699584961, -1.387112021446228, 0.598965585231781, -0.23465125262737274, 1.0533525943756104, -0.6299529671669006, -0.714847207069397, -0.26156389713287354, -0.3652518391609192, -0.04491506889462471, -0.47802677750587463, 0.9303568601608276, -0.3296399414539337, 0.6496321558952332, -0.43691393733024597, -0.9627586603164673, 0.120266392827034, -0.20824038982391357, -0.618812620639801, -0.330917626619339, 0.116301529109478, 1.0205172300338745, -1.3607620000839233, -0.43691781163215637, -0.04437137767672539, 0.360087513923645, -0.9564868807792664, 1.2595059871673584, -0.4959982931613922, 0.24193806946277618, 0.1448030173778534, 0.2206093966960907, 0.21716658771038055, -0.12027812749147415, 0.2547891139984131, -0.30102235078811646, -0.28012868762016296, 0.4364858865737915, 0.09835922718048096, 1.1670843362808228, -0.24925841391086578, 0.4351038634777069, -0.45384347438812256, -0.7866184711456299, 0.030437763780355453, 0.3059040606021881, -0.06934060156345367, -0.6486421823501587, 0.12372283637523651, 0.2350529432296753, -0.6422938704490662, 0.07097071409225464, 0.8336643576622009, 0.7210937142372131, -0.29850080609321594, -0.1651529222726822, 0.5172019004821777, -0.26776057481765747, 0.4404135048389435, 0.389950692653656, 0.42179447412490845, 0.6434541940689087, 0.33609381318092346, -0.5424890518188477, 0.2475818395614624, -0.4939901828765869, 0.15822435915470123, 0.2876330316066742, 0.6440914869308472, 0.7175840139389038, 0.6407557725906372, -0.7826546430587769, -0.4488881528377533, 0.1611308455467224, 0.35997968912124634, 1.5909266471862793, -0.3489018380641937, -0.4572645127773285, -0.7506558299064636, -0.4699855148792267, -0.3046329915523529, 0.37998777627944946, -0.3341391980648041, -0.11099348217248917, -0.36830124258995056, -0.7828931212425232, 0.9982211589813232, 0.26476240158081055, 0.69415682554245, -0.28451430797576904, -0.06216609850525856, -0.09603773057460785, 0.027391815558075905, -1.0664558410644531, -0.8792507648468018, 0.5810312628746033, -0.4273375868797302, -0.03194579854607582, 0.23019824922084808, -0.2413133978843689, -0.010164769366383553, -0.879194438457489, 1.0386332273483276, -0.1752251833677292, -0.05345684289932251, -0.2469024658203125, 0.4257481098175049, -0.8693153262138367, -0.8896062970161438, 0.3570573329925537, 0.24255985021591187, -0.3813428580760956, 0.539320170879364, 0.4785708785057068, 0.20233067870140076, 0.1420077681541443, -0.24993737041950226, -0.05179830268025398, -0.2585872709751129, 0.11527618020772934, 0.6393627524375916, -0.27041080594062805, 0.4226386547088623, -1.0479105710983276, 0.8428393602371216, -0.20078818500041962, -0.6620352268218994, 0.28750309348106384, -0.8105506300926208, -0.16546887159347534, 0.820441722869873, -0.6320921778678894, -0.18376091122627258, -0.8554727435112, 0.18060438334941864, -0.3959878385066986, 0.15465973317623138, 0.15983913838863373, 0.31029069423675537, 0.429806649684906, 0.2726188898086548, 0.7122984528541565, 0.06989756226539612, -0.18884186446666718, 0.38797417283058167, -0.500117838382721, 0.37993013858795166, 0.16507075726985931, -0.19923420250415802, -0.25812143087387085, -0.31780919432640076, -0.8305824398994446, -0.3767103850841522, -0.15844878554344177, -0.2027183473110199, -0.15098507702350616, -0.06553459912538528, -0.5205405354499817, -0.849585235118866, -0.1080261766910553, -0.9350930452346802, -0.3032657504081726, 0.06669659167528152, -0.3985469341278076, -0.2364329695701599, -0.9596790075302124, -1.292409062385559, -1.0475883483886719, -0.37127071619033813, -0.8864161968231201, 0.5744836330413818, -0.0038388147950172424, -0.3495318293571472, -0.4996993839740753, -0.20553849637508392, -0.3377143144607544, 1.0643209218978882, -0.7749421000480652, 0.7130325436592102, -0.21858851611614227, -0.34757062792778015, -0.15361380577087402, 0.1896970272064209, 0.47208699584007263, -0.09584793448448181, 0.22810257971286774, -0.9755111932754517, 0.3663903474807739, -0.5957483649253845, -0.03672933578491211, 0.0069664898328483105, -0.005691413301974535, 0.9122411012649536, -0.3364211916923523, -0.8277754187583923, 0.20418989658355713, 1.454630732536316, -0.290276437997818, -0.02105652168393135, -0.1858173906803131, 0.971040666103363, 0.21568498015403748, 0.005072262138128281, 0.4553394019603729, 0.5477752685546875, 0.5067724585533142, 0.2505383789539337, 0.0858868658542633, 0.19543488323688507, -0.8801779747009277, 0.2652604877948761, 1.7262300252914429, 0.26535704731941223, -0.023780427873134613, -1.0580103397369385, 1.0789093971252441, -1.3735684156417847, -0.48531776666641235, 0.4738483726978302, 0.7315030097961426, 0.44972050189971924, -0.5040649175643921, -0.22966092824935913, -0.2101956158876419, 0.375422865152359, -0.06512723118066788, -0.5768687725067139, -0.6589453220367432, 0.0495842806994915, 0.1252635419368744, 0.25222858786582947, 0.7075386643409729, -0.20006711781024933, 0.8515334129333496, 15.228774070739746, 1.017906904220581, 0.15104077756404877, 0.5685805082321167, 0.7125564813613892, 0.5542380213737488, -0.6042969822883606, -0.0018309978768229485, -1.1674283742904663, 0.3221127390861511, 1.2577248811721802, 0.2715698778629303, 0.7838265895843506, 0.088159941136837, 0.10433399677276611, 0.2823927104473114, -0.47880905866622925, 0.3299112319946289, 0.4716304540634155, -0.9750673770904541, 0.3194783329963684, -0.05583737790584564, 0.18971438705921173, 0.5038307905197144, 0.35532692074775696, 0.8031442761421204, 0.8309527635574341, -0.5812482833862305, 0.6175122857093811, 0.2450326830148697, 1.0231324434280396, -0.15263578295707703, 0.32118818163871765, 0.5237379670143127, -0.9471520781517029, -0.13216015696525574, -0.577695906162262, -1.1209135055541992, 0.18279056251049042, 0.284883975982666, -0.8046197891235352, -0.5915666818618774, 0.11138544231653214, 0.688737154006958, 0.09457669407129288, 0.17998000979423523, -0.11874279379844666, 0.8610252737998962, -0.15067046880722046, -0.13687826693058014, 0.26772814989089966, 0.4882749021053314, 0.3572666347026825, 0.1885225921869278, 0.0655454769730568, -0.2256266325712204, 0.03325716033577919, 0.6654717922210693, -0.30147096514701843, -0.022399963811039925, -0.39583879709243774, -0.1578608602285385, 0.18752636015415192, 0.5547017455101013, 0.5148962140083313, 0.07618901133537292, -0.43132761120796204, 0.24175694584846497, 0.9600173830986023, 0.07603707164525986, -0.39275696873664856, 0.14617109298706055, 0.18587975203990936, -0.28746551275253296, -0.026800846680998802, 0.6642093658447266, -0.08327215909957886, -0.539412796497345, -0.5866932272911072, -0.37292346358299255, 0.36232665181159973, -0.8088691830635071, -0.9148193597793579, 0.9520479440689087, -0.09121130406856537, -0.47244134545326233, -0.062015388160943985, -0.24365420639514923, 0.14131192862987518, 0.3224124312400818, -1.205201268196106, -0.6749253273010254, 0.37431949377059937, -0.4090861976146698, -0.11981009691953659, 0.1150614470243454, 1.1490261554718018, 0.19536833465099335, -0.003916015848517418, 0.31463679671287537, 0.010259113274514675, 0.06805989146232605, -0.289429247379303, -1.024216890335083, 0.9873387217521667, 0.19487498700618744, -0.2197999209165573, 0.2928290069103241, 0.19460251927375793, 0.3369773030281067, -0.5550749897956848, 0.04701279103755951, 1.003395438194275, -0.8621276021003723, -0.5637463927268982, -0.809429407119751, -1.0813424587249756, 0.4218584895133972, 0.6976963877677917, -0.15572097897529602, 0.3574121296405792, 0.07431303709745407, -0.40394067764282227, -0.005920844152569771, -0.8109546899795532, 0.24431820213794708, 1.0290290117263794, -0.68941730260849, -0.20425593852996826, -0.05784211307764053, 0.5496305227279663, -0.8871285915374756, -0.6210185885429382, -0.21537600457668304, 0.2265007346868515, -0.24233873188495636, 0.8410005569458008, -0.6104667782783508, 0.5676097273826599, 0.9359462261199951, -0.3602685034275055, -0.9575240015983582, -0.05869735777378082, -0.7920674085617065, -0.03758810833096504, 0.3708552420139313, 0.7062350511550903, -0.3893439471721649, 0.18997427821159363, 0.9042810201644897, 0.016631323844194412, -0.5638985633850098, -0.7607486248016357, -0.3339608609676361, 0.23777829110622406, -0.44496968388557434, 0.5274162888526917, 0.24017322063446045, 0.39204418659210205, 0.13995233178138733, 0.2690083682537079, 0.45419272780418396, 0.03205178305506706, -0.7277715802192688, -0.14685970544815063, 0.0881604254245758, 0.25048089027404785, -0.28442710638046265, -0.21151353418827057, -1.257582187652588, 0.11091636121273041, -1.2022459506988525, 0.2948513329029083, -0.6105603575706482, -0.6407722234725952, -0.3559119999408722, -0.14185115694999695, 0.020064109936356544, 0.2070680856704712, -0.4976150691509247, -0.4415624737739563, -0.5602107644081116, -0.41429224610328674, 0.7434595823287964, 0.7994884252548218, -0.7507537007331848, 0.23807166516780853, -0.03522736206650734, -0.2508993446826935, 0.21426676213741302, 0.4918784201145172, -0.5257074236869812, -0.4475409984588623, -1.3655962944030762, 0.36511069536209106, 0.09734559059143066, -0.274827778339386, -0.4754776358604431, 0.6676993370056152, 0.3122442960739136, -0.17362000048160553, 0.012104165740311146, 0.27431994676589966, -1.1884396076202393, -0.6191302537918091, 0.3052751123905182, -0.8524247407913208, 0.25571712851524353, 0.07796298712491989, -0.5504165291786194, -0.33130496740341187, 0.5968998670578003, -0.017596134915947914, -1.2897082567214966, -0.476263165473938, 0.38393929600715637, -0.7721288204193115, 0.5917806625366211, -0.4604571461677551, -0.18845205008983612, -0.775300920009613, -0.37242287397384644, 0.022937709465622902, 0.6188539266586304, -0.28882265090942383, 1.2951487302780151, 0.30497539043426514, -1.2769242525100708, -0.07876256853342056, 0.5573873519897461, 0.06490889936685562, 0.2264522910118103, 0.22566701471805573, 0.22562064230442047, -0.11523684859275818, 0.5997970700263977, 0.4364185929298401, -0.11272043734788895, -0.7917219400405884, 0.3434597849845886, 0.7575867176055908, -0.3600827753543854, -0.06150269880890846, 0.8350076079368591, -0.6218017935752869, -1.1415830850601196, 0.05910594016313553, -1.4048521518707275, -0.3019147217273712, -0.36382442712783813, 0.3898911774158478, 0.6318387389183044, -0.09252960979938507, -0.21554891765117645, -0.8308126926422119, 0.07694832980632782, -0.11852996796369553, -0.3741597533226013, 0.5069074630737305, -0.09125272929668427, -0.2551131248474121, 0.6544507145881653, 0.819238007068634, -0.5138177275657654, -0.7686258554458618, -0.7979257106781006, -0.21951347589492798, -0.2878587543964386, 0.005736264865845442, -0.3488204777240753, -0.4975138008594513, 0.6204538345336914, 0.36054474115371704, 0.4660845696926117, -0.161340594291687, -0.03703663498163223, 0.038755327463150024, 0.24045534431934357, 0.2500236928462982, -0.6850165724754333, -0.7733274102210999, 1.1571553945541382, 1.3012479543685913, -0.9512115120887756, -0.03684192895889282, -0.32746729254722595, -0.8296344876289368, 0.4457334280014038, 0.377803236246109, -0.09431593865156174, 0.9744747281074524, 0.14885686337947845, 0.12484252452850342, 0.33529457449913025, -0.9688203930854797, -0.1787714660167694, 0.5416449904441833, 1.1364848613739014, 0.765071451663971, 0.40010201930999756, 0.19844725728034973, 0.7370724081993103, -0.043906837701797485, 0.31896620988845825, 0.1563708484172821, 0.373352587223053, 0.006020089145749807, -0.07332046329975128, 0.23250712454319, 0.703141450881958, -0.8287613987922668, -1.0107920169830322, 0.1391383856534958, 0.33706119656562805, 0.23244617879390717, 0.7571138143539429, 0.7729968428611755, 0.08621687442064285, 0.42590445280075073, 0.26072657108306885, 0.17361102998256683, -0.12206734716892242, -0.22376005351543427, -0.3599407374858856, -0.5035414695739746, -0.03435126319527626, -0.22269009053707123, -0.6716458201408386, -0.4223773181438446, -0.0686880573630333, 0.022913608700037003, 0.23695191740989685, 0.20500174164772034, 0.9161592125892639, 0.6655610203742981, 0.5653781890869141, -0.18739081919193268, -0.22017352283000946, -0.3547079265117645, -1.169195294380188, 0.1798108071088791, -0.6762950420379639, 0.046905722469091415, 0.1100451648235321, -0.18288448452949524, -0.45851877331733704]}, "authors": [{"authorId": "2243808364", "name": "Shiyi Zhu"}, {"authorId": "2260831276", "name": "Jingting Ye"}, {"authorId": "2243775310", "name": "Wei Jiang"}, {"authorId": "2256972664", "name": "Qi Zhang"}, {"authorId": "2243304520", "name": "Yifan Wu"}, {"authorId": "2223080664", "name": "Jianguo Li"}], "references": [{"paperId": "104b0bb1da562d53cbda87aec79ef6a2827d191a", "title": "Llama 2: Open Foundation and Fine-Tuned Chat Models"}, {"paperId": "f5afaccfe90268485a9961c5771ec5e71e9b806c", "title": "Extending Context Window of Large Language Models via Positional Interpolation"}, {"paperId": "60b35c6d68acced19b0c66edcfc0ee0a2c11efed", "title": "Landmark Attention: Random-Access Infinite Context Length for Transformers"}, {"paperId": "a0e7c31d723608e03f30fc92ffc2a604a7a039da", "title": "PyTorch FSDP: Experiences on Scaling Fully Sharded Data Parallel"}, {"paperId": "57e849d0de13ed5f91d086936296721d4ff75a75", "title": "LLaMA: Open and Efficient Foundation Language Models"}, {"paperId": "9575afb5702bc33d7df14c48feeee5901ea00369", "title": "A Length-Extrapolatable Transformer"}, {"paperId": "c6d38add1b7bbc10f0da37a90e3f1b51ee5fb617", "title": "Neural Networks and the Chomsky Hierarchy"}, {"paperId": "e37018d3cfab9cfc29a7b78404e6c86ea18a907e", "title": "GPT-NeoX-20B: An Open-Source Autoregressive Language Model"}, {"paperId": "9ca329408813d209b1dcb36936f7f9cba82506bd", "title": "Train Short, Test Long: Attention with Linear Biases Enables Input Length Extrapolation"}, {"paperId": "66c10bf1f11bc1b2d92204d8f8391d087f6de1c4", "title": "RoFormer: Enhanced Transformer with Rotary Position Embedding"}, {"paperId": "50796b0f3edf9cb5ff1e447c298b33755378aa4f", "title": "GLM: General Language Model Pretraining with Autoregressive Blank Infilling"}, {"paperId": "db1afe3b3cd4cd90e41fbba65d3075dd5aebb61e", "title": "The Pile: An 800GB Dataset of Diverse Text for Language Modeling"}, {"paperId": "6f68e1bb253925d8431588555d3010419f322e04", "title": "Transformers are RNNs: Fast Autoregressive Transformers with Linear Attention"}, {"paperId": "90abbc2cf38462b954ae1b772fac9532e2ccd8b0", "title": "Language Models are Few-Shot Learners"}, {"paperId": "3c8a456509e6c0805354bd40a35e3f2dbf8069b1", "title": "PyTorch: An Imperative Style, High-Performance Deep Learning Library"}, {"paperId": "f51497f463566581874c941353dd9d80069c5b77", "title": "Compressive Transformers for Long-Range Sequence Modelling"}, {"paperId": "d3ecb512bc5c91fccfb50003b5094ad1e043b5bb", "title": "opt\\_einsum - A Python package for optimizing contraction order for einsum-like expressions"}, {"paperId": "45dfef0cc1ed96558c1c650432ce39d6a1050b6a", "title": "Fixing Weight Decay Regularization in Adam"}, {"paperId": "204e3073870fae3d05bcbc2f6a8e263d9b72e776", "title": "Attention is All you Need"}, {"paperId": "0e6824e137847be0599bb0032e37042ed2ef5045", "title": "Aligning Books and Movies: Towards Story-Like Visual Explanations by Watching Movies and Reading Books"}, {"paperId": null, "title": "Alon Benhaim, Vishrav Chaudhary, Xia Song, and Furu Wei. A length-extrapolatable transformer. ArXiv, abs/2212.10554"}, {"paperId": "df2b0e26d0599ce3e70df8a9da02e51594e0e992", "title": "BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding"}, {"paperId": null, "title": "Sam McCandlish, Alec Radford, Ilya Sutskever, and Dario Amodei. Language models are few-shot learners. ArXiv, abs"}, {"paperId": null, "title": "Ntk-aware scaled rope allows llama models to have extended (8k+) context size without any fine-tuning and minimal perplexity degradation"}, {"paperId": null, "title": "exists(layer_past) and layer_past.numel() > 0: past_t, past_value = layer_past t_layer = \\ 15"}, {"paperId": null, "title": "Cure the headache of Transformers via Collinear Constrained Attention"}]}