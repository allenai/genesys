{"paperId": "d4d920dad3e7ab80363d31d554a366d0ac076371", "title": "SqueezeAttention: 2D Management of KV-Cache in LLM Inference via Layer-wise Optimal Budget", "abstract": "Optimizing the Key-Value (KV) cache of the Large Language Model (LLM) has been considered critical to saving the cost of inference. Most of the existing KV-cache compression algorithms attempted to sparsify the sequence of tokens by taking advantage of the different importance of tokens. In this work, we found that by identifying the importance of attention layers, we could optimize the KV-cache jointly from two dimensions. Based on our observations regarding layer-wise importance in inference, we propose SqueezeAttention to precisely optimize the allocation of KV-cache budget among layers on-the-fly and then incorporate three representative token sparsification algorithms to compress the KV-cache for each layer with its very own budget. By optimizing the KV-cache from both sequence's and layer's dimensions, SqueezeAttention achieves around 30% to 70% of the memory reductions and up to 2.2 times of throughput improvements in a wide range of LLMs and benchmarks. The code is available at https://github.com/hetailang/SqueezeAttention.", "venue": "arXiv.org", "year": 2024, "citationCount": 1, "influentialCitationCount": 0, "openAccessPdf": null, "tldr": {"model": "tldr@v2.0.0", "text": "This work proposes SqueezeAttention to precisely optimize the allocation of KV-cache budget among layers on-the-fly and then incorporate three representative token sparsification algorithms to compress the KV-cache for each layer with its very own budget."}, "embedding": {"model": "specter_v2", "vector": [0.036438748240470886, 0.5832820534706116, -0.9862936735153198, 0.03884459286928177, -0.6540355682373047, 0.226066455245018, 0.5989577174186707, 0.17983312904834747, -0.9869965314865112, -0.13800063729286194, 0.8959534168243408, -0.1806490570306778, 0.29367855191230774, 0.2183847725391388, -0.2581179440021515, 0.14341725409030914, -0.904306173324585, 0.2740304470062256, 0.05532602593302727, 0.07107070088386536, -0.1397414654493332, -0.6516559720039368, -1.2832691669464111, 0.36883512139320374, 0.433852881193161, 0.7569286823272705, 0.19161374866962433, 0.9679871201515198, -0.7700864672660828, 0.35865339636802673, 0.6056979298591614, -0.12136422097682953, 0.10330111533403397, 0.013185810297727585, -0.3152611255645752, -0.2719016373157501, 0.30059200525283813, -0.5771854519844055, -0.6323726773262024, 0.824679970741272, -0.13572826981544495, 0.33226683735847473, 0.32980480790138245, -0.7502031922340393, 0.21915391087532043, 1.1175129413604736, 0.3774801194667816, 0.9664486646652222, -0.8858574628829956, -0.7083674669265747, 1.233705759048462, -1.4900966882705688, 0.005721594672650099, 1.3339813947677612, 0.41689252853393555, 0.29971909523010254, -0.28392162919044495, -0.18522386252880096, 0.9134587645530701, 0.3564375638961792, -1.0323607921600342, -0.7456738948822021, -0.34014320373535156, 0.2705172300338745, 2.21750807762146, 0.07323741912841797, 0.1752336621284485, 0.19169297814369202, -0.33210474252700806, 1.5722196102142334, -0.4264393150806427, -0.9191434979438782, -0.11961409449577332, 0.03798537701368332, 0.429841011762619, 0.9501880407333374, -0.1388845294713974, 0.18423013389110565, -1.0495120286941528, -0.35979950428009033, 0.24817918241024017, -0.0492435097694397, 0.38922885060310364, 0.07772313058376312, 0.015917308628559113, 0.7060462236404419, -0.02232939377427101, 0.8385295271873474, -0.026723593473434448, 1.019296646118164, 0.933624804019928, -0.054809313267469406, 0.32605570554733276, 0.045515026897192, -0.13228552043437958, -0.058472614735364914, -1.4277695417404175, 0.3461460471153259, -0.16490623354911804, 0.708461344242096, -0.34560930728912354, 0.3818827271461487, -1.0840362310409546, 0.24757733941078186, 1.3312867879867554, 0.15633614361286163, 0.6039145588874817, -0.7734662890434265, 0.29343727231025696, -0.9261155128479004, -0.1741303652524948, -0.21290439367294312, -0.00042806236888282, -0.04038834571838379, -0.981269121170044, -1.2244195938110352, -0.562148928642273, 0.36886072158813477, -0.8974391222000122, 0.7814937233924866, -0.14996270835399628, 0.6073348522186279, -0.0345890074968338, 0.46435171365737915, 0.6026747226715088, 0.7184804677963257, 0.2886424958705902, -0.09620627760887146, 1.1786656379699707, -1.1633802652359009, -0.6245120167732239, -1.0740045309066772, 0.787177562713623, 0.0033838478848338127, 0.22766819596290588, -0.4386870563030243, -1.729122281074524, -1.0419585704803467, -0.848493754863739, -0.21215291321277618, -0.49433135986328125, -0.024762315675616264, 1.0943886041641235, 0.25093644857406616, -0.9478026628494263, 0.507810652256012, -0.5398160219192505, 0.32080522179603577, 0.4725090265274048, 0.05756860226392746, 0.3440517783164978, -0.24986699223518372, -1.6026899814605713, 0.2556101679801941, 0.3217889368534088, -0.6969304084777832, -0.20020920038223267, -1.0660779476165771, -1.297337293624878, 0.39415985345840454, 0.4687969386577606, -0.4664561450481415, 1.3883317708969116, 0.31540966033935547, -1.0539089441299438, 0.45843076705932617, -0.6614423990249634, -0.10494464635848999, 0.3078390955924988, -0.13952559232711792, -0.3669692873954773, -0.3869965374469757, -0.3450755774974823, 0.4014304280281067, 0.7421764731407166, -0.2597971558570862, -0.45350781083106995, 0.21498356759548187, -0.4302840828895569, 0.06758323311805725, -0.2280033677816391, 0.6843315958976746, -0.8914414644241333, -0.07539531588554382, 0.32031792402267456, 0.8759555816650391, -0.20058438181877136, -0.12295601516962051, -0.4447718858718872, -0.8815863728523254, 0.4900871515274048, 0.04945056512951851, 1.4670114517211914, -0.9220657348632812, -0.849170446395874, 0.0665581002831459, 0.16399334371089935, 0.2491510659456253, -0.5495045185089111, 0.3440517485141754, 0.05394947528839111, 0.49406421184539795, -0.149551123380661, -1.2606641054153442, 0.3981153964996338, -0.2250140756368637, -0.8483464121818542, -0.3236795663833618, -0.05306962504982948, 0.9433952569961548, -0.8085271120071411, -0.46927395462989807, -0.10168346762657166, 0.4017026126384735, -1.2814481258392334, 1.2623354196548462, -0.5545076131820679, -0.09450322389602661, -0.09357994049787521, -0.2881625294685364, 0.3458504378795624, -0.10312332212924957, 0.5334197878837585, -0.4606550931930542, -0.16757090389728546, 0.6798113584518433, -0.4866543710231781, 1.2187001705169678, -0.5132643580436707, 0.34475991129875183, 0.09038496017456055, -0.5608513951301575, -0.08719255775213242, 0.487599641084671, -0.28531479835510254, -0.37943652272224426, 0.048015981912612915, 0.4040451943874359, -0.659486711025238, 0.15683366358280182, 1.3240050077438354, 0.7599101066589355, -0.5931098461151123, 0.23202702403068542, 0.30314400792121887, -0.08558638393878937, 0.4815155863761902, 0.8555062413215637, 0.4205814003944397, 0.10066543519496918, 0.5032702088356018, 0.0343400314450264, 0.3504581153392792, -0.8757970333099365, -0.09072216600179672, 1.0486465692520142, 0.6635028719902039, 0.4555589556694031, 0.5094874501228333, -0.574379563331604, -0.73443204164505, 0.3559572100639343, 0.37037989497184753, 1.4448394775390625, -0.18950827419757843, -0.4461766183376312, -0.6447373032569885, -0.30547353625297546, 0.06379463523626328, 0.16587939858436584, -0.07525090128183365, -0.2721511423587799, -0.631303071975708, -0.968927800655365, 1.2254855632781982, 0.35074424743652344, 1.0261834859848022, -0.5600541234016418, -0.2222849726676941, -0.3952539265155792, 0.18603938817977905, -0.9072025418281555, -0.37997955083847046, 0.40224847197532654, -0.49463802576065063, 0.4458669126033783, 0.4942455589771271, 0.12721705436706543, 0.18586783111095428, -0.7003200650215149, 1.0442932844161987, 0.031122049316763878, -0.38195234537124634, -0.2136363834142685, 0.5881777405738831, -0.2736239433288574, -0.9001333117485046, 0.3765062391757965, 0.18602335453033447, -0.48397013545036316, 0.5097617506980896, 0.6444782614707947, 0.099307581782341, -0.4691946506500244, -0.527248203754425, 0.23786671459674835, -0.12779274582862854, -0.11227794736623764, 0.8399810194969177, -0.09375515580177307, -0.2302228957414627, -1.1126161813735962, 0.9064598083496094, 0.041365332901477814, -0.44041967391967773, 0.08944639563560486, -0.6897657513618469, 0.005470954347401857, 0.569413959980011, -0.7138486504554749, -0.28159111738204956, -1.2108972072601318, -0.23245938122272491, -0.48595505952835083, -0.15399658679962158, 0.1722905933856964, 0.19933801889419556, 0.543657124042511, -0.3424471616744995, 0.8684359192848206, 0.17952218651771545, -0.4643107056617737, 0.8867647051811218, -0.5694743990898132, 0.50938481092453, -0.07700376957654953, -0.08001867681741714, -0.07765306532382965, -0.17648890614509583, -0.9277912378311157, -0.3218540549278259, -0.36754193902015686, -0.1709340363740921, 0.020188814029097557, -0.10268529504537582, -0.6128756403923035, -0.7782866358757019, -0.19610631465911865, -0.9949816465377808, -0.39431020617485046, 0.0682859718799591, -0.06798702478408813, -0.29780733585357666, -0.8948942422866821, -1.5946319103240967, -0.6739429831504822, -0.7184321284294128, -1.111904501914978, 0.4848363697528839, -0.1867993026971817, -0.4152846038341522, -0.6039413213729858, -0.3540756106376648, -0.36876335740089417, 1.2786495685577393, -1.1218096017837524, 1.0839980840682983, 0.03663378953933716, -0.2865111231803894, -0.11116426438093185, 0.019083598628640175, 0.4005202651023865, -0.5531353950500488, 0.05277436226606369, -0.8633440136909485, 0.29506441950798035, -0.4048205316066742, -0.3701416850090027, 0.7039574384689331, 0.5120997428894043, 1.0369346141815186, -0.31723153591156006, -0.8019995093345642, 0.622789740562439, 1.459739089012146, -1.0289466381072998, 0.23991240561008453, -0.19288316369056702, 0.9456846714019775, -0.5466505289077759, 0.012864294461905956, 0.890852153301239, 0.17600956559181213, 0.5026187896728516, 0.15188229084014893, -0.19358447194099426, -0.16700801253318787, -0.48342645168304443, 0.3945449888706207, 2.090122938156128, 0.4825725257396698, -0.18173860013484955, -0.44122958183288574, 0.5077495574951172, -1.591603398323059, -0.770222008228302, 0.8308739066123962, 0.7727060914039612, 0.6548742651939392, -0.20609356462955475, -0.1736292988061905, 0.03581203147768974, 0.016691336408257484, 0.7022325992584229, -0.30915263295173645, -1.1256992816925049, 0.2808454632759094, 0.2956565320491791, 0.45361119508743286, 1.0745340585708618, -0.17208223044872284, 0.8680839538574219, 14.365211486816406, 1.4930981397628784, 0.08673008531332016, 0.6735149621963501, 0.7385017275810242, 0.06586110591888428, -0.5803732872009277, -0.22069016098976135, -1.828741431236267, 0.17887923121452332, 1.35816490650177, 0.1372644156217575, 0.47893911600112915, 0.09571641683578491, 0.10947495698928833, 0.018062397837638855, -0.14581066370010376, 0.2228085845708847, 0.322530597448349, -1.6436233520507812, 0.4372057020664215, -0.004044803325086832, 0.04824160411953926, 0.4388023018836975, 0.6809514760971069, 0.8670970797538757, 0.43396589159965515, -0.5567955374717712, 0.6550397276878357, 0.36077681183815, 1.17708420753479, -0.35219162702560425, 0.3638226091861725, 0.7093808054924011, -1.1310409307479858, 0.07295745611190796, -0.6750617027282715, -1.0772171020507812, 0.40666356682777405, 0.22991950809955597, -0.7679280638694763, -0.7526909112930298, -0.3257105350494385, 0.236770361661911, 0.49072444438934326, 0.13932348787784576, 0.0044569880701601505, 0.8717000484466553, -0.2906283736228943, 0.09231294691562653, 0.475879967212677, 0.7145763635635376, 0.18316811323165894, 0.3513558804988861, -0.18104904890060425, -0.18357683718204498, 0.15987864136695862, 0.5411511659622192, -0.5625350475311279, -0.4056139886379242, -0.04059780761599541, -0.12321632355451584, 0.42279309034347534, 0.7523041367530823, 0.5553576946258545, -0.09605339169502258, -0.5520545840263367, 0.20878691971302032, 0.8585056662559509, -0.047570858150720596, -0.3893449604511261, 0.2221941351890564, 0.7237676382064819, -0.48391711711883545, 0.35410165786743164, 0.524463951587677, -0.11266759783029556, -0.48547011613845825, -0.7805740833282471, -0.5317527651786804, 0.32210466265678406, -0.38857609033584595, -0.3988853693008423, 0.6997944712638855, 0.1587841659784317, -0.03690600395202637, 0.13895262777805328, -0.30532070994377136, 0.02036244235932827, 0.38029375672340393, -1.4575814008712769, -0.4746018648147583, 0.8285305500030518, -0.5999205708503723, -0.26904624700546265, 0.2624731957912445, 1.3973042964935303, 0.40356117486953735, -0.38574138283729553, 0.5508080720901489, 0.41582998633384705, -0.03638674318790436, -0.5058582425117493, -0.5095961689949036, 1.1092722415924072, 0.3922988772392273, -0.08021049201488495, 0.27373048663139343, -0.24159842729568481, 0.14328554272651672, -0.7928961515426636, -0.3555489480495453, 0.8983780741691589, -0.6574563384056091, -0.6426201462745667, -0.9350873231887817, -0.9444615840911865, 0.3465408980846405, 0.43536630272865295, 0.044562190771102905, 0.41346225142478943, -0.008054564706981182, -0.4337379038333893, -0.07932482659816742, -0.6986620426177979, 0.15187335014343262, 0.5284237861633301, -0.6045123338699341, 0.0730760395526886, -0.3984740376472473, 0.6328827738761902, -1.2156541347503662, -0.8556294441223145, -0.24586398899555206, 0.11273874342441559, -0.035884544253349304, 1.1721644401550293, -0.5863324999809265, 0.7646478414535522, 0.8695709705352783, -0.4147374927997589, -0.6810641884803772, -0.11537269502878189, -0.5116766691207886, -0.56022047996521, 0.13645237684249878, 0.8389813303947449, 0.02220412716269493, 0.3229018747806549, 0.8887534737586975, 0.3550829291343689, -0.7504050731658936, -0.8479772806167603, -0.10518289357423782, 0.008370833471417427, -0.7825421094894409, 0.5951172709465027, -0.30170413851737976, 0.2613067030906677, -0.02980562299489975, 0.1119568943977356, 0.526046097278595, -0.2154434770345688, -0.6970961093902588, 0.3630240857601166, 0.5151670575141907, -0.0993444100022316, -0.5166826844215393, -0.4645867943763733, -1.3918646574020386, 0.0068100676871836185, -1.3253146409988403, 0.11597458273172379, -0.710929811000824, -0.04274984076619148, -0.18923917412757874, -0.3576600253582001, 0.12391912937164307, 0.06163584813475609, -0.18405631184577942, -0.4437229335308075, -0.7524944543838501, -0.7450272440910339, 0.7829321026802063, 0.6214801669120789, -0.5556646585464478, 0.3378441631793976, -0.14483048021793365, 0.1303425133228302, 0.24253204464912415, 0.4470638036727905, -0.5415676236152649, -0.7655191421508789, -1.2652723789215088, 0.19318947196006775, 0.06870358437299728, -0.3809658885002136, -0.4257851243019104, 0.7925006151199341, 0.43599167466163635, -0.2181089222431183, -0.12105591595172882, 0.6267908811569214, -0.7420037984848022, -0.5849359035491943, 0.5082723498344421, -1.078570008277893, -0.05278243497014046, 0.5890443921089172, -0.6303860545158386, -0.36568427085876465, 0.3881036043167114, -0.20909534394741058, -1.0548980236053467, -0.9520710110664368, 0.5477598309516907, -0.643971860408783, 0.4270888566970825, -0.8380841016769409, 0.17945608496665955, -1.0861303806304932, -0.3629952669143677, 0.2123507261276245, -0.01588592305779457, -0.3395506739616394, 0.7391479015350342, 0.6138046383857727, -1.1802388429641724, 0.009365291334688663, 0.709861159324646, -0.25274142622947693, 0.11860735714435577, 0.6057746410369873, 0.3483806848526001, -0.19399885833263397, 0.6757587194442749, 0.5405608415603638, 0.3830015957355499, -1.244991421699524, 0.030400503426790237, 0.4182937443256378, -0.9031156897544861, -0.5717067718505859, 1.1599196195602417, -0.7420774102210999, -0.6657440662384033, 0.13384467363357544, -1.494844913482666, -0.30262815952301025, -0.7072581648826599, 0.9104852080345154, 0.2370131015777588, -0.061990417540073395, -0.06578104197978973, -0.7973231077194214, -0.040125772356987, -0.3529280424118042, -0.701541006565094, 0.3242065906524658, -0.044226549565792084, -0.6459971070289612, 0.46352866291999817, 1.108117938041687, -0.4122041165828705, -0.6669567823410034, -0.8544288873672485, -0.37059086561203003, -0.24238109588623047, 0.7393182516098022, -0.05411326140165329, -0.5276715159416199, 0.5502994656562805, 0.18903633952140808, 0.39898884296417236, -0.10115289688110352, -0.1253509670495987, 0.606507420539856, 0.4467918872833252, 0.000576638150960207, -0.645135760307312, -0.965623140335083, 1.2059283256530762, 0.698318600654602, -0.794542133808136, 0.5035102963447571, 0.1023782417178154, -0.7713696956634521, 0.4965459108352661, 0.3118501603603363, 0.12587858736515045, 1.043932318687439, 0.5053266882896423, 0.025928035378456116, 0.2685096263885498, -1.4265751838684082, -0.3640967905521393, 0.8562653064727783, 0.6788542866706848, 0.6243938207626343, 0.44575583934783936, 0.16161639988422394, 0.950751543045044, 0.3510751724243164, -0.027910200878977776, 0.09298641979694366, 0.45728012919425964, -0.5331611037254333, -0.041528187692165375, 0.0835360512137413, 0.971416175365448, -0.8136017918586731, -1.0262906551361084, 0.6378841400146484, 0.6397008299827576, 0.1492471992969513, 0.41220107674598694, 1.1443134546279907, 0.11472339183092117, 0.03071172907948494, 0.18351083993911743, 0.6732301712036133, -0.3310377597808838, -0.10424737632274628, -0.15156421065330505, -0.49164023995399475, -0.06659084558486938, 0.10483703762292862, -0.08446342498064041, -0.8760489225387573, -0.592279314994812, 0.5025814175605774, 0.27310559153556824, 0.36627665162086487, 1.1861358880996704, 0.7817493081092834, 0.5655045509338379, -0.5786343812942505, -0.35609981417655945, -0.422529011964798, -0.9565616250038147, -0.2571772634983063, -0.5034084916114807, -0.06664372980594635, 0.21999719738960266, -0.22938324511051178, -0.5049348473548889]}, "authors": [{"authorId": "2295682814", "name": "Zihao Wang"}, {"authorId": "2295666797", "name": "Shaoduo Gan"}], "references": [{"paperId": "eb95c327260725498404eb43ec370d419b8d92c7", "title": "SGLang: Efficient Execution of Structured Language Model Programs"}, {"paperId": "6c323c535365e1c7cbfd9703cbec3b5650a3346b", "title": "Model Tells You What to Discard: Adaptive KV Cache Compression for LLMs"}, {"paperId": "fdc53c2c10742464087c0525f77e32604827a21d", "title": "Efficient Streaming Language Models with Attention Sinks"}, {"paperId": "83b90f4a0ae4cc214eb3cc140ccfef9cd99fac05", "title": "Efficient Memory Management for Large Language Model Serving with PagedAttention"}, {"paperId": "b31a5884a8ebe96b6300839b28608b97f8f8ef76", "title": "LongBench: A Bilingual, Multitask Benchmark for Long Context Understanding"}, {"paperId": "104b0bb1da562d53cbda87aec79ef6a2827d191a", "title": "Llama 2: Open Foundation and Fine-Tuned Chat Models"}, {"paperId": "ce9435c82dc9b576f2037aa2f4357a520be9b2aa", "title": "SkipDecode: Autoregressive Skip Decoding with Batching and Caching for Efficient LLM Inference"}, {"paperId": "d6eeb2898bd9bd34744194ef543062dda6c4531a", "title": "Scissorhands: Exploiting the Persistence of Importance Hypothesis for LLM KV Cache Compression at Test Time"}, {"paperId": "c193eb176985a81ae64f63c5e50b2f11cfb7c4e6", "title": "Dynamic Context Pruning for Efficient and Interpretable Autoregressive Transformers"}, {"paperId": "42a14d824caa3348046eb34c37e2ab7985faa7a3", "title": "High-throughput Generative Inference of Large Language Models with a Single GPU"}, {"paperId": "3df83a60f55c64b40e6dbcd99cf9f67894a0736e", "title": "Do Transformers Need Deep Long-Range Memory?"}, {"paperId": "925ad2897d1b5decbea320d07e99afa9110e09b2", "title": "Longformer: The Long-Document Transformer"}, {"paperId": "f4238bd2385a52413ccbacfd9e409a650235bd13", "title": "Adaptive Attention Span in Transformers"}, {"paperId": "7f74703f583650ec274d25d15e1b51ba084d8661", "title": "Soft Similarity and Soft Cosine Measure: Similarity of Features in Vector Space Model"}, {"paperId": null, "title": "2023. Mistral 7b"}, {"paperId": null, "title": "2024. H2o: Heavy-hitter oracle for efficient generative inference of large language models"}, {"paperId": null, "title": "2023. Llmcarbon: Modeling the end-to-end carbon foot-print of large language models"}]}