{"paperId": "c9603ec967879c24973b5bd48861df2e5555932e", "title": "LongRoPE: Extending LLM Context Window Beyond 2 Million Tokens", "abstract": "Large context window is a desirable feature in large language models (LLMs). However, due to high fine-tuning costs, scarcity of long texts, and catastrophic values introduced by new token positions, current extended context windows are limited to around 128k tokens. This paper introduces LongRoPE that, for the first time, extends the context window of pre-trained LLMs to an impressive 2048k tokens, with up to only 1k fine-tuning steps at within 256k training lengths, while maintaining performance at the original short context window. This is achieved by three key innovations: (i) we identify and exploit two forms of non-uniformities in positional interpolation through an efficient search, providing a better initialization for fine-tuning and enabling an 8x extension in non-fine-tuning scenarios; (ii) we introduce a progressive extension strategy that first fine-tunes a 256k length LLM and then conducts a second positional interpolation on the fine-tuned extended LLM to achieve a 2048k context window; (iii) we readjust LongRoPE on 8k length to recover the short context window performance. Extensive experiments on LLaMA2 and Mistral across various tasks demonstrate the effectiveness of our method. Models extended via LongRoPE retain the original architecture with minor modifications to the positional embedding, and can reuse most pre-existing optimizations.", "venue": "arXiv.org", "year": 2024, "citationCount": 38, "influentialCitationCount": 1, "openAccessPdf": null, "tldr": {"model": "tldr@v2.0.0", "text": "This paper introduces LongRoPE that, for the first time, extends the context window of pre-trained LLMs to an impressive 2048k tokens, with up to only 1k fine-tuning steps at within 256k training lengths, while maintaining performance at the original short context window."}, "embedding": {"model": "specter_v2", "vector": [0.10870174318552017, 0.34257474541664124, -0.6642859578132629, -0.18249930441379547, -0.37510254979133606, -0.39925986528396606, 0.6920714974403381, -0.1419650912284851, -0.7882124185562134, -0.1604996621608734, 0.5376701951026917, -0.09335552155971527, 0.8479329347610474, 0.4450420141220093, 0.0029154859948903322, -0.0661897286772728, -0.9966782927513123, -0.0061851073987782, -0.07306314259767532, -0.07954994589090347, -0.2029239386320114, -0.7043120861053467, -0.4347657859325409, 0.3167934715747833, 0.2928641140460968, 0.33167949318885803, 0.5135128498077393, 0.862322211265564, -0.49366331100463867, 0.1151868924498558, 0.33195772767066956, -0.21341928839683533, 0.022047342732548714, 0.1458415985107422, -0.3858805000782013, -0.41374441981315613, 0.4047282636165619, -0.42786937952041626, -0.22238552570343018, 0.5225046873092651, -0.1843857765197754, 0.43160921335220337, 0.016906484961509705, -0.6642013192176819, -0.3494226932525635, 1.2976800203323364, 0.6288543343544006, 0.5973129868507385, -0.712428867816925, -0.54742431640625, 1.4025262594223022, -1.8137753009796143, 0.06542380899190903, 1.2347348928451538, 0.7621432542800903, 0.47015032172203064, -0.49408429861068726, -0.49257034063339233, 0.9431607127189636, 0.20426923036575317, -0.8240091800689697, -0.5765169262886047, 0.08847144991159439, 0.3800884485244751, 2.282792806625366, -0.14261357486248016, 0.18362200260162354, 0.7758216857910156, -0.05004372447729111, 1.5507936477661133, -0.14003682136535645, -1.0766648054122925, -0.3149126470088959, 0.1947280615568161, 0.37101855874061584, 0.13729806244373322, -0.4878031015396118, 0.27528509497642517, -0.6644173264503479, -0.24890905618667603, 0.18971142172813416, -0.22715264558792114, 0.5995586514472961, 0.1603291630744934, -0.498158723115921, 0.5691530108451843, 0.16621725261211395, 1.1041462421417236, 0.01659264601767063, 0.9290258884429932, 0.5282042026519775, 0.21854998171329498, 0.2563571333885193, 0.37794867157936096, -0.46676310896873474, 0.18054527044296265, -1.1952221393585205, 0.22971193492412567, -0.26128384470939636, 0.6957484483718872, -0.2954501211643219, 0.3465736508369446, -0.6200211048126221, 0.22680898010730743, 1.2915165424346924, 0.09274638444185257, 0.5253188610076904, -0.6802465319633484, 0.4952688217163086, -0.7171555161476135, 0.025170426815748215, -0.4327543377876282, -0.23205381631851196, -0.3049177825450897, -0.4152836501598358, -1.293330430984497, -0.3396861255168915, -0.04454337805509567, -0.2733096778392792, 1.0265926122665405, 0.022507481276988983, 0.4516659677028656, 0.21356110274791718, 0.1659718155860901, 0.6449587345123291, 0.838966965675354, 0.3895356059074402, 0.1349850296974182, 0.7400016188621521, -1.5287271738052368, -0.6394072771072388, -1.3821899890899658, 1.0299566984176636, -0.3870154917240143, 0.7279702425003052, -0.41398054361343384, -0.9576461315155029, -0.8450193405151367, -1.0813074111938477, -0.22237811982631683, -1.0151296854019165, 0.6737051606178284, 0.8256878852844238, 0.5073725581169128, -0.7025353908538818, 0.8481878638267517, -0.27705445885658264, 0.1046142578125, -0.0639127865433693, -0.011567864567041397, 0.3271610736846924, -0.10352219641208649, -1.9148222208023071, 0.41301223635673523, 0.5197724103927612, -0.08100613951683044, 0.1999792605638504, -0.6268460154533386, -1.0627743005752563, -0.09584783762693405, 0.4094485938549042, -0.16909322142601013, 1.2662185430526733, -0.0857098177075386, -1.3861724138259888, 0.5590827465057373, -0.25600114464759827, 0.08317718654870987, 0.2741301655769348, -0.3547094166278839, -0.7426517605781555, -0.7883754968643188, -0.5135976672172546, 0.6163520216941833, 0.43208807706832886, 0.192747101187706, 0.051485054194927216, 0.24225278198719025, -0.24443553388118744, 0.16774395108222961, -0.4442819654941559, 0.7735347151756287, -0.18645237386226654, -0.5357128977775574, 0.14854586124420166, 0.44975563883781433, -0.16991625726222992, -0.5702419877052307, -0.2658323347568512, -1.1031529903411865, 0.7857469916343689, 0.09284602850675583, 1.397151231765747, -0.732803225517273, -0.869124710559845, -0.12820884585380554, -0.43784987926483154, 0.06750839948654175, -0.9409482479095459, 0.6399891376495361, -0.2115286886692047, 0.43649083375930786, 0.22294773161411285, -1.6075234413146973, 0.3356773555278778, -0.22149758040905, -0.60353022813797, -0.23857539892196655, 0.04472583904862404, 1.1826624870300293, -1.026619791984558, -0.14810071885585785, -0.07419468462467194, 0.5047302842140198, -0.9386584758758545, 0.8033508062362671, -0.5073151588439941, -0.03649694845080376, 0.11185942590236664, -0.16728124022483826, -0.20075605809688568, -0.18278777599334717, 0.5221211910247803, 0.019877733662724495, -0.2911216914653778, 0.8089877963066101, -0.7552672028541565, 1.4574068784713745, -0.7801333665847778, 0.6804019212722778, -0.1196637973189354, 0.051708243787288666, -0.22382532060146332, 0.32658085227012634, -0.3186611235141754, 0.09062805026769638, 0.17391635477542877, 0.5353966951370239, -0.8804975152015686, 0.4165396988391876, 1.2730076313018799, 1.0033286809921265, -0.3561471104621887, 0.00731106149032712, 0.1743442863225937, -0.09354598820209503, 0.2591384947299957, 0.3682154417037964, 0.24740374088287354, 0.638023853302002, 0.2934223711490631, -0.0224493145942688, 0.40820857882499695, -0.7562317252159119, -0.027258342131972313, 0.42349666357040405, 0.6192343235015869, 0.6287738084793091, 0.28560420870780945, -0.45702990889549255, -0.507808268070221, 0.2545791566371918, 0.3909301459789276, 1.7139182090759277, -0.27361780405044556, -0.3209068179130554, -0.698216438293457, -0.165047287940979, -0.2439962476491928, 0.04095013439655304, -0.30232661962509155, 0.2863394618034363, -0.7198230624198914, -0.9363356828689575, 1.0027239322662354, 0.27153798937797546, 0.6926233172416687, -0.7921110391616821, -0.41060760617256165, 0.022459471598267555, 0.1136280745267868, -0.9485557675361633, -0.9517953991889954, 0.30848202109336853, -0.7314294576644897, 0.1575000286102295, 0.17426425218582153, -0.18445827066898346, 0.050466179847717285, -0.764523446559906, 0.8693955540657043, -0.5609592795372009, -0.1338929980993271, -0.08596985042095184, 0.3983030915260315, -0.2434656322002411, -0.6926476359367371, 0.5877549052238464, 0.506787896156311, -0.2148549109697342, 0.34749624133110046, 0.5869213342666626, 0.0992877334356308, -0.18953461945056915, -0.32819974422454834, 0.1992788016796112, 0.19606739282608032, 0.20112743973731995, 1.0447413921356201, -0.38118308782577515, 0.38732999563217163, -1.3281959295272827, 0.7630444765090942, 0.32882967591285706, -0.3394797146320343, 0.2389906793832779, -0.9106208086013794, -0.4556736350059509, 0.5224857330322266, -1.0350421667099, -0.25644761323928833, -0.8360029458999634, 0.19410909712314606, -0.19471508264541626, -0.015387028455734253, 0.1917833387851715, -0.019032523036003113, 0.5049490928649902, 0.03100164420902729, 0.3724868595600128, -0.14267469942569733, -0.43934616446495056, 0.9276260137557983, -0.6101377606391907, 0.48167186975479126, 0.267854779958725, -0.10170825570821762, -0.4418794512748718, -0.33702200651168823, -0.8652597665786743, -0.25941231846809387, -0.7174499034881592, -0.5669080018997192, -0.08785773068666458, 0.0539664551615715, -0.6167099475860596, -0.6476994752883911, 0.1606416255235672, -0.9663872718811035, -0.4871610701084137, 0.16421891748905182, -0.15849243104457855, 0.014371265657246113, -0.8548619747161865, -1.2324180603027344, -0.45758256316185, -0.8410075902938843, -0.858858048915863, 0.3188263475894928, 0.08175299316644669, -0.4538615047931671, -1.0349690914154053, 0.12377013266086578, -0.48886317014694214, 1.2163851261138916, -0.40052640438079834, 0.6892978549003601, -0.13030706346035004, 0.2007111757993698, -0.5467221736907959, 0.471892774105072, 0.6127172708511353, -0.46609002351760864, 0.38085100054740906, -1.1438859701156616, 0.12239470332860947, -0.40405744314193726, -0.19315023720264435, 0.2133212387561798, 0.28703686594963074, 0.48332977294921875, -0.27695637941360474, -0.630748450756073, 0.3663862645626068, 1.3621869087219238, -0.9989368915557861, 0.09562262892723083, 0.2597436308860779, 0.8306156396865845, -0.040792159736156464, -0.1710817962884903, 0.43916091322898865, 0.2575736939907074, 0.35839030146598816, 0.2352399230003357, -0.016642890870571136, -0.03948819637298584, -0.6596981287002563, 0.6781186461448669, 1.6381804943084717, 0.5737642049789429, 0.21905013918876648, -0.9350184202194214, 0.8198387622833252, -1.0415962934494019, -0.8886226415634155, 0.6259710788726807, 0.8255975246429443, 0.9217151403427124, -0.2886808216571808, -0.46539607644081116, -0.3709413409233093, 0.3339628577232361, 0.7785619497299194, -0.542750358581543, -0.9360059499740601, -0.29347196221351624, -0.030105844140052795, -0.024473536759614944, 0.9059270620346069, -0.6126372814178467, 1.0659481287002563, 14.562529563903809, 1.0510174036026, 0.049803607165813446, 0.5259363055229187, 0.7785129547119141, -0.27068281173706055, -0.4219624102115631, 0.07033707201480865, -1.5914909839630127, 0.014201529324054718, 1.2595574855804443, 0.42369502782821655, 0.5809392333030701, 0.37631887197494507, 0.3887459635734558, 0.12207183241844177, -0.7376982569694519, 0.49896520376205444, 0.3707641065120697, -1.403590202331543, 0.05219631269574165, -0.0022394261322915554, 0.7415978312492371, 0.6439618468284607, 0.8964417576789856, 0.9823511242866516, 0.15185518562793732, -0.40750622749328613, 0.6063765287399292, -0.01228793803602457, 1.009222388267517, -0.2684735059738159, 0.3260609209537506, 0.45041072368621826, -0.9544748067855835, -0.15185342729091644, -0.7703174352645874, -1.0824586153030396, -0.10717128962278366, 0.26265090703964233, -0.5328144431114197, -0.6666932702064514, -0.2977823317050934, 0.8234251141548157, -0.2603030502796173, 0.19691316783428192, -0.07805951684713364, 0.6219162344932556, -0.09956387430429459, -0.21082481741905212, 0.9004694819450378, 0.39678865671157837, 0.44954851269721985, 0.3908669650554657, -0.18624159693717957, -0.29737380146980286, 0.10732999444007874, 0.46093758940696716, -0.5164287686347961, 0.1832285076379776, 0.031351637095212936, -0.28832000494003296, 0.261322557926178, 1.0036380290985107, 0.6136264204978943, 0.14193487167358398, -0.24270081520080566, 0.4210454523563385, 0.525337815284729, 0.21250048279762268, -0.33261343836784363, -0.32260987162590027, 0.41436538100242615, -0.6432581543922424, -0.1740710735321045, 0.3418006896972656, -0.2788647413253784, -0.582745373249054, -0.50506192445755, -0.16003090143203735, -0.0019208776066079736, -0.5054396390914917, -0.3862302005290985, 0.9240952134132385, -0.2736743986606598, -0.3304288685321808, -0.0770387277007103, -0.7636196613311768, -0.4364680051803589, 0.7437306642532349, -1.4818639755249023, -1.036697268486023, 0.7186560034751892, -0.5010861158370972, -0.22325399518013, 0.24785716831684113, 1.3194808959960938, 0.16958104074001312, -0.6114808320999146, 0.44757911562919617, 0.779002845287323, 0.04858468100428581, 0.06178192049264908, -0.8259045481681824, 1.158916711807251, 0.38157418370246887, -0.1565435826778412, 0.3619422912597656, -0.11595744639635086, 0.35660088062286377, -0.44417616724967957, -0.22639009356498718, 1.0980206727981567, -1.1261093616485596, -0.22858943045139313, -0.8538644313812256, -0.581876814365387, 0.47075411677360535, 0.6583251953125, -0.2280544638633728, 0.49653881788253784, 0.11597651988267899, -0.5765506029129028, -0.12478785216808319, -0.6448011994361877, 0.258738249540329, 0.3030282258987427, -0.7648414373397827, -0.36870503425598145, -0.14483501017093658, 0.5406398773193359, -1.1400997638702393, -0.6929342746734619, -0.49027881026268005, 0.48842644691467285, 0.07583718001842499, 0.9962406754493713, -0.47389599680900574, 0.5079140067100525, 1.0625159740447998, -0.3372536301612854, -0.875365138053894, 0.41999658942222595, -0.9963432550430298, -0.1199246346950531, 0.3576703667640686, 0.9913424253463745, -0.4119231402873993, 0.1956976056098938, 0.799361526966095, 0.3664489686489105, -0.9839755892753601, -0.8496097922325134, -0.6072429418563843, 0.5054007172584534, -0.6112895011901855, 0.5138347744941711, 0.17339468002319336, 0.23037396371364594, 0.1291850209236145, 0.32169851660728455, 0.5764044523239136, -0.20158030092716217, -0.63386070728302, 0.10143264383077621, 0.23759469389915466, -0.33264604210853577, -0.6171502470970154, -0.36810338497161865, -1.4310805797576904, 0.09168656915426254, -1.1214332580566406, -0.2295674979686737, -0.5750465989112854, -0.4526880979537964, -0.42314934730529785, -0.3303840458393097, 0.167131245136261, 0.17644166946411133, -0.24998870491981506, -0.3437146544456482, -0.578771710395813, -0.3034607172012329, 0.8036944270133972, 0.7010921835899353, -0.6440271735191345, -0.19429798424243927, 0.19114698469638824, 0.44951513409614563, 0.2148074358701706, 0.62307208776474, -0.2695779502391815, -0.5694023370742798, -1.610964298248291, 0.7759073376655579, -0.3244135081768036, -0.2353350669145584, -0.5058968663215637, 0.5150784254074097, 0.23198330402374268, 0.06111219897866249, -0.18948300182819366, 0.3889954090118408, -0.8295115232467651, -0.4727259576320648, 0.14914533495903015, -1.0375077724456787, 0.513522207736969, 0.24494674801826477, -0.681324303150177, -0.13300824165344238, 0.4568169414997101, -0.1788499355316162, -0.8419924378395081, -0.9498133659362793, 0.31556540727615356, -0.5900547504425049, 0.15877723693847656, -0.49968504905700684, -0.20805613696575165, -1.0020025968551636, -0.05197161063551903, -0.37858909368515015, 0.5433465242385864, -0.31397759914398193, 1.1714638471603394, 0.31447044014930725, -1.2920148372650146, 0.009361966513097286, 0.30261024832725525, -0.10489418357610703, 0.23378856480121613, 0.5154975056648254, 0.44564375281333923, -0.3520891070365906, 0.5995824337005615, 0.6521278023719788, 0.28836390376091003, -1.1408629417419434, -0.10637012869119644, 0.7353152632713318, -0.724480152130127, -0.30868592858314514, 1.2345138788223267, -0.7176222801208496, -1.276708722114563, 0.3387215733528137, -1.651808500289917, -0.5135236382484436, -0.23741097748279572, 0.8868645429611206, 0.30637258291244507, -0.13213466107845306, -0.19806699454784393, -0.6539111137390137, 0.14778867363929749, 0.013138454407453537, -0.4827321469783783, 0.5260934829711914, -0.5982481241226196, -0.389132022857666, 0.9038909673690796, 1.0331803560256958, -0.3958251476287842, -1.0047385692596436, -0.8203461170196533, -0.2699441611766815, -0.031623270362615585, 0.4917605519294739, -0.5823571085929871, -0.19602547585964203, 0.8002447485923767, 0.43145421147346497, 0.19055385887622833, -0.1819591075181961, -0.32535433769226074, 0.33652999997138977, 0.9047623872756958, 0.0025950304698199034, -1.0170345306396484, -0.6385068297386169, 1.4168109893798828, 1.05503511428833, -0.9847627878189087, 0.1491135060787201, 0.41706550121307373, -0.6436008810997009, 0.7910537719726562, 0.2514718770980835, 0.34790506958961487, 1.0279083251953125, -0.40262818336486816, 0.22513242065906525, 0.6496503949165344, -1.2581416368484497, 0.2571442723274231, 0.6583930850028992, 0.5584525465965271, 0.6852916479110718, 0.4365222454071045, 0.16143816709518433, 1.0333646535873413, 0.06500925868749619, -0.4666315019130707, 0.5393276214599609, 0.5045262575149536, -0.1863536834716797, -0.23841586709022522, -0.00615690415725112, 0.20936961472034454, -0.8721873164176941, -0.9510701298713684, -0.03213997557759285, 0.48808005452156067, 0.2348831295967102, 0.7069082260131836, 0.6825301051139832, 0.24260422587394714, 0.14757490158081055, 0.5342546701431274, 0.35167327523231506, -0.4935416877269745, -0.461271196603775, -0.2555124759674072, -0.6712395548820496, -0.08687233179807663, 0.060213878750801086, -0.37050652503967285, -0.4622233808040619, -0.35549619793891907, -0.04995067045092583, -0.08666522800922394, 0.5575182437896729, 1.0305407047271729, 0.40310776233673096, 0.43140578269958496, -0.07086041569709778, -0.6967676877975464, -0.5722237825393677, -1.0996252298355103, -0.17008854448795319, -0.7042891979217529, -0.09165725111961365, 0.4198768436908722, 0.037940409034490585, -0.31900927424430847]}, "authors": [{"authorId": "2284935861", "name": "Yiran Ding"}, {"authorId": "2274195530", "name": "L. Zhang"}, {"authorId": "2284970741", "name": "Chengruidong Zhang"}, {"authorId": "2284939061", "name": "Yuanyuan Xu"}, {"authorId": "2284868563", "name": "Ning Shang"}, {"authorId": "2257094139", "name": "Jiahang Xu"}, {"authorId": "145338263", "name": "Fan Yang"}, {"authorId": "2257128651", "name": "Mao Yang"}], "references": [{"paperId": "2b8439f319dfa73df62ca8957ff6d0c1f3c7a73c", "title": "Soaring from 4K to 400K: Extending LLM's Context with Activation Beacon"}, {"paperId": "1f5b4e393a1e02ab49e5ca2e6819cc28841918a2", "title": "Fewer is More: Boosting LLM Reasoning with Reinforced Context Pruning"}, {"paperId": "539fadfb615ef84c240f4741061c44eeda540091", "title": "Scaling Laws of RoPE-based Extrapolation"}, {"paperId": "fdc53c2c10742464087c0525f77e32604827a21d", "title": "Efficient Streaming Language Models with Attention Sinks"}, {"paperId": "819bbdc2dac9e13d9ca3e2508a6e063186ce5e40", "title": "YaRN: Efficient Context Window Extension of Large Language Models"}, {"paperId": "823ca4778e1027f2f0b356df051d762dcecaaba0", "title": "FlashAttention-2: Faster Attention with Better Parallelism and Work Partitioning"}, {"paperId": "b069c32fcd77160f944ab3ba71ab6f0cfb782c68", "title": "Focused Transformer: Contrastive Training for Context Scaling"}, {"paperId": "80980cd10d19f021c14a6b7eee871b6a5d328024", "title": "Augmenting Language Models with Long-Term Memory"}, {"paperId": "60b35c6d68acced19b0c66edcfc0ee0a2c11efed", "title": "Landmark Attention: Random-Access Infinite Context Length for Transformers"}, {"paperId": "5278a8eb2ba2429d4029745caf4e661080073c81", "title": "Generative Agents: Interactive Simulacra of Human Behavior"}, {"paperId": "f6ba3fab410cf2182fde171beeeec57bffa3e90b", "title": "SuperScaler: Supporting Flexible DNN Parallelization via a Unified Abstraction"}, {"paperId": "002c256d30d6be4b23d365a8de8ae0e67e4c9641", "title": "Improving language models by retrieving from trillions of tokens"}, {"paperId": "77d956cdab4508d569ae5741549b78e715fd0749", "title": "TruthfulQA: Measuring How Models Mimic Human Falsehoods"}, {"paperId": "66c10bf1f11bc1b2d92204d8f8391d087f6de1c4", "title": "RoFormer: Enhanced Transformer with Rotary Position Embedding"}, {"paperId": "db1afe3b3cd4cd90e41fbba65d3075dd5aebb61e", "title": "The Pile: An 800GB Dataset of Diverse Text for Language Modeling"}, {"paperId": "814a4f680b9ba6baba23b93499f4b48af1a27678", "title": "Measuring Massive Multitask Language Understanding"}, {"paperId": "a0dc3135c40e150f0271002a96b7c9680b6cac40", "title": "Fourier Features Let Networks Learn High Frequency Functions in Low Dimensional Domains"}, {"paperId": "f51497f463566581874c941353dd9d80069c5b77", "title": "Compressive Transformers for Long-Range Sequence Modelling"}, {"paperId": "8b0f27bb594b1eaaf493eaf1e2ee723a2b0a19ad", "title": "HellaSwag: Can a Machine Really Finish Your Sentence?"}, {"paperId": "79e523beb1e1411a241edde0464b07c2ebc231d1", "title": "Single Path One-Shot Neural Architecture Search with Uniform Sampling"}, {"paperId": "7a84a692327534fd227fa1e07fcb3816b633c591", "title": "Neural Tangent Kernel: Convergence and Generalization in Neural Networks"}, {"paperId": "88bb0a28bb58d847183ec505dda89b63771bb495", "title": "Think you have Solved Question Answering? Try ARC, the AI2 Reasoning Challenge"}, {"paperId": "e3aa232577bb427b1f3a34acbdef84bd85734042", "title": "LM-Infinite: Simple On-the-Fly Length Generalization for Large Language Models"}, {"paperId": "0eedbc38bc215fdbe4e5bcde8aeac08fb3ce9f44", "title": "Parallel Context Windows Improve In-Context Learning of Large Language Models"}, {"paperId": null, "title": "An open source recipe to reproduce"}, {"paperId": null, "title": "LocalLLaMA. Dynamically scaled rope further increases performance of long context llama with zero fine-tuning, 2023a"}]}