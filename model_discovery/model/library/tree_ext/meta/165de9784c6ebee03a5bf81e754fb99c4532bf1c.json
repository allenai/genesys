{"paperId": "165de9784c6ebee03a5bf81e754fb99c4532bf1c", "title": "Efficient Parallelization Layouts for Large-Scale Distributed Model Training", "abstract": "Efficiently training large language models requires parallelizing across hundreds of hardware accelerators and invoking various compute and memory optimizations. When combined, many of these strategies have complex interactions regarding the final training efficiency. Prior work tackling this problem did not have access to the latest set of optimizations, such as FlashAttention or sequence parallelism. In this work, we conduct a comprehensive ablation study of possible training configurations for large language models. We distill this large study into several key recommendations for the most efficient training. For instance, we find that using a micro-batch size of 1 usually enables the most efficient training layouts. Larger micro-batch sizes necessitate activation checkpointing or higher degrees of model parallelism and also lead to larger pipeline bubbles. Our most efficient configurations enable us to achieve state-of-the-art training efficiency results over a range of model sizes, most notably a Model FLOPs utilization of 70.5% when training a Llama 13B model.", "venue": "arXiv.org", "year": 2023, "citationCount": 3, "influentialCitationCount": 0, "openAccessPdf": null, "tldr": {"model": "tldr@v2.0.0", "text": "This work conducts a comprehensive ablation study of possible training configurations for large language models and finds that using a micro-batch size of 1 usually enables the most efficient training layouts."}, "embedding": {"model": "specter_v2", "vector": [0.006787897553294897, 0.20879751443862915, -0.630375325679779, 0.1287672221660614, -0.3941975235939026, 0.15464617311954498, 0.5805487632751465, -0.12950898706912994, -0.8532289266586304, -0.6991192102432251, 0.415916383266449, -0.5538042187690735, 0.6423044204711914, 0.2833506464958191, -0.16606232523918152, 0.08627719432115555, -1.0031013488769531, 0.08461794257164001, -0.12289046496152878, 0.06062420457601547, -0.23942109942436218, 0.10151036083698273, -1.2252320051193237, 0.31815892457962036, 0.25120633840560913, 0.7293461561203003, -0.04842923581600189, 0.9812133312225342, -0.1491735428571701, 0.37412649393081665, 0.2768598794937134, 0.4400773048400879, 0.17315563559532166, 0.21280920505523682, -0.31373995542526245, -0.2200918048620224, 0.5959572196006775, -0.46551963686943054, -0.5490179657936096, 0.5522395968437195, 0.10934770107269287, 0.2494887262582779, -0.0051630898378789425, -0.6681375503540039, 0.40798017382621765, 0.3390902876853943, -0.05458182469010353, 1.0050915479660034, -0.7727335691452026, -0.28507000207901, 0.46488481760025024, -1.3733181953430176, 0.18895187973976135, 1.2737772464752197, 0.515868604183197, 0.09022999554872513, -0.2638312876224518, -0.44738975167274475, 0.311697781085968, 0.05791550502181053, -0.7324120998382568, -0.7290714979171753, -0.22119776904582977, -0.15333181619644165, 2.301084280014038, -0.31092673540115356, 0.09785022586584091, 0.37242984771728516, 0.2516436278820038, 1.2509948015213013, 0.011464637704193592, -1.1431092023849487, 0.11011125892400742, -0.02500527910888195, 0.8989562392234802, 0.8180984854698181, -0.14562375843524933, 0.17204269766807556, -1.0786041021347046, -0.4867379665374756, 0.1353076547384262, 0.01288718543946743, 0.7777994275093079, 0.12278872728347778, -0.25902286171913147, 0.5386120080947876, 0.4818277060985565, 0.9697265625, -0.16140207648277283, 0.7698724269866943, 0.8710234761238098, 0.10772372782230377, 0.3134521543979645, 0.2246023416519165, 0.1100630983710289, 0.4116918444633484, -1.1737453937530518, -0.053339071571826935, -0.0812278464436531, 0.7325699329376221, -0.11050473898649216, 0.5892131924629211, -0.8034561276435852, -0.07206995040178299, 1.2232846021652222, 0.12661811709403992, 0.3337644636631012, -0.4663545489311218, 0.34667065739631653, -0.9210898280143738, 0.06053834781050682, -0.14412865042686462, -0.3696906864643097, -0.5556051135063171, -1.0060269832611084, -0.9657992124557495, -0.4838794767856598, -0.3763876259326935, -0.8283343315124512, 0.10740334540605545, 0.022783836349844933, 0.7412995100021362, 0.3381190896034241, 0.4699518084526062, 0.4988583028316498, 0.8809215426445007, 0.6177049875259399, 0.23837286233901978, 1.0304533243179321, -1.4933171272277832, -0.08816225081682205, -1.1194603443145752, 0.9425739049911499, -0.44947776198387146, 0.1199115589261055, -0.40911322832107544, -1.4641039371490479, -1.1818069219589233, -0.951240599155426, -0.18052712082862854, -0.22701993584632874, 0.2955593764781952, 1.3300424814224243, 0.2145576775074005, -1.359521746635437, 0.6627804040908813, -0.6740785241127014, -0.21690168976783752, 0.2243642807006836, 0.3675858974456787, 0.5400782227516174, -0.32738059759140015, -0.9575969576835632, -0.004164279904216528, 0.19854652881622314, -0.30642685294151306, -0.11436093598604202, -0.755257785320282, -0.6379611492156982, 0.13535605370998383, -0.2977825999259949, -0.6272650361061096, 1.1636552810668945, -0.2997922897338867, -1.2145425081253052, 0.5833881497383118, -0.35603687167167664, -0.02552192099392414, 0.1460934579372406, 0.1692568063735962, -0.6570266485214233, -0.15761218965053558, -0.856062114238739, 1.0170480012893677, 0.745235025882721, 0.0019502394134178758, 0.039118941873311996, 0.0313272587954998, -0.3759143352508545, 0.39949312806129456, -0.520819902420044, 1.2949496507644653, -0.4289887547492981, 0.2676026225090027, 0.3882826566696167, 0.3392297625541687, -0.5152881145477295, -0.5436543822288513, -0.41714802384376526, -0.6732479333877563, 0.6761956214904785, 0.15811927616596222, 0.8733279705047607, -1.1416298151016235, -1.2325621843338013, 0.251755028963089, -0.2783035933971405, 0.12785618007183075, -0.821805477142334, 0.5961865186691284, -0.4595506191253662, 0.17073683440685272, 0.296733021736145, -1.228723406791687, -0.01092651765793562, -0.5908037424087524, -0.8556996583938599, -0.3541734218597412, -0.3543255031108856, 0.7643279433250427, -0.19204038381576538, 0.038215555250644684, -0.40286239981651306, 0.549914538860321, -1.3280290365219116, 0.9626205563545227, -0.3466285467147827, 0.2699865996837616, 0.16201016306877136, -0.3159852623939514, 0.39847123622894287, -0.3646453320980072, 0.6776725649833679, -0.5404948592185974, -0.35223594307899475, 0.217630073428154, -0.03728022053837776, 1.5035614967346191, -0.3633844554424286, 0.1724902242422104, 0.46248340606689453, -0.5523241758346558, -0.12506893277168274, 0.30426305532455444, -0.13661052286624908, -0.589195728302002, 0.2186404913663864, 0.5499189496040344, -0.22634752094745636, 0.36677515506744385, 1.319868803024292, 1.0240840911865234, -0.25613850355148315, 0.3745996057987213, 0.24028649926185608, -0.40593603253364563, 0.45150917768478394, 0.5265651345252991, 0.6520329117774963, 0.05567461624741554, -0.4319193363189697, -0.2832426428794861, 0.02407485619187355, -0.8728471398353577, -0.2791632115840912, 0.617885947227478, 0.40430572628974915, 0.22227779030799866, 0.5331161618232727, -0.74886155128479, -0.6840036511421204, 0.28727900981903076, 0.8150896430015564, 1.3989373445510864, -0.585763692855835, 0.24890996515750885, -0.7576211094856262, -0.3112311363220215, -0.4028935432434082, -0.09200557321310043, 0.44232887029647827, 0.049659211188554764, -0.9665469527244568, -1.0493577718734741, 0.49924367666244507, 0.02008158527314663, 0.7568330764770508, -0.7842321991920471, -0.6673485040664673, -0.8781425952911377, 1.0192409753799438, -0.9681391716003418, -0.3983379304409027, 0.5318927764892578, -0.9240669012069702, 0.363569438457489, 0.06818458437919617, -0.42531299591064453, 0.5234009027481079, 0.04156770557165146, 1.0237513780593872, -0.2561408579349518, -0.48800981044769287, 0.06822799146175385, 0.6024540662765503, -0.33503538370132446, -0.7191647887229919, 0.34964168071746826, 0.10797736048698425, -0.4507012367248535, 0.06150473654270172, 0.2814447581768036, -0.1850467324256897, -0.5876578092575073, -0.24130244553089142, 0.39169198274612427, 0.2396768480539322, -0.2277326136827469, 0.8529823422431946, -0.3643885552883148, -0.07001421600580215, -1.1606173515319824, 0.9032182097434998, 0.03344910964369774, -0.4265424907207489, 0.22716940939426422, -0.5770195126533508, -0.2892122268676758, 0.7308230996131897, -0.6541463136672974, -0.3201065957546234, -0.9229374527931213, -0.12569297850131989, -0.7339491248130798, -0.4216611087322235, 0.06305377185344696, 0.7433983683586121, -0.11363783478736877, 0.28890693187713623, 0.4709360599517822, 0.3920111060142517, 0.12097571790218353, 0.3948498070240021, -0.7566251754760742, 0.044967323541641235, 0.19955094158649445, -0.23783546686172485, -0.05753610283136368, -0.15145301818847656, -1.0581246614456177, -0.3593510091304779, -0.23948456346988678, -0.15825609862804413, -0.22263966500759125, 0.17496778070926666, -0.7465353608131409, -0.73499995470047, 0.18955104053020477, -1.2049623727798462, -0.7088592648506165, 0.17902997136116028, 0.12174076586961746, -0.017675399780273438, -1.1225918531417847, -1.5614979267120361, -0.2713874578475952, -1.342982530593872, -1.2778867483139038, 0.6628915667533875, 0.353727251291275, -0.32267433404922485, -0.5182798504829407, -0.11826654523611069, -0.44295796751976013, 1.1204004287719727, -0.8038415312767029, 0.7525007128715515, 0.12420158088207245, -0.14395196735858917, -0.1572795957326889, -0.013636209070682526, 0.16934649646282196, -1.0354753732681274, 0.4688314199447632, -0.9751821756362915, -0.2958025336265564, -0.47281649708747864, -0.6819986701011658, 0.3719409704208374, 0.3639541566371918, 0.8902430534362793, 0.0774325355887413, -0.596177875995636, 0.46229007840156555, 1.2657339572906494, -0.7168002128601074, 0.1662694811820984, -0.4510578513145447, 1.1769503355026245, -0.13710398972034454, -0.5156520009040833, 0.6135443449020386, -0.22869344055652618, 0.6038103103637695, -0.23542314767837524, -0.568482518196106, -0.14915230870246887, -0.24564822018146515, 0.7046428322792053, 1.8416829109191895, 1.136577844619751, 0.07104573398828506, -0.8317942023277283, 0.0009272580500692129, -0.8909353017807007, -0.5812567472457886, 0.4680900573730469, 0.7315328121185303, 0.19217821955680847, -0.30692267417907715, -0.07720494270324707, -0.2806081771850586, 0.2968437969684601, 0.7034196257591248, -0.6343499422073364, -1.214907169342041, 0.39195072650909424, 0.7059380412101746, 0.2970806062221527, 0.7345436215400696, -0.21513523161411285, 0.6650341749191284, 14.645888328552246, 1.0833284854888916, -0.4175131916999817, 0.7832409143447876, 1.1249022483825684, 0.07625577598810196, -0.2739226520061493, -0.21601222455501556, -1.3478885889053345, -0.0238537285476923, 2.017172336578369, 0.6285474300384521, 0.5129201412200928, 0.19935782253742218, 0.22650636732578278, -0.25954702496528625, -0.26278960704803467, 0.6176546216011047, 0.3272641897201538, -1.5898513793945312, -0.053287483751773834, 0.09373187273740768, 0.6394143104553223, 0.9173782467842102, 0.8165590763092041, 0.8113619685173035, 0.2943795323371887, -0.14172153174877167, 0.4114607274532318, 0.19663791358470917, 0.984079122543335, -0.36327579617500305, -0.005156381521373987, 0.5979079008102417, -0.5679046511650085, 0.018902543932199478, -0.3434291183948517, -1.0737224817276, 0.21904349327087402, 0.2877067029476166, -0.8523121476173401, -0.6434116959571838, -0.601938009262085, 0.32945579290390015, 0.13540025055408478, 0.38552427291870117, 0.07483901083469391, 0.8657490611076355, -0.3427889049053192, -0.020862527191638947, 0.28575849533081055, 0.482696533203125, -0.33078813552856445, 0.14107097685337067, -0.05607360601425171, -0.26482221484184265, 0.41097649931907654, 0.054260190576314926, -0.40020811557769775, -0.36462166905403137, -0.21403807401657104, -0.20633575320243835, 0.03615090250968933, 1.1608800888061523, 0.042301587760448456, 0.1479160487651825, -0.4840420186519623, 0.19210302829742432, 0.9402071833610535, 0.15117305517196655, -0.2916165888309479, 0.33937981724739075, 0.25775548815727234, -0.8467236757278442, -0.30302128195762634, 0.045423366129398346, -0.3760543167591095, -0.4648117125034332, -0.900095522403717, -0.39993253350257874, 0.31534096598625183, -0.6449568867683411, -0.2919410765171051, 0.7290529608726501, -0.17565664649009705, 0.05095099285244942, 0.2832081913948059, -0.816229522228241, -0.6621849536895752, 0.4540329575538635, -1.2600069046020508, -0.78265780210495, 0.42586585879325867, -0.5279266238212585, -0.5232545137405396, 0.06063539534807205, 1.4113796949386597, 0.3411920368671417, -0.827879786491394, 0.03822846710681915, 0.3701682686805725, -0.3542931079864502, -0.45281046628952026, -0.1770942062139511, 1.0573924779891968, 0.7204188704490662, -0.058190081268548965, -0.21334007382392883, -0.0006920098676346242, 0.1351916342973709, -1.266613483428955, -0.16038784384727478, 0.7819824814796448, -0.28055793046951294, -0.30433812737464905, -1.0044502019882202, -0.654430627822876, 0.2503178119659424, 0.6748563647270203, 0.13134001195430756, 0.4555385112762451, 0.15793782472610474, -0.3471851944923401, -0.32310032844543457, -0.566928505897522, 0.08889306336641312, 0.48673972487449646, -1.0520341396331787, 0.5984904170036316, 0.6103540658950806, 0.525654137134552, -1.2865289449691772, -0.5265148878097534, -0.37783870100975037, -0.17543812096118927, -0.3304446339607239, 0.8375477194786072, -0.20431658625602722, 0.6482341289520264, 1.1273409128189087, 0.25714683532714844, -0.5709344744682312, 0.46766260266304016, -0.6715298891067505, -0.2323400229215622, -0.10469096153974533, 0.47702842950820923, -0.3623974025249481, 0.6190666556358337, 1.1212760210037231, -0.2679007351398468, -0.5909275412559509, -0.6545385122299194, 0.09283308684825897, -0.13293132185935974, -0.535692572593689, 0.10856430977582932, -0.3194052577018738, 0.1863635629415512, 0.1458706557750702, 0.6224783062934875, 0.5463008880615234, -0.5542299747467041, -0.43477246165275574, 0.38623106479644775, 0.47769761085510254, -0.3753465712070465, -0.482797771692276, -0.02661929465830326, -1.3727308511734009, 0.2683742344379425, -1.2947275638580322, 0.01671949401497841, -0.44344037771224976, -0.32594549655914307, -0.6304847002029419, 0.10503076761960983, 0.22731511294841766, 0.5075470805168152, -0.09839664399623871, -0.3695383071899414, -0.1709703505039215, -0.7033407688140869, 0.6508248448371887, 0.560317873954773, -0.3488321900367737, -0.14708785712718964, -0.40542975068092346, 0.4126960039138794, 0.32472461462020874, 0.5862898230552673, -0.11927007883787155, -0.9047495722770691, -1.6101962327957153, 0.13206511735916138, 0.06972570717334747, -0.2777745723724365, -1.0964518785476685, 0.71244877576828, 0.44196000695228577, -0.08378738909959793, 0.31117454171180725, 0.15850380063056946, -0.72364342212677, -0.3641829192638397, 0.4063927233219147, -0.5261959433555603, 0.52702796459198, 0.7443807721138, -0.8755565285682678, -0.11647114157676697, 0.5258005857467651, 0.002475607441738248, -0.5291779041290283, -0.9990091323852539, 0.2966163754463196, -0.27013781666755676, -0.12223891913890839, -0.058623068034648895, 0.30528807640075684, -1.2118476629257202, 0.3148161768913269, 0.06349307298660278, 0.06931018084287643, -0.24803496897220612, 0.6739209294319153, 0.1421467661857605, -0.7542539238929749, 0.2849016785621643, 0.605545163154602, -0.8463016152381897, 0.11066038906574249, 1.2797256708145142, 0.798117995262146, -0.7761625647544861, 0.5774943828582764, 0.3555961847305298, 0.23472560942173004, -0.978893518447876, -0.04165669158101082, 0.6596867442131042, -0.8564468026161194, 0.05811746045947075, 1.0915096998214722, -0.6829397678375244, -0.6823698282241821, 0.09847632050514221, -1.1149898767471313, -0.3619161546230316, -0.42577555775642395, 0.6837025880813599, 0.0592530257999897, 0.5385264754295349, 0.1759442538022995, -0.5820116996765137, -0.09967479854822159, -0.13483506441116333, -0.6059787273406982, 0.08990888297557831, 0.21184325218200684, -0.31093302369117737, 0.21642030775547028, 0.8759382367134094, -0.508671760559082, -0.7685602903366089, -0.46141278743743896, -0.5704336166381836, 0.26421791315078735, 0.49056681990623474, -0.18385016918182373, -0.6960867047309875, 1.000091314315796, 0.6525446772575378, 0.10238712280988693, 0.08400741964578629, -0.16346929967403412, 0.331632524728775, 0.37109559774398804, 0.13658252358436584, -0.6474398970603943, -0.6696880459785461, 1.5161246061325073, 0.8824640512466431, -0.7295447587966919, 0.4733560383319855, 8.959304250311106e-05, -0.705234706401825, 0.6502557992935181, 0.6602820754051208, 0.029922015964984894, 1.049720287322998, 0.30867329239845276, -0.05499892309308052, 0.17566798627376556, -0.9107038974761963, 0.040855299681425095, 0.4841926693916321, 0.3166222870349884, 0.8777743577957153, 0.43757468461990356, 0.02219162881374359, 0.46571505069732666, 0.3439444303512573, -0.02644534967839718, 0.19249922037124634, 0.6309622526168823, 0.045933328568935394, -0.062175653874874115, 0.12074059247970581, 0.6109516024589539, -0.2726737856864929, -0.7426449060440063, 0.5689910650253296, 0.474581778049469, 0.050037071108818054, 0.4256938099861145, 1.5467889308929443, 0.016426343470811844, 0.29383042454719543, 0.16239938139915466, 0.7897178530693054, -0.5851242542266846, -0.6009519100189209, -0.0502328984439373, -0.48919838666915894, -0.13149523735046387, 0.07649099826812744, -0.28262007236480713, -0.7261891961097717, -0.5403872132301331, 0.7799386382102966, -0.05228718742728233, 0.4951326251029968, 0.9862393736839294, 1.3670639991760254, 0.5884767770767212, -0.1760445535182953, -1.1873301267623901, -0.4804096221923828, -0.8410618901252747, 0.06683339178562164, -0.7128198146820068, -0.5588289499282837, 0.5866572260856628, 0.2372814118862152, -0.5169758200645447]}, "authors": [{"authorId": "2265751788", "name": "Johannes Hagemann"}, {"authorId": "2024731554", "name": "Samuel Weinbach"}, {"authorId": "2156114269", "name": "Konstantin Dobler"}, {"authorId": "2265751794", "name": "Maximilian Schall"}, {"authorId": "2265591376", "name": "Gerard de Melo"}], "references": [{"paperId": "8511ea96d61593de57cbc2e996910e5cb3dbfe84", "title": "DISTFLASHATTN: Distributed Memory-efficient Attention for Long-context LLMs Training"}, {"paperId": "a51ac7a5e8f6454268ac16ecdc52ecac98ce54d9", "title": "DeepSpeed Ulysses: System Optimizations for Enabling Training of Extreme Long Sequence Transformer Models"}, {"paperId": "823ca4778e1027f2f0b356df051d762dcecaaba0", "title": "FlashAttention-2: Faster Attention with Better Parallelism and Work Partitioning"}, {"paperId": "87c5b281fa43e6f27191b20a8dd694eda1126336", "title": "FlashAttention: Fast and Memory-Efficient Exact Attention with IO-Awareness"}, {"paperId": "bc8b82e8eb0b0714892e4ec7a54ebdf47c4fde96", "title": "Reducing Activation Recomputation in Large Transformer Models"}, {"paperId": "9ca329408813d209b1dcb36936f7f9cba82506bd", "title": "Train Short, Test Long: Attention with Linear Biases Enables Input Length Extrapolation"}, {"paperId": "509b16378deec0fb6bbec1d7aeb32a4bdeedddb1", "title": "GSPMD: General and Scalable Parallelization for ML Computation Graphs"}, {"paperId": "774591fdd988eaaff3917e7c5171d044b0843e63", "title": "Efficient Large-Scale Language Model Training on GPU Clusters Using Megatron-LM"}, {"paperId": "268d347e8a55b5eb82fb5e7d2f800e33c75ab18a", "title": "An Image is Worth 16x16 Words: Transformers for Image Recognition at Scale"}, {"paperId": "725264948d7b6946259af5b8d966e996b9570f99", "title": "DeepSpeed: System Optimizations Enable Training Deep Learning Models with Over 100 Billion Parameters"}, {"paperId": "ac04ed0f3ae0f5b269c9b3e0d1232007d60dbf7e", "title": "Memory-Efficient Pipeline-Parallel DNN Training"}, {"paperId": "90abbc2cf38462b954ae1b772fac9532e2ccd8b0", "title": "Language Models are Few-Shot Learners"}, {"paperId": "bdbf780dfd6b3eb0c9e980887feae5f23af15bc4", "title": "GLU Variants Improve Transformer"}, {"paperId": "10eda4521c032adabaa8e70d6569e17370b29dcd", "title": "Root Mean Square Layer Normalization"}, {"paperId": "70fe1f854bc59092ded4bf2939a6624a80e5e4c3", "title": "ZeRO: Memory Optimization Towards Training A Trillion Parameter Models"}, {"paperId": "8323c591e119eb09b28b29fd6c7bc76bd889df7a", "title": "Megatron-LM: Training Multi-Billion Parameter Language Models Using Model Parallelism"}, {"paperId": "d07284a6811f1b2745d91bdb06b040b57f226882", "title": "Decoupled Weight Decay Regularization"}, {"paperId": "204e3073870fae3d05bcbc2f6a8e263d9b72e776", "title": "Attention is All you Need"}, {"paperId": "942deb7d865b7782c03176d95e3a0d56cb71009e", "title": "Training Deep Nets with Sublinear Memory Cost"}, {"paperId": "8665c9b459e4161825baf1f25b5141f41a5085ff", "title": "A bridging model for parallel computation"}, {"paperId": null, "title": "Automating inter-and intra-operator"}]}