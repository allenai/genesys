{"paperId": "53c3940f35b8b45d55ed49056282e1961954513d", "title": "Self-attention Does Not Need $O(n^2)$ Memory", "abstract": "We present a very simple algorithm for attention that requires $O(1)$ memory with respect to sequence length and an extension to self-attention that requires $O(\\log n)$ memory. This is in contrast with the frequently stated belief that self-attention requires $O(n^2)$ memory. While the time complexity is still $O(n^2)$, device memory rather than compute capability is often the limiting factor on modern accelerators. Thus, reducing the memory requirements of attention allows processing of longer sequences than might otherwise be feasible. We provide a practical implementation for accelerators that requires $O(\\sqrt{n})$ memory, is numerically stable, and is within a few percent of the runtime of the standard implementation of attention. We also demonstrate how to differentiate the function while remaining memory-efficient. For sequence length 16384, the memory overhead of self-attention is reduced by 59X for inference and by 32X for differentiation.", "venue": "", "year": 2021, "citationCount": 95, "influentialCitationCount": 7, "openAccessPdf": null, "tldr": {"model": "tldr@v2.0.0", "text": "A practical implementation for accelerators that requires $O(\\sqrt{n})$ memory, is numerically stable, and is within a few percent of the runtime of the standard implementation of attention is provided."}, "embedding": {"model": "specter_v2", "vector": [0.474881649017334, 0.5692052245140076, 0.022874299436807632, 0.003743665525689721, 0.032256316393613815, -0.10376955568790436, 0.26786091923713684, 0.016619108617305756, -0.6272724866867065, -0.12428832799196243, 0.21116942167282104, 0.32582002878189087, 0.8165677785873413, -0.09785620868206024, -0.24578692018985748, -0.1759749799966812, -1.0450644493103027, -0.3919876217842102, 0.4677724838256836, 0.14225001633167267, 0.5742406249046326, -0.5177767872810364, -1.6702570915222168, 0.26711881160736084, 0.21909035742282867, 0.9237364530563354, 0.24574755132198334, 1.2990038394927979, -0.1654285490512848, 0.19798065721988678, 0.1501220166683197, 0.11786314845085144, 0.20253464579582214, -0.1929119974374771, -0.42195937037467957, -0.542998731136322, 0.5803113579750061, -0.028351271525025368, -0.4355849623680115, 1.001469373703003, 0.1383150964975357, 0.2857014238834381, 0.25466254353523254, -0.553865373134613, 0.10445617884397507, 0.7587301135063171, 0.4527229964733124, 1.369370937347412, -0.17259861528873444, -0.28823283314704895, 0.9625180959701538, -1.0677955150604248, 0.1464691311120987, 1.4370766878128052, 0.5666964054107666, 0.31667837500572205, -0.12091348320245743, -0.28848329186439514, 0.459553986787796, 0.1903783679008484, -0.6883214712142944, -0.48891741037368774, 0.015932170674204826, -0.30275294184684753, 1.7603832483291626, 0.05702999606728554, 0.07683635503053665, 0.23862887918949127, 0.4070625305175781, 1.4585922956466675, 0.02210971526801586, -0.6915866136550903, 0.3579559028148651, 0.199870303273201, 0.7479772567749023, 0.700958251953125, -0.3845278024673462, 0.2983531355857849, -1.0678328275680542, -0.1434582769870758, 0.8012391328811646, -0.2649926543235779, 0.28085166215896606, -0.36029839515686035, -0.2654537260532379, 0.5473349094390869, 0.160186305642128, 0.7295092344284058, -0.20196639001369476, 0.7500524520874023, 0.8801063299179077, -0.0612056590616703, -0.2731176018714905, 0.22541490197181702, 0.5142860412597656, 0.06300623714923859, -0.8030968308448792, 0.0296634528785944, -0.058208167552948, 1.2010678052902222, -0.03518366813659668, 0.8159122467041016, -0.6153246164321899, 0.0013726043980568647, 0.9809213280677795, 0.13551974296569824, 0.8228231072425842, -0.7762281894683838, -0.1675087958574295, -0.655472457408905, 0.1501871943473816, -0.7829404473304749, -0.2104756385087967, -0.5045625567436218, -0.8527618050575256, -0.4992288649082184, -0.3092954158782959, -0.11152346432209015, -0.384548544883728, 0.2577051818370819, -0.11802895367145538, 0.14655250310897827, -0.14070896804332733, 0.5292785167694092, 0.5522102117538452, 0.2543414235115051, 0.1428794115781784, 0.1193835660815239, 1.4463039636611938, -0.8825216293334961, -0.626720130443573, -0.9321059584617615, -0.2111305445432663, -0.10830645263195038, -0.07167036086320877, -0.4414156675338745, -1.641793966293335, -1.2774344682693481, -1.055638074874878, -0.07832470536231995, -0.46915605664253235, 0.072633296251297, 1.3508949279785156, 0.044121239334344864, -0.9365209341049194, 1.2173614501953125, -0.18282471597194672, -0.31248193979263306, 0.4906497299671173, 0.1864510476589203, 0.6965646147727966, 0.5831840634346008, -1.0155622959136963, 0.1591649353504181, 0.20549558103084564, -0.4100179076194763, -0.16495871543884277, -0.44007980823516846, -1.060835838317871, 0.16400046646595, 0.28324514627456665, -0.5008280277252197, 1.230770230293274, -0.21584120392799377, -1.0112260580062866, 0.7956201434135437, -0.6684495210647583, -0.3568819463253021, 0.20558668673038483, 0.14316831529140472, -0.5212893486022949, -0.0607110932469368, -0.2031092643737793, 0.6700074672698975, 0.6080523729324341, -0.31550824642181396, -0.502448558807373, -0.17657069861888885, -0.48444703221321106, -0.2461867779493332, -0.23007462918758392, 0.8828327655792236, -0.6351836919784546, -0.38717466592788696, 0.4486945867538452, 0.228878915309906, -0.11979333311319351, -0.2028864175081253, -0.3966437876224518, -0.830969512462616, 0.6325532793998718, 0.5056427121162415, 1.1192047595977783, -0.9980027675628662, -1.1508969068527222, -0.11130252480506897, -0.2721342146396637, -0.0776335746049881, -0.5293957591056824, 0.3163292407989502, -0.703299880027771, 0.13613009452819824, -0.41516900062561035, -0.6965534090995789, -0.26960813999176025, -0.5469836592674255, -0.641902506351471, -0.13768649101257324, 0.07664716988801956, 0.9651021361351013, -1.1654577255249023, -0.1842007339000702, -0.23739641904830933, 0.2553560435771942, -0.8343484997749329, 1.166405200958252, -0.13346482813358307, 0.20824982225894928, 0.040701765567064285, -0.2802974581718445, 0.13652122020721436, -0.16403749585151672, 0.2807025909423828, -0.5724324584007263, -0.2724723517894745, 0.15926256775856018, -0.23079784214496613, 1.3563239574432373, -0.12312664836645126, 0.8670300841331482, 0.1065949946641922, -0.43790555000305176, 0.27443522214889526, -0.05291704088449478, -0.13540469110012054, -0.24681539833545685, 0.5673357844352722, -0.4741678535938263, -0.38268813490867615, -0.05195503309369087, 0.6844127178192139, 1.5053733587265015, -0.1660948395729065, 0.16258841753005981, 0.3819921910762787, -0.2559998333454132, 0.018142515793442726, 0.056604474782943726, 0.8142521977424622, 0.35386717319488525, 0.5331475138664246, -0.3686157166957855, 0.23119091987609863, -0.7129248380661011, 0.021416407078504562, 0.8432633876800537, 0.5132848620414734, 0.7590053677558899, 0.0726180374622345, -0.953650951385498, -0.26455453038215637, 0.13908350467681885, 0.49100664258003235, 1.410838007926941, -0.22316451370716095, 0.31301191449165344, -1.060141921043396, -0.2426937222480774, -0.17324350774288177, 0.16484017670154572, -0.5522303581237793, -0.29251211881637573, -0.40867114067077637, -1.0150532722473145, 0.7734282612800598, 0.6178918480873108, 1.2087522745132446, -0.891146183013916, -1.2164946794509888, -0.11239426583051682, 0.8399114608764648, -0.6513404846191406, -0.9378405809402466, 0.6738224029541016, -0.7033350467681885, -0.07665348798036575, 0.29924824833869934, -0.15325158834457397, 0.34560737013816833, -0.43728703260421753, 0.8290985226631165, -0.33987879753112793, -0.7122423052787781, 0.017932172864675522, 0.9385754466056824, -0.6930543184280396, -0.14030319452285767, 0.21443097293376923, 0.13402144610881805, -0.19097355008125305, 0.42750608921051025, -0.13780973851680756, -0.3216981887817383, -0.044600993394851685, -0.13410477340221405, -0.4763707220554352, -0.009319270960986614, 0.018101107329130173, 0.3944135904312134, 0.07576678693294525, 0.03737806901335716, -1.1329387426376343, 0.6187182068824768, 0.05804155394434929, -0.2012636661529541, -0.5447845458984375, -0.6481459140777588, -0.07343681901693344, 0.347704142332077, -0.7471084594726562, -0.4147835075855255, -0.35765305161476135, 0.07379451394081116, -0.28058648109436035, -0.5070256590843201, -0.4268813133239746, 0.2747625410556793, -0.4470520615577698, 0.4010659456253052, 0.3590710461139679, 0.46334588527679443, 0.2897149920463562, 0.16614362597465515, -0.6727344989776611, 1.066604495048523, 0.37754082679748535, -0.12489139288663864, 0.21649974584579468, 0.06399013102054596, -1.0643079280853271, -0.4607137143611908, -0.29060739278793335, -0.4401944577693939, -0.3498760461807251, 0.32344260811805725, -0.2565002143383026, -1.8463280200958252, -0.1223323866724968, -1.104637861251831, -0.3607276380062103, 0.11637221276760101, -0.340180367231369, -0.3760821223258972, -0.5270878076553345, -0.9380775094032288, -1.0549770593643188, -0.9419378042221069, -0.6105012893676758, 0.4166019856929779, 0.28262585401535034, -0.6928418874740601, -0.424051970243454, -0.433685839176178, -0.6918177008628845, 1.052865743637085, -0.43002942204475403, 0.27562958002090454, -0.043730299919843674, -0.5075172781944275, -0.19937002658843994, 0.16824086010456085, 0.08887379616498947, -0.14474616944789886, 0.07598032057285309, -0.9858415126800537, 0.30301082134246826, 0.11049458384513855, 0.10697939246892929, 0.33522918820381165, 0.21505504846572876, 1.1542285680770874, -0.15457551181316376, -0.7262290120124817, 0.13311730325222015, 1.3551676273345947, -0.17597231268882751, 0.306506484746933, 0.18761038780212402, 0.653724730014801, 0.044636353850364685, -0.044788554310798645, 0.7384565472602844, 0.24456444382667542, 0.5511512160301208, 0.3505493998527527, 0.03168310597538948, 0.027228500694036484, 0.03850000351667404, 0.24324645102024078, 0.7644633054733276, 0.40388983488082886, 0.36639779806137085, -0.7305904030799866, 0.779981255531311, -1.2219011783599854, -1.4065051078796387, 0.6454843878746033, 0.9113402962684631, 0.27878421545028687, 0.09937113523483276, -0.0997893214225769, -0.11232844740152359, 0.6571558117866516, 0.01892201043665409, -1.0133041143417358, -0.8396672010421753, 0.08586601912975311, 0.14557121694087982, 0.4130780100822449, 0.7130447626113892, -0.584281861782074, 0.346989244222641, 15.270699501037598, 0.3860318958759308, 0.04274193197488785, 0.13253618776798248, 0.5889964699745178, 0.5949833989143372, 0.04381469637155533, -0.19563518464565277, -1.3770174980163574, 0.3031352460384369, 1.006597638130188, 0.42913079261779785, 0.4674820005893707, 0.757874608039856, 0.0049405694007873535, -0.218711718916893, -0.4764239490032196, 0.6713459491729736, 0.7830480337142944, -1.177538275718689, -0.25607043504714966, 0.06832243502140045, -0.29105061292648315, -0.12363503873348236, 0.4781707227230072, 0.3945653438568115, 0.510176420211792, 0.1346156746149063, 0.08988261222839355, 0.5274617075920105, 0.7976869940757751, -0.3283207416534424, 0.08505410701036453, 0.32034918665885925, -0.901852011680603, -0.2057165503501892, -0.6613150835037231, -1.109393835067749, 0.13681642711162567, 0.4032854437828064, -0.8491024971008301, -0.8865575790405273, 0.1394071727991104, -0.08849535137414932, 0.09244652092456818, 0.6023277044296265, 0.06977348774671555, 0.37795716524124146, 0.30617576837539673, -0.31593096256256104, -0.23322974145412445, 0.6608532667160034, 0.3462570607662201, 0.40375036001205444, -0.13843461871147156, 0.37152668833732605, -0.26643475890159607, 0.4074596166610718, 0.2542579770088196, -0.6315355896949768, -0.20957918465137482, 0.017321385443210602, 0.019107164815068245, 1.0962210893630981, 0.3685542345046997, 0.16530825197696686, 0.1683521717786789, 0.614158570766449, 0.27067071199417114, -0.19308505952358246, -0.4833126962184906, -0.5514770150184631, 0.5781331062316895, -0.5905349254608154, 0.3445683419704437, 0.26345884799957275, -0.592492401599884, -0.17682525515556335, -1.1480703353881836, -0.36902502179145813, 0.4389984607696533, -0.8071451187133789, -0.6252440214157104, 1.0397950410842896, -0.6041077375411987, -0.1574573665857315, 0.25821447372436523, -0.6937439441680908, -0.6452832818031311, 0.2982493042945862, -0.8138939142227173, 0.06192651763558388, -0.21478776633739471, -0.7922874093055725, -0.2173122614622116, 0.25721776485443115, 1.0858794450759888, -0.4451830983161926, -0.24689266085624695, 0.08679382503032684, -0.4720322787761688, -0.1638164520263672, -0.29005780816078186, -0.7696694135665894, 1.1273194551467896, 0.3444328308105469, -0.6188302040100098, 0.6263637542724609, 0.35346677899360657, -0.07105135172605515, -1.0882487297058105, -0.03380303457379341, 0.2639192044734955, -0.8067765831947327, -0.337270051240921, -0.8491417169570923, -1.2789660692214966, 0.07337777316570282, 0.8861011266708374, -0.08606701344251633, 0.31825727224349976, -0.026970703154802322, -0.21208873391151428, -0.21095889806747437, -0.8418406844139099, 0.3192600607872009, 0.9034841656684875, -0.5476951599121094, -0.45452266931533813, -0.5725566148757935, 0.1173756793141365, -0.9785743951797485, -0.5672268867492676, -0.3817916512489319, 0.2699439823627472, -0.5396668910980225, 1.2919387817382812, -0.41619637608528137, 0.3899099826812744, 0.5143810510635376, 0.3570374548435211, -0.5371774435043335, -0.24611736834049225, -0.7448846697807312, -0.08113506436347961, 0.525420069694519, 0.205364391207695, -0.4334287941455841, 0.6025595664978027, 0.8075008392333984, 0.06867721676826477, -0.245120108127594, -0.6424614191055298, -0.30972036719322205, -0.4238576591014862, -0.19849859178066254, 0.2839004099369049, -0.004867309704422951, 0.3568834066390991, 0.20470130443572998, 0.7451796531677246, 0.5683177709579468, 0.2170097529888153, -0.06879384815692902, 0.36925023794174194, 0.007690074387937784, -0.1411547213792801, -0.6898109912872314, -0.46610209345817566, -1.2396584749221802, 0.11855768412351608, -0.9262992143630981, 0.3724423944950104, -0.5745266079902649, -0.7316758632659912, 0.2967989146709442, 0.04429760202765465, 0.043400682508945465, 0.10196404159069061, -0.3106948435306549, -0.8235741257667542, -0.871902346611023, -0.3994371294975281, 0.36015036702156067, 0.4413405656814575, -0.47531259059906006, 0.0491151437163353, 0.14595149457454681, -0.17583712935447693, 0.4157724380493164, 0.8333216905593872, -0.2809484004974365, -0.33276626467704773, -0.9251452684402466, 0.10428120940923691, 0.19034147262573242, -0.17850108444690704, -1.0894184112548828, 1.2047452926635742, 0.606762707233429, 0.45555078983306885, -0.4871915578842163, 0.3398427367210388, -0.8200234770774841, -0.45632290840148926, 0.5354753136634827, -0.7323697805404663, 0.1934264451265335, 0.516116201877594, -0.48810499906539917, 0.1475730687379837, 0.2640015780925751, 0.06750709563493729, -1.2786494493484497, -0.7876781821250916, 0.18206161260604858, -0.8396427035331726, 0.2823924124240875, -0.13235057890415192, -0.38496917486190796, -1.1468712091445923, -0.037373293191194534, -0.16069108247756958, 0.14486221969127655, -0.4087240695953369, 0.8312268257141113, 0.2054377794265747, -0.8734045624732971, 0.4821261167526245, 0.3647507131099701, -0.33183008432388306, -0.15983417630195618, 0.883435845375061, -0.09234923124313354, 0.12904150784015656, 0.34865593910217285, -0.27470335364341736, 0.0630897507071495, -0.9222217202186584, 0.5391383171081543, 0.29458311200141907, 0.24282221496105194, -0.050249096006155014, 0.8089352250099182, -0.5114992260932922, -0.5083943605422974, 0.2559322118759155, -1.023658037185669, -0.4891934394836426, 0.16084060072898865, 0.8343153595924377, 0.7067843675613403, -0.22026942670345306, -0.02010476216673851, -0.8191004991531372, 0.37702327966690063, 0.19028234481811523, -0.4029413163661957, 0.0749560296535492, -0.2572687566280365, -0.2780613303184509, 0.6309836506843567, 0.43855810165405273, -0.25268810987472534, -0.810990035533905, -0.28219836950302124, -0.2704131007194519, -0.2967011332511902, 0.18953153491020203, -0.06772889941930771, -0.5851609110832214, 0.919781506061554, 0.6464332938194275, 0.5754148960113525, 0.08572077006101608, -0.47310328483581543, -0.10613683611154556, 0.5352045297622681, 0.049284178763628006, -0.5162927508354187, -0.5526162981987, 1.191293716430664, 1.2608168125152588, -0.43081289529800415, 0.21909815073013306, -0.5881046056747437, -0.6065331697463989, 0.9294262528419495, 0.7756292819976807, -0.27279120683670044, 0.7185724973678589, -0.029816823080182076, -0.03134479001164436, 0.20791782438755035, -0.8179645538330078, -0.36688971519470215, 0.7133851647377014, 1.0108588933944702, 0.4963233768939972, -0.28164976835250854, 0.28592491149902344, 0.6455685496330261, -0.036425087600946426, 0.18143023550510406, 0.5564854145050049, 0.39333832263946533, -0.46842721104621887, 0.4788183867931366, -0.016616497188806534, 0.4650583863258362, -0.4902697205543518, -0.5389249324798584, 0.607734739780426, 0.5151825547218323, 0.12025479972362518, 0.5217667818069458, 1.1228141784667969, 0.008819859474897385, 0.4546562433242798, 0.1392764449119568, 0.503216564655304, -0.4158984124660492, -0.47442251443862915, -0.22069419920444489, -0.5802780985832214, -0.3112182915210724, -0.02600776217877865, -0.908063530921936, -0.6369146704673767, 0.14125776290893555, 0.24065691232681274, 0.13311311602592468, 0.6607674360275269, 0.5321963429450989, 0.8990246653556824, 0.8291709423065186, -0.12808288633823395, -0.8218520283699036, -0.3840020000934601, -0.7168290615081787, 0.40673327445983887, -1.0485658645629883, -0.15679289400577545, -0.13703912496566772, -0.43625596165657043, -0.22909702360630035]}, "authors": [{"authorId": "1800714", "name": "M. Rabe"}, {"authorId": "2144884927", "name": "Charles Staats"}], "references": [{"paperId": "87c5b281fa43e6f27191b20a8dd694eda1126336", "title": "FlashAttention: Fast and Memory-Efficient Exact Attention with IO-Awareness"}, {"paperId": "12809bcb734beafeb47876f42e7b438e27fe99fe", "title": "General-purpose, long-context autoregressive modeling with Perceiver AR"}, {"paperId": "5d032bd2632b6f5847767f39ce247098c6bbc563", "title": "Combiner: Full Attention Transformer with Sparse Computation Cost"}, {"paperId": "af679d69fcc1d0fcf0f039aba937853bcb50a8de", "title": "Luna: Linear Unified Nested Attention"}, {"paperId": "7e9ff94476f41041c75e253e84f487db00e9c861", "title": "Long Range Arena: A Benchmark for Efficient Transformers"}, {"paperId": "3fbf6339273c50b04e886fa9bd4ad18c952a683d", "title": "Rethinking Attention with Performers"}, {"paperId": "044e13d7dd4e0655eb76f0bd00b2c1bdb44e2be3", "title": "Big Bird: Transformers for Longer Sequences"}, {"paperId": "c0b79e6a5fd88ef13aa4780df5aae0aaa6b2be87", "title": "Linformer: Self-Attention with Linear Complexity"}, {"paperId": "657329c633709dd1ac34a30d57341b186b1a47c2", "title": "Efficient Content-Based Sparse Attention with Routing Transformers"}, {"paperId": "055fd6a9f7293269f1b22c1470e63bd02d8d9500", "title": "Reformer: The Efficient Transformer"}, {"paperId": "2cf3bd0cc1382f35384e259d99e4f9744eeaed28", "title": "Blockwise Self-Attention for Long Document Understanding"}, {"paperId": "7edacd94dc1509803d9bbcc1d92fea780d71cb3e", "title": "MnnFast: A Fast and Scalable System Architecture for Memory-Augmented Neural Networks"}, {"paperId": "21da617a0f79aabf94272107184606cefe90ab75", "title": "Generating Long Sequences with Sparse Transformers"}, {"paperId": "5f4a22ee70ca613d9c0630eafc96364fe365fdf8", "title": "Efficient Attention: Attention with Linear Complexities"}, {"paperId": "204e3073870fae3d05bcbc2f6a8e263d9b72e776", "title": "Attention is All you Need"}, {"paperId": "942deb7d865b7782c03176d95e3a0d56cb71009e", "title": "Training Deep Nets with Sublinear Memory Cost"}, {"paperId": "fa72afa9b2cbc8f0d7b05d52548906610ffbb9c5", "title": "Neural Machine Translation by Jointly Learning to Align and Translate"}, {"paperId": null, "title": "Memory efficient attention, 2021"}, {"paperId": null, "title": "Flax: A neural network library and ecosystem for JAX"}, {"paperId": "df2b0e26d0599ce3e70df8a9da02e51594e0e992", "title": "BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding"}, {"paperId": null, "title": "JAX: composable transformations of Python+NumPy programs"}, {"paperId": null, "title": "ef\ufb01cient"}]}