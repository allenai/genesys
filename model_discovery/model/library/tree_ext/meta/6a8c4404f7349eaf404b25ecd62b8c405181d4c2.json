{"paperId": "6a8c4404f7349eaf404b25ecd62b8c405181d4c2", "title": "Understanding the RoPE Extensions of Long-Context LLMs: An Attention Perspective", "abstract": "Enabling LLMs to handle lengthy context is currently a research hotspot. Most LLMs are built upon rotary position embedding (RoPE), a popular position encoding method. Therefore, a prominent path is to extrapolate the RoPE trained on comparably short texts to far longer texts. A heavy bunch of efforts have been dedicated to boosting the extrapolation via extending the formulations of the RoPE, however, few of them have attempted to showcase their inner workings comprehensively. In this paper, we are driven to offer a straightforward yet in-depth understanding of RoPE extensions from an attention perspective and on two benchmarking tasks. A broad array of experiments reveals several valuable findings: 1) Maintaining attention patterns to those at the pretrained length improves extrapolation; 2) Large attention uncertainty leads to retrieval errors; 3) Using longer continual pretraining lengths for RoPE extensions could reduce attention uncertainty and significantly enhance extrapolation.", "venue": "arXiv.org", "year": 2024, "citationCount": 0, "influentialCitationCount": 0, "openAccessPdf": null, "tldr": {"model": "tldr@v2.0.0", "text": "A broad array of experiments reveals several valuable findings that could reduce attention uncertainty and significantly enhance extrapolation in RoPE extensions, and using longer continual pretraining lengths for RoPE extensions could reduce attention uncertainty and significantly enhance extrapolation."}, "embedding": {"model": "specter_v2", "vector": [0.01923748478293419, 0.6683260798454285, -0.7965497374534607, -0.11328531056642532, -0.48656436800956726, -0.36229899525642395, 0.6630290746688843, 0.2743813097476959, -0.7737285494804382, -0.2679257094860077, 0.9027445912361145, -0.04499763995409012, 0.05171973630785942, 0.6931136250495911, 0.013790609315037727, 0.016796205192804337, -0.8056842684745789, 0.05664244294166565, -0.11107106506824493, -0.6905150413513184, 0.4417218267917633, -0.4684280753135681, -0.40622827410697937, 0.17897950112819672, 0.263609379529953, 0.37376073002815247, 0.2030324637889862, 0.9669429659843445, -0.3249225914478302, 0.049038246273994446, 0.5748405456542969, -0.4937056303024292, 0.2702438533306122, 0.17433221638202667, -0.4319608807563782, -0.6188057661056519, 0.5703784823417664, -0.5222808122634888, -0.6649165749549866, 0.7166976928710938, -0.14708943665027618, 0.38404616713523865, 0.5032697319984436, -0.2887588441371918, -0.8253678679466248, 0.9906349182128906, 0.5951166749000549, 0.569091260433197, 0.12201068550348282, -0.7570919394493103, 1.6554081439971924, -1.7537038326263428, 0.4735853374004364, 1.1239279508590698, 0.8869190812110901, 0.5373152494430542, -0.03082859516143799, 0.2028987854719162, 0.7937595844268799, 0.5425594449043274, -0.9058846831321716, -0.3707595765590668, 0.3088947534561157, 0.4299168586730957, 1.4712541103363037, -0.29204273223876953, -0.09321184456348419, 0.6033090949058533, 0.07197373360395432, 1.634143590927124, 0.1465502828359604, -1.062783122062683, -0.3189437687397003, 0.16563422977924347, 0.20570403337478638, 0.26947447657585144, -0.6567245125770569, 0.3005324900150299, -0.6460120677947998, 0.01960143819451332, -0.02886667661368847, 0.06386598944664001, -0.19259190559387207, -0.045424364507198334, -0.009204240515828133, 0.3155394494533539, 0.789852499961853, 0.7338916063308716, -0.16590455174446106, 0.721150815486908, 0.49471205472946167, 0.13632388412952423, 0.27906692028045654, 0.25696468353271484, -0.06681718677282333, 0.3392360508441925, -1.2244952917099, 0.3311568796634674, -0.08208747208118439, 0.7476899027824402, -0.20192617177963257, -0.5933287143707275, -0.7614630460739136, 0.1764775514602661, 1.2528314590454102, -0.2148677259683609, 0.6017662286758423, -0.6630449295043945, 0.24247489869594574, -0.741678774356842, 0.06668122857809067, -1.0721217393875122, -0.10570768266916275, -0.5197882056236267, -0.5622974038124084, -1.3385828733444214, -0.6486144065856934, 0.011912505142390728, 0.06097183749079704, 0.8615772724151611, -0.35980117321014404, 0.16298219561576843, 0.3378590941429138, 0.6909407377243042, 0.3481418490409851, 0.8853250741958618, 0.27439793944358826, -0.051997099071741104, 0.5615018010139465, -1.1790934801101685, -0.9559295177459717, -1.1091445684432983, 1.2654049396514893, -0.3993140757083893, 0.7802729606628418, -0.32057222723960876, -1.0866085290908813, -1.1726919412612915, -1.333542823791504, -0.2771524488925934, -0.9223456382751465, 0.7300382256507874, 0.35028403997421265, 0.03827425837516785, -1.1865088939666748, 1.456194281578064, -0.268000066280365, 0.146749347448349, 0.46335023641586304, -0.007736693602055311, 0.3993450999259949, -0.6938876509666443, -1.8169355392456055, 0.48522552847862244, 0.26058971881866455, 0.08537064492702484, 0.3926372826099396, -0.2723354995250702, -1.3080111742019653, -0.06623256206512451, 0.481291264295578, -0.41272127628326416, 0.9552382826805115, 0.0655774474143982, -1.351172924041748, 0.40172991156578064, -0.37365952134132385, 0.16888853907585144, 0.40600475668907166, -0.6849221587181091, -0.395378977060318, -0.2999505400657654, -0.21807760000228882, 0.8244268894195557, 0.3620814383029938, -0.17400717735290527, 0.04752075672149658, 0.19265401363372803, -0.3490763306617737, 0.49892792105674744, -0.3999784290790558, 0.4254809021949768, -0.36976540088653564, -0.3315180838108063, 0.3379358947277069, 0.37105169892311096, 0.00472221476957202, -0.11675523221492767, -0.19574867188930511, -1.4482399225234985, 0.9736030697822571, 0.09466776251792908, 1.7167633771896362, -0.8038862347602844, -0.2614001929759979, -0.44997480511665344, -0.152610182762146, 0.04698207601904869, -0.9382672905921936, 1.1002260446548462, -0.2252144068479538, 0.45085006952285767, -0.023737439885735512, -1.5315815210342407, 0.3490486443042755, -0.31442567706108093, -0.6813034415245056, -0.21950587630271912, -0.0908784344792366, 1.2963639497756958, -1.194940209388733, 0.01051217783242464, -0.5680751800537109, 0.3981068432331085, -0.631487250328064, 0.835870087146759, -0.3393291234970093, -0.13050810992717743, 0.18873922526836395, -0.3729088604450226, -0.2933979332447052, -0.4789520502090454, 0.42779600620269775, -0.3305506706237793, 0.18899402022361755, 0.508908212184906, -0.42302343249320984, 1.4857819080352783, -0.3741483986377716, 0.9781895279884338, -0.6284883618354797, 0.08134397864341736, -0.051387883722782135, 0.27920275926589966, -0.4032714366912842, 0.039344366639852524, 0.09476523846387863, 0.6798574328422546, -0.8383721113204956, 0.1400635689496994, 1.3952699899673462, 0.8887796401977539, -0.374567449092865, 0.16724595427513123, -0.06346317380666733, 0.2326136976480484, 0.19996438920497894, 0.646178662776947, 0.14489087462425232, 0.8865306973457336, 0.28169500827789307, -0.11770090460777283, 0.6663995981216431, -0.7915040850639343, -0.41238319873809814, 0.19691595435142517, 0.6018150448799133, 0.7253846526145935, 0.2790035605430603, -0.5635433793067932, -0.6200394034385681, 0.5133031606674194, 0.44615671038627625, 1.6645671129226685, 0.15294615924358368, -0.8581054210662842, -0.8271811604499817, -0.5739192366600037, -0.3691007196903229, -0.0943726971745491, -0.46759727597236633, -0.30589649081230164, -0.7515046000480652, -0.8581068515777588, 0.7704547643661499, 0.6604489088058472, 0.6437011957168579, -0.4568902254104614, -0.4015294909477234, -0.16690444946289062, -0.13527153432369232, -0.545737624168396, -0.9367141723632812, 0.18089741468429565, -0.6110599040985107, 0.015858039259910583, -0.28072965145111084, -0.36363446712493896, 0.17887136340141296, -0.9442103505134583, 0.6416770219802856, -0.1264200210571289, 0.06272304803133011, 0.13135430216789246, 0.13681244850158691, -0.3249097764492035, -0.33364424109458923, 0.7619749903678894, 0.46847838163375854, -0.3577917516231537, 0.5721907615661621, 0.9482743740081787, -0.3976510167121887, -0.04216763749718666, -0.5756485462188721, 0.03519502282142639, 0.3566961884498596, 0.03988594561815262, 0.9080912470817566, -0.3687842786312103, 0.607174813747406, -1.0795575380325317, 1.1725820302963257, 0.34391409158706665, -0.05920908972620964, 0.43083077669143677, -1.1070775985717773, -0.37039968371391296, 0.4902290105819702, -0.9775717258453369, -0.0673632100224495, -1.1029163599014282, 0.21613235771656036, -0.309467077255249, 0.19892361760139465, 0.6066126823425293, 0.4779622554779053, 0.48001110553741455, 0.48912423849105835, 0.18872202932834625, 0.12634135782718658, -0.2610263526439667, 0.8646547198295593, -0.4676198363304138, 0.6438841819763184, 0.17150071263313293, -0.21840117871761322, -0.5141257643699646, 0.26029303669929504, -0.550769031047821, -0.5920032262802124, -0.3507135510444641, -0.7594010829925537, -0.18917341530323029, -0.05948852002620697, -0.325531005859375, -0.5973896980285645, -0.4963358938694, -0.7146528959274292, -0.19646038115024567, 0.01511666364967823, -0.5685184001922607, -0.21612755954265594, -0.6365531086921692, -1.538535237312317, -0.3105023205280304, -0.6289874315261841, -0.8872764706611633, 0.5319048762321472, 0.0773104801774025, -0.7039687037467957, -0.9370507597923279, 0.1674858033657074, -0.771025538444519, 1.0972771644592285, -0.4423038959503174, 0.8192962408065796, -0.05620849132537842, 0.06677243113517761, -0.7278233170509338, 0.4659107029438019, 0.6301009654998779, -0.23807072639465332, 0.20739313960075378, -0.6056033372879028, -0.26899203658103943, -0.02645047754049301, -0.18019239604473114, 0.11559605598449707, 0.2851354479789734, 0.6391949653625488, -0.5195639729499817, -0.853908896446228, 0.1961115002632141, 1.7368226051330566, -0.8655449151992798, 0.303297758102417, 0.2566298842430115, 0.8230238556861877, 0.6518269181251526, 0.19203457236289978, 0.38365688920021057, 0.12543119490146637, 0.37153810262680054, -0.10888956487178802, 0.2264549881219864, -0.3019310235977173, -0.9073591828346252, 0.6205347776412964, 2.0142035484313965, 0.4192700982093811, -0.12287890166044235, -1.239552617073059, 0.4403776228427887, -1.299912929534912, -0.7126641273498535, 0.8798315525054932, 0.5810486674308777, 0.6167019009590149, -0.5759921073913574, -0.45154109597206116, -0.22082124650478363, 0.4218238294124603, 0.6255385279655457, -0.4660837650299072, -0.3683336675167084, -0.08699909597635269, 0.029993759468197823, -0.023756904527544975, 0.8499419093132019, -0.45404472947120667, 0.7646890878677368, 14.358901977539062, 0.7576487064361572, -0.10816024243831635, 0.22847330570220947, 1.014184594154358, 0.1734006404876709, -0.19051377475261688, 0.08031070977449417, -1.4984500408172607, 0.19517482817173004, 1.2406984567642212, 0.40216749906539917, 0.14395518600940704, 0.05685827508568764, -0.1951606124639511, 0.4228855073451996, -1.2048802375793457, 0.6532614231109619, 0.8487473130226135, -1.355155110359192, 0.2870655357837677, 0.12448270618915558, 0.5855353474617004, 0.27280524373054504, 1.1963847875595093, 0.6338761448860168, -0.2669210433959961, -0.3802904188632965, 0.5440763831138611, 0.4011612832546234, 1.2189151048660278, -0.1333373337984085, 0.8888646960258484, 0.5613594055175781, -0.5775595307350159, -0.4648989140987396, -0.9987841844558716, -0.9411113262176514, 0.2502964437007904, -0.23696555197238922, -0.5049859285354614, -0.3292068541049957, -0.2846185564994812, 1.2651522159576416, -0.5325653553009033, 0.19356894493103027, -0.31960615515708923, 0.2560025751590729, 0.1770567148923874, -0.21609441936016083, 0.8118754029273987, 0.2014026641845703, 0.37538689374923706, 0.30228883028030396, 0.24904316663742065, 0.11237236112356186, -0.14509381353855133, 0.2111036628484726, -0.4674161374568939, 0.25026288628578186, -0.25465577840805054, -0.09956756979227066, 0.20097337663173676, 0.8044679760932922, 0.7981988787651062, 0.1426728069782257, 0.12862993776798248, 0.5124638080596924, 0.6027162075042725, 0.33525118231773376, 0.09827030450105667, -0.7666580677032471, -0.07994221895933151, -0.2729986608028412, -0.1657409816980362, 0.5252364277839661, -0.20858846604824066, -0.5596991777420044, -0.5804954767227173, -0.20404846966266632, 0.055754899978637695, -0.8163763880729675, -0.9967855215072632, 1.092747688293457, -0.1601114571094513, -0.8146297931671143, -0.04505905508995056, -0.8736724853515625, -0.04765099659562111, 0.5646939873695374, -1.7195252180099487, -0.4783763289451599, 0.5725392699241638, -0.7139929533004761, -0.3956730365753174, 0.07726983726024628, 0.8818966746330261, 0.15933853387832642, -0.32088175415992737, 0.3715040683746338, 0.4008769690990448, -0.042655572295188904, 0.1839723289012909, -1.0442782640457153, 0.4654865860939026, 0.12146471440792084, -0.18691545724868774, 0.6946933269500732, -0.17650958895683289, 0.1805463433265686, -0.5877828001976013, -0.09888207912445068, 0.838556706905365, -1.232102394104004, -0.7571328282356262, -0.45813024044036865, -1.1006630659103394, 0.3394794762134552, 0.7468281388282776, -0.3916480839252472, 0.42977526783943176, 0.050797875970602036, -0.13104650378227234, 0.043539080768823624, -0.6301265358924866, 0.41617366671562195, 0.3810062110424042, -1.0214842557907104, -0.7341185808181763, -0.16040755808353424, 0.24660752713680267, -1.0494672060012817, -0.4983748495578766, 0.03008442372083664, 0.16657331585884094, 0.3933822810649872, 1.0398916006088257, -0.5501905679702759, 1.2160362005233765, 0.5673012137413025, -0.4220966100692749, -0.7812526226043701, -0.12320797890424728, -0.9211224913597107, -0.30067068338394165, 0.20550702512264252, 0.6876643896102905, -0.047013673931360245, 0.4471589922904968, 0.8144223093986511, 0.33296361565589905, -1.366294503211975, -0.17356106638908386, -0.18736997246742249, 0.5143850445747375, -0.022610332816839218, 0.20126116275787354, -0.019524114206433296, 0.21159334480762482, 0.38521331548690796, 0.39220187067985535, 0.527069628238678, -0.24976509809494019, -0.7237378358840942, -0.16256485879421234, -0.039209846407175064, -0.03517991304397583, -0.874967098236084, -0.30918148159980774, -1.9094983339309692, -0.0024488563649356365, -1.3666143417358398, -0.01604350656270981, -1.0093997716903687, -0.6032399535179138, -0.22724546492099762, -0.43342381715774536, -0.13443714380264282, -0.04292608052492142, -0.25265100598335266, -0.2167804092168808, -0.15454478561878204, -0.6644577383995056, 0.8751614093780518, 0.8053749799728394, -0.3187966048717499, -0.012609664350748062, -0.028703486546874046, -0.01000883337110281, 0.09184041619300842, 0.40725794434547424, -0.33308926224708557, -0.8841918706893921, -1.2997894287109375, 1.092148780822754, -0.17921854555606842, -0.3213788866996765, -0.28609296679496765, 0.9306517839431763, 0.8332164287567139, 0.15979619324207306, -0.28269705176353455, 0.4022788405418396, -1.0012990236282349, -0.5765582919120789, 0.10284591466188431, -1.524025797843933, 0.7079471349716187, -0.14758485555648804, -0.20671410858631134, -0.3033268451690674, 0.23909404873847961, -0.18787746131420135, -0.5147517323493958, -0.6781728863716125, 0.5577833652496338, -0.22237157821655273, -0.02525431290268898, -0.5520907640457153, -0.23613668978214264, -1.246671438217163, -0.43133899569511414, -0.24244830012321472, 0.45248672366142273, 0.10302792489528656, 0.891595721244812, 0.8609627485275269, -1.5992244482040405, -0.028927071020007133, 0.18473196029663086, 0.1559097319841385, 0.18591941893100739, 0.5301036834716797, 0.50656658411026, -0.26703208684921265, 0.5734186768531799, 0.5824268460273743, 0.11103413999080658, -1.0705283880233765, 0.17458577454090118, 0.541045606136322, -0.5143435597419739, -0.4756922423839569, 1.1352192163467407, -0.6290109157562256, -0.9485741257667542, 0.15530087053775787, -0.9348688125610352, -0.7732830047607422, -0.19319187104701996, 0.7435406446456909, 0.33803069591522217, -0.462409645318985, -0.2516424357891083, -0.4729847013950348, 0.6402137875556946, -0.37611812353134155, -0.4993080198764801, 0.6676247119903564, -0.6380162239074707, -0.45797649025917053, 0.670062243938446, 1.3751130104064941, -0.6153402328491211, -1.147078275680542, -1.128310203552246, 0.009902168065309525, -0.3708498179912567, 0.24877791106700897, -0.45056673884391785, 0.05843768268823624, 0.8917080163955688, 0.5510395169258118, 0.09500283747911453, 0.14196226000785828, 0.04399275779724121, 0.3653229773044586, 0.9653013944625854, -0.3570071756839752, -0.7973596453666687, -0.22894757986068726, 1.0214155912399292, 1.623156189918518, -0.6118744611740112, 0.5972427725791931, 0.19069179892539978, -0.6303597092628479, 1.0922082662582397, -0.10677824914455414, -0.029771288856863976, 0.8130704164505005, -0.557877779006958, 0.16059739887714386, 0.22346150875091553, -1.0466854572296143, 0.4860176742076874, 1.1388919353485107, 0.8732565641403198, 0.6148542165756226, -0.06214332953095436, -0.10613848268985748, 0.6153018474578857, -0.02555783838033676, -0.08805220574140549, 0.5649582147598267, 0.5559916496276855, -0.1453583836555481, -0.4752112925052643, 0.48298123478889465, 0.18686586618423462, -1.035233736038208, -0.6233438849449158, -0.016141794621944427, 0.27399101853370667, -0.026499858126044273, 0.2878585755825043, 0.4705179035663605, 0.15562374889850616, 0.10328224301338196, 0.40363919734954834, 0.36949244141578674, -0.3700997829437256, -0.3182373344898224, -0.28524285554885864, -1.0024352073669434, 0.11719315499067307, -0.17312684655189514, -0.5733702778816223, -0.19067615270614624, -0.07660900801420212, 0.19588789343833923, -0.07965390384197235, 0.5547245740890503, 0.8887091875076294, 0.786656379699707, 0.31369608640670776, -0.2791217863559723, -0.583691418170929, -0.812843918800354, -0.9668418765068054, 0.197599396109581, -0.1378302425146103, 0.04280351847410202, 0.3305527865886688, -0.0011975698871538043, -0.2809928357601166]}, "authors": [{"authorId": "2262545040", "name": "M. Zhong"}, {"authorId": "2307559946", "name": "Chen Zhang"}, {"authorId": "2307743865", "name": "Yikun Lei"}, {"authorId": "2273820302", "name": "Xikai Liu"}, {"authorId": "2274218703", "name": "Yan Gao"}, {"authorId": "2274057855", "name": "Yao Hu"}, {"authorId": "2266796043", "name": "Kehai Chen"}, {"authorId": "2267153486", "name": "Min Zhang"}], "references": [{"paperId": "dddf8ebf50aef9f6ac683ea086215223425b95ce", "title": "Base of RoPE Bounds Context Length"}, {"paperId": "93765da00ae8f14bb7675b95fc55a8a57fff091f", "title": "Can Perplexity Reflect Large Language Model's Ability in Long Text Understanding?"}, {"paperId": "f288e2238ac8725baa7ca9874bbc3fed1e89a632", "title": "Data Engineering for Scaling Language Models to 128K Context"}, {"paperId": "a1f76db91c0debcf93ae9889736bce8470902113", "title": "Large Language Models: A Survey"}, {"paperId": "0595dac8260443365dfbe4821787419736baaa66", "title": "Extending LLMs' Context Window with 100 Samples"}, {"paperId": "7260442ef9c0448f07ce3803efd49cebaffcebe9", "title": "DeepSeek LLM: Scaling Open-Source Language Models with Longtermism"}, {"paperId": "a6348981246adcd42e8ba39acf139da745696eff", "title": "Towards the Law of Capacity Gap in Distilling Language Models"}, {"paperId": "539fadfb615ef84c240f4741061c44eeda540091", "title": "Scaling Laws of RoPE-based Extrapolation"}, {"paperId": "5fc1a3a49e8f1d106118b69d1d6be3b6caa23da0", "title": "Qwen Technical Report"}, {"paperId": "0b0debb710366cdff461938c80763eace1651af6", "title": "Code Llama: Open Foundation Models for Code"}, {"paperId": "104b0bb1da562d53cbda87aec79ef6a2827d191a", "title": "Llama 2: Open Foundation and Fine-Tuned Chat Models"}, {"paperId": "f5afaccfe90268485a9961c5771ec5e71e9b806c", "title": "Extending Context Window of Large Language Models via Positional Interpolation"}, {"paperId": "6bef46eccb4c7f521e4f255a01595ebf9994ae22", "title": "Evaluating Open-Domain Question Answering in the Era of Large Language Models"}, {"paperId": "66c10bf1f11bc1b2d92204d8f8391d087f6de1c4", "title": "RoFormer: Enhanced Transformer with Rotary Position Embedding"}, {"paperId": "33422275fbb9958f55419620697faf531482699b", "title": "How Can We Know When Language Models Know? On the Calibration of Language Models for Question Answering"}, {"paperId": "90abbc2cf38462b954ae1b772fac9532e2ccd8b0", "title": "Language Models are Few-Shot Learners"}, {"paperId": "db95ba221305a3aa2ec8bbc78de0f42485c63c12", "title": "Generalizing Question Answering System with Pre-trained Language Model Fine-tuning"}, {"paperId": "204e3073870fae3d05bcbc2f6a8e263d9b72e776", "title": "Attention is All you Need"}, {"paperId": "e3aa232577bb427b1f3a34acbdef84bd85734042", "title": "LM-Infinite: Simple On-the-Fly Length Generalization for Large Language Models"}, {"paperId": "cd18800a0fe0b668a1cc19f2ec95b5003d0a5035", "title": "Improving Language Understanding by Generative Pre-Training"}, {"paperId": null, "title": "Needle in a haystack - pressure testing llms"}, {"paperId": null, "title": "Things i\u2019m learning while training superhot"}, {"paperId": null, "title": "4: Validation Perplexity on Proof-pile (Azerbayev et al., 2022) of MiniMA-2-3B"}]}