{"paperId": "2016c5b269e2011afba84670c5f85dc7f96644ff", "title": "PipeFusion: Displaced Patch Pipeline Parallelism for Inference of Diffusion Transformer Models", "abstract": "This paper introduces PipeFusion, a novel approach that harnesses multi-GPU parallelism to address the high computational and latency challenges of generating high-resolution images with diffusion transformers (DiT) models. PipeFusion splits images into patches and distributes the network layers across multiple devices. It employs a pipeline parallel manner to orchestrate communication and computations. By leveraging the high similarity between the input from adjacent diffusion steps, PipeFusion eliminates the waiting time in the pipeline by reusing the one-step stale feature maps to provide context for the current step. Our experiments demonstrate that it can generate higher image resolution where existing DiT parallel approaches meet OOM. PipeFusion significantly reduces the required communication bandwidth, enabling DiT inference to be hosted on GPUs connected via PCIe rather than the more costly NVLink infrastructure, which substantially lowers the overall operational expenses for serving DiT models. Our code is publicly available at https://github.com/PipeFusion/PipeFusion.", "venue": "arXiv.org", "year": 2024, "citationCount": 0, "influentialCitationCount": 0, "openAccessPdf": null, "tldr": {"model": "tldr@v2.0.0", "text": "PipeFusion significantly reduces the required communication bandwidth, enabling DiT inference to be hosted on GPUs connected via PCIe rather than the more costly NVLink infrastructure, which substantially lowers the overall operational expenses for serving DiT models."}, "embedding": {"model": "specter_v2", "vector": [0.59718918800354, 0.030132589861750603, -0.37432241439819336, 0.21797414124011993, -0.3607451021671295, 0.21109993755817413, 0.857589602470398, -0.3709954619407654, -0.20005150139331818, -0.8734429478645325, 0.48897653818130493, 0.4129112958908081, 0.12921400368213654, -0.2501033842563629, 0.04533633962273598, -0.442314088344574, -1.1131293773651123, -0.1683276742696762, 0.7693616151809692, -0.3381155729293823, 0.07579924911260605, -0.0004482531803660095, -1.1422098875045776, 0.5047962069511414, 0.3305700719356537, 1.3821842670440674, -0.14954468607902527, 1.20090913772583, -0.046316277235746384, 0.3026431202888489, 0.5924287438392639, -0.07563818991184235, 0.6869979500770569, -0.053301602602005005, 0.04520729184150696, 0.20262819528579712, 0.7150155305862427, -0.7323946356773376, -0.6002793908119202, 0.859410285949707, 0.1545545905828476, -0.14266067743301392, 0.6672531366348267, -0.5241290330886841, -0.25872743129730225, 0.0683676153421402, -0.05479736626148224, 1.277337908744812, -0.3176303505897522, -0.5092819929122925, 0.8219664096832275, -1.271180272102356, 0.48328152298927307, 1.3917858600616455, 0.7421446442604065, -0.2734394073486328, -0.5585154294967651, -0.2605687379837036, 0.16484197974205017, 0.16275009512901306, -0.5796711444854736, -0.2839357256889343, 0.0507042333483696, -0.49515295028686523, 1.5261775255203247, -0.4076392650604248, 0.1733677238225937, 0.8138293623924255, 0.4335572421550751, 1.3383303880691528, 0.30295035243034363, -0.6360244154930115, -0.05021567642688751, -0.24833577871322632, -0.061866167932748795, 0.791934609413147, -0.4506796896457672, 0.4162145256996155, -1.2429192066192627, -0.2216101586818695, 0.9105663895606995, -0.016392957419157028, 0.18193045258522034, -0.274819016456604, -0.2059587985277176, 0.6739814281463623, 0.7369471192359924, 0.346296101808548, -0.514463484287262, 0.46183377504348755, 0.5315346717834473, 0.08389793336391449, 0.2726128101348877, -0.39246776700019836, 0.4498519003391266, 0.7131941318511963, -0.9347965121269226, 0.26906007528305054, 0.10794312506914139, 0.4894692897796631, -0.049105480313301086, -0.1004633754491806, -0.6134946346282959, 0.009802870452404022, 1.2415927648544312, 0.12160715460777283, 0.33445078134536743, -0.6428627371788025, -0.1230294480919838, -1.1194058656692505, 0.12502521276474, -0.9748955965042114, 0.32056671380996704, -0.06762117147445679, -1.063817024230957, -0.4967680871486664, -0.6472681760787964, -0.000563926761969924, -1.0203696489334106, -0.27918267250061035, 0.15430203080177307, 0.443013459444046, -0.15116454660892487, 0.6735713481903076, 0.2886437177658081, 0.4158287048339844, 0.33325889706611633, 0.40463313460350037, 1.033503770828247, -1.40125572681427, -0.2832692563533783, -0.5541502237319946, -0.09357915073633194, -0.41952934861183167, -0.15890294313430786, 0.017408467829227448, -1.2722201347351074, -1.0909515619277954, -0.853378176689148, 0.08394257724285126, -0.3715316951274872, -0.32236143946647644, 1.2095242738723755, 0.14024971425533295, -1.2188472747802734, 1.0079054832458496, -0.5785645246505737, -0.39515721797943115, 0.8249561190605164, 0.04359688237309456, 0.48317307233810425, -0.2608810067176819, -0.9379672408103943, 0.06752488762140274, -0.5068053603172302, -0.4754391610622406, -0.46420183777809143, -0.8053529262542725, -0.4369603991508484, 0.014336436986923218, -0.12422270327806473, -0.7294067740440369, 1.003438115119934, -0.15209601819515228, -0.9228526949882507, 0.43049556016921997, -0.1532745212316513, -0.24964261054992676, 0.5650361776351929, -0.14239849150180817, -0.3655797839164734, 0.34315699338912964, -0.055291809141635895, 0.7478447556495667, 1.1559315919876099, 0.08767098933458328, -0.37447482347488403, -0.1849278211593628, -0.5730715990066528, 0.23898348212242126, -0.16727522015571594, 0.994224488735199, -0.3936164975166321, -0.2680400311946869, 0.3092373311519623, 0.7562713623046875, -0.5556354522705078, 0.35687804222106934, -0.5036444067955017, -0.3773144483566284, 1.107356071472168, 0.0625186562538147, 0.3071962594985962, -0.9231604337692261, -0.678501307964325, 0.11047803610563278, 0.506931483745575, -0.4051668345928192, -0.5495011806488037, 0.667417585849762, -0.14008764922618866, 0.1669464111328125, 0.1478390097618103, -0.788022518157959, -0.027810510247945786, -0.5031278133392334, -0.838079035282135, -0.28225088119506836, 0.1257530152797699, 1.058017373085022, -0.5562824010848999, -0.09086889773607254, -0.006607279647141695, 0.907637894153595, -0.7552077770233154, 1.0316962003707886, -0.34565067291259766, 0.46502313017845154, -0.20702698826789856, 0.13521884381771088, 0.2845224440097809, -0.5657411813735962, 0.5642514824867249, -0.9676088690757751, -0.07658647000789642, 0.011348285712301731, -0.44106996059417725, 1.3850644826889038, 0.13251356780529022, 0.2991490662097931, -0.04108805954456329, -0.48470601439476013, 0.24938048422336578, 0.26428064703941345, 0.27317729592323303, -0.6450626254081726, 0.11357184499502182, 0.441790908575058, -0.5677770376205444, 0.28748688101768494, 0.47143685817718506, 1.1783320903778076, 0.1403406411409378, -0.08797062933444977, 0.3431287407875061, -0.40034219622612, 0.2713775336742401, 0.3583352267742157, 0.9640864729881287, 0.3824369013309479, -0.22902654111385345, -0.13889780640602112, -0.11600860208272934, -0.8162423968315125, -0.3113093078136444, 0.7811924815177917, 0.4623887836933136, 1.1109946966171265, 0.7493149042129517, -0.9440650939941406, -0.5597258806228638, -0.4414327144622803, 0.4580126106739044, 0.8027098178863525, 0.05326111987233162, -0.09093712270259857, -0.7353920936584473, -0.4764651954174042, -0.33369073271751404, -1.2033196687698364, -0.5484505295753479, 0.2624205946922302, -0.24447448551654816, -1.1758394241333008, 0.6490073204040527, 0.08685719221830368, 1.4886491298675537, -0.46142634749412537, -0.46295762062072754, -0.5375955104827881, 0.6519091725349426, -0.6762542128562927, -0.42764127254486084, 0.46726635098457336, -0.2968001365661621, -0.043475694954395294, -0.3636516034603119, -0.17608019709587097, 0.13777221739292145, -0.32412561774253845, 0.6698211431503296, -0.5086517333984375, -0.9293735027313232, 0.2285424768924713, 0.3831188380718231, -0.3930695056915283, -0.12787415087223053, -0.04506592079997063, -0.33222323656082153, 0.015805169939994812, 0.17638292908668518, -0.26246410608291626, -0.7891269326210022, 0.16516047716140747, -0.5559439659118652, 0.1957564502954483, 0.232481449842453, -0.11908600479364395, 1.097212791442871, -0.020876441150903702, -0.15946081280708313, -0.8198649883270264, 0.9653688073158264, -0.2775973975658417, -0.4851921796798706, -0.2648296058177948, -0.6198405623435974, -0.471333771944046, 0.2653794586658478, -0.8850142359733582, -0.4135623276233673, -0.6297224164009094, 0.069216288626194, -0.5997125506401062, -0.529916524887085, -0.327116996049881, 0.711962878704071, -0.6251940131187439, 0.8622472882270813, 0.19252189993858337, 0.38122037053108215, -0.14098650217056274, 0.7278175950050354, -1.1019483804702759, 0.7133032083511353, 0.25102439522743225, -0.012375679798424244, 0.6474290490150452, 0.155657097697258, -0.972290575504303, -0.37067028880119324, -0.4375671148300171, -0.6980575919151306, -0.36492323875427246, 0.7026927471160889, -0.3429974317550659, -0.7012019157409668, 0.10305601358413696, -0.889030933380127, -0.3109222650527954, 0.07957981526851654, -0.22415657341480255, -0.32372844219207764, -0.7388023138046265, -1.5223380327224731, -0.013274533674120903, -1.1675633192062378, -1.3299516439437866, 0.6923831701278687, 0.332933247089386, -0.22290439903736115, -0.7693983316421509, -0.1646413505077362, -0.9364486336708069, 1.052524209022522, -0.17194139957427979, 0.44257164001464844, 0.2706218957901001, -0.649725079536438, 0.0679771825671196, -0.38980358839035034, 0.3440304398536682, -0.317073255777359, 0.34680914878845215, -0.8126732707023621, 0.6789071559906006, -0.3391653597354889, -0.19921500980854034, 0.3429303467273712, 0.6297456622123718, 0.5900458693504333, 0.34214937686920166, -0.7175970077514648, 0.6982893943786621, 1.312463641166687, -0.7646584510803223, 0.27553048729896545, -0.05548393353819847, 0.8354048132896423, 0.07855705916881561, -0.5626417994499207, 0.610356330871582, -0.07636550813913345, 0.4751889109611511, 0.012099022977054119, -0.896490752696991, -1.0297927856445312, -0.43070757389068604, 0.21929684281349182, 0.8787615895271301, 0.8189140558242798, 0.12083285301923752, -0.7579275965690613, 0.48606956005096436, -1.135934829711914, -0.7414404153823853, 0.23463211953639984, 0.4054180681705475, -0.058202680200338364, -0.4291694760322571, 0.07815418392419815, -0.41733425855636597, 0.32793277502059937, 0.5791933536529541, -0.6171152591705322, -0.46504151821136475, 0.03311917930841446, 0.7776582837104797, 0.3841542899608612, 0.5484012961387634, -0.32888880372047424, 0.21794393658638, 15.008928298950195, 0.9182462692260742, -0.3840445578098297, 0.24032895267009735, 0.790045976638794, 0.8205774426460266, -0.0752272978425026, -0.04286010190844536, -1.1988338232040405, -0.0025061704218387604, 1.1043254137039185, 0.18023480474948883, 0.3912971019744873, 0.15695826709270477, -0.15834839642047882, -0.14675217866897583, -0.23669226467609406, 0.5881824493408203, 0.47647497057914734, -1.4379642009735107, -0.07111740857362747, 0.26313069462776184, 0.520408570766449, 1.037526249885559, 1.0670253038406372, -0.10260606557130814, 0.5532382130622864, -0.21372441947460175, 0.12043583393096924, 0.4538504183292389, 0.8704151511192322, 0.25480979681015015, -0.11669853329658508, 0.06118297204375267, -1.049824595451355, 0.2977699041366577, -0.6097766757011414, -0.8281704783439636, 0.4157106876373291, 0.42120906710624695, -0.8451761603355408, -0.3735460340976715, 0.4777950644493103, 1.095336675643921, 0.020538970828056335, 0.7186417579650879, -0.1634611189365387, 0.21609938144683838, -0.24545587599277496, 0.44915857911109924, 0.11529220640659332, 0.3099360167980194, -0.18507561087608337, 0.10832105576992035, 0.05704057216644287, -0.22930091619491577, 0.39562681317329407, 0.2507232129573822, -0.1990235447883606, -0.38592255115509033, -0.3723139464855194, 0.13730169832706451, -0.4696781039237976, 1.242472767829895, -0.04932495951652527, 0.14800061285495758, -0.5773823261260986, 0.9067529439926147, 0.4705497622489929, 0.16282130777835846, -0.2373889833688736, -0.17624737322330475, 0.5211889743804932, -0.1371694803237915, 0.48492005467414856, 0.4426027238368988, -0.30805298686027527, -0.4482821226119995, -0.7983535528182983, -0.06343866884708405, 0.3496812880039215, -0.7866913080215454, -1.2162384986877441, 1.2416242361068726, -0.13212262094020844, -0.17417921125888824, 0.28476718068122864, -0.6666170954704285, -0.4069975018501282, 0.6914060115814209, -1.4675307273864746, -0.7808972001075745, -0.05763573572039604, -0.20830760896205902, -0.31897735595703125, 0.3671148717403412, 1.1343668699264526, 0.2309553027153015, -0.14091365039348602, -0.5326476097106934, -0.19321124255657196, -0.22856605052947998, 0.1352275013923645, -0.6289867162704468, 1.2446157932281494, 0.4292374849319458, 0.06322570890188217, -0.2667962908744812, -0.19955582916736603, -0.1952933371067047, -0.6809031367301941, 0.1758880764245987, -0.05570020154118538, -0.44138526916503906, 0.0790645033121109, -0.48712801933288574, -0.9106212854385376, 0.1179589033126831, 0.8020647168159485, 0.4161571264266968, 0.26581236720085144, -0.3010878264904022, -0.4974147081375122, -0.18583041429519653, -0.7875011563301086, 0.04886559769511223, 0.35788291692733765, -0.6285724639892578, 0.11945335566997528, 0.10371176153421402, 0.07400921732187271, -1.120341420173645, -1.1086369752883911, -0.147805854678154, 0.4912613034248352, -0.6769682765007019, 1.3835132122039795, 0.23241694271564484, 0.6775710582733154, 0.8538722991943359, -0.16068990528583527, -0.5969216823577881, 0.08043970912694931, -0.9100100994110107, -0.10656337440013885, -0.06948558241128922, 0.15234310925006866, -0.14374496042728424, 0.599084198474884, 0.5564470887184143, 0.5568011403083801, -0.6609386801719666, -0.12365087866783142, 0.13501855731010437, -0.08100028336048126, -0.22161033749580383, 0.130137637257576, -0.5188384056091309, -0.33896157145500183, 0.04065028578042984, 0.538726270198822, 0.7661821842193604, 0.5365698933601379, -0.567500114440918, 0.43387606739997864, -0.020465468987822533, -0.21118684113025665, -0.4780328869819641, -0.6768775582313538, -1.6666820049285889, -0.5801778435707092, -1.0197956562042236, -0.3309236168861389, -0.9513924717903137, -0.7657341957092285, -0.17526692152023315, 0.04616546258330345, -0.33502188324928284, 0.4831603169441223, 0.19843924045562744, -0.6960096955299377, -0.28228631615638733, -0.5430468320846558, 0.5205838084220886, 1.2764363288879395, -0.5112638473510742, 0.06361988186836243, -0.29578810930252075, 0.22823987901210785, 0.682223916053772, 0.20111918449401855, -0.1955643892288208, -0.8110905289649963, -1.2339013814926147, -0.13472826778888702, 0.018926354125142097, 0.12441030889749527, -1.0304118394851685, 0.8541553020477295, 0.6767909526824951, 0.5530490875244141, 0.045202579349279404, 0.47995346784591675, -0.7158430814743042, -0.32169872522354126, 0.3396395444869995, -0.5042223334312439, 0.01983284391462803, -0.011403375305235386, -0.36144667863845825, -0.07010122388601303, 1.3255784511566162, 0.1870718151330948, -0.7779581546783447, -1.194797158241272, 0.6643499732017517, -0.2671128809452057, -0.20082959532737732, -0.24071775376796722, -0.10707899183034897, -1.3901828527450562, -0.0761231929063797, -0.3351518213748932, 0.08980456739664078, -0.26578599214553833, 0.8167829513549805, 0.7881165742874146, -1.010422706604004, 0.3574884533882141, 0.6914316415786743, -0.6514411568641663, 0.07065431773662567, 0.8802366256713867, 0.977304220199585, -0.49833768606185913, -0.038105644285678864, -0.21494054794311523, -0.03370939940214157, -0.4488648474216461, 0.15064384043216705, 0.9132441878318787, -0.4077053666114807, -0.5355362296104431, 0.9423877000808716, -0.03176893666386604, -0.35192549228668213, 0.012953553348779678, -0.8176187872886658, -0.16834305226802826, -0.46782082319259644, 0.9356570243835449, 0.40430593490600586, 0.07313266396522522, 0.2468799352645874, -0.3798340857028961, 0.3703187108039856, -0.5023226737976074, -0.7525272965431213, 0.33156323432922363, -0.14674240350723267, -0.21629175543785095, 0.0023888929281383753, 0.4907887578010559, -0.6233989000320435, -1.2694902420043945, -0.8701255321502686, -0.5455439686775208, -0.5198694467544556, 0.4144737422466278, -0.4428718686103821, -0.6193408370018005, 0.9560749530792236, 0.9954441785812378, 0.47196105122566223, 0.4236289858818054, 0.06866592168807983, 0.6212211847305298, 0.10686864703893661, -0.22706632316112518, -0.16896690428256989, -0.21526800096035004, 0.4953376054763794, 0.9290051460266113, -0.6895956993103027, 0.3845905363559723, -0.49138984084129333, -0.5226233601570129, 0.7754988670349121, 0.24738967418670654, -0.5518084764480591, 1.2531509399414062, 0.2786707282066345, 0.2341853380203247, -0.20523859560489655, -0.6308786273002625, -0.39302507042884827, 0.7840990424156189, 1.6645032167434692, 0.3361804783344269, -0.0839390978217125, 0.2471880167722702, 0.19292543828487396, 0.5555310845375061, 0.1923365592956543, 0.08915428817272186, 0.31340378522872925, -0.18725524842739105, -0.19691532850265503, -0.14711491763591766, 0.8607726097106934, -0.7692136168479919, -0.5644197463989258, 0.239460751414299, 0.29679611325263977, 0.14276401698589325, 0.5424789190292358, 0.9836010336875916, 0.0211696308106184, 0.6428189277648926, -0.7654166221618652, 0.7108190655708313, -0.15323074162006378, -0.260660320520401, 0.5392118692398071, -0.9163340926170349, -0.47651928663253784, -0.197879821062088, -0.41826677322387695, -0.2607004940509796, -0.36897221207618713, 0.8776735067367554, -0.24463549256324768, 0.2915177643299103, 0.46644046902656555, 0.9225870370864868, 0.5667622089385986, -0.040949832648038864, -1.0206987857818604, -0.1028282642364502, -0.40308523178100586, -0.03624194860458374, -0.35144633054733276, -0.19816429913043976, -0.0680372565984726, 0.03372979536652565, -0.0029829740524291992]}, "authors": [{"authorId": "2302815939", "name": "Jiannan Wang"}, {"authorId": "2303233521", "name": "Jiarui Fang"}, {"authorId": "2303334242", "name": "Aoyu Li"}, {"authorId": "2303328737", "name": "PengCheng Yang"}], "references": [{"paperId": "28f59093730d88719b96041f9544c73671f798bd", "title": "USP: A Unified Sequence Parallelism Approach for Long Context Generative AI"}, {"paperId": "29053ced75c38a121f2a76ffb36880614c7e188a", "title": "DistriFusion: Distributed Parallel Inference for High-Resolution Diffusion Models"}, {"paperId": "6dc5c6190dfbe55c8b45b7b23800614c21e5b51c", "title": "MegaScale: Scaling Large Language Model Training to More Than 10, 000 GPUs"}, {"paperId": "50a9825f5ae6e2ed68639bd05173109b1af4b587", "title": "AutoChunk: Automated Activation Chunk for Memory-Efficient Long Sequence Inference"}, {"paperId": "e0eac8c64be3313e581c28a495bec192e7e67284", "title": "Latte: Latent Diffusion Transformer for Video Generation"}, {"paperId": "02ad9f3fefe33cb9ca546591bec65dbdf7766c80", "title": "Ring Attention with Blockwise Transformers for Near-Infinite Context"}, {"paperId": "8fafd95a6ffbecf9c1b5f4542ac4b78a00602551", "title": "PixArt-\u03b1: Fast Training of Diffusion Transformer for Photorealistic Text-to-Image Synthesis"}, {"paperId": "a51ac7a5e8f6454268ac16ecdc52ecac98ce54d9", "title": "DeepSpeed Ulysses: System Optimizations for Enabling Training of Extreme Long Sequence Transformer Models"}, {"paperId": "d7890d1906d95c4ae4c430b350455156d6d8aed9", "title": "SDXL: Improving Latent Diffusion Models for High-Resolution Image Synthesis"}, {"paperId": "ba3e9e45f91257c9af6dfe74ed91a03c53086f07", "title": "Parallel Sampling of Diffusion Models"}, {"paperId": "736973165f98105fec3729b7db414ae4d80fcbeb", "title": "Scalable Diffusion Models with Transformers"}, {"paperId": "625d57bd52c60cd79aa4add6c4420dc2ad3b808a", "title": "On Distillation of Guided Diffusion Models"}, {"paperId": "670bab7b71be5e432b0dc60f406a6115cf6c0633", "title": "gDDIM: Generalized denoising diffusion implicit models"}, {"paperId": "4530c25da949bb2185c50663158ef19d52e3c6b5", "title": "DPM-Solver: A Fast ODE Solver for Diffusion Probabilistic Model Sampling in Around 10 Steps"}, {"paperId": "6651ff3d8c89a3cddfeef0c5d03ac4cb121758e3", "title": "Fast Sampling of Diffusion Models with Exponential Integrator"}, {"paperId": "c10075b3746a9f3dd5811970e93c8ca3ad39b39d", "title": "High-Resolution Image Synthesis with Latent Diffusion Models"}, {"paperId": "ad14e11bc97cc2fed0fd344e7cb7d7ce4205bfc6", "title": "Score-based Generative Modeling in Latent Space"}, {"paperId": "633e2fbfc0b21e959a244100937c5853afca4853", "title": "Score-Based Generative Modeling through Stochastic Differential Equations"}, {"paperId": "014576b866078524286802b1d0e18628520aa886", "title": "Denoising Diffusion Implicit Models"}, {"paperId": "3fd7c9ba742dd2b435afa75217847e5087e2f2a8", "title": "PipeDream: generalized pipeline parallelism for DNN training"}, {"paperId": "8323c591e119eb09b28b29fd6c7bc76bd889df7a", "title": "Megatron-LM: Training Multi-Billion Parameter Language Models Using Model Parallelism"}, {"paperId": "d79a26226393f687ddbc375e32055b40b8ad8d38", "title": "GPipe: Efficient Training of Giant Neural Networks using Pipeline Parallelism"}, {"paperId": "231af7dc01a166cac3b5b01ca05778238f796e41", "title": "GANs Trained by a Two Time-Scale Update Rule Converge to a Local Nash Equilibrium"}, {"paperId": "6364fdaa0a0eccd823a779fcdd489173f938e91a", "title": "U-Net: Convolutional Networks for Biomedical Image Segmentation"}, {"paperId": "696ca58d93f6404fea0fc75c62d1d7b378f47628", "title": "Microsoft COCO Captions: Data Collection and Evaluation Server"}, {"paperId": null, "title": "Hugging Face. Pixart-alpha model checkpoint"}]}