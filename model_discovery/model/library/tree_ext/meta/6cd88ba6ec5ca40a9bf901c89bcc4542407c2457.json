{"paperId": "6cd88ba6ec5ca40a9bf901c89bcc4542407c2457", "title": "Attention Score is not All You Need for Token Importance Indicator in KV Cache Reduction: Value Also Matters", "abstract": "Scaling the context size of large language models (LLMs) enables them to perform various new tasks, e.g., book summarization. However, the memory cost of the Key and Value (KV) cache in attention significantly limits the practical applications of LLMs. Recent works have explored token pruning for KV cache reduction in LLMs, relying solely on attention scores as a token importance indicator. However, our investigation into value vector norms revealed a notably non-uniform pattern questioning their reliance only on attention scores. Inspired by this, we propose a new method: Value-Aware Token Pruning (VATP) which uses both attention scores and the $ \\ell_{1} $ norm of value vectors to evaluate token importance. Extensive experiments on LLaMA2-7B-chat and Vicuna-v1.5-7B across 16 LongBench tasks demonstrate VATP's superior performance.", "venue": "arXiv.org", "year": 2024, "citationCount": 1, "influentialCitationCount": 0, "openAccessPdf": null, "tldr": {"model": "tldr@v2.0.0", "text": "This work proposes a new method: Value-Aware Token Pruning (VATP) which uses both attention scores and the norm of value vectors to evaluate token importance and demonstrates VATP's superior performance."}, "embedding": {"model": "specter_v2", "vector": [-0.1933748573064804, 0.352081298828125, -0.7788132429122925, 0.33420419692993164, -0.7000229954719543, -0.18989348411560059, 0.7346281409263611, 0.3613574802875519, -0.8192553520202637, 0.03500344231724739, 0.9094304442405701, 0.22068184614181519, 0.23573815822601318, 0.2027667909860611, 0.20749379694461823, 0.015998078510165215, -0.5478924512863159, 0.43069297075271606, 0.08658111840486526, -0.31578001379966736, 0.17187243700027466, -0.9178556799888611, -0.8019374012947083, 0.22719420492649078, 0.581267237663269, 0.48206689953804016, 0.0031213124748319387, 0.9145819544792175, -0.8644562363624573, 0.5261768698692322, 0.04266255721449852, -0.15684691071510315, -0.214911550283432, -0.24217359721660614, -0.49608588218688965, -0.39952290058135986, 0.354958713054657, -0.30465808510780334, -0.08199457079172134, 0.6592744588851929, -0.06840693950653076, 0.31200459599494934, 0.38356444239616394, -0.5697534680366516, -0.17224201560020447, 1.1539640426635742, 0.4283558428287506, 0.711258590221405, -0.4393894374370575, -0.5565887093544006, 1.5544075965881348, -1.4503942728042603, 0.4361649453639984, 1.2003451585769653, 0.4167335629463196, 0.3207401931285858, -0.1772918403148651, -0.058932337909936905, 0.7029599547386169, 0.45865342020988464, -0.9243722558021545, -0.5947115421295166, 0.08488370478153229, 0.011572487652301788, 2.239311695098877, 0.11689174920320511, 0.12260408699512482, 0.09652248024940491, -0.40464285016059875, 1.5358484983444214, -0.6276350617408752, -0.607800304889679, -0.008920068852603436, 0.010563084855675697, 0.47624820470809937, 0.24737828969955444, -0.18871471285820007, -0.40624338388442993, -0.8644859790802002, -0.6357899308204651, -0.0703781470656395, -0.33414226770401, -0.15657535195350647, -0.18592965602874756, -0.3439735174179077, 0.6214605569839478, -0.1950506716966629, 1.0375564098358154, -0.2678551971912384, 1.0113401412963867, 0.8979001045227051, 0.3312075734138489, 0.28322499990463257, 0.6813907027244568, -0.3133365213871002, -0.17518393695354462, -1.052247166633606, 0.37797942757606506, -0.035725709050893784, 0.9216040968894958, -0.48400866985321045, 0.3821043372154236, -1.2471272945404053, 0.4963630139827728, 0.9609426259994507, 0.10993509739637375, 0.5644524693489075, -0.8632853031158447, 0.13139386475086212, -0.5625991821289062, 0.44415366649627686, -0.2909230887889862, 0.08533788472414017, -0.046432994306087494, -0.7398450374603271, -1.3172622919082642, -0.30685582756996155, 0.3218158483505249, -0.39920032024383545, 0.4245416522026062, -0.21981249749660492, 0.0285476166754961, 0.04391860589385033, 0.2613840103149414, 1.0350605249404907, 0.5988144874572754, 0.16978363692760468, -0.5553433299064636, 0.8961489796638489, -0.8419602513313293, -0.9821049571037292, -0.6544781923294067, 1.1632188558578491, -0.2948003113269806, 0.2760090231895447, -0.023545347154140472, -1.6937553882598877, -0.8007422685623169, -0.6832824349403381, -0.28008589148521423, -0.49248144030570984, 0.307620644569397, 0.472766250371933, 0.05282892659306526, -0.8466143608093262, 0.6291234493255615, -0.1632162481546402, -0.23591026663780212, 0.21220022439956665, -0.02223881147801876, 0.5568196773529053, -0.1445014625787735, -1.3887995481491089, 0.4615356922149658, 0.0036761502269655466, -0.8020946979522705, 0.1120074912905693, -0.6613359451293945, -1.0100351572036743, -0.007388353813439608, 0.5418537855148315, -0.3130206763744354, 1.3244357109069824, 0.36191269755363464, -1.2573890686035156, 0.10404826700687408, -0.43683838844299316, 0.0950428918004036, 0.36756792664527893, -0.3500712811946869, -0.12456543743610382, -0.4898591637611389, -0.43991056084632874, 0.3473660349845886, 0.6436260342597961, -0.17569328844547272, -0.45283445715904236, 0.6484720706939697, -0.41338440775871277, 0.08118928968906403, -0.336348295211792, 0.9196041822433472, -0.6500166058540344, 0.0881643295288086, 0.1509394645690918, 0.8764811754226685, 0.1800430864095688, -0.317682147026062, -0.15884628891944885, -1.2895171642303467, 0.6808531880378723, 0.07688973098993301, 1.768425703048706, -0.4643953740596771, -0.4124513268470764, -0.28904518485069275, 0.14628219604492188, 0.20308098196983337, -0.6485620141029358, 0.7590564489364624, 0.38785406947135925, 0.6873830556869507, -0.00858311727643013, -1.0537608861923218, 0.20600876212120056, -0.2641383409500122, -0.7213320732116699, -0.20413964986801147, -0.11479780822992325, 1.16825532913208, -0.8889423608779907, -0.33349964022636414, 0.1491335928440094, 0.27159884572029114, -0.8478245139122009, 1.017684817314148, -0.6292897462844849, -0.10421069711446762, -0.11005496233701706, -0.15105341374874115, -0.01557537354528904, 0.11121567338705063, 0.4525911211967468, -0.44745883345603943, -0.5268028378486633, 0.3081096112728119, -0.579307496547699, 0.8769724369049072, -0.041875939816236496, 0.393460214138031, -0.032980091869831085, -0.14889086782932281, 0.07547799497842789, 0.5472081899642944, -0.021709052845835686, -0.3569481670856476, 0.36587822437286377, 0.3625439405441284, -0.5880740880966187, 0.3014266788959503, 1.2758184671401978, 1.3253684043884277, -0.7954067587852478, 0.04097151756286621, 0.352117657661438, -0.40706145763397217, 0.9075048565864563, 0.6902548670768738, 0.40093138813972473, 0.17757640779018402, 0.5081755518913269, -0.08181870728731155, 0.6964535713195801, -0.2834738790988922, 0.022742798551917076, 0.8320749998092651, 0.4697139859199524, 0.9105199575424194, 0.7771302461624146, -0.49118390679359436, -0.5996281504631042, 0.5568092465400696, 0.9159376621246338, 1.6405577659606934, -0.08422986418008804, -0.7145025730133057, -0.8258119821548462, -0.11931706964969635, -0.2323489785194397, 0.42399799823760986, -0.3533056974411011, -0.15334834158420563, -0.803602397441864, -0.7783122062683105, 0.9080889821052551, 0.29127827286720276, 0.5573872327804565, -0.6703502535820007, -0.42061877250671387, -0.08014749735593796, 0.06608371436595917, -0.6098688244819641, -0.5396375060081482, 0.13399234414100647, -0.5783454775810242, -0.004165387712419033, 0.10574927181005478, 0.20639246702194214, -0.20060193538665771, -0.4339073598384857, 1.0597162246704102, -0.12747155129909515, 0.22124896943569183, 0.33413389325141907, 0.17564882338047028, -0.735331654548645, -0.7727848887443542, 0.32118934392929077, 0.1909724771976471, -0.5607296824455261, 0.32331621646881104, 0.9337899684906006, 0.11460909247398376, -0.21925956010818481, -0.08355998992919922, 0.07308176159858704, -0.02121938019990921, 0.270550936460495, 0.8369518518447876, -0.32858139276504517, -0.09809365123510361, -0.9432131052017212, 1.3858799934387207, 0.23830805718898773, -0.43280017375946045, 0.33569881319999695, -0.7828738689422607, -0.5762873888015747, 0.2668219804763794, -0.7431620359420776, -0.2177683264017105, -1.2454051971435547, 0.39173102378845215, -0.0804448127746582, 0.16708679497241974, 0.4792458415031433, 0.25505146384239197, 0.37122926115989685, -0.25895553827285767, 0.6098741292953491, 0.20877979695796967, -0.5758086442947388, 0.8596667051315308, -0.5886307954788208, 0.5366845726966858, 0.3156706392765045, -0.39201804995536804, -0.21217437088489532, -0.32323798537254333, -1.1182096004486084, 0.0430607832968235, -0.5126196146011353, -0.38461580872535706, -0.14862757921218872, -0.02495945431292057, -0.6058381795883179, -0.6280931234359741, -0.00031120661878958344, -1.1824543476104736, -0.10313791036605835, -0.25358161330223083, -0.29895636439323425, -0.11401723325252533, -0.8319633603096008, -1.1520236730575562, -0.5695636868476868, -0.9916365742683411, -1.0572419166564941, 0.2911530137062073, -0.2607305645942688, -0.8705766201019287, -0.2934432327747345, 0.08505140990018845, -0.42969241738319397, 1.2585504055023193, -0.7090651392936707, 0.9880741238594055, -0.2592383623123169, 0.12177930027246475, -0.457470178604126, 0.40462741255760193, 0.3996922969818115, -0.413528710603714, 0.3111918568611145, -0.6313353180885315, 0.16462989151477814, -0.14334653317928314, -0.08203374594449997, 0.5381264090538025, 0.6729903817176819, 0.5112640857696533, -0.08805913478136063, -0.4660034477710724, -0.013191292993724346, 1.0331798791885376, -0.6812734603881836, 0.006992788054049015, 0.053718358278274536, 1.3475466966629028, -0.0017157451948150992, 0.1821351945400238, 0.889051616191864, 0.03483104333281517, 0.496919184923172, 0.3490380048751831, -0.3035319149494171, -0.31605076789855957, -0.2158549726009369, 0.5196928381919861, 2.3934760093688965, 0.10961613804101944, -0.36425578594207764, -0.5862608551979065, 0.7047672867774963, -1.5811774730682373, -0.8871667981147766, 0.08364648371934891, 0.8495863676071167, 0.7370919585227966, -0.4775357246398926, -0.16749529540538788, -0.24261051416397095, 0.14398972690105438, 0.5073933601379395, -0.2633480131626129, -0.9663165211677551, -0.04989505931735039, -0.012454323470592499, 0.09201440215110779, 0.783977746963501, -0.2645230293273926, 0.8477699756622314, 14.697229385375977, 1.274435043334961, 0.28539133071899414, 0.7228745818138123, 0.5575389266014099, -0.1715594381093979, -0.41142475605010986, -0.13189862668514252, -1.100472092628479, -0.0975753664970398, 1.102626919746399, -0.24190212786197662, 0.0997164249420166, 0.15212762355804443, 0.29428908228874207, -0.07479776442050934, -0.34425848722457886, 0.39244070649147034, 0.41896480321884155, -1.3256748914718628, 0.621676504611969, 0.1500433385372162, 0.367451936006546, 0.47584080696105957, 0.5825228691101074, 1.0436991453170776, 0.0535336397588253, -0.1903565675020218, 0.59360271692276, 0.01700388640165329, 0.8799086809158325, -0.6070507168769836, 0.7478306293487549, 0.5424460768699646, -0.8180781006813049, -0.09923428297042847, -1.0324612855911255, -1.176213264465332, 0.12745217978954315, -0.019217487424612045, -0.6659731864929199, -0.8227108716964722, -0.46413707733154297, 0.36011582612991333, 0.0634462907910347, 0.22341738641262054, 0.017631998285651207, 0.7855709791183472, 0.1104985848069191, -0.37348049879074097, 0.44109803438186646, 0.38066592812538147, 0.46625590324401855, 0.3228188455104828, 0.01173780020326376, 0.004498521331697702, -0.07957631349563599, 0.40801262855529785, -0.749077558517456, 0.19486112892627716, -0.24858511984348297, -0.16739661991596222, 0.3013631999492645, 0.9125419855117798, 0.503947913646698, -0.2292991727590561, -0.42361244559288025, 0.20206834375858307, 0.4794079065322876, -0.21103303134441376, -0.3007142245769501, -0.07772141695022583, 0.7052429914474487, -0.515545666217804, 0.1895872801542282, 0.6358709931373596, -0.08695141971111298, -0.4401557445526123, -0.9078127145767212, -0.3604077994823456, 0.1486632078886032, -0.5291708707809448, -0.2966082990169525, 0.7389917373657227, 0.26413029432296753, -0.6217560172080994, -0.016038089990615845, -0.18629758059978485, -0.43719688057899475, 0.23796731233596802, -1.1858497858047485, -0.7534497976303101, 0.5495560169219971, -0.5515543222427368, -0.08152437955141068, 0.15452271699905396, 1.284557819366455, -0.28201669454574585, -0.31839224696159363, 0.20209161937236786, 0.883855938911438, -0.18375152349472046, -0.09332215040922165, -0.8430916666984558, 0.9224386215209961, 0.22432726621627808, -0.05630108714103699, 0.155861034989357, 0.19334745407104492, 0.10585517436265945, -0.9538853764533997, -0.24096722900867462, 1.070510745048523, -1.2409266233444214, -0.7373724579811096, -0.9146342873573303, -1.2104170322418213, -0.14929838478565216, 0.8083456754684448, -0.342785120010376, 0.04291632026433945, 0.10279194265604019, -0.06662560254335403, 0.022285910323262215, -0.6994829177856445, 0.08185851573944092, 0.31292518973350525, -0.35492777824401855, -0.2869601845741272, -0.20586994290351868, 0.5231307744979858, -1.0345659255981445, -0.6598514318466187, -0.323563814163208, -0.1704884171485901, 0.06632436066865921, 0.8511278033256531, -0.3521050810813904, 0.41257932782173157, 0.6204130053520203, 0.04332295432686806, -0.8946857452392578, -0.2841007709503174, -0.8750056028366089, -0.5104667544364929, 0.5197030901908875, 0.7654011249542236, 0.08971364796161652, 0.061501819640398026, 0.996580183506012, 0.338009238243103, -0.7083434462547302, -0.8460460901260376, -0.11720582097768784, 0.4759136140346527, -0.6337034702301025, 0.48466169834136963, -0.2540026903152466, 0.4193718731403351, 0.0807075947523117, 0.08294039219617844, -0.025593487545847893, -0.4034556448459625, -0.8998525142669678, 0.47567108273506165, 0.006845592055469751, 0.5516797304153442, -0.8014819622039795, -0.012420250102877617, -1.0153218507766724, -0.40455925464630127, -0.5325934886932373, 0.06129325181245804, -1.1335514783859253, -0.07471553236246109, 0.5068930387496948, -0.36877545714378357, 0.034158095717430115, 0.3532360792160034, -0.31292828917503357, -0.37536025047302246, -0.3918483853340149, -1.227952003479004, 0.7685670256614685, 0.7545319199562073, -0.9357134699821472, -0.17115747928619385, -0.32755547761917114, -0.018405701965093613, 0.3648810088634491, 0.6134286522865295, -0.5169578790664673, -0.7872071862220764, -1.2563879489898682, 0.4549514949321747, -0.2623763382434845, -0.6949515342712402, -0.3499435484409332, 0.8374112248420715, 0.23958852887153625, 0.01641317829489708, -0.3220655024051666, 0.31985998153686523, -0.5900712013244629, -0.5834326148033142, 0.29819825291633606, -0.9194058775901794, 0.25228196382522583, 0.15873877704143524, -0.9921916723251343, -0.293084979057312, 0.4222424626350403, -0.08897804468870163, -1.0766876935958862, -0.8466112613677979, 0.09235093742609024, -0.8965281844139099, 0.43111371994018555, -0.6698740124702454, -0.30796775221824646, -1.0149117708206177, -0.45995354652404785, 0.31415942311286926, 0.39299994707107544, -0.21116822957992554, 0.9318241477012634, 0.5667139887809753, -1.0596519708633423, -0.2675703167915344, 0.20244143903255463, 0.053289931267499924, -0.2035241276025772, 0.37392476201057434, 0.5797662734985352, -0.07092735916376114, 0.5056586265563965, 0.5342951416969299, 0.25866690278053284, -1.3367620706558228, -0.11196820437908173, 0.3447829782962799, -0.4930068552494049, -0.29235371947288513, 1.2736166715621948, -0.7650964856147766, -0.6649369597434998, 0.133387491106987, -1.659774661064148, -0.9249337315559387, -0.064275361597538, 0.9932012557983398, 0.6533907055854797, 0.01495620422065258, -0.36604586243629456, -0.7361415028572083, 0.017919480800628662, -0.24054032564163208, -0.5653725266456604, 0.3836688697338104, -0.3832451105117798, -0.6075991988182068, 0.5431981682777405, 0.776529848575592, -0.40479615330696106, -0.31929245591163635, -0.4580865204334259, -0.11153357475996017, 0.037906233221292496, 0.641414999961853, -0.2701348066329956, -0.2085682451725006, 0.6746516227722168, 0.4476187229156494, 0.394327849149704, -0.11103437840938568, -0.2357109636068344, 0.433970183134079, 0.7266266345977783, -0.05884264409542084, -1.2351175546646118, -0.8156578540802002, 1.5057107210159302, 1.4275010824203491, -0.8728883266448975, 0.82042396068573, 0.6386192440986633, -1.2163118124008179, 0.558506190776825, 0.3704148828983307, 0.2561532258987427, 0.45745036005973816, -0.2070600390434265, 0.19393084943294525, 0.1518290489912033, -1.4964568614959717, -0.3377684950828552, 0.7292361259460449, 0.8232249617576599, 0.8867478966712952, 0.16099777817726135, -0.2561573088169098, 1.1343188285827637, 0.6022922396659851, -0.1383875459432602, 0.8205443620681763, 0.5610745549201965, -0.4451541304588318, 0.059034910053014755, 0.09909646958112717, 0.6532872915267944, -0.6411234736442566, -0.6514154076576233, -0.1747838407754898, 0.7525084614753723, 0.2631763815879822, 0.6923034191131592, 0.7251698970794678, 0.10961131751537323, 0.3990766108036041, 0.2148646116256714, 0.37230533361434937, -0.5194657444953918, -0.6607872843742371, 0.17882436513900757, -0.47127845883369446, 0.05518491938710213, 0.08684755116701126, -0.5843531489372253, -0.5448562502861023, -0.4620305001735687, 0.03728390112519264, 0.4834387004375458, -0.05074121803045273, 0.8470837473869324, 0.823434054851532, 0.44582393765449524, -0.8943209648132324, -0.5820231437683105, -0.5388514995574951, -1.2366842031478882, -0.12427334487438202, -0.19465647637844086, -0.3178196847438812, 0.0237856637686491, 0.009323311038315296, -0.44746771454811096]}, "authors": [{"authorId": "2300138950", "name": "Zhiyu Guo"}, {"authorId": "2298970864", "name": "Hidetaka Kamigaito"}, {"authorId": "2266807418", "name": "Taro Watanabe"}], "references": [{"paperId": "ad6213b9968b09fd26c9bd88acbbb67b83c2d065", "title": "SWE-agent: Agent-Computer Interfaces Enable Automated Software Engineering"}, {"paperId": "41b47f33a24feefd6728bdc1339d0d4ff5fec7be", "title": "Gemini 1.5: Unlocking multimodal understanding across millions of tokens of context"}, {"paperId": "6c323c535365e1c7cbfd9703cbec3b5650a3346b", "title": "Model Tells You What to Discard: Adaptive KV Cache Compression for LLMs"}, {"paperId": "65fe385a665480b41fafc56d76a3bd72e92e8886", "title": "BooookScore: A systematic exploration of book-length summarization in the era of LLMs"}, {"paperId": "fdc53c2c10742464087c0525f77e32604827a21d", "title": "Efficient Streaming Language Models with Attention Sinks"}, {"paperId": "b31a5884a8ebe96b6300839b28608b97f8f8ef76", "title": "LongBench: A Bilingual, Multitask Benchmark for Long Context Understanding"}, {"paperId": "104b0bb1da562d53cbda87aec79ef6a2827d191a", "title": "Llama 2: Open Foundation and Fine-Tuned Chat Models"}, {"paperId": "d6eeb2898bd9bd34744194ef543062dda6c4531a", "title": "Scissorhands: Exploiting the Persistence of Importance Hypothesis for LLM KV Cache Compression at Test Time"}, {"paperId": "5ae6fb6b5a3c7df515ff4a82ac9673bae6a8e200", "title": "GQA: Training Generalized Multi-Query Transformer Models from Multi-Head Checkpoints"}, {"paperId": "57e849d0de13ed5f91d086936296721d4ff75a75", "title": "LLaMA: Open and Efficient Foundation Language Models"}, {"paperId": "81b234a1e6da7bc8131e8585a9455dca5dd68754", "title": "Transkimmer: Transformer Learns to Layer-wise Skim"}, {"paperId": "731d7e310e2e9194ad039fc290db93f4ec5eecc4", "title": "Fine- and Coarse-Granularity Hybrid Self-Attention for Efficient BERT"}, {"paperId": "90abbc2cf38462b954ae1b772fac9532e2ccd8b0", "title": "Language Models are Few-Shot Learners"}, {"paperId": "9a21740d87976bf76f4a9668a9da631035302fb2", "title": "Attention Is Not Only a Weight: Analyzing Transformers with Vector Norms"}, {"paperId": "94f94e8892261d0377159379ca5a166ceae19a14", "title": "PoWER-BERT: Accelerating BERT Inference via Progressive Word-vector Elimination"}, {"paperId": "204e3073870fae3d05bcbc2f6a8e263d9b72e776", "title": "Attention is All you Need"}, {"paperId": "b8b45b14df9029562b8995c6ab7fd90a8810f312", "title": "GPT3.int8(): 8-bit Matrix Multiplication for Transformers at Scale"}, {"paperId": null, "title": "size of 10 and a history window size of w = 400 . When integrating with Scissorhands and H 2 O, the only differences are the token importance score and intentionally keeping attention sink tokens"}, {"paperId": null, "title": "by importance score in H 2 O is k 2 , with a local window size also of k 2"}, {"paperId": null, "title": "2024. Many-shot in-context learning"}, {"paperId": null, "title": "B Ablation Study Table 2 shows the F1 scores for 4 QA tasks different types of norm for value vector: \u2113 and \u2113 \u221e"}, {"paperId": null, "title": "Table 2: F1 Scores under Different Norms for 4 Tasks C Dataset Details We select the English subset from Longbench"}, {"paperId": null, "title": "2024b. A simple and effective pruning approach for large language models"}]}