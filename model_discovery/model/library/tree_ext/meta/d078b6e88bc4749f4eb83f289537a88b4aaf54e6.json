{"paperId": "d078b6e88bc4749f4eb83f289537a88b4aaf54e6", "title": "On the Expressivity Role of LayerNorm in Transformers' Attention", "abstract": "Layer Normalization (LayerNorm) is an inherent component in all Transformer-based models. In this paper, we show that LayerNorm is crucial to the expressivity of the multi-head attention layer that follows it. This is in contrast to the common belief that LayerNorm's only role is to normalize the activations during the forward pass, and their gradients during the backward pass. We consider a geometric interpretation of LayerNorm and show that it consists of two components: (a) projection of the input vectors to a $d-1$ space that is orthogonal to the $\\left[1,1,...,1\\right]$ vector, and (b) scaling of all vectors to the same norm of $\\sqrt{d}$. We show that each of these components is important for the attention layer that follows it in Transformers: (a) projection allows the attention mechanism to create an attention query that attends to all keys equally, offloading the need to learn this operation by the attention; and (b) scaling allows each key to potentially receive the highest attention, and prevents keys from being\"un-select-able\". We show empirically that Transformers do indeed benefit from these properties of LayeNorm in general language modeling and even in computing simple functions such as\"majority\". Our code is available at https://github.com/tech-srl/layer_norm_expressivity_role .", "venue": "Annual Meeting of the Association for Computational Linguistics", "year": 2023, "citationCount": 20, "influentialCitationCount": 0, "openAccessPdf": {"url": "http://arxiv.org/pdf/2305.02582", "status": "GREEN"}, "tldr": {"model": "tldr@v2.0.0", "text": "It is shown that LayerNorm is crucial to the expressivity of the multi-head attention layer that follows it in Transformers, and empirically that Transformers do indeed benefit from these properties of LayeNorm in general language modeling and even in computing simple functions such as\"majority\"."}, "embedding": {"model": "specter_v2", "vector": [0.23899607360363007, 0.5963071584701538, -0.7053311467170715, -0.39576664566993713, -0.249521404504776, 0.21701055765151978, 0.8317184448242188, -0.269687294960022, -0.5826932787895203, -0.4229881167411804, 0.7755863070487976, 0.3534611165523529, 0.08597660064697266, -0.023089271038770676, -0.22523272037506104, 0.00893864780664444, -0.8467433452606201, 0.14976216852664948, 0.06867733597755432, -0.5904372930526733, -0.07925309240818024, -0.5696215033531189, -1.308031439781189, 0.8133172392845154, 0.06945358961820602, 0.6979547142982483, -0.14243528246879578, 0.8338152766227722, -0.37352320551872253, 0.7731525897979736, 0.5429234504699707, -0.3087482154369354, 0.29154691100120544, 0.3670869767665863, 0.01592595875263214, -0.038910169154405594, 0.7141109108924866, -0.46948447823524475, -0.5279220938682556, 0.9317327737808228, -0.08429224789142609, 0.036234885454177856, 0.384076863527298, -0.9935822486877441, -0.07209570705890656, 1.3292572498321533, 0.5550041198730469, 0.8813270926475525, -0.5634781122207642, -0.8833075165748596, 1.6052707433700562, -1.6843602657318115, 0.16464999318122864, 1.5382159948349, 0.3366931974887848, 0.30883273482322693, -0.44142067432403564, -0.4576626420021057, 0.9597506523132324, -0.062344349920749664, -0.9818517565727234, -0.7568923830986023, -0.23152318596839905, -0.17073312401771545, 1.6088968515396118, -0.054274220019578934, -0.14295530319213867, 0.16553007066249847, 0.049382757395505905, 1.6724742650985718, -0.03521014004945755, -0.6546866297721863, -0.3142590820789337, 0.3714286983013153, 0.11484671384096146, 0.7423530220985413, -0.5562635660171509, 0.3037697672843933, -1.357568383216858, -0.07828540354967117, 0.6202033162117004, 0.13134317100048065, -0.13007783889770508, -0.7339078187942505, -0.4651258885860443, 0.6259125471115112, 0.45017126202583313, 0.8924823999404907, -0.7229142785072327, 0.7405247688293457, 0.27146798372268677, 0.4282923936843872, 0.3152013421058655, 0.21254250407218933, 0.024994811043143272, 0.4115125834941864, -1.024943232536316, 0.2973331809043884, -0.12947344779968262, 0.482535183429718, -0.0005111242062412202, 0.21081313490867615, -0.9482739567756653, 0.24688859283924103, 1.478937029838562, 0.05227804183959961, 0.3888958692550659, -0.5632472038269043, 0.4053763151168823, -0.5638020634651184, -0.0011663881596177816, -0.5409749150276184, 0.10527927428483963, -0.19434623420238495, -0.27328911423683167, -0.8338695764541626, -0.5804046988487244, 0.1952071487903595, -0.8870589733123779, 0.8973345160484314, -0.4072268307209015, -0.3468700349330902, -0.11341682076454163, 0.4757603704929352, 0.08793816715478897, 0.3631436228752136, 0.5911572575569153, 0.4779919683933258, 0.7916097640991211, -0.25923240184783936, -0.7065048217773438, -1.0256558656692505, 0.764634907245636, -0.22926490008831024, 0.4033728241920471, -0.26966190338134766, -1.205825924873352, -0.49296650290489197, -0.8336338996887207, 0.19108246266841888, -0.5266281962394714, -0.0807289332151413, 1.059206485748291, 0.3902466297149658, -1.404274821281433, 0.6257898807525635, -0.21915976703166962, -0.22752246260643005, 0.6860308647155762, 0.4728924632072449, -0.15964654088020325, -0.23678234219551086, -1.1863831281661987, 0.4093506336212158, 0.3176671266555786, -0.5071612596511841, -0.2651432752609253, -0.8772237300872803, -1.2443174123764038, -0.05703658238053322, 0.3821733295917511, -0.46002331376075745, 1.402290940284729, 0.02868623286485672, -0.9274918437004089, 0.7238528728485107, -0.5969797372817993, 0.2633943259716034, 0.16221565008163452, -0.4982806146144867, -0.5119393467903137, -0.38898012042045593, -0.017333464697003365, 0.548358678817749, 0.6322029232978821, -0.48084667325019836, -0.38382136821746826, -0.3427363634109497, -0.25444626808166504, 0.3721390962600708, -0.6260430812835693, 1.0234259366989136, -0.3441826105117798, -0.19058085978031158, 0.5169568657875061, 1.1714080572128296, 0.315478652715683, 0.18685492873191833, -0.49263161420822144, -0.876272976398468, 0.5619930624961853, 0.4423608183860779, 1.230262041091919, -0.9620181322097778, -0.5484633445739746, 0.12875159084796906, 0.16848962008953094, -0.2593654692173004, -0.526591420173645, 0.6590951085090637, -0.625452995300293, 0.5577131509780884, -0.1612754762172699, -1.3283145427703857, 0.2342018038034439, -0.20438642799854279, -0.7009859681129456, -0.2161584198474884, -0.14058281481266022, 0.9635823369026184, -0.5476812124252319, -0.18715821206569672, -0.008491553366184235, 0.3967629671096802, -0.8572563529014587, 1.2635222673416138, -0.11516541987657547, -0.5257757902145386, -0.09667511284351349, -0.1771213859319687, 0.03736419230699539, -0.060158681124448776, 0.058438997715711594, -0.6353340744972229, -0.40998178720474243, 0.378452330827713, -0.5301496982574463, 1.2576946020126343, -0.08476732671260834, 0.32498425245285034, 0.25905051827430725, -0.393869012594223, -0.27195289731025696, 0.5115476846694946, -0.0665959045290947, -0.4413197338581085, 0.13192078471183777, 0.32099950313568115, -0.6624490022659302, 0.26396891474723816, 0.7064008116722107, 0.5635222792625427, -0.23212851583957672, 0.23380106687545776, 0.5097266435623169, -0.3898744583129883, 0.3536149859428406, 0.46275168657302856, 0.35743004083633423, 0.2660484313964844, 0.15864305198192596, -0.3395613133907318, -0.025243140757083893, -0.9776812195777893, -0.2815978527069092, 0.512292206287384, 0.9347240328788757, 0.7559810280799866, 0.5471828579902649, -0.7593398094177246, -0.13942724466323853, -0.39830252528190613, 0.32573333382606506, 1.9352762699127197, -0.40880274772644043, -0.28421953320503235, -0.5643290877342224, -0.11850797384977341, -0.18845480680465698, 0.3417494297027588, -0.7972903847694397, -0.16014739871025085, -0.566972017288208, -1.149369478225708, 0.9593527317047119, 0.3385879099369049, 0.6868903040885925, -0.24831882119178772, -0.12527044117450714, -0.2706072926521301, 0.8173562288284302, -0.6740413904190063, -0.8631179332733154, 0.4849120080471039, -0.5482630133628845, -0.05615115910768509, 0.0495757982134819, -0.20263783633708954, 0.21935802698135376, -0.8697656989097595, 0.6937994956970215, -0.6424369215965271, -0.004647048655897379, 0.0688706487417221, 0.9267821311950684, -0.8325605988502502, -0.32908424735069275, 0.2887478768825531, 0.1849709153175354, 0.15454241633415222, 0.29408949613571167, 0.46540936827659607, 0.19306403398513794, 0.17554225027561188, -0.7220934629440308, 0.40431448817253113, 0.23187968134880066, -0.37381383776664734, 0.4957454800605774, -0.5961998105049133, -0.28353333473205566, -1.2838937044143677, 1.1087698936462402, 0.1414307802915573, -0.244451642036438, 0.19141565263271332, -0.7501060366630554, -0.08917560428380966, -0.06785733997821808, -0.502574622631073, -0.15447084605693817, -1.0149078369140625, 0.4606592059135437, -0.3451193869113922, 0.009860843420028687, 0.12074628472328186, 0.06305749714374542, 0.16755253076553345, 0.2362530678510666, 0.2642539441585541, 0.4249211847782135, -0.048881590366363525, 0.7315843105316162, -0.861937940120697, 0.45986634492874146, 0.05330101400613785, 0.08987168967723846, 0.08416910469532013, -0.4114438593387604, -0.8814242482185364, -0.09990787506103516, -0.2972630262374878, 0.3072775602340698, -0.12899360060691833, 0.27103543281555176, -0.5390244722366333, -0.979943573474884, 0.06519614160060883, -0.9117630124092102, -0.3925832509994507, 0.09637923538684845, -0.1029217317700386, -0.0455341674387455, -1.4707576036453247, -1.2961676120758057, -0.6727349758148193, -0.4945322871208191, -1.0141706466674805, 0.40883952379226685, -0.21217204630374908, -0.3322356343269348, -0.44096139073371887, -0.36221301555633545, -0.8448760509490967, 1.399669885635376, -0.8543152213096619, 0.9308677911758423, -0.21726581454277039, -0.385954886674881, -0.19761236011981964, 0.1887589395046234, 0.5317786931991577, -0.2632833421230316, -0.06631900370121002, -0.8902366161346436, 0.7527077794075012, -0.20835158228874207, -0.03348895534873009, -0.03777550905942917, 0.45474958419799805, 0.6650246977806091, 0.015033486299216747, -0.5300953388214111, 0.38341856002807617, 1.4004456996917725, -0.543936550617218, 0.03960377722978592, 0.07129104435443878, 1.1588988304138184, 0.5108740925788879, -0.556746244430542, 0.48725250363349915, 0.7378301024436951, 0.4379459023475647, 0.5600934028625488, -0.2782077193260193, 0.003827364183962345, -0.4448806047439575, 0.4394397735595703, 1.2931946516036987, 0.3428846299648285, -0.1387675553560257, -1.0568623542785645, 0.6175327897071838, -1.2062571048736572, -0.8669495582580566, 1.0263830423355103, 0.7358860373497009, 0.2230137437582016, -0.44706088304519653, -0.37815061211586, -0.20519934594631195, 0.5565441250801086, 0.6734994053840637, -0.038785405457019806, -0.7359231114387512, 0.08960139751434326, 0.4041242003440857, 0.36919519305229187, 1.0817309617996216, -0.2523012161254883, 0.4987209141254425, 14.825995445251465, 0.18053124845027924, -0.08404640853404999, 0.3642696142196655, 0.4812385141849518, -0.12581324577331543, -0.7036893367767334, -0.35462337732315063, -1.2321711778640747, -0.12494954466819763, 0.6489985585212708, 0.1885504573583603, 0.6944261193275452, -0.09163672477006912, -0.10442134737968445, 0.23310714960098267, -0.80780428647995, 0.6656433939933777, 0.7639315128326416, -0.9298263192176819, 0.470085471868515, 0.15611501038074493, 0.06489235907793045, 0.5448340177536011, 0.8155601024627686, 0.6136160492897034, 0.6407744884490967, -0.6308540105819702, 0.6403185725212097, 0.5065173506736755, 0.6823990941047668, -0.010240063071250916, 0.04667051509022713, 0.35723939538002014, -0.8550087213516235, -0.14749141037464142, -0.2535022497177124, -1.1167384386062622, 0.27480819821357727, 0.20155668258666992, -0.5600795745849609, -1.0148814916610718, 0.0041794972494244576, 0.30238887667655945, 0.40506303310394287, 0.24535511434078217, -0.3080476224422455, 0.1827690452337265, -0.42055758833885193, 0.25097402930259705, 0.16154523193836212, 1.049163818359375, 0.2087623029947281, 0.027194028720259666, 0.1761053502559662, -0.24979208409786224, 0.18900638818740845, 0.4729467034339905, -0.8276112079620361, -0.021997975185513496, -0.12924131751060486, -0.18033766746520996, 0.10965083539485931, 0.6089316010475159, 0.8271716833114624, 0.2565022110939026, -0.15412548184394836, 0.17103694379329681, 0.3558190166950226, 0.19703729450702667, 0.12840095162391663, -0.11433647572994232, 1.1004611253738403, 0.021933577954769135, 0.056932926177978516, 0.7911023497581482, -0.06974297761917114, -0.3764573931694031, -0.6684675812721252, -0.4086054265499115, 0.4290798008441925, -0.8780351877212524, -0.5514270067214966, 0.8916613459587097, 0.2672610878944397, -0.007401087321341038, 0.275428831577301, -0.9034895896911621, -0.33941301703453064, 0.5560489892959595, -1.4104537963867188, -0.739745557308197, 0.35688889026641846, -0.10991848260164261, -0.4368603229522705, 0.1711842566728592, 1.334424376487732, 0.21876788139343262, -0.4919297397136688, -0.03117063082754612, -0.7152549028396606, -0.0432007797062397, 0.023337459191679955, -1.0253180265426636, 0.8219670057296753, 0.23909355700016022, -0.138795405626297, 0.8474268913269043, 0.026709791272878647, 0.17156696319580078, -0.5887056589126587, 0.30925875902175903, 1.0288022756576538, -0.8037073016166687, -0.3015749752521515, -0.6996598243713379, -0.7044699788093567, 0.6647181510925293, 0.7307127714157104, -0.019799483940005302, 0.30249086022377014, 0.2324170172214508, -0.6783400177955627, -0.18569713830947876, -0.3745240569114685, 0.10375607013702393, 0.511014997959137, -1.0180962085723877, -0.40715107321739197, -0.4771960377693176, 0.017294079065322876, -1.09299635887146, -0.6284106969833374, -0.256241112947464, 0.12352073937654495, -0.1794409453868866, 0.8648956418037415, -0.653306782245636, 0.1525116115808487, 0.5600507259368896, -0.5176410675048828, -1.0065317153930664, -0.08527407795190811, -0.83421790599823, 0.004696732386946678, 0.14761590957641602, 0.9624946713447571, -0.38542601466178894, 0.19780467450618744, 0.8907712697982788, 0.030428456142544746, -0.39114031195640564, -0.3437166213989258, 0.37106847763061523, 0.016300074756145477, -0.9615990519523621, 0.7110191583633423, -0.02258268930017948, -0.1267746388912201, -0.09148634225130081, 0.5305185317993164, 0.7362473011016846, -0.19958138465881348, -1.198756456375122, -0.017577053979039192, -0.19242988526821136, 0.27590104937553406, -0.6042742133140564, -0.7306501865386963, -0.9564637541770935, -0.37952402234077454, -1.1708545684814453, 0.10942342877388, -1.3458410501480103, -0.6882278323173523, 0.007743041962385178, -0.5812748670578003, 0.4787294268608093, 0.33733701705932617, -0.4800560176372528, -0.47750377655029297, -0.5710010528564453, -0.40022432804107666, 0.5022026896476746, 0.7011703252792358, -0.4625021815299988, 0.30667316913604736, -0.08743250370025635, -0.4176221787929535, 0.3676127791404724, 0.5080993175506592, -0.7563995122909546, -0.9242758750915527, -1.6150637865066528, 0.7681282758712769, -0.4686303436756134, -0.13984151184558868, -0.5447363257408142, 0.9299972057342529, 0.5674940347671509, -0.0861923024058342, 0.2637834846973419, 0.7551451921463013, -0.8650191426277161, -0.7736810445785522, 0.0034055078867822886, -0.894849956035614, 0.29295170307159424, 0.26007527112960815, -1.0953882932662964, -0.34748655557632446, 1.1469388008117676, -0.32434308528900146, -0.9065401554107666, -0.7346349358558655, 0.7613928914070129, -0.4753890335559845, 0.16991589963436127, -0.3160739839076996, -0.2906433045864105, -1.224708914756775, -0.21384982764720917, 0.043271876871585846, 0.16055990755558014, -0.22872944176197052, 0.9623072743415833, 0.5200964212417603, -1.1606086492538452, -0.00645443145185709, 0.7930198311805725, 0.2072949856519699, -0.1035269945859909, 0.28399741649627686, 0.33083540201187134, -0.06414415687322617, 0.18417444825172424, 0.16945777833461761, 0.10156074911355972, -0.8097074031829834, -0.5162741541862488, 0.7329797148704529, -0.12390954047441483, 0.08643848448991776, 1.3749194145202637, -0.17498734593391418, -0.9169536828994751, 0.1268962025642395, -1.595979928970337, -0.5180179476737976, -0.1639900952577591, 0.9191070795059204, 0.06462360918521881, 0.023307165130972862, -0.32021090388298035, -0.7120718955993652, 0.23490110039710999, -0.4033634662628174, -0.6348526477813721, 0.4932115375995636, 0.12225764244794846, -0.5889831781387329, 0.741301953792572, 0.6953168511390686, -0.546852707862854, -0.3999265432357788, -0.6318118572235107, -0.45632025599479675, 0.09097286313772202, 0.6119065284729004, -0.17580296099185944, -0.6349637508392334, 0.8512075543403625, 0.6626582741737366, 0.3465501368045807, -0.158350870013237, -0.1386149525642395, -0.33984237909317017, 0.2646869122982025, -0.10542920976877213, -0.5436933636665344, -0.8094133734703064, 1.0216025114059448, 1.2063543796539307, -0.44149380922317505, 0.1839175671339035, -0.10427805036306381, -0.727577269077301, 0.5605157017707825, 0.42458072304725647, 0.2831982970237732, 0.9251644015312195, 0.30753061175346375, 0.5415998101234436, -0.24052906036376953, -1.0449777841567993, -0.3678141236305237, 0.7581004500389099, 1.0439984798431396, 0.8971838355064392, 0.36555299162864685, 0.5028679370880127, 0.5152305960655212, 0.059205103665590286, 0.20151574909687042, -0.023969916626811028, 0.7093333005905151, -0.39816388487815857, -0.1454828828573227, 0.06036433205008507, 0.9544451832771301, -0.8717683553695679, -0.8479249477386475, 0.3326758146286011, 0.8989881873130798, 0.32833924889564514, 0.3329732418060303, 0.8294529318809509, -0.024357939139008522, 0.8528938889503479, 0.2473480999469757, 0.36822330951690674, -0.6855340003967285, -0.37355777621269226, -0.4501760005950928, -0.39328691363334656, -0.33392491936683655, -0.07466242462396622, -0.30796632170677185, -0.2650800347328186, -0.00011162267765030265, 0.5440630316734314, -0.20595641434192657, 0.6149312257766724, 0.9104247689247131, 0.5893323421478271, 0.6464542746543884, -0.4844109117984772, -0.6226539611816406, -0.5322325229644775, -0.8442765474319458, -0.12792114913463593, -0.5653014779090881, -0.07713513821363449, -0.07913163304328918, -0.27567142248153687, -0.6043722629547119]}, "authors": [{"authorId": "1720739223", "name": "Shaked Brody"}, {"authorId": "47051926", "name": "Uri Alon"}, {"authorId": "2115022635", "name": "Eran Yahav"}], "references": [{"paperId": "f4adc782a7f2ef6412273d289fae9423fbe27fb3", "title": "Low-Rank Softmax Can Have Unargmaxable Classes in Theory but Rarely in Practice"}, {"paperId": "17293893e0ef799fc038b5da01fc6baf3b08abdd", "title": "Stolen Probability: A Structural Weakness of Neural Language Models"}, {"paperId": "b45d656ac8cc2e940609580cf291ee76ffcac20a", "title": "On Layer Normalization in the Transformer Architecture"}, {"paperId": "40922d386116975853a743b1d810c1e0f03e886a", "title": "Understanding and Improving Layer Normalization"}, {"paperId": "10eda4521c032adabaa8e70d6569e17370b29dcd", "title": "Root Mean Square Layer Normalization"}, {"paperId": "204e3073870fae3d05bcbc2f6a8e263d9b72e776", "title": "Attention is All you Need"}, {"paperId": "97fb4e3d45bb098e27e0071448b6152217bd35a5", "title": "Layer Normalization"}, {"paperId": "05dd7254b632376973f3a1b4d39485da17814df5", "title": "SQuAD: 100,000+ Questions for Machine Comprehension of Text"}, {"paperId": "995c5f5e62614fcb4d2796ad2faab969da51713e", "title": "Batch Normalization: Accelerating Deep Network Training by Reducing Internal Covariate Shift"}, {"paperId": "687bac2d3320083eb4530bf18bb8f8f721477600", "title": "Recursive Deep Models for Semantic Compositionality Over a Sentiment Treebank"}, {"paperId": "506a4e414eea51aefab6503eaba929c2d0530660", "title": "Proof of Theorem 1"}, {"paperId": null, "title": "Theorem 2"}, {"paperId": "9405cc0d6169988371b2755e573cc28650d14dfe", "title": "Language Models are Unsupervised Multitask Learners"}, {"paperId": "df2b0e26d0599ce3e70df8a9da02e51594e0e992", "title": "BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding"}, {"paperId": null, "title": "2018)) on the sentiment analysis task. Table 4 shows the results of running this model on the validation"}, {"paperId": null, "title": "2018), except that we used a hidden size of 8, 4 hidden layers, and a learning rate of 5e-5, resulting in a model with 446K learnable parameters"}, {"paperId": null, "title": "assigned to w"}, {"paperId": null, "title": "one word w i whose embedding is on the convex hull"}]}