{"paperId": "b5982eee6b5d24c740d7d543a08859582f184bed", "title": "Training-Free Exponential Extension of Sliding Window Context with Cascading KV Cache", "abstract": "The context window within a transformer provides a form of active memory for the current task, which can be useful for few-shot learning and conditional generation, both which depend heavily on previous context tokens. However, as the context length grows, the computational cost increases quadratically. Recent works have shown that saving a few initial tokens along with a fixed-sized sliding window leads to stable streaming generation with linear complexity in transformer-based Large Language Models (LLMs). However, they make suboptimal use of the fixed window by naively evicting all tokens unconditionally from the key-value (KV) cache once they reach the end of the window, resulting in tokens being forgotten and no longer able to affect subsequent predictions. To overcome this limitation, we propose a novel mechanism for storing longer sliding window contexts with the same total cache size by keeping separate cascading sub-cache buffers whereby each subsequent buffer conditionally accepts a fraction of the relatively more important tokens evicted from the previous buffer. Our method results in a dynamic KV cache that can store tokens from the more distant past than a fixed, static sliding window approach. Our experiments show improvements of 5.6% on long context generation (LongBench), 1.2% in streaming perplexity (PG19), and 0.6% in language understanding (MMLU STEM) using LLMs given the same fixed cache size. Additionally, we provide an efficient implementation that improves the KV cache latency from 1.33ms per caching operation to 0.54ms, a 59% speedup over previous work.", "venue": "arXiv.org", "year": 2024, "citationCount": 0, "influentialCitationCount": 0, "openAccessPdf": null, "tldr": {"model": "tldr@v2.0.0", "text": "This work proposes a novel mechanism for storing longer sliding window contexts with the same total cache size by keeping separate cascading sub-cache buffers whereby each subsequent buffer conditionally accepts a fraction of the relatively more important tokens evicted from the previous buffer."}, "embedding": {"model": "specter_v2", "vector": [0.5336629152297974, 0.35440245270729065, -0.18797816336154938, -0.08429429680109024, -0.7325354218482971, -0.6273865699768066, 0.5259145498275757, -0.1274677813053131, -0.5843877196311951, -0.4663567841053009, 0.5491712093353271, 0.008116829209029675, 0.8209779262542725, -0.14593975245952606, -0.25177648663520813, 0.03609444946050644, -0.8843239545822144, -0.1432511806488037, 0.8153757452964783, -0.5143394470214844, -0.23509061336517334, -1.0338462591171265, -1.0050995349884033, 0.5538783669471741, 0.5383089184761047, 0.3153395354747772, 0.5821712613105774, 1.0979152917861938, -0.5699830055236816, 0.24052372574806213, 0.5021621584892273, -0.32778221368789673, 0.09529360383749008, -0.31907233595848083, -0.17534950375556946, -0.3832448720932007, 0.3393631875514984, -0.5034873485565186, -0.29145464301109314, 0.5172733068466187, 0.06539785861968994, 0.1460353434085846, -0.3809603154659271, -0.9650570154190063, -0.19429883360862732, 1.2738369703292847, 0.7996186017990112, 0.5771782994270325, -0.34729135036468506, -0.6844869256019592, 1.6167058944702148, -1.5523395538330078, 0.3849261403083801, 1.224996566772461, 0.3217010498046875, 0.6930261850357056, -0.01336249802261591, -0.5536991357803345, 1.138919472694397, 0.4342816472053528, -0.8456114530563354, -0.5141059756278992, 0.11114230751991272, 0.24440798163414001, 2.2955727577209473, -0.3216860890388489, 0.8131095767021179, 0.6568556427955627, -0.14528965950012207, 1.6956381797790527, -0.7792826294898987, -0.90859055519104, -0.22719545662403107, 0.04539108648896217, 0.35443246364593506, 0.8793009519577026, -0.6238363981246948, 0.1497822403907776, -0.9257495999336243, -0.21834123134613037, 0.5563690066337585, -0.1411198079586029, 0.2063400000333786, -0.12120576202869415, -0.3408418595790863, 0.6722214818000793, -0.08381608873605728, 0.9514352083206177, 0.28334227204322815, 0.6197353601455688, 0.8826821446418762, 0.20151886343955994, 0.06035766750574112, 0.2167292982339859, -0.09474309533834457, 0.08062191307544708, -1.1066210269927979, 0.5501475930213928, -0.3750157952308655, 1.0051233768463135, -0.5944229364395142, 0.36825111508369446, -1.0316028594970703, 0.31827765703201294, 1.0073742866516113, -0.052815672010183334, 0.4341016709804535, -0.7927346229553223, 0.3926790654659271, -0.8082380294799805, 0.023599442094564438, -0.012576409615576267, 0.2039281129837036, 0.06855693459510803, -0.37951377034187317, -1.3889490365982056, -0.26811596751213074, -0.028777483850717545, -0.6308223605155945, 0.7990328669548035, 0.015372625552117825, 0.9645773768424988, 0.3168073296546936, 0.15031780302524567, 0.5781010389328003, 0.7759686708450317, 0.2684359550476074, -0.013042869977653027, 0.4861021339893341, -1.1909915208816528, -0.443204402923584, -0.9764270186424255, 0.7746878862380981, 0.061302464455366135, 0.550701379776001, -0.03331524878740311, -1.444790244102478, -0.9515782594680786, -0.9387195706367493, -0.09099212288856506, -0.5964174866676331, -0.09622274339199066, 0.8908907175064087, 0.45582571625709534, -1.0388233661651611, 0.8315976858139038, -0.39215973019599915, -0.019910939037799835, 0.2359296977519989, -0.15690143406391144, 0.3402649164199829, -0.45266392827033997, -1.7693750858306885, -0.14852267503738403, 0.2656289339065552, -0.4658641815185547, -0.19043125212192535, -1.0725501775741577, -1.2551835775375366, -0.02486080676317215, 0.5626046657562256, -0.1328512281179428, 1.4670709371566772, -0.13620053231716156, -1.4223620891571045, 0.2710264325141907, -0.5090785622596741, 0.18349869549274445, 0.27492034435272217, -0.1752539873123169, -0.5575688481330872, -0.5116897821426392, -0.2876637279987335, 0.5782907009124756, 0.3782446086406708, 0.31827694177627563, -0.661925196647644, -0.01187722198665142, -0.10366763919591904, 0.022427937015891075, -0.21442709863185883, 0.7136199474334717, -0.5094271302223206, -0.0470438078045845, 0.30369076132774353, 0.6352940797805786, -0.1517050415277481, -0.5504534840583801, 0.014980738051235676, -1.4562164545059204, 0.7844739556312561, 0.1001167967915535, 1.1916722059249878, -0.7436625361442566, -0.755952775478363, -0.3094163239002228, -0.3749297559261322, 0.11204148083925247, -0.9806416034698486, 0.9175684452056885, -0.08420083671808243, 0.1660015732049942, 0.27831655740737915, -0.9363077878952026, -0.07585923373699188, -0.37776944041252136, -0.8524381518363953, -0.6900296211242676, 0.35706788301467896, 1.1840647459030151, -1.2760320901870728, -0.0571192167699337, -0.08799201250076294, 0.27781248092651367, -1.1173536777496338, 1.0312681198120117, -0.42650288343429565, -0.04460443556308746, -0.1520039588212967, -0.06848253309726715, -0.20217792689800262, 0.12473254650831223, 0.5553066730499268, -0.20998753607273102, -0.20705565810203552, 0.40303683280944824, -0.5384347438812256, 1.740386724472046, -0.49522167444229126, 0.1765737235546112, -0.39830130338668823, -0.4540833532810211, 0.011283539235591888, 0.6419165134429932, -0.5194410681724548, -0.44324493408203125, -0.0526689812541008, 0.3041524291038513, -0.642469584941864, 0.32277384400367737, 1.0425831079483032, 0.7911794781684875, -0.45534083247184753, -0.20662342011928558, 0.8117585778236389, -0.23367804288864136, 0.5919139981269836, 0.7730664014816284, 0.6137092709541321, 0.3605164587497711, 0.13424034416675568, 0.2436237782239914, 0.2799207270145416, -0.62971031665802, 0.25486698746681213, 0.6039102077484131, 0.6598738431930542, 0.987855851650238, 0.5576353073120117, -0.4051745533943176, -0.6737752556800842, 0.03317314386367798, 0.8489006757736206, 1.783689260482788, -0.07396213710308075, -0.4951085150241852, -0.7633129954338074, -0.21908406913280487, -0.5295814871788025, 0.5110838413238525, -0.1717280149459839, -0.1576523333787918, -0.5653234720230103, -0.630903959274292, 1.011929988861084, 0.6544376015663147, 0.7591579556465149, -0.677592933177948, -0.3786841034889221, 0.20495103299617767, -0.03237367421388626, -1.0569367408752441, -0.6139616966247559, -0.04808080568909645, -0.603213906288147, -0.07891622930765152, 0.15228277444839478, -0.033990275114774704, -0.2235029935836792, -0.47774001955986023, 0.9405227899551392, -0.3773585259914398, -0.42689958214759827, 0.18898548185825348, 0.20229776203632355, -0.5789560079574585, -0.8174015283584595, 0.17777201533317566, 0.06593261659145355, -0.5324431657791138, 0.23349468410015106, 0.7050368189811707, -0.017926638945937157, -0.2971823215484619, -0.26660439372062683, 0.469022274017334, -0.31769952178001404, 0.10984302312135696, 0.7749119400978088, -0.590888500213623, 0.21800866723060608, -1.320497751235962, 0.708901584148407, 0.2907552719116211, -0.442476361989975, 0.4689423441886902, -0.49818018078804016, -0.7880303263664246, 0.5555161237716675, -0.8113614320755005, -0.548633337020874, -0.8795387744903564, -0.16376519203186035, -0.4759875237941742, -0.027461685240268707, -0.0993017703294754, 0.08297321200370789, 0.5538300275802612, -0.021801430732011795, 0.8470290899276733, -0.01297036837786436, 0.04696512594819069, 0.8026495575904846, -0.884321391582489, 0.32379958033561707, 0.3520479202270508, -0.1955214887857437, -0.21038340032100677, -0.49154695868492126, -0.7313542366027832, -0.23533332347869873, -0.5817207098007202, -0.6453394889831543, -0.39008358120918274, 0.14890934526920319, -0.6934663653373718, -0.49479570984840393, 0.10424879938364029, -0.8249474167823792, -0.4845466911792755, 0.11902238428592682, -0.5358163714408875, -0.23674224317073822, -0.9676092863082886, -1.0816994905471802, -0.40614768862724304, -0.8263638019561768, -0.8963385820388794, 0.46605291962623596, -0.0837639644742012, -0.3574684262275696, -0.5897746086120605, 0.331906795501709, -0.42104190587997437, 0.879570722579956, -0.6666580438613892, 0.6706516146659851, -0.0008320805500261486, -0.25770363211631775, -0.36393502354621887, 0.6773597002029419, 0.5885481834411621, -0.4569421410560608, 0.30979299545288086, -0.8248987197875977, 0.012741643004119396, -0.6457212567329407, -0.41274845600128174, 0.39747995138168335, 0.23235449194908142, 0.516897976398468, 0.3733631372451782, -0.7571163773536682, 0.23781298100948334, 1.7108657360076904, -0.28227561712265015, 0.22520779073238373, -0.26998767256736755, 1.1082640886306763, 0.023955032229423523, 0.25598305463790894, 0.38933631777763367, 0.2073679119348526, 0.2426040917634964, -0.035182010382413864, 0.023130344226956367, 0.16777373850345612, -0.7127522230148315, 0.9135972857475281, 1.561763048171997, 0.28694233298301697, 0.036056824028491974, -0.7410027980804443, 0.9691001176834106, -1.436804175376892, -1.093611717224121, 0.706512451171875, 0.7506928443908691, 0.48823001980781555, -0.32246968150138855, -0.21419113874435425, -0.19434234499931335, 0.3344878554344177, 0.3307168781757355, -0.486858606338501, -0.8031790256500244, 0.1622818261384964, 0.4708173871040344, -0.08592191338539124, 0.7600497603416443, -0.21778450906276703, 1.2780647277832031, 14.404479026794434, 1.3279188871383667, 0.011247584596276283, 0.5478034019470215, 0.3332723081111908, -0.24620570242404938, -0.3962598443031311, -0.019855566322803497, -1.7038358449935913, -0.4661605954170227, 1.1789969205856323, -0.15938101708889008, 0.469225138425827, 0.3024712800979614, 0.32056689262390137, 0.16357892751693726, -0.6575767397880554, 0.4203311800956726, 0.523384153842926, -1.5292545557022095, 0.4049743711948395, -0.18486203253269196, 0.07744678854942322, 0.7614957094192505, 0.638382077217102, 1.1286795139312744, 0.1859644055366516, -0.11408942192792892, 0.5865572690963745, -0.08368334174156189, 0.8879367709159851, -0.27640220522880554, 0.12258248031139374, 0.5691675543785095, -0.9971033930778503, -0.3884452283382416, -0.848002016544342, -0.9769334197044373, 0.379542738199234, -0.01619877479970455, -0.7672300338745117, -0.5542563796043396, -0.1550208330154419, 0.6708950996398926, 0.06987881660461426, 0.19563476741313934, -0.18363289535045624, 1.0135120153427124, 0.05043179541826248, -0.07272734493017197, 0.5424140691757202, 0.26731109619140625, 0.38996729254722595, 0.2261734902858734, 0.21544095873832703, 0.31226253509521484, 0.14777913689613342, 0.5344144701957703, -0.25641903281211853, 0.010149134323000908, -0.35171541571617126, -0.1511198878288269, 0.056636691093444824, 1.001914620399475, 0.24581608176231384, -0.18462273478507996, -0.6910786032676697, 0.5521557927131653, 0.6547107100486755, -0.12083110213279724, -0.41639208793640137, -0.13359256088733673, 0.4064875543117523, -0.463032066822052, 0.3462457060813904, 0.5395469069480896, 0.2657715678215027, -0.9000145196914673, -0.7392860054969788, -0.19353410601615906, 0.3131425380706787, -0.587634801864624, -0.30393657088279724, 0.8440108299255371, -0.052061233669519424, -0.36644458770751953, -0.07494212687015533, -0.36991915106773376, -0.8462345600128174, 0.21898625791072845, -1.3133234977722168, -0.9730815291404724, 0.39208322763442993, -0.023122064769268036, 0.10776215046644211, 0.38306334614753723, 1.2813751697540283, -0.17214372754096985, -0.4125942289829254, 0.2477773129940033, 0.2730003893375397, 0.09956943243741989, -0.21623069047927856, -0.9399281740188599, 1.2901288270950317, 0.4957966208457947, 0.08651004731655121, -0.08847549557685852, -0.3171207308769226, 0.09142138808965683, -0.8226767182350159, -0.39450088143348694, 0.773281991481781, -0.7226329445838928, -0.5460953712463379, -1.370024561882019, -1.0016065835952759, 0.3987720310688019, 0.718858540058136, -0.27784475684165955, 0.47827738523483276, 0.20175331830978394, -0.36828646063804626, -0.18508152663707733, -0.49420246481895447, 0.3470962345600128, 0.7618530988693237, -0.4834289848804474, -0.20003199577331543, -0.3240707814693451, 0.9035757184028625, -1.0547316074371338, -0.6911165714263916, -0.4891112744808197, 0.3216266334056854, -0.20855848491191864, 0.9414904117584229, -0.3388307988643646, 0.4333062469959259, 1.25005042552948, 0.08599311858415604, -0.8357959389686584, -0.09986890852451324, -0.8024659752845764, 0.2908199429512024, 0.5567855834960938, 0.6333011984825134, -0.10189300775527954, 0.31615471839904785, 0.9412592649459839, 0.3966938555240631, -0.5841376185417175, -0.6064261794090271, -0.31663569808006287, 0.4717215597629547, -0.867550253868103, 0.42834070324897766, -0.05537937954068184, 0.4266620874404907, 0.16480199992656708, 0.5975154638290405, 0.6118765473365784, -0.3271259367465973, -0.690589427947998, 0.23188436031341553, 0.23102222383022308, -0.028404146432876587, -0.11228448152542114, -0.3211188018321991, -1.1295907497406006, 0.050031453371047974, -1.2331368923187256, -0.00928671658039093, -0.7646759152412415, -0.474060982465744, -0.03528253361582756, -0.41682127118110657, -0.014294068329036236, -0.11403971165418625, -0.5288295745849609, -0.21690411865711212, -1.1142867803573608, -0.7796727418899536, 0.4889376759529114, 0.8410409092903137, -0.5598592758178711, -0.18101218342781067, -0.05775700509548187, 0.17692042887210846, 0.0829082727432251, 0.5441377758979797, -0.23287180066108704, -1.1610381603240967, -1.2500168085098267, 0.5839195251464844, 0.2712875306606293, -0.1382690817117691, -0.5064263343811035, 0.6243935227394104, 0.416257381439209, 0.006605176255106926, -0.29928329586982727, 0.2735366225242615, -0.35340210795402527, -0.606148362159729, 0.030766436830163002, -0.8661811351776123, 0.17187802493572235, 0.20717692375183105, -0.5907487273216248, -0.298237681388855, 0.5321779251098633, -0.17194131016731262, -1.3671568632125854, -1.451271891593933, 0.4617863595485687, -0.7015633583068848, 0.36529648303985596, -0.3393038511276245, -0.19589169323444366, -0.6352342963218689, -0.22262510657310486, -0.06982842832803726, 0.43504682183265686, -0.3631787896156311, 1.2218849658966064, 0.9078380465507507, -1.039028525352478, -0.07832196354866028, 0.221376433968544, 0.09119711816310883, 0.2519703805446625, 0.8076695799827576, 0.13467442989349365, 0.160817489027977, 0.25800764560699463, 0.4183516502380371, 0.25676262378692627, -1.5018882751464844, 0.08316907286643982, 0.618977963924408, -0.41924577951431274, -0.2956272065639496, 1.3555164337158203, -0.6348385810852051, -0.8876035213470459, -0.04160693287849426, -1.638532280921936, -0.5401496291160583, -0.2623937427997589, 1.012898325920105, 0.4065612554550171, 0.08779063075780869, 0.11740433424711227, -0.43214231729507446, 0.1346864402294159, -0.37793177366256714, -0.7248802781105042, 0.47206512093544006, -0.05846010148525238, -0.2986871004104614, 0.9703899621963501, 0.6478596925735474, -0.7526143193244934, -0.7613065838813782, -0.5139817595481873, -0.5787613391876221, -0.14687399566173553, 0.45193740725517273, -0.24223469197750092, -0.2888385057449341, 1.0219202041625977, 0.46170493960380554, 0.2722126841545105, -0.09649530798196793, -0.14685824513435364, 0.6455967426300049, 0.590027928352356, 0.2515016496181488, -0.8673490881919861, -0.6154601573944092, 1.2551273107528687, 0.9505961537361145, -0.9366015791893005, -0.2902095317840576, -0.06912747770547867, -1.0433846712112427, 0.7999678254127502, 0.5341672897338867, -0.24888616800308228, 0.7634090185165405, -0.18659597635269165, 0.23924018442630768, 0.6743952631950378, -1.7039381265640259, -0.21647928655147552, 0.49588680267333984, 1.0247372388839722, 0.7238503098487854, 0.08654513210058212, 0.38858386874198914, 1.0423164367675781, 0.3683060109615326, 0.22486379742622375, 0.5398641228675842, 0.44161611795425415, -0.21073655784130096, -0.13605354726314545, 0.37224701046943665, 0.5170663595199585, -0.778459370136261, -1.0253286361694336, 0.27986693382263184, 0.4368831515312195, 0.3204720914363861, 0.7995069622993469, 1.023927092552185, 0.26679012179374695, 0.652961015701294, 0.48355990648269653, 0.8726687431335449, -0.513332724571228, -0.40657398104667664, -0.15332242846488953, -0.7378451228141785, -0.57318115234375, 0.1394297182559967, -0.6401907801628113, -0.4737684726715088, 0.1921839863061905, -0.04272991791367531, 0.0027519988361746073, -0.028728559613227844, 0.9320980906486511, 0.5313454270362854, 0.4026985764503479, -0.42639121413230896, -0.338921457529068, -0.24892616271972656, -0.742897629737854, -0.15561462938785553, -0.38512513041496277, -0.3047669231891632, 0.36972102522850037, 0.35696446895599365, -0.14624598622322083]}, "authors": [{"authorId": "2051330801", "name": "Jeffrey Willette"}, {"authorId": "2116623957", "name": "Heejun Lee"}, {"authorId": "3445691", "name": "Youngwan Lee"}, {"authorId": "2306785832", "name": "Myeongjae Jeon"}, {"authorId": "2265627157", "name": "Sung Ju Hwang"}], "references": [{"paperId": "3fd5bc3077d04965eaa3498372c39bbdd09d55e4", "title": "Leave No Context Behind: Efficient Infinite Context Transformers with Infini-attention"}, {"paperId": "4e2a3ddeaf5defb9318b43c364b9a9efe3847dcf", "title": "Compressed Context Memory For Online Language Model Interaction"}, {"paperId": "db633c6b1c286c0386f0078d8a2e6224e03a6227", "title": "Mistral 7B"}, {"paperId": "93e58491830abe1eb965ab37ec64fa97263f6048", "title": "HyperAttention: Long-context Attention in Near-Linear Time"}, {"paperId": "fdc53c2c10742464087c0525f77e32604827a21d", "title": "Efficient Streaming Language Models with Attention Sinks"}, {"paperId": "5fc1a3a49e8f1d106118b69d1d6be3b6caa23da0", "title": "Qwen Technical Report"}, {"paperId": "b6346f9fa093b8e85df712485a2b851b9f680dac", "title": "LongLoRA: Efficient Fine-tuning of Long-Context Large Language Models"}, {"paperId": "b31a5884a8ebe96b6300839b28608b97f8f8ef76", "title": "LongBench: A Bilingual, Multitask Benchmark for Long Context Understanding"}, {"paperId": "104b0bb1da562d53cbda87aec79ef6a2827d191a", "title": "Llama 2: Open Foundation and Fine-Tuned Chat Models"}, {"paperId": "823ca4778e1027f2f0b356df051d762dcecaaba0", "title": "FlashAttention-2: Faster Attention with Better Parallelism and Work Partitioning"}, {"paperId": "60b35c6d68acced19b0c66edcfc0ee0a2c11efed", "title": "Landmark Attention: Random-Access Infinite Context Length for Transformers"}, {"paperId": "9ca329408813d209b1dcb36936f7f9cba82506bd", "title": "Train Short, Test Long: Attention with Linear Biases Enables Input Length Extrapolation"}, {"paperId": "66c10bf1f11bc1b2d92204d8f8391d087f6de1c4", "title": "RoFormer: Enhanced Transformer with Rotary Position Embedding"}, {"paperId": "3fbf6339273c50b04e886fa9bd4ad18c952a683d", "title": "Rethinking Attention with Performers"}, {"paperId": "814a4f680b9ba6baba23b93499f4b48af1a27678", "title": "Measuring Massive Multitask Language Understanding"}, {"paperId": "925ad2897d1b5decbea320d07e99afa9110e09b2", "title": "Longformer: The Long-Document Transformer"}, {"paperId": "055fd6a9f7293269f1b22c1470e63bd02d8d9500", "title": "Reformer: The Efficient Transformer"}, {"paperId": "f51497f463566581874c941353dd9d80069c5b77", "title": "Compressive Transformers for Long-Range Sequence Modelling"}, {"paperId": "661d142c23cb2a3207d5f1ba2ac7ff61f2d4fb2f", "title": "Triton: an intermediate language and compiler for tiled neural network computations"}, {"paperId": "204e3073870fae3d05bcbc2f6a8e263d9b72e776", "title": "Attention is All you Need"}, {"paperId": "efbd381493bb9636f489b965a2034d529cd56bcd", "title": "Pointer Sentinel Mixture Models"}]}