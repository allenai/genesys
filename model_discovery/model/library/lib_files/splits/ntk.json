{
    "ntk-0": "r/LocalLLaMA\nSearch in $r / L \\ldots$\nCreate\n(1\nr/LocalLLaMA 1 yr. ago\nbloc97\n\n# NTK-Aware Scaled RoPE allows LLaMA models to have extended ( $8 \\mathrm{k}+$ ) context size without any fine-tuning and minimal perplexity degradation. ## News\n\nI've seen the posts about SuperHOT and just recently, the paper from Meta which uses RoPE interpolation, and I've noticed an immediate improvement that can be brought to this method. Basically if you apply Neural Tangent Kernel (NTK) theory to this problem, it becomes clear that simply interpolating the RoPE's fourier space \"linearly\" is very sub-optimal, as it prevents the network to distinguish the order and positions of tokens that are very close by. Borrowing from NTK literature, scaling down the fourier features too much will eventually even prevent succesful finetunes (this is corroborated by the recent paper by Meta that suggests an upper bound of $\\sim 600 x$ )\n\nInstead of the simple linear interpolation scheme, I've tried to design a nonlinear interpolation scheme using tools from NTK literature. Basically this interpolation scheme changes the base of the RoPE instead of the scale, which intuitively changes the \"spinning\" speed which each of the RoPE's dimension vectors compared to the next. Because it does not scale the fourier features directly, all the positions are perfectly distinguishable from eachother, even when taken to the extreme (eg. streched 1 million times, which is effectively a context size of 2 Billion)\n\nTo my surprise, this method works extremely well, so much so that you don't even need to fine tune the LLaMA 7B model for 4096 context size! The perplexity degradation is minimal. I'm sure with fine tuning this would become even better. Enough explanations, here's some empirical results. All the perplexity measurements are done on LLaMA 7b with the tau/scrolls $\\cdot$ Datasets at Hugging Face dataset (I only used a subset of gov_report). Here's a graph showing the average perplexity of LLaMA 7 b on a set of 40 very long prompts (12k+ context size). Compared to changing the scale (from SuperHOT, which was set to 4), we change a factor alpha, which when equal to 8 provides the same context size increase but with much less perplexity degradation. All without any finetuning! ![](https://cdn.mathpix.com/cropped/2024_09_12_dbe32765baccd1d0b68bg-02.jpg?height=1029&width=1774&top_left_y=179&top_left_x=147)\n\nGraph showing the average perplexity of LLaMA 7 b on set of 40 very long prompt ( $12 \\mathrm{k}+$ context size) with previous and new interpolation scheme\n\nHere's more results, showing more scale and alpha factors. ![](https://cdn.mathpix.com/cropped/2024_09_12_dbe32765baccd1d0b68bg-02.jpg?height=1100&width=1780&top_left_y=1483&top_left_x=144)\n\nHere's more results, showing more scale and alpha factors. Zoomed-in version of the second graph, showing the details. ![](https://cdn.mathpix.com/cropped/2024_09_12_dbe32765baccd1d0b68bg-03.jpg?height=1074&width=1775&top_left_y=134&top_left_x=152)\n\nZoomed-in version of the second graph, showing the details. Code can be found on a colab notebook with a test example. NTKAwareScaledRotaryEmbedding.ipynb Colaboratory_(google.com). Again, the changes to the RoPE code is only 3 lines. Also just for fun, I've pasted the entirety of the Meta paper [2306.15595] Extending Context Window of Large Language Models via Positional Interpolation (arxiv.org), with the abstract and conclusions removed, and asked OASST-sft-6-Ilama-30b some questions. I think it fared pretty well given it hasn't been fine tuned at all for $6000+$ context size. I used an alpha of 8 for this prompt. The entire paper is about 6200 tokens. These prompts can be found in the colab notebook linked above. The following questions are simply appended at the end of the prompt which contains the entire research paper. ## QUESTION\n\nPlease give me a brief summary of this research paper in a few bullet points. ## ANSWER\n\n* Large Language models (LLMs) often have a pre-defined context window size, but sometimes they need to operate on longer contexts, e.g., in conversation systems or summarization tasks. * Extending the context window of an existing pre-trained LLM is challenging because direct extrapolation of positional encodings can lead to poor performance. * Researchers propose \"Position Interpolation\" to extend the context window of LLMs by downscaling the positional encodings. * They experimentally validate the effectiveness of Position Interpolation on LLaMA models, reducing the perplexity gap between the original and extended contexts. * They compare Position Interpolation with direct extrapolation and find that Position Interpolation works better. * They apply Position Interpolation to LLaMa models and fine-tune them on the Pile dataset, finding that the models can effectively utilize longer contexts. * They also evaluate the models' abilities to attend to longer contexts and perform well on benchmarks within the original context size. * They apply Position Interpolation to long document summarization and obtain competitive results. * They provide insights into the interpolation/extrapolation tradeoff and discuss potential improvements. * They plan to explore more advanced methods like data augmentation and multi-task learning to improve the interpolation. ## QUESTION\n\nPlease write me the abstract for this paper. ## ANSWER\n\nThis paper presents a technique called \"Position Interpolation\" for extending the context window size of pre-trained Large Language Models (LLMs) without modifying their architecture. Previous methods like ALiBi and LeX were unable to efficiently extend the context window size of LLMs, leading to poor performance. The authors propose Position Interpolation, which involves downscaling the positional encoding of the LLM's attention mechanism to match the desired longer context window size. They prove mathematically that interpolated attention scores are more stable than extrapolated ones, allowing the model to adapt to longer contexts with just a few hundred fine-tuning steps. Experiments showed that Position Interpolation enables LLMs to perform well on longer contexts, reducing perplexity by up to 0.8 points on average, and generating strong summarizations. Extending the context window size to 32768 led to slight degradation on the original benchmarks, but the models adapted to longer texts. The authors conclude that interpolating positional encodings allows the model to attend to relevant evidence in the longer contexts, and the stability of the interpolated attention score helps the model avoid catastrophic behaviors. ## QUESTION\n\nHow many steps was the model fine tuned for the final results? Give a short answer. ## ANSWER\n\nThe authors of the paper \"Extending Context Windows of Large Language Models via Position Interpolation\" fine-tuned the model for 1000 batches for the experiments presented in the paper. ## ANSWER\n\nThe interpolation bound is at least $2-29.7^{*} 10^{\\wedge}(-6)$ times smaller than the extrapolation bound.",
    "ntk-1": "Sorry for the large dump of information on reddit, I'm too lazy to write a blog post for this. I might give a more detailed explanation on how I derived the formula used to calculate the base if enough people are interested. I did not test fine-tuning performance as I do not have the resources or the time to fine tune an LLM, I just derived this formula during lunch and experimented with it. However, I think that this method will do even better with fine tuning. Also thanks to the people behind the SuperHOT blogpost, it was their hard work that inspired me and allowed me to make this contribution for everyone! Finally, I really hope this post will inspire others to start experimenting on ways to improve LLMs.",
    "ntk-2": "There's so much to learn and so much left to discover! What a time to be alive! Students, whether you're creating show-stopping images, making memorable reports, or designing iconic posters, Adobe Creative Cloud helps you express all of your ideas. Save over 65\\% on Adobe Creative Cloud. Students save over 60\\% on Adobe Creative Cloud. Learn more\nLearn More\nadobe.com\n\nAdd a comment\n\nSort by: Best $\\vee$\nSearch Comments\nkaiokendev \u30fb 1y ago\nI am curious - You emailed this approach to me? I did not get a chance to test it with finetune yet, but based on your result I am impressed. Solid work\n$84 \\square$ Reply\nbloc97 OP \u30fb1y ago \u30fbEdited 1y ago\nsurprised that they did not even mention NTK in that paper as it's generally a \"proven\" theory and used extensively in the field of ML + computer vision/graphics and inverse rendering. For example the paper about Fourier feature networks. Where the positional embeddeding used for 2D/3D rendering is very similar to RoPE. $44 \\quad \\square$ Reply\n\n## kaiokendev \u30fb 1y ago\n\nI think it is commonly the case that the application of some easy things will go unnoticed or forgotten because everyone's mind is stuck in \"complex-mode\". In this case, RoPE is developed in 2021, so now we can look back and say how no one thought to apply this in the last 2 years, but in reality there are a lot of factors that result in various group being hyperfocused on specific approaches, and that's not even mentioning the fact only a small percentage of those end up getting reproduced and incorporated. The results end up looking more like the Tesla tunnels than the Autobahn. Sometimes all it takes is one person looking at it from the simple angle to get the breakthrough results like what you did here. At least thats my thought on it\nReply\n\nBangkokPadang \u30fb1y ago\nSometimes it just takes a fresh set of eyes. I love in u/kaiokendev 's explanation of how he came up with the approach used in the superHOT models, it was because he noticed that OpenAl's context seemed to be growing by 4 x , so he tried scaling the frequency window down by a factor of .25 and that did it, lol. $24 \\quad$ Reply\nbloc97 OP \u30fb 1y ago\nI think that openai must have used some trick to increase context size, because training gpt4 to have 32 k is unsustainable. If in a few weeks they extend their context by $4 x$ again then we will be sure that they did not know about SuperHOT and or NTK-aware RoPE scaling. $19 \\square$ Reply\nDannyDaemonic \u30fb1y ago\nCan this be used with superHOT to get 32 k ? 1 Reply\nBangkokPadang \u30fb 1y ago\nhttps://kaiokendev.github.io\nThe dev that came up with this method has some pretty detailed writings about it, and the possible ramifications of it. Looks like he's currently exploring 16k context here:\nhttps://huggingface.co/kaiokendev/superhot-13b-16k-no-rlhf-test\nSo there's really no solid \"yes or no\" answer yet. My guess would be Probably at some point. $2 \\square$ Reply\nJain92ru $\\cdot 1$ y ago\nCongratulations, now this post is cited in a new Meta paper:\nhttps://ai.meta.com/research/publications/code-Ilama-open-foundation-models-for-code\n$8 \\square$ Reply\n\nErikBjare \u30fb1y ago\n\n![](https://cdn.mathpix.com/cropped/2024_09_12_dbe32765baccd1d0b68bg-07.jpg?height=295&width=623&top_left_y=1343&top_left_x=405)\n\nIncredible. Well done u/bloc97\n\n![](https://cdn.mathpix.com/cropped/2024_09_12_dbe32765baccd1d0b68bg-07.jpg?height=140&width=141&top_left_y=1783&top_left_x=352)\n$\\square$ Reply\n\nTheWheelsOnTheBusG \u30fb1y ago\nActually legendary. $3 \\square$ Reply\nunital \u30fb1y ago \u30fbEdited 1y ago\nCan I ask if you could give a high level explanation of how NTK is being used in CV? My\n(rudimentary) understanding of the NTK is that training an infinitely wide NN is essentially the same as doing kernel regression - and the kernel is precisely the NTK.",
    "ntk-3": "How does this translate to applications in CV? Thanks! $2 \\square$ Reply\nbloc97 OP \u30fb1y ago \u30fbEdited 1y ago\n\nMost of the time in computer graphics, especially in inverse rendering, when you are trying to represent a 3D scene, we like to use some kind of continuous field (whether its a light field, signed distance field, radiance field, etc.), because in order to do inverse rendering (eg. obtain a 3D scene/object given a few 2D images), you need the 3D representation to be differentiable (so that you can find the gradient of the 3D scene w.r.t. the 2D images)\n\nWell what is differentiable and very capable at representing complex functions? Neural networks! However for decades researchers couldn't find a reason why NNs failed to learn low-dimensional data (eg. a light field is a 5D function, which is really \"low-dimensional\", compared to MNIST images which are 784-dimensional)\n\nIn NeRF they solved this issue and proved it mathematically using NTK, and showed that NNs, when used as a regression algorithm, tend to prefer very smooth solutions on lowdimensional data unless you force it to learn high frequencies using special positional encoding techniques. (They call the specific technique they used \"Fourier Features\" Fourier Feature Networks (bmild.github.io). )\n\nSince then all inverse rendering techniques are somewhat indirectly based off the insights found in the NeRF paper. $13 \\square$ Reply\n\nStill-Base-7503 \u30fb1y ago\nYou sir are a hero.",
    "ntk-4": "thanks fo your work. Now my 13b bimbo can remember things or two haha. $19 \\square$ Reply\n01\nIntimidatingOstrich6 \u30fb1y ago\nlolling at people busting their asses doing all this math and science and here we all are just like \"thanks brah, now my Al torture victim will actually remember that they couldn't run away even if they managed to abrade through their chain, since I cut one of their feet off two months ago!\"\n\n![](https://cdn.mathpix.com/cropped/2024_09_12_dbe32765baccd1d0b68bg-08.jpg?height=229&width=592&top_left_y=1847&top_left_x=275)\n\nI've made a very cool python script to cut puppy legs based on heuristics and nodal transfers. $5 \\square$ Reply\n\nBangkokPadang \u30fb1y ago\n. $2 \\square$ Reply\n\nLumiphoton \u30fb1y ago \u30fbEdited 1y ago\n\nHopefully you get around to setting up a GitHub page for this work so that it will be seen by the right sets of eyes, I can see it getting quite a lot of attention on there. 14 Reply\nbloc97 OP \u30fb 1y ago\nThanks! However I'm not sure about writing anything more at this point. I made this post out of my spare time just so it doesn't get forgotten or make us unnecessarily waste time on rediscovering it in the future. $11 \\square$ Reply\n\nReturningTarzan \u30fb1y ago\nExLlama Developer\n(this is corroborated by the recent paper by Meta that suggests an upper bound of $\\sim 600 \\mathrm{x}$ )\n\nI mean... by then you're at 1.2 million tokens and you'll have hit many walls already: memory requirements, inference speed, numerical precision/stability... I think it's safe to say that aiming for context above, say, 100k without rethinking the basic idea of self-attention is a dead end. From the charts provided, alpha $=16$ appears to be a negative result (perplexity increases with more context added, starting from it seems 500 tokens?), alpha $=8$ survives the catastrophic collapse that alpha $=4$ suffers at about 5 k tokens, but it doesn't seem to consider more than 5 k tokens after that point. It'll be very interesting to see how it improves with finetuning. 27 Reply\nkaiokendev \u30fb 1y ago \u30fbEdited 1y ago\nYes, I agree. Still it is nice to see alpha $=2$ perform so well with no fine-tuning. Like you say I already observed base llama with no-finetuning can still perform well with linear scaling factor of 2 with no fine-tuning (at least, up to 4 K ), and we can see it in his chart as well (dotted yellow line), I think the scale of 4 on the base model is a bad example -- it is known there is massive ppl increase when scale $<0.5$ for the untrained model but performs well for 0.5 for some reason.",
    "ntk-5": "The alpha $=4$ also looks promising. But, it does not hurt to have a potentially better method, but we will see with fine-tuning. Everything else I will echo with you: the main problem is that damn cache :)\n$11 \\square$ Reply\nbloc97 OP \u30fb 1y ago\nI'm not sure if it's quite right to say it doesn't consider more tokens after 5k, as the network still stays coherent when generating beyond 5 k tokens, you can think of it having decreasing perplexity until about 6 k tokens, then it has 2 k more tokens that it can generate when reading the previous 6 k . $4 \\square$ Reply\nReturningTarzan \u30fb1y ago \u30fbEdited 1y ago\nExLlama Developer\n\nSkip to main content\naverage over lots of examples to rule out that that it's not just the sample text getting more surprising. $4 \\square$ Reply\nbloc97 OP \u30fb1y ago \u30fbEdited 1y ago\nPerplexity increasing does not necessarily mean that the network is not able to retrieve from and attend to previous tokens. Perplexity is a good indicator for open-ended generation, but usually is not that good at determining whether the network \"remembers\" past tokens. An obvious edge case could be you hiding a password inside of a document that is just full of $A$ repeating, eg:\n\"AAAA[...x2000]AAAAAThe password is: 86763AAAAAA[...x2000]AAA\"\nIf then you asked the question: \"What is the password?\"\n\nWhether the network can respond successfully or not will mostly be independent of perplexity. A network that only assumes the whole text is A will only have a very tiny increase in perplexity because it was surprised to see numbers instead of $A$. Meanwhile a network with high perplexity could still be surprised for the whole prompt because it finds it very suprising that someone would be spamming A on the keyboard, but still correctly be able to retrieve and give the correct password, no matter where that password was located (beginning, middle or end). I hope that makes sense, I find this quite hard to explain... However I do admit that my evaluation is lacking substance, as I should have provided PPL scores for the \"sliding window\" approach, so that we can see for sure that PPL (whether increasing or not) with the new method is actually lower than just truncating previous tokens. I might get to that when I have time, but my preliminary tests show that even at alpha $=16$ with very high perplexity, the network is able to attend to all the context size, however due to high PPL it hallucinates and loses coherence if you let generate for more than a few words... ## 5 Reply\n\nReturningTarzan \u30fb1y ago\nExLlama Developer\nPerplexity doesn't tell the whole story, no. But in a sequence that \"makes sense\", having more context to work with should, on average, make each subsequent token less surprising. Talking here about a natural language, of course, not a sequence that tries to break the patterns that the model is trained on, although even in a sequence of all A's the model should still be less and less surprised with each successive A. I think the best way to really measure would be to fix the sequence being evaluated while providing varying amounts of past context relevant to it. l.e. start at some position n in a long sequence and run inference on tokens [n-a*x:n+b], for some constants a and b and increasing values of $x$, while measuring the average perplexity only on $[n: n+b]$. As $x$ increases, the ground truth at [n:n+b] should become less and less surprising, until the model reaches some limit to the amount of context it can process, one way or another. Skip to main content\n\nI'm out of my Element but wouldn't there still be value for prose generation? Maybe I'm misunderstanding what you're responding to. ![](https://cdn.mathpix.com/cropped/2024_09_12_dbe32765baccd1d0b68bg-11.jpg?height=183&width=533&top_left_y=414&top_left_x=336)\n\nIf the model isn't actually attending to tokens 1-1000 in a 6000 token sequence, you'll get the same result by not including tokens 1-1000 in the first place. It'll just be faster. But really you want the model to care about the whole context. And whether it does or not is reflected in perplexity, which is a measure of how \"surprised\" the model is by the ground truth. Having more context should make it easier for the model to predict what's coming, which is the flip side of its ability to generate coherent text. If perplexity bottoms out at some point it means you're no longer gaining any predictive power from adding more context, so you may as well not. ![](https://cdn.mathpix.com/cropped/2024_09_12_dbe32765baccd1d0b68bg-11.jpg?height=184&width=512&top_left_y=1087&top_left_x=401)\n\nThanks for the reply\n$1 \\square$ Reply\n\n## ironborn123 \u30fb1y ago\n\nInterestingly, Proust's Remembrance of Things Past is generally regarded as the longest book at 1.3 mil words. so if tokens were words, then meta's 600x context would almost be able to consume it whole. Although currently tokens are on average half a word, so the book would be around 2.6 mil tokens. A cool benchmark for an Ilm to achieve one day. $1 \\square$ Reply\nLetterRip \u30fb 1y ago\ntokens are generally $3 / 4$ of a word. $1 \\square$ Reply\nmrjackspade \u30fb 1y ago\nHow long until we can summarize \"The Loud House: Revamped\"? $$\n1 \\square \\text { Reply }\n$$\n\nkryptkpr \u30fb1y ago\nLlama 3\nFantastic results! It continuously blows my mind how the most interesting work on ML is happening on a tiny subreddit. 18 Reply\n$8 \\square$ Reply\nardentis_ignis \u30fb 1y ago\nThis is genuinely mind-blowing! I'm incredibly eager to experience firsthand the future you're both ingeniously designing! u/kaiokendev and $u /$ bloc97, you are awe-inspiring. Your dedication, effort, and particularly your ingenuity stand as a beacon for all to admire. The fact that you've achieved such extraordinary results without the support of any companies or universities is a testament to your skills and determination. You're setting a formidable precedent, showcasing how passion, hard work, and innovative thinking can result in unparalleled achievements. I'm thoroughly impressed by your accomplishments and wait with bated breath to see what you'll pioneer next! Keep up the phenomenal work - you are truly making a significant impact. 12\nReply\n\nSingle_Ring4886 \u30fb1y ago\nYou are great! 65 Reply\n\nObiWanCanShowIMe \u30fb1y ago\nThis is exactly why AI will help humaniy is crazy ways. OP found something right out in the open and applied it. Imagine an Al with access finding everything that is right out in the open that no one is currently looking at or piecing together. The implications for general research are crazy. 11 Reply\nsolidsnakeblue \u30fb 1y ago\n\nThis is exactly why Al will help humaniy is crazy ways. OP found something right out in the open and applied it. Imagine an Al with access finding everything that is right out in the open that no one is currently looking at or piecing together. The implications for general research are crazy. This application of AI is what gets me the most excited. ![](https://cdn.mathpix.com/cropped/2024_09_12_dbe32765baccd1d0b68bg-12.jpg?height=173&width=587&top_left_y=2389&top_left_x=169)\n\nDo we have an AI that can reason yet? I know we can test for reason, but those standardized tests are designed for humans without eidetic memory. $2 \\square$ Reply\n\nSkip to main content\n\nYeah of course, this method only changes the initial RoPE cache values in huggingface, it does not touch anything related to the model's inference code. $3 \\square$ Reply\nklop2031 \u30fb 1y ago\nThis community is amazing! 4 Reply\npseudonerv \u30fb 1y ago\ncan you eli18 how do you go from NTK theory to\nbase $=$ base ${ }^{*}$ a $^{* *}(\\operatorname{dim} /(\\operatorname{dim}-2))$\n??? $4 \\quad$ Reply\nbloc97 OP \u30fb1y ago \u30fb Edited 1y ago\n60. So for each second, the minute hand turns $1 / 60$ th of a minute, and for each minute, the hour hand turns $1 / 60$ th. Now if you slowed down time by a factor of $4 x$, that is a linear RoPE scaling used in SuperHOT. Unfortunately now it is really really hard to distinguish each second, because now the seconds hand barely moves each second. So if someone gave you two different times, which is only different by a single second, you won't be able to distinguish them from afar (let's say the NNs have myopia because that's basically what NTK predicts)\n\nNow NTK-Aware RoPE scaling does not slow down the seconds. One second is still one second, but it slows down minutes by a factor of let's say 1.5 , and the hours by a factor of 2 . This way you can fit 90 minutes in a hour, and fit 24 hours in half a day. So now you basically have a clock that can measure 129.6 k seconds instead of 43.2 k seconds. Because you don't need a precise measurement of the hour hand when looking at the time, scaling the hours more compared to seconds is crucial. You don't want to lose the precision of the seconds hand, but you can afford to lose precision on the minutes hand and even more on the hours hand. Then, it's just a matter of deriving the base change formula in order to obtain such a scaling. (where less precise dimensions are scaled more and more)\n\nI hope that makes sense! Edit: Fixed small calculation error, the seconds shouldn't change... $20 \\square$ Reply\npseudonerv \u30fb 1y ago\nThanks for the detailed eli14. So using my 14 yo math skill, the factor,\n$a^{* *}(\\operatorname{dim} /(\\operatorname{dim}-2))$\nis just a constant\n$8^{* *}(128 / 126)$\n\nThe angle theta now have an additional factor of $8^{\\star *}(-2(\\mathrm{i}-1) / 126)$.",
    "ntk-6": "For $\\mathrm{i}=1$, the factor is 1 . for $\\mathrm{i}=\\mathrm{d} / 2=64$, the factor is $1 / 8$. Perfect! 35 Reply\ndisperaller \u30fb3mo ago\nHi sir, the math is quite straight forward. However, according to this post, somehow i got confused again (gradientai/Llama-3-8B-Instruct-262k $\\cdot$ Hugging Face). Gradient, they use NTKaware to expand Ilama3 8 b from 8 k to 65 k , then from 65 k to 262 k , the rope theta they used to expand from $8 k$ to $65 k$ is 15.3 million, don't see how this 15.3 million calculates since $65 / 8$ should be about 8, and times the original llama3 rope theta ( 0.5 million), should be 4 m instead of 15.3 m .",
    "ntk-7": "I was hoping someone could help explain the math behind this, thanks in advance. Skip to main content\n\nIcaruswept $\\cdot 1 y$ ago\nThis is very cool. Please do a short paper or post somewhere so that it can be referred to in literature in the field. 4 Reply\n\nBackgroundFeeling707 \u30fb1y ago\nHow could I test this in Ilama.cpp? 3 Reply\n\nIgoory \u30fb1y ago \u30fbEdited 1y ago\nYou would have to compile it, after applying a patch to ggml.c\nFrom what I could tell it's just a matter of changing the lines:\nconst float theta_scale $=\\operatorname{powf}\\left(10000.0,-2.0 f / n \\_d i m s\\right) ;$\nto\nconst float theta_scale $=\\operatorname{powf(10000.0*}$ powf(8.0, n_dims / (n_dims - 2.0)), -2.0f/n_dims);\n$6 \\quad \\square$ Reply\n\nBackgroundFeeling707 \u30fb1y ago\ngreat, thanks! $1 \\square$ Reply\n(i)\nambient_temp_xeno \u30fb 1y ago\nLlama 65B\nJust to check, is this on the regular source code or a PR we already had? 1 Reply\n\nIgoory \u30fb 1y ago\nOn the regular source code, but you will also need the scratch buffer patch from the PR\n3 Reply\nambient_temp_xeno \u30fb1y ago\nLlama 65B\nExcellent, thanks! 15 Reply\nambient_temp_xeno $\\cdot 1$ y ago $\\cdot$ Edited 1y ago\nLlama 65B\nIt works. Skip to main content\n\nHow does VRAM behave? 2\nReply\nbloc97 OP \u30fb1y ago\nExtremely bad, as expected VRAM usage grows quadratically, I had to stop at 12 k tokens using the original huggingface transformers implementation. Maybe better attention methods would reduce vram requirements, but it is not the focus of this work... 5 Reply\ntronathan $\\cdot 1 y$ ago \u30fbEdited 1y ago\nForgive my ignorance; Do you happen to know, or have a general sense, of how exllama's vram usage compares to HF transformers in this regard? afaik exllama / exllama_hf uses a much more vram-efficient algorithm. You may want to look into this (using text-generation-webui, you can load it with `--loader exllama`). I am curious to hear some concrete numbers on how VRAM scales with context length on various models (7/13/33) using exllama.",
    "ntk-8": "I'm sure this information will surface soon!",
    "ntk-9": "Really amazing work! Thank you! The ELI14 explanation was most excellent. ![](https://cdn.mathpix.com/cropped/2024_09_12_dbe32765baccd1d0b68bg-16.jpg?height=164&width=432&top_left_y=1420&top_left_x=275)\nin my experience it seems to scale linearly but the compute time does increase quadratically. 3 Reply\n\nAlternative_World936 \u30fb 1y ago \u30fbEdited 1y ago\nThat's Cool!",
    "ntk-10": "From my understanding, we scale the base up to achieve non-linear interpolation. However, according to the code, you put the scaling like:\nwhy do we need this \\alpha^ ${ }^{\\text {dim }} /$ dim-2\\}, can we simply scale the base up with alpha ? $2 \\square$ Reply\nmaratonininkas \u30fb1y ago\nThis will definitely work with just alpha\n$2 \\square$ Reply\n<img class=\"imgSvg\" id = \"m0zx6ptbwkvh7ffsho\" src=\"data:image/svg+xml;base64,PHN2ZyBpZD0ic21pbGVzLW0weng2cHRid2t2aDdmZnNobyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMjI2IDEyMy44MzkzODY1MjAyODkzNSIgc3R5bGU9IndpZHRoOiAyMjUuNzUwMDI0NDg2NDc3MjNweDsgaGVpZ2h0OiAxMjMuODM5Mzg2NTIwMjg5MzVweDsgb3ZlcmZsb3c6IHZpc2libGU7Ij48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTB6eDZwdGJ3a3ZoN2Zmc2hvLTEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iMTUyLjI1MDAyNDQ4NjQ4OTk2IiB5MT0iNDguMjc5ODQyNjMxMTIwNDQ1IiB4Mj0iMTgzLjc1MDAyNDQ4NjQ3NzIzIiB5Mj0iNDguMjc5ODcwOTA1NzM0ODEiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0weng2cHRid2t2aDdmZnNoby0zIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjEzNi40OTk5OTk5OTk5NjE5NyIgeTE9Ijc1LjU1OTYyODcxMzAxMjA3IiB4Mj0iMTUyLjI1MDAyNDQ4NjQ4OTk2IiB5Mj0iNDguMjc5ODQyNjMxMTIwNDQ1Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMHp4NnB0Yndrdmg3ZmZzaG8tNSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSIxMDQuOTk5OTk5OTk5OTc0NjMiIHkxPSI3NS41NTk2MDA0MzgzOTc3MSIgeDI9IjEzNi40OTk5OTk5OTk5NjE5NyIgeTI9Ijc1LjU1OTYyODcxMzAxMjA3Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMHp4NnB0Yndrdmg3ZmZzaG8tNyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI4NS45MTQ2MTY0NjczNTg5NyIgeTE9Ijk3LjI3NjQwMzUwNDUyNTE2IiB4Mj0iOTguNTE0NjM2MDU2NTgxMzQiIHkyPSI3NS40NTI1NzQ2MzkwMTE4MyI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTB6eDZwdGJ3a3ZoN2Zmc2hvLTkiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iODkuMjQ5OTc1NTEzNDQ2NjciIHkxPSIxMDIuODM5Mzg2NTIwMjg5MzUiIHgyPSIxMDQuOTk5OTk5OTk5OTc0NjMiIHkyPSI3NS41NTk2MDA0MzgzOTc3MSI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTB6eDZwdGJ3a3ZoN2Zmc2hvLTExIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9Ijg5LjI1MDAyNDQ4NjUxNTI0IiB5MT0iNDguMjc5Nzg2MDgxODkxNjg2IiB4Mj0iMTA0Ljk5OTk5OTk5OTk3NDYzIiB5Mj0iNzUuNTU5NjAwNDM4Mzk3NzEiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0weng2cHRid2t2aDdmZnNoby0xMyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI1Ny43NDk5NzU1MTM0NTkzNiIgeTE9IjEwMi44MzkzNTgyNDU2NzUwMiIgeDI9Ijg5LjI0OTk3NTUxMzQ0NjY3IiB5Mj0iMTAyLjgzOTM4NjUyMDI4OTM1Ij48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMHp4NnB0Yndrdmg3ZmZzaG8tMTUiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNjAuOTAwMDE5Mzk3MDk2MSIgeTE9IjUzLjk0OTc2MDYzNDczNjUwNiIgeDI9Ijg2LjEwMDAxOTM5NzA4NTk0IiB5Mj0iNTMuOTQ5NzgzMjU0NDI3OTciPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0weng2cHRid2t2aDdmZnNoby0xNyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI1Ny43NTAwMjQ0ODY1Mjc5NSIgeTE9IjQ4LjI3OTc1NzgwNzI3NzM2IiB4Mj0iODkuMjUwMDI0NDg2NTE1MjQiIHkyPSI0OC4yNzk3ODYwODE4OTE2ODYiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0weng2cHRid2t2aDdmZnNoby0xOSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI4OS4yNTAwMjQ0ODY1MTUyNCIgeTE9IjQ4LjI3OTc4NjA4MTg5MTY4NiIgeDI9IjEwNS4wMDAwNDg5NzMwNDMxNiIgeTI9IjIxIj48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMjAlIj48L3N0b3A+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjEwMCUiPjwvc3RvcD48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0ibGluZS1tMHp4NnB0Yndrdmg3ZmZzaG8tMjEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iNDguNDg1MzY0MTM1NTE3IiB5MT0iNzUuNDUyNTI5NzMyMzk2OTMiIHgyPSI2MS4wODUzNDQ1NDYyODQ1IiB5Mj0iOTcuMjc2MzgxMjE3NjAxNzQiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0weng2cHRid2t2aDdmZnNoby0yMyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI0MiIgeTE9Ijc1LjU1OTU0Mzg4OTE2OTAyIiB4Mj0iNTcuNzQ5OTc1NTEzNDU5MzYiIHkyPSIxMDIuODM5MzU4MjQ1Njc1MDIiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PGxpbmVhckdyYWRpZW50IGlkPSJsaW5lLW0weng2cHRid2t2aDdmZnNoby0yNSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI0MiIgeTE9Ijc1LjU1OTU0Mzg4OTE2OTAyIiB4Mj0iNTcuNzUwMDI0NDg2NTI3OTUiIHkyPSI0OC4yNzk3NTc4MDcyNzczNiI+PHN0b3Agc3RvcC1jb2xvcj0iY3VycmVudENvbG9yIiBvZmZzZXQ9IjIwJSI+PC9zdG9wPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIxMDAlIj48L3N0b3A+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImxpbmUtbTB6eDZwdGJ3a3ZoN2Zmc2hvLTI3IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjEwNS4wMDAwNDg5NzMwNDMxNiIgeTE9IjIxIiB4Mj0iMTM2LjUwMDA0ODk3MzAzMDUyIiB5Mj0iMjEuMDAwMDI4Mjc0NjE0MjgiPjxzdG9wIHN0b3AtY29sb3I9ImN1cnJlbnRDb2xvciIgb2Zmc2V0PSIyMCUiPjwvc3RvcD48c3RvcCBzdG9wLWNvbG9yPSJjdXJyZW50Q29sb3IiIG9mZnNldD0iMTAwJSI+PC9zdG9wPjwvbGluZWFyR3JhZGllbnQ+PC9kZWZzPjxtYXNrIGlkPSJ0ZXh0LW1hc2stbTB6eDZwdGJ3a3ZoN2Zmc2hvIj48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ3aGl0ZSI+PC9yZWN0PjxjaXJjbGUgY3g9IjEzNi40OTk5OTk5OTk5NjE5NyIgY3k9Ijc1LjU1OTYyODcxMzAxMjA3IiByPSI3Ljg3NSIgZmlsbD0iYmxhY2siPjwvY2lyY2xlPjwvbWFzaz48c3R5bGU+CiAgICAgICAgICAgICAgICAuZWxlbWVudC1tMHp4NnB0Yndrdmg3ZmZzaG8gewogICAgICAgICAgICAgICAgICAgIGZvbnQ6IDE0cHggSGVsdmV0aWNhLCBBcmlhbCwgc2Fucy1zZXJpZjsKICAgICAgICAgICAgICAgICAgICBhbGlnbm1lbnQtYmFzZWxpbmU6ICdtaWRkbGUnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLnN1Yi1tMHp4NnB0Yndrdmg3ZmZzaG8gewogICAgICAgICAgICAgICAgICAgIGZvbnQ6IDguNHB4IEhlbHZldGljYSwgQXJpYWwsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIDwvc3R5bGU+PGcgbWFzaz0idXJsKCN0ZXh0LW1hc2stbTB6eDZwdGJ3a3ZoN2Zmc2hvKSI+PGxpbmUgeDE9IjE1Mi4yNTAwMjQ0ODY0ODk5NiIgeTE9IjQ4LjI3OTg0MjYzMTEyMDQ0NSIgeDI9IjE4My43NTAwMjQ0ODY0NzcyMyIgeTI9IjQ4LjI3OTg3MDkwNTczNDgxIiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTB6eDZwdGJ3a3ZoN2Zmc2hvLTEnKSI+PC9saW5lPjxsaW5lIHgxPSIxMzYuNDk5OTk5OTk5OTYxOTciIHkxPSI3NS41NTk2Mjg3MTMwMTIwNyIgeDI9IjE1Mi4yNTAwMjQ0ODY0ODk5NiIgeTI9IjQ4LjI3OTg0MjYzMTEyMDQ0NSIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0weng2cHRid2t2aDdmZnNoby0zJykiPjwvbGluZT48bGluZSB4MT0iMTA0Ljk5OTk5OTk5OTk3NDYzIiB5MT0iNzUuNTU5NjAwNDM4Mzk3NzEiIHgyPSIxMzYuNDk5OTk5OTk5OTYxOTciIHkyPSI3NS41NTk2Mjg3MTMwMTIwNyIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0weng2cHRid2t2aDdmZnNoby01JykiPjwvbGluZT48bGluZSB4MT0iODUuOTE0NjE2NDY3MzU4OTciIHkxPSI5Ny4yNzY0MDM1MDQ1MjUxNiIgeDI9Ijk4LjUxNDYzNjA1NjU4MTM0IiB5Mj0iNzUuNDUyNTc0NjM5MDExODMiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMHp4NnB0Yndrdmg3ZmZzaG8tNycpIj48L2xpbmU+PGxpbmUgeDE9Ijg5LjI0OTk3NTUxMzQ0NjY3IiB5MT0iMTAyLjgzOTM4NjUyMDI4OTM1IiB4Mj0iMTA0Ljk5OTk5OTk5OTk3NDYzIiB5Mj0iNzUuNTU5NjAwNDM4Mzk3NzEiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMHp4NnB0Yndrdmg3ZmZzaG8tOScpIj48L2xpbmU+PGxpbmUgeDE9Ijg5LjI1MDAyNDQ4NjUxNTI0IiB5MT0iNDguMjc5Nzg2MDgxODkxNjg2IiB4Mj0iMTA0Ljk5OTk5OTk5OTk3NDYzIiB5Mj0iNzUuNTU5NjAwNDM4Mzk3NzEiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMHp4NnB0Yndrdmg3ZmZzaG8tMTEnKSI+PC9saW5lPjxsaW5lIHgxPSI1Ny43NDk5NzU1MTM0NTkzNiIgeTE9IjEwMi44MzkzNTgyNDU2NzUwMiIgeDI9Ijg5LjI0OTk3NTUxMzQ0NjY3IiB5Mj0iMTAyLjgzOTM4NjUyMDI4OTM1IiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTB6eDZwdGJ3a3ZoN2Zmc2hvLTEzJykiPjwvbGluZT48bGluZSB4MT0iNjAuOTAwMDE5Mzk3MDk2MSIgeTE9IjUzLjk0OTc2MDYzNDczNjUwNiIgeDI9Ijg2LjEwMDAxOTM5NzA4NTk0IiB5Mj0iNTMuOTQ5NzgzMjU0NDI3OTciIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMHp4NnB0Yndrdmg3ZmZzaG8tMTUnKSI+PC9saW5lPjxsaW5lIHgxPSI1Ny43NTAwMjQ0ODY1Mjc5NSIgeTE9IjQ4LjI3OTc1NzgwNzI3NzM2IiB4Mj0iODkuMjUwMDI0NDg2NTE1MjQiIHkyPSI0OC4yNzk3ODYwODE4OTE2ODYiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMHp4NnB0Yndrdmg3ZmZzaG8tMTcnKSI+PC9saW5lPjxsaW5lIHgxPSI4OS4yNTAwMjQ0ODY1MTUyNCIgeTE9IjQ4LjI3OTc4NjA4MTg5MTY4NiIgeDI9IjEwNS4wMDAwNDg5NzMwNDMxNiIgeTI9IjIxIiBzdHlsZT0ic3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS13aWR0aDoxLjI2IiBzdHJva2U9InVybCgnI2xpbmUtbTB6eDZwdGJ3a3ZoN2Zmc2hvLTE5JykiPjwvbGluZT48bGluZSB4MT0iNDguNDg1MzY0MTM1NTE3IiB5MT0iNzUuNDUyNTI5NzMyMzk2OTMiIHgyPSI2MS4wODUzNDQ1NDYyODQ1IiB5Mj0iOTcuMjc2MzgxMjE3NjAxNzQiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMHp4NnB0Yndrdmg3ZmZzaG8tMjEnKSI+PC9saW5lPjxsaW5lIHgxPSI0MiIgeTE9Ijc1LjU1OTU0Mzg4OTE2OTAyIiB4Mj0iNTcuNzQ5OTc1NTEzNDU5MzYiIHkyPSIxMDIuODM5MzU4MjQ1Njc1MDIiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMHp4NnB0Yndrdmg3ZmZzaG8tMjMnKSI+PC9saW5lPjxsaW5lIHgxPSI0MiIgeTE9Ijc1LjU1OTU0Mzg4OTE2OTAyIiB4Mj0iNTcuNzUwMDI0NDg2NTI3OTUiIHkyPSI0OC4yNzk3NTc4MDcyNzczNiIgc3R5bGU9InN0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utd2lkdGg6MS4yNiIgc3Ryb2tlPSJ1cmwoJyNsaW5lLW0weng2cHRid2t2aDdmZnNoby0yNScpIj48L2xpbmU+PGxpbmUgeDE9IjEwNS4wMDAwNDg5NzMwNDMxNiIgeTE9IjIxIiB4Mj0iMTM2LjUwMDA0ODk3MzAzMDUyIiB5Mj0iMjEuMDAwMDI4Mjc0NjE0MjgiIHN0eWxlPSJzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLXdpZHRoOjEuMjYiIHN0cm9rZT0idXJsKCcjbGluZS1tMHp4NnB0Yndrdmg3ZmZzaG8tMjcnKSI+PC9saW5lPjwvZz48Zz48dGV4dCB4PSIxODMuNzUwMDI0NDg2NDc3MjMiIHk9IjQ4LjI3OTg3MDkwNTczNDgxIiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSIxNTIuMjUwMDI0NDg2NDg5OTYiIHk9IjQ4LjI3OTg0MjYzMTEyMDQ0NSIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iMTM2LjQ5OTk5OTk5OTk2MTk3IiB5PSI2Ny42ODQ2Mjg3MTMwMTIwNyIgY2xhc3M9ImVsZW1lbnQtbTB6eDZwdGJ3a3ZoN2Zmc2hvIiBmaWxsPSJjdXJyZW50Q29sb3IiIHN0eWxlPSIKICAgICAgICAgICAgICAgIHRleHQtYW5jaG9yOiBzdGFydDsKICAgICAgICAgICAgICAgIHdyaXRpbmctbW9kZTogdmVydGljYWwtcmw7CiAgICAgICAgICAgICAgICB0ZXh0LW9yaWVudGF0aW9uOiB1cHJpZ2h0OwogICAgICAgICAgICAgICAgbGV0dGVyLXNwYWNpbmc6IC0xcHg7CiAgICAgICAgICAgICAgICBkaXJlY3Rpb246IGx0cjsKICAgICAgICAgICAgIj48dHNwYW4+TzwvdHNwYW4+PC90ZXh0Pjx0ZXh0IHg9IjEzNi40OTk5OTk5OTk5NjE5NyIgeT0iNzUuNTU5NjI4NzEzMDEyMDciIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjEwNC45OTk5OTk5OTk5NzQ2MyIgeT0iNzUuNTU5NjAwNDM4Mzk3NzEiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9Ijg5LjI0OTk3NTUxMzQ0NjY3IiB5PSIxMDIuODM5Mzg2NTIwMjg5MzUiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjU3Ljc0OTk3NTUxMzQ1OTM2IiB5PSIxMDIuODM5MzU4MjQ1Njc1MDIiIGNsYXNzPSJkZWJ1ZyIgZmlsbD0iI2ZmMDAwMCIgc3R5bGU9IgogICAgICAgICAgICAgICAgZm9udDogNXB4IERyb2lkIFNhbnMsIHNhbnMtc2VyaWY7CiAgICAgICAgICAgICI+PC90ZXh0Pjx0ZXh0IHg9IjQyIiB5PSI3NS41NTk1NDM4ODkxNjkwMiIgY2xhc3M9ImRlYnVnIiBmaWxsPSIjZmYwMDAwIiBzdHlsZT0iCiAgICAgICAgICAgICAgICBmb250OiA1cHggRHJvaWQgU2Fucywgc2Fucy1zZXJpZjsKICAgICAgICAgICAgIj48L3RleHQ+PHRleHQgeD0iNTcuNzUwMDI0NDg2NTI3OTUiIHk9IjQ4LjI3OTc1NzgwNzI3NzM2IiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSI4OS4yNTAwMjQ0ODY1MTUyNCIgeT0iNDguMjc5Nzg2MDgxODkxNjg2IiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSIxMDUuMDAwMDQ4OTczMDQzMTYiIHk9IjIxIiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48dGV4dCB4PSIxMzYuNTAwMDQ4OTczMDMwNTIiIHk9IjIxLjAwMDAyODI3NDYxNDI4IiBjbGFzcz0iZGVidWciIGZpbGw9IiNmZjAwMDAiIHN0eWxlPSIKICAgICAgICAgICAgICAgIGZvbnQ6IDVweCBEcm9pZCBTYW5zLCBzYW5zLXNlcmlmOwogICAgICAgICAgICAiPjwvdGV4dD48L2c+PC9zdmc+\"/>\n\nSexPanther_Bot \u30fb1y ago\n$60 \\%$ of the time, it works every time\n\nI am confused, what does $60 \\%$ of the time mean?",
    "ntk-11": "$$\n2 \\square \\text { Reply }\n$$\n\nFeeling-Currency-360 \u30fb1y ago\nwell so coincidental that the base did indeed now grow bigger with the base model's now being up to 4 k . 1 Reply\n\nJonathanFly \u30fb1y ago\nDoes anyone have or know of an example implementation in plain pytorch, not huggingface transformers. Like something you could plug into https://github.com/karpathy/nanoGPT ?",
    "ntk-12": "This is probably trivial for anyone who knows what they are doing but I could use an example... Reply\nfemtoGPT? 1 Reply\nkache_y \u30fb1y ago\nCongratulations on the code llama cite\n$2 \\square$ Reply\nshamblack19 \u30fb3mo ago\nHey Im trying to understand the math here and have some questions:\n\n```\nbase = base * a ** (dim / (dim-2)) #Base change formula\n```\n\n1: Seems like the same base will be used at all positions along the embedding dimension, right? I thought the goal was to increase the base at higher embedding positions, where is that happening here? 2: I don't understand what (dim/(dim-2)) is doing. Why (dim-2)?? Let me know if my understanding is wrong, still trying to wrap my head around the intuition\n\n$$\n1 \\square \\text { Reply }\n$$\n\npower of $-2 i / d$ will change based on $i$, so if $i$ is small, then this thing will become 1 , has no effect on the low dimension values, for large $i$, this thing will also grow, causing the the high dimension values to show interpolation effects.",
    "ntk-13": "2. me neither :<\n$2 \\square$ Reply\nshamblack19 \u30fb3mo ago\nYou're awesome!!!! I actually had to go onto Desmos and plot out the math but I fully understand it now!! Really appreciate you haha\n\nGlad you're also confused about that exponent. It always evaluates to a constant that's close to 1, I'm thinking it's redundant. $1 \\square$ Reply\n\nDependent-Pomelo-853 \u30fb1y ago\nHas anyone been able to run the Colab? For me it stays stuck saying I need to install accelerate, when I literally have it imported. $1 \\square$ Reply\n\n![](https://cdn.mathpix.com/cropped/2024_09_12_dbe32765baccd1d0b68bg-18.jpg?height=117&width=115&top_left_y=1355&top_left_x=165)\ngijs4g \u30fb1y ago\n!pip install accelerate $-U$\n\nAfter installing, then restart runtime\n1 Reply\n\nPhotographMaster8285 \u30fb1y ago\nGreat work! Have you ever tested long-distance information, such as \"Please tell me the author's email\"? I tried it on a 7B Llama, and while it did generate coherent sentences, it didn't retain long-distance information like the author's email address. $1 \\square$ Reply\nzju1997_2022 \u30fb 1y ago\ndamn hot! $1 \\leftrightarrows$ Reply\n\nSirius-ctrl \u30fb1y ago\nHi, thanks for the great work. Do you mind sharing the code that you use to plot those figures? I use the same technique on original Llama ckpt but it seems like the perplexity is super high. I think their might be some bugs for my code but I cannot fine them. 1 Reply\n\nSkip to main content\n\nCould anyone please provide an integration of this approach for vllm? I unfrotunately have no idea how to apply this method in vllm :(\n$1 \\square$ Reply\n\nYesodYIN \u30fb 1y ago\nyour work is pretty good. i think it can be called as RoPE-twister to make it clear to understand\n1 Reply\n\nAdditional_Box_3063 \u30fb1y ago\nI have been facing with oom errors whenever i try to increase the context window of an IIm. The maximum i could output size of 4 k . Anything above is giving me the oom error. I have been trying NTKbased rope for extending the window size to 16k. 4 GPUs make up 128Gb of RAM in the DGX. Is this not enough ?,or am I doing anything wrong? I even set the devices to be auto which distributes the weights across all the devices. does anyone know on how to deal with this error ?? 1 Reply\n\nAccurate-Door3692 \u30fb1y ago\n128Gb VRAM is pretty enough to load model even without LoRA, but you'll be unable to use big context, coz memory consumption will raise immediately during inference and it doesn't matter how much GPUs you have, you'll see that memory all of them would be consumed. Experimenting with Llama2 7B model I noticed that it doesn't matter deploying it on one or two GPUs, during inference behaviour will be the same.",
    "ntk-14": "Can't say what is wrong here... 2 Reply\n\nAdditional_Box_3063 \u30fb1y ago\nSo increasing the context window is a myth ?? Why isn't anyone talking about it?? I have seen fine tuned models beings posted with 16k, 32 k in huggingface. Not sure how to work around with models. Any idea on how to deal with this context? The author in this paper fed the entire research paper to the prompt and it generated the output\n$1 \\square$ Reply\n\nAccurate-Door3692 \u30fb1y ago\nIt's not a myth, but to handle a big context you have to have something like A100 80GB\nI was able to repeat author's experiment on a single RTX 3090 and on two of them. So results I described above. 2\n(\\) Reply\n\nSkip to main content\n$1 \\square$ Reply\n\n## More posts you may like\n\nr/MachineLearning\n[R] Fine-Tuning Language Models with Just Forward Passes\n196 upvotes $\\cdot$ 34 comments\nr/\nr/AskFeminists\nWhy is it \"empowering\" for women to wear revealing clothes? 82 upvotes $\\cdot 66$ comments\nr/leetcode\nday\\#1 neetcode\n128 upvotes $\\cdot$ 16 comments\nr/LocalLLaMA\nExllamaV2, Now With Tensor Parallelism! 102 upvotes $\\cdot$ 42 comments\nr/LocalLLaMA\nSomeone claims to have finetuned Pythia for 8 k context length. 19 upvotes $\\cdot 8$ comments\nr/LocalLLaMA\n\"Today, the diff weights for LLaMA 7B were published which enable it to support context sizes of up to $32 \\mathrm{k}^{\\prime \\prime}$\n131 upvotes $\\cdot$ 24 comments\nr/PersonalFinanceCanada\nWhen did you get involved in your parents' finances? 88 upvotes $\\cdot 69$ comments\nr/LocalLLaMA\nMiniCPM3-4B Released! 139 upvotes $\\cdot$ 28 comments\n\nSkip to main content\n475 upvotes $\\cdot 216$ comments\nr/LocalLLaMA\nPingPong: Role-playing benchmark for LLMs\n137 upvotes $\\cdot$ 37 comments\nr/LocalLLaMA\nNew pruning method, Wanda, can prune LLMs to $50 \\%$ sparsity with no retraining or weight update needed and minimal degradation\n161 upvotes $\\cdot$ 28 comments\nr/MachineLearning\n[D] Does GPT-4-32k eliminates/reduces the use of chunk strategies? 31 upvotes $\\cdot$ 15 comments\nr/LocalLLaMA\nLooking for Ideas: Former AMD Engineer \\& Startup Founder Ready to Build an Open-Source Project\u2014 What Problems Need Solving? 218 upvotes $\\cdot$ 103 comments\nr/LocalLLaMA\nExclude Top Choices (XTC): A sampler that boosts creativity, breaks writing clich\u00e9s, and inhibits nonverbatim repetition, from the creator of DRY\n218 upvotes $\\cdot$ 106 comments\nr/LocalLLaMA\nQwen2 VL 7B: Far More Impressive Than I Thought! 109 upvotes $\\cdot$ 29 comments\nr/LocalLLaMA\nreMind: An Open-Source Digital Memory Assistant\n116 upvotes $\\cdot$ 21 comments\nr/MachineLearning\nLIMA, a 65B-Param LLaMa fine-tuned with standard supervised loss on only 1,000 carefully curated prompts \\& responses, without any RLHF, demonstrates remarkably strong... 309 upvotes $\\cdot$ 29 comments\nr/LocalLLaMA\nClaude-Dev Now With Local LLM support! (Ollama, OpenAI Compatible Servers)\n$[R]$ Tiny Language Models (below 10m parameters or only one transformer block) can generate paragraphs of coherent text and reason...provided training is limited to stories that only contain words... 575 upvotes $\\cdot$ 123 comments\nr/LocalLLaMA\nFlux. 1 converted into GGUF - what interesting opportunity it offers in Ilm space? 134 upvotes $\\cdot$ 60 comments\nr/LocalLLaMA\nReflection 70B lessons learned\n169 upvotes $\\cdot$ 59 comments\nr/ r/ChatGPTCoding\nMy experience with PrivateGPT (Iv\u00e1n Mart\u00ednez's project)\n30 upvotes $\\cdot$ 28 comments\nr/StableDiffusion\nSD's noise schedule is flawed! This new paper investigates it. 386 upvotes $\\cdot$ 122 comments\n$r /$ PygmalionAI\nThe Varying Levels of Getting Started with \"Uncensored\" LLM-Powered Chatbots\n51 upvotes $\\cdot 29$ comments\nr/LocalLLaMA\nCommand R+ Still the GOAT and why we need unaligned models\n268 upvotes $\\cdot$ 68 comments\n\n"
}