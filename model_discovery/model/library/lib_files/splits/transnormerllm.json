{
    "transnormerllm-0": "# TRANSNORMERLLM: A FASTER AND BETTER LARGE LANGUAGE MODEL WITH IMPROVED TRANSNORMER \n\nZhen Qin ${ }^{\\sharp}$, Dong Li ${ }^{\\sharp}$, Weigao Sun ${ }^{\\sharp}$, Weixuan Sun ${ }^{\\sharp}$, Xuyang Shen ${ }^{\\sharp}$,<br>Xiaodong Han, Yunshen Wei, Baohong Lv, Xiao Luo, Yu Qiao, Yiran Zhong*<br>OpenNLPLab, Shanghai AI Laboratory<br>https://github.com/OpenNLPLab/TransnormerLLM\n\n\n#### Abstract\n\nWe present TransNormerLLM, the first linear attention-based Large Language Model (LLM) that outperforms conventional softmax attention-based models in terms of both accuracy and efficiency.",
    "transnormerllm-1": "TransNormerLLM evolves from the previous linear attention architecture TransNormer (Qin et al., 2022a) by making advanced modifications that include positional embedding, linear attention acceleration, gating mechanism, tensor normalization, and inference acceleration and stabilization. Specifically, we use LRPE (Qin et al., 2023b) together with an exponential decay to avoid attention dilution issues while allowing the model to retain global interactions between tokens. Additionally, we propose Lightning Attention, a cutting-edge technique that accelerates linear attention by more than twice in runtime and reduces memory usage by a remarkable four times. To further enhance the performance of TransNormer, we leverage a gating mechanism to smooth training and a new tensor normalization scheme to accelerate the model, resulting in an impressive acceleration of over $20 \\%$. Furthermore, we develop a robust inference algorithm that ensures numerical stability and consistent inference speed, regardless of the sequence length, showcasing superior efficiency during both training and inference stages. We also implement an efficient model parallel schema for TransNormerLLM, enabling seamless deployment on large-scale clusters and facilitating expansion to even more extensive models, i.e., LLMs with 175B parameters. We validate our model design through a series of ablations and train models with sizes of $385 \\mathrm{M}, 1 \\mathrm{~B}$, and 7 B on our self-collected corpus. Benchmark results demonstrate that our models not only match the performance of state-of-the-art LLMs with Transformer but are also significantly faster. ## 1 INTRODUCTION\n\nThe field of Natural Language Processing (NLP) has been revolutionized by the advent of large-scale language models (LLMs) (Touvron et al., 2023a; Biderman et al., 2023, Brown et al., 2020). These models have demonstrated exceptional performance across a multitude of tasks, elevating abilities to comprehend, generate, and interact with human languages in computational frameworks. Previous language modeling development has predominantly centered around Transformer architectures, with seminal models such as vanilla Transformer (Vaswani et al., 2017), GPT series (Radford et al., 2018, 2019, Brown et al., 2020), BERT (Devlin et al., 2019), and BART (Lewis et al., 2019) standing as standard backbones in related fields. The success of Transformer architectures is premised on the softmax attention mechanism, which discerns dependencies among input tokens in a data-driven scheme and has global position awareness, offering the model an effective way to handle the longrange dynamism of natural language. Nevertheless, conventional Transformers are not without their constraints. Primarily, their quadratic time complexity with respect to the sequence length limits their scalability and hampers efficiency in terms of computational resources and time during the training and inference stages. Numerous efficient sequence modeling methods have been proposed in an attempt to reduce the quadratic time complexity to linear (Katharopoulos et al. 2020, Choromanski et al., 2021, Qin et al., 2022b, Zheng\n\n[^0]et al. 2023, 2022). However, there are two reasons that prohibit them to be applied to LLMs: 1) their performance in language modeling is often unsatisfactory; 2) they do not demonstrate speed advantages in real-world scenarios. In this paper, we introduce TransNormerLLM, the first linear attention-based LLM that surpasses conventional softmax attention in both accuracy and efficiency. The development of TransNormerLLM builds upon the foundations of the previous linear attention architecture, TransNormer (Qin et al., 2022a), while incorporating a series of advanced modifications to achieve superior performance. The key enhancements in TransNormerLLM include positional embedding, linear attention acceleration, gating mechanism, tensor normalization, and inference acceleration. One notable improvement is the replacement of the TransNormer's DiagAttention with Linear Attention to enhance global interactions. To address the issue of dilution, we introduced LRPE (Qin et al., 2023b) with exponential decay (Press et al., 2022, Qin et al., 2023a; Peng et al. 2023a). Lightning Attention, a novel technique that significantly accelerates linear attention during training is introduced, resulting in a more than two-fold improvement, while also reducing memory usage by four times with IO awareness. Furthermore, we simplified GLU and Normalization, with the latter leading to a $20 \\%$ speedup. A robust inference algorithm ensures the stability of numerical values and constant inference speed, regardless of the sequence length, thereby enhancing the efficiency of our model during both training and inference stages. We validate the efficacy of TransNormerLLM on our self-collected pre-train corpus, which is more than 6 TB in size and contains over 2 trillion tokens. We expand the original TransNormer model, ranging from 385 M to 175 B parameters, and benchmark models with sizes of $385 \\mathrm{M}, 1 \\mathrm{~B}$, and 7 B . The benchmark results demonstrate that our models achieve competitive performance with existing state-of-the-art transformer-based LLMs with similar sizes while also having faster inference speeds. We will open-source our pre-trained models, enabling researchers and practitioners to build upon our work and explore efficient transformer structures in LLMs. ## 2 RELATED WORK\n\n### 2.1 TRANSFORMER-BASED LLMS\n\nIn recent years, the field of Large Language Models (LLMs) has experienced significant advancements. Adhering to the scaling laws (Kaplan et al, 2020), various LLMs with over 100 billion parameters have been introduced, such as GPT-3 (Brown et al. 2020), Gopher (Rae et al., 2022), PaLM (Chowdhery et al., 2022), GLM (Du et al., 2022) and etc.. More specialized models like Galactica (Taylor et al., 2022) have also emerged for specific domains like science. A notable development is Chinchilla (Hoffmann et al., 2022), an LLM model with 70 billion parameters that redefines these scaling laws, focusing on the number of tokens rather than model weights. Furthermore, LLaMA (Touvron et al., 2023a) has also sparked interest due to its promising performance and open-source availability. The discourse around LLMs also encompasses the dynamics between open-source and closed-source models. Open-source models such as BLOOM (Workshop et al., 2023), OPT (Zhang et al. 2022), LLaMA (Touvron et al. 2023a), Pythia (Biderman et al., 2023) and Falcon (Penedo et al.| 2023) are rising to compete against their closed-source counterparts, including GPT-3 (Brown et al. 2020) and Chinchilla (Hoffmann et al., 2022). To speed up training, Sparse Attention (Child et al., 2019; Beltagy et al., 2020) was introduced, but among large models, only GPT-3 adopted it (Brown et al.| 2020; Scao et al., 2022). ### 2.2 NON-TRANSFORMER-BASED LLMS CANDIDATES\n\nDespite the proliferation of Transformer-based large models in the research community, a portion of recent work has prioritized addressing its square time complexity. This focus has led to the exploration and development of a series of model architectures that diverge from the traditional Transformer structure. Among them, four significant contenders-linear transformers, state space model, long convolution, and linear recurrence-have shown promising results as substitutes for self-attention (SA) modules when modeling long sequences. These alternatives are favored for their superior asymptotic time complexity and competitive performances. Linear Transformer Linear Transformer decomposes Softmax Attention into the form of the inner product of hidden representations, which allows it to use the \"Right Product Trick,\" where the product\nof keys and values is computed to avoid the quadratic $n \\times n$ matrix.",
    "transnormerllm-2": "Different methods utilize various hidden representations. For example, Katharopoulos et al. (2020) use 1+elu as an activation function, Qin et al. (2022b) use the cosine function to approximate the properties of softmax, and Ke et al.",
    "transnormerllm-3": "(2021); Zheng et al. (2022; 2023) approximate softmax through theoretical approaches. Although its theoretical complexity is $O\\left(n d^{2}\\right)$, the actual computational efficiency of Linear Attention becomes quite low when used in causal attention due to the need for cumsum operations (Hua et al., 2022).",
    "transnormerllm-4": "On the other hand, most Linear Transformers still exhibit a certain performance gap compared to traditional Transformers (Katharopoulos et al.",
    "transnormerllm-5": "2020; Liu et al. 2022). State Space Model State Space Model is based on the State Space Equation for sequence modeling (Gu et al. 2022b), using special initialization (Gu et al., 2020, 2022a), diagonalization assumptions (Gupta et al., 2022), and some techniques (Dao et al., 2022b) to achieve performance comparable to Transformers. On the other hand, due to the characteristics of the State Space Equation, it enables inference to be conducted within constant complexity (Gu et al., 2022b). Long Convolution Long convolution models ( Qin et al. 2023, Fu et al. 2023) utilize a kernel size equal to the input sequence length, facilitating a wider context compared to traditional convolutions. Training these models involves the efficient $O(n \\log n)$ Fast Fourier Transforms (FFT) algorithm. However, long convolutions pose certain challenges, such as the need for causal convolution inference, which necessitates caching all historical computations similar to SA's key-value (KV) cache. The memory requirements for handling long sequences, coupled with the higher inference complexity compared to RNNs, make them less ideal for processing long sequences. Linear RNN Linear RNNs (Orvieto et al. 2023, Peng et al., 2023b), in contrast, stand out as more suitable replacements for SA in long-sequence modeling. A notable example is the RWKV (Peng et al. 2023b) model, a linear RNN-based LLM that has shown competitive performance against similarly scaled GPT models. ## 3 TRANSNORMERLLM\n\n### 3.1 ARCHITECTURE IMPROVEMENT\n\nIn this section, we thoroughly investigate each module of the network and propose several improvements to achieve an optimal balance between efficiency and performance. Below, we outline the key designs of each block along with the inspiration behind each change. For the details of configurations for TransNormerLLM variants from 385M to 175B parameters, see Appendix A\n\n### 3.1.1 IMPROVEMENT 1: PoSITION ENCODING\n\nIn TransNormer, DiagAttention is used at the lower layers to avoid dilution issues. However, this leads to a lack of global interaction between tokens. In TransNormerLLM, we leverage LRPE (Qin et al., 2023b) with exponential decay (Press et al., 2022, Qin et al., 2023a; Peng et al., 2023b) to address this issue, retaining full attention at the lower layers. The expression of our position encoding is as follows:\n\n$$\na_{s t}=\\mathbf{q}_{s}^{\\top} \\mathbf{k}_{t} \\lambda^{s-t} \\exp ^{i \\theta(s-t)}\n$$\n\nwhich we call LRPE-d - Linearized Relative Positional Encoding with exponential decay. Similar to the original LRPE, we set $\\theta$ to be learnable. We empirically find that rather than applying LRPE-d to every layer, applying it to the first layer and keeping other layers with exponential decay can speed up training by approximately $15-20 \\%$ but only with a subtle effect on the performance. Note that this position encoding is fully compatible with Linear Attention, as it can be decomposed with respect to $s$ and $t$ separately. The value of $\\lambda$ for the $h$-th head in the $l$-th layer (assuming there are a total of $H$ heads and $L$ layers) is given by:\n\n$$\n\\lambda=\\exp \\left(-\\frac{8 h}{H} \\times\\left(1-\\frac{l}{L}\\right)\\right)\n$$\n\nHere, $\\frac{8 h}{H}$ corresponds to the decay rate of the $h$-th head, while $\\left(1-\\frac{l}{L}\\right)$ corresponds to the decay rate of the $l$-th layer. The term $\\left(1-\\frac{l}{L}\\right)$ ensures that the Theoretical Receptive Fields (TRF) Qin et al. 2023c) at the lower layers is smaller compared to the higher layers, which aligns with TransNormer's motivation. It should be noted that the decay rate in the last layer is set to 1, allowing each token to attend to global information. We choose $\\lambda$ to be non-learnable since we empirically found that gradients become unstable when $\\lambda$ is learnable, leading to NaN values. ### 3.1.2 IMPROVEMENT 2: GATING MECHANISM\n\nGate can enhance the performance of the model and smooth the training process. In TransNormerLLM, we adopted the approach from Flash (Hua et al. 2022) and used the structure of Gated Linear Attention (GLA) in token mixing:\n\n$$\n\\text { TokenMixer : } \\mathbf{O}=\\operatorname{Norm}\\left(\\mathbf{Q K}^{\\top} \\mathbf{V}\\right) \\odot \\mathbf{U}\n$$\n\nwhere: $\\quad \\mathbf{Q}=\\phi\\left(\\mathbf{X} \\mathbf{W}_{q}\\right), \\mathbf{K}=\\phi\\left(\\mathbf{X} \\mathbf{W}_{k}\\right), \\mathbf{V}=\\mathbf{X} \\mathbf{W}_{v}, \\mathbf{U}=\\mathbf{X} \\mathbf{W}_{u}$. We choose $\\phi$ to be swish (Ramachandran et al. 2017) activation function as we empirically find that it outperforms other activation functions, as shown in Table 6\n\nTo further accelerate the model, we propose Simple GLU (SGLU), which removes the activation function from the original GLU structure as the gate itself can introduce non-linearity. Therefore, our channel mixing becomes:\n\n$$\n\\text { ChannelMixer : } \\mathbf{O}=[\\mathbf{V} \\odot \\mathbf{U}] \\mathbf{W}_{o}, \\mathbf{V}=\\mathbf{X} \\mathbf{W}_{v}, \\mathbf{U}=\\mathbf{X} \\mathbf{W}_{u}\n$$\n\nWe empirically find that not using an activation function in GLU will not lead to any performance loss, as demonstrated in Table 7 . ### 3.1.3 IMPROVEMENT 3: TENSOR NORMALIZATION\n\nWe employ the NormAttention introduced in TransNormer (Qin et al, 2022a) as follows:\n\n$$\n\\mathbf{O}=\\operatorname{Norm}\\left(\\left(\\mathbf{Q K}^{\\top}\\right) \\mathbf{V}\\right)\n$$\n\nThis attention mechanism eliminates the softmax and scaling operation. Moreover, it can be transformed into linear attention through right multiplication:\n\n$$\n\\mathbf{O}=\\operatorname{Norm}\\left(\\mathbf{Q}\\left(\\mathbf{K}^{\\top} \\mathbf{V}\\right)\\right)\n$$\n\nThis linear form allows for recurrent prediction with a complexity of $O\\left(n d^{2}\\right)$, making it efficient during inference. Specifically, we only update $\\mathbf{K}^{\\top} \\mathbf{V}$ in a recurrent manner without computing the full attention matrix. In TransNormerLLM, we replace the RMSNorm with a new simple normalization function called SimpleRMSNorm, abbreviated as SRMSNorm:\n\n$$\n\\operatorname{SRMSNorm}(\\mathbf{x})=\\frac{\\mathbf{x}}{\\|\\mathbf{x}\\|_{2} / \\sqrt{d}}\n$$\n\nWe empirically find that using SRMSNorm does not lead to any performance loss, as demonstrated in the ablation study in Table. 8 . ### 3.1.4 THE OVERALL STRUCTURE\n\nThe overall structure is illustrated in Figure 1. In this structure, the input $\\mathbf{X}$ is updated through two consecutive steps: First, it undergoes Gated Linear Attention (GLA) with the application of SimpleRMSNorm (SRMSNorm) normalization. Then, it goes through the Simple Gated Linear Unit (SGLU) with SRMSNorm normalization again. This overall architecture helps improve the model's performance based on the PreNorm approach. The pseudo-code of the overall process is as follows:\n\n$$\n\\begin{gathered}\n\\mathbf{X}=\\mathbf{X}+\\operatorname{GLA}(\\operatorname{SRMSNorm}(\\mathbf{X})) \\\\\n\\mathbf{X}=\\mathbf{X}+\\operatorname{SGLU}(\\operatorname{SRMSNorm}(\\mathbf{X}))\n\\end{gathered}\n$$\n\n### 3.2 TraINING OPTIMIZATION\n\n### 3.2.1 Lightning Attention\n\nThe structure of linear attention allows for efficient attention calculation with a complexity\n\n![](https://cdn.mathpix.com/cropped/2024_09_17_292835b4009c58e22eb5g-04.jpg?height=659&width=666&top_left_y=1687&top_left_x=1071)\n\nFigure 1: Architecture overview of the proposed model. Each transformer block is composed of a Gated Linear Attention(GLA) for token mixing and a Simple Gated Linear Unit (SGLU) for channel mixing.",
    "transnormerllm-6": "We apply pre-norm for both modules. of $O\\left(n d^{2}\\right)$ through right-multiplication. However, for causal prediction, right-multiplication is not efficient as it necessitates cumsum computation (Hua et al. 2022), which hinders parallelism training. As a result, during training, we continue to use the conventional left-multiplication version. To accelerate attention calculations, we introduce the Lightning Attention algorithm inspired by (Dao 2023, Dao et al. 2022a), which makes our linear attention IO-friendly. It computes the following:\n\n$$\n\\mathbf{O}=\\left(\\mathbf{Q K}{ }^{\\top} \\odot \\mathbf{M}\\right) \\mathbf{V}\n$$\n\nHere, $\\mathbf{M}$ is the attention mask which enables lower triangular causal masking and positional encoding. In the Lightning Attention, we split the inputs $\\mathbf{Q}, \\mathbf{K}, \\mathbf{V}$ into blocks, load them from slow HBM to fast SRAM, then compute the attention output with respect to those blocks. Then we accumulate the final results. The computation speed is accelerated by avoiding the operations on slow HBM. The implementation details of Lightning Attention are shown in Appendix B where Algorithm 3 for forward pass and Algorithm 4 for backward pass. ### 3.2.2 MODEL ParaLLELISM ON TransNORMERLLM\n\nTo effectively execute large-scale pre-training for TransNormerLLM, we have put efforts on system optimization encompassing various dimensions. Specifically, we employ fully sharded data parallelism (FSDP) (Zhao et al. 2023), a technique that shards all model parameters, gradients, and optimizer state tensors across the entire cluster. This strategic partition significantly reduces the memory footprint on each individual GPU, thereby enhancing memory utilization. In our pursuit of greater efficiency, we leverage activation checkpointing (Shoeybi et al. 2019), which minimizes the cached activations in memory during the forward pass. Instead of retaining these activations, they are recomputed when calculating gradients in the backward pass. This approach saves huge GPU memory thus enable to apply bigger batch size. Furthermore, we harness automatic mixed precision (AMP) (Micikevicius et al. 2017) to simultaneously save GPU memory and expedite computational speed. It's noteworthy that in our experimental setup, we employ BFloat16 (Kalamkar et al. 2019) due to its observed advantage in enhancing the training stability of TransNormerLLM models. In addition to the previously mentioned optimization endeavors, we delve deeper into the realm of system engineering by implementing model parallelism specifically tailored to linear transformers, drawing inspiration from Megatron-LM model parallelism (Shoeybi et al., 2019). In a standard transformer model, each transformer layer comprises a self-attention block followed by a two-layer multi-layer perceptron (MLP) block. Megatron-LM model parallelism independently addresses these two constituent blocks. Similarly, within the architecture of TransNormerLLM, characterized by its two primary components, SGLU and GLA, we apply model parallelism to each of these components separately. The intricate details of our model parallelism strategies are elaborated below. Model Parallelism on SGLU Recall the SGLU structure in (5):\n\n$$\n\\mathbf{O}=\\left[\\left(\\mathbf{X} \\mathbf{W}_{v}\\right) \\odot\\left(\\mathbf{X} \\mathbf{W}_{u}\\right)\\right] \\mathbf{W}_{o}\n$$\n\nThe model parallelism adaptation of SGLU is as follows:\n\n$$\n\\left[\\mathbf{O}_{1}^{\\prime}, \\mathbf{O}_{2}^{\\prime}\\right]=\\mathbf{X}\\left[\\mathbf{W}_{v}^{1}, \\mathbf{W}_{v}^{2}\\right] \\odot \\mathbf{X}\\left[\\mathbf{W}_{u}^{1}, \\mathbf{W}_{u}^{2}\\right],=\\left[\\mathbf{X} \\mathbf{W}_{v}^{1}, \\mathbf{X} \\mathbf{W}_{v}^{2}\\right] \\odot\\left[\\mathbf{X} \\mathbf{W}_{u}^{1}, \\mathbf{X} \\mathbf{W}_{u}^{2}\\right]\n$$\n\nwhich splits the weight matrices $\\mathbf{W}_{v}$ and $\\mathbf{W}_{u}$ along their columns and obtains an output matrix splitting along its columns too. Then the split output $\\left[\\mathbf{O}_{1}, \\mathbf{O}_{2}\\right]$ is multiplied by another matrix which is split along its rows as:\n\n$$\n\\mathbf{O}=\\left[\\mathbf{O}_{1}^{\\prime}, \\mathbf{O}_{2}^{\\prime}\\right]\\left[\\mathbf{W}_{o}^{1}, \\mathbf{W}_{o}^{2}\\right]^{\\top}=\\mathbf{O}_{1}^{\\prime} \\mathbf{W}_{o}^{1}+\\mathbf{O}_{2}^{\\prime} \\mathbf{W}_{o}^{2}\n$$\n\nSimilar with model parallelism in Megatron-LM, this whole procedure splits three general matrix multiplies (GEMMs) inside the SGLU block across multiple GPUs and only introduces a single all-reduce collective communication operation in both the forward and backward passes, respectively. Model Parallelism on GLA Recall the GLA block in (3) and (4), its model parallelism version is:\n\n$$\n\\left[\\mathbf{O}_{1}, \\mathbf{O}_{2}\\right]=\\operatorname{SRMSNorm}\\left(\\mathbf{Q K}^{\\top} \\mathbf{V}\\right) \\odot \\mathbf{U}\n$$\n\nwhere:\n\n$$\n\\mathbf{Q}=\\left[\\phi\\left(\\mathbf{X} \\mathbf{W}_{q}^{1}\\right), \\phi\\left(\\mathbf{X} \\mathbf{W}_{q}^{2}\\right)\\right], \\mathbf{K}=\\left[\\phi\\left(\\mathbf{X} \\mathbf{W}_{q}^{1}\\right), \\phi\\left(\\mathbf{X} \\mathbf{W}_{q}^{2}\\right)\\right], \\mathbf{V}=\\mathbf{X}\\left[\\mathbf{W}_{v}^{1}, \\mathbf{W}_{v}^{2}\\right], \\mathbf{U}=\\mathbf{X}\\left[\\mathbf{W}_{u}^{1}, \\mathbf{W}_{u}^{2}\\right]\n$$\n\nNote that in our implementation, we use the combined QKVU projection to improve computation efficiency for linear attention. The obtained split output matrix $\\left[\\mathbf{O}_{1}, \\mathbf{O}_{2}\\right]$ again is multiplied by a weight matrix split along its columns which is similar to (13). ```\nAlgorithm 1 Origin Inference Algorithm\n    Input: \\(\\mathbf{q}_{t}, \\mathbf{k}_{t}, \\mathbf{v}_{t}, t=1, \\ldots, n\\)\n    Output: \\(\\mathbf{o}_{t}, t=1, \\ldots, n\\)\n    Initialize: \\([\\mathrm{kv}]_{0}=\\mathbf{0}\\);\n    for \\(t=1, \\ldots, n\\) do\n        \\([\\mathbf{k v}]_{t}=[\\mathbf{k v}]_{t-1}+\\mathbf{k}_{\\mathbf{t}} \\lambda^{-t} \\mathbf{v}_{t}^{\\top}\\)\n        \\(\\mathbf{o}_{t}=\\mathbf{q}_{t} \\lambda^{t}[\\mathbf{k v}]_{t}\\). end for\nAlgorithm 2 Robust Inference Algorithm\n```\n\n```\n    Input: \\(\\mathbf{q}_{t}, \\mathbf{k}_{t}, \\mathbf{v}_{t}, t=1, \\ldots, n\\);\n    Output: \\(\\mathbf{o}_{t}, t=1, \\ldots, n\\);\n    Initialize: \\([\\overline{\\mathbf{k v}}]_{0}=\\mathbf{0}\\);\n    for \\(t=1, \\ldots, n\\) do\n        \\([\\overline{\\mathbf{k v}}]_{t}=\\lambda[\\overline{\\mathbf{k v}}]_{t-1}+\\mathbf{k}_{\\mathbf{t}} \\mathbf{v}_{t}^{\\top}\\)\n        \\(\\mathbf{o}_{t}=\\mathbf{q}_{t}[\\overline{\\mathbf{k v}}]_{t}\\)\n    end for\n```\n\n\n### 3.3 Robust INFERENCE\n\nIn this section, we discuss the inference problem in TransNormerLLM. It is important to note that the formula 1 can be decomposed into the following form:\n\n$$\na_{s t}=\\left(\\mathbf{q}_{s} \\lambda^{s} \\exp ^{i \\theta s}\\right)^{\\top}\\left(\\mathbf{k}_{t} \\lambda^{-t} \\exp ^{i \\theta t}\\right)\n$$\n\nThis allows TransNormerLLM to perform inference in the form of an RNN.",
    "transnormerllm-7": "Details of the procedure are shown in Algorithm 1 . However, it is worth noting that $\\lambda<1$, which results in:\n\n$$\n\\left\\|\\mathbf{q}_{s} \\lambda^{s} \\exp ^{i \\theta s}\\right\\|_{2}=\\left\\|\\mathbf{q}_{s}\\right\\|_{2} \\lambda^{s} \\rightarrow 0,\\left\\|\\mathbf{k}_{t} \\lambda^{-t} \\exp ^{i \\theta t}\\right\\|_{2}=\\left\\|\\mathbf{k}_{t}\\right\\|_{2} \\lambda^{-t} \\rightarrow \\infty\n$$\n\nleading to numerical precision issues. To avoid these issues, we propose a Robust Inference Algorithm in 2. Since $\\left\\|\\mathbf{q}_{s} \\exp ^{i \\theta s}\\right\\|=\\left\\|\\mathbf{q}_{s}\\right\\|$, $\\left\\|\\mathbf{k}_{t} \\exp ^{i \\theta t}\\right\\|=\\left\\|\\mathbf{k}_{t}\\right\\|$, for simplicity, we will omit LRPE (Qin et al., 2023b) in the subsequent discussions, considering only $a_{s t}=\\mathbf{q}_{s}^{\\top} \\mathbf{k}_{t} \\lambda^{s-t}$. We provide a mathematical proof of $[\\mathbf{k v}]_{t}=$ $\\lambda^{-t}[\\overline{\\mathbf{k v}}]_{t}$ in Appendix C\n\n## 4 EXPERIMENTS\n\nWe use PyTorch (Paszke et al. 2019) and Triton (Tillet et al., 2019) to implement TransNormerLLM in Metaseq framework (Zhang et al., 2022). Our model is trained using Adam optimizer Kingma \\& Ba, 2017), and we employ FSDP to efficiently scale our model to NVIDIA A100 80G clusters. We additionally leverage the model parallel as appropriate to optimize performance. In ablation studies, all models are trained on a sampled corpus from our corpus with 300B tokens. In order to reduce the fluctuation of Losses and PPLs in the tables below, we compute the average Losses and PPLs of the last 1 k iterations as the final metrics. For our benchmark models, we train our 385M, 1B, and 7B models on our corpus for 1 trillion, 1.2 trillion, and 1.4 trillion tokens respectively. We use an input sequence length of 8192 tokens in our pretraining process. For a comprehensive understanding of our corpus, encompassing intricate details such as data preprocessing methods and tokenization procedures, we direct interested readers to Appendix D. ### 4.1 Architecture Ablations\n\nTransformer $\\boldsymbol{v s}$ TransNormerLLM We carried out a meticulous series of comparative tests between our TransNormerLLM and Transformer, spanning over an array of disparate sizes. The comparative performance of these models is clearly illustrated in Table 1. Under identical configurations, it becomes evident that our TransNormerLLM exhibits a superior performance profile compared to Transformer. We observed that TransNormerLLM outperformed Transformer by a remarkable 5\\% at the size of 385 M . More importantly, as the size reached 1B, this superiority became even more pronounced, with an advantage of $9 \\%$ for TransNormerLLM over Transformer. Table 1: Transformer $\\boldsymbol{v s}$ TransNormerLLM. TransNormerLLM performs better than Transformer in size of 385 M and 1B under identical configurations by $5 \\%$ and $9 \\%$, respectively. | Model Size | 385M |  |  | 1B |  |  |\n| :---: | :---: | :---: | :---: | :---: | :---: | :---: |\n| Method | Updates | Loss | PPL | Updates | Loss | PPL |\n| Transformer | 100K | 2.362 | 5.160 | 100K | 2.061 | 4.765 |\n| TransNormerLLM | 100 K | 2.248 | 4.770 | 100 K | 1.896 | 3.729 |\n\nTransNormer vs TransNormerLLM We compare the original TransNormer and the improved TransNormerLLM and the results are shown in Table 2 TransNormerLLM exhibited an enhancement of $2 \\%$ and $1 \\%$ respectively. Table 2: TransNormer vs TransNormerLLM. | Method | Params | Updates | Loss | PPL |\n| :--- | :--- | :--- | :--- | :--- |\n| TransNormerLLM | 385 M | 100 K | 2.248 | 4.770 |\n| TransNormer-T1 | 379 M | 100 K | 2.290 | 4.910 |\n| TransNormer-T2 | 379 M | 100 K | 2.274 | 4.858 |\n\nPositional Encoding In the positional encoding experiment, we conducted a series of tests, comparing Mix (LRPE-d for the first layer, ExpDecay for the rest), APE (Absolute Positional Encoding), LRPE, Exp-Decay (Exponential Decay), and LRPE-d. As evident from Table 3. Ours and LRPE-d achieve better performance than other options. We select the Mix positional encoding as it boosts the training speed up to $20 \\%$ while only slightly worse than LRPE-d. We also perform ablations on the decay temperature $\\left(1-\\frac{l}{L}\\right)$ in Eq. 2. The perplexity of the TransNormerLLM is reduced by adding the decay temperature, as shown in Table 4. Gating Mechanism We conduct ablation studies to examine the effect of including the gating mechanism. As observed in Table 55, gate enabled the reduction of the loss value from 2.263 to 2.248 . GLA Activation Functions We conducted experiments on the GLA (Gated Linear Attention) structure with respect to the activation function. As shown in Table 6, using Swish and 1+elu leads to similar performance. However, in our experiments, using $1+$ elu in our 7B model may encounter a NaN problem, so we use Swish in our model. GLU Activation Functions We conduct an experiment by removing the activation function within the Gated Linear Units (GLU) structure. As shown in Table 7 , the results reveal that this alteration had a negligible impact on the final outcome. As a result, we decide to adopt the Simple Gated Linear Units (SGLU) structure in our final model configuration. Normalization functions In our study, we conducted a series of ablation tests employing various normalization methods including SRMSNorm, RMSNorm and LayerNorm. The results indicate that there is almost no difference among these methods when applied to TransNormerLLM. Nevertheless, during the course of our testing, we revisited and re-engineered the SRMSNorm using Triton. As it is shown in Figure 2, empirical evidence supports that our modification offers a significant boost in computational speed when operating with larger dimensions, compared to the PyTorch implementation methods. Lightning Attention We conducted a speed and memory comparison between our Lightning Attention and the baseline, which is the PyTorch implementation of the NormAttention Qin et al. 2022a). Figure 3 (left) reports the runtime in milliseconds of the forward + backward pass. Baseline runtime grows quadratically with sequence length, while Lightning Attention operates significantly faster, at least $2 \\times$ faster than the PyTorch implementation. Figure 3 (right) reports the memory footprint of Lightning Attention compared to the baseline. The memory footprint of Lightning Attention grows linearly with sequence length, which is up to $4 \\times$ more efficient than the baseline when the sequence length is 8192 . Our proposed Lightning Attention achieves superior efficiency. Table 3: Positional encoding. LRPE-d leads to the most optimal outcome. | PE Methods | Params | Updates | Loss | PPL |\n| :--- | :--- | :--- | :--- | :--- |\n| Mix | 385 M | 100 K | 2.248 | 4.770 |\n| APE | 386 M | 100 K | 2.387 | 5.253 |\n| Exp-Decay | 385 M | 100 K | 2.267 | 4.834 |\n| LRPE | 385 M | 100 K | 2.287 | 4.899 |\n| LRPE-d | 385 M | 100 K | 2.236 | 4.728 |\n\nTable 4: Ablations on decay temperature. The results of decay temperature proved to be superior. | Temperature | Params | Updates | Loss | PPL |\n| :--- | :--- | :--- | :--- | :--- |\n| w/ temperature | 385 M | 100 K | 2.248 | 4.770 |\n| w/o temperature | 385 M | 100 K | 2.258 | 4.804 |\n\nTable 5: Ablations on gating mechanism. The performance with the gate proved to be superior. | Gate | Params | Updates | Loss | PPL |\n| :--- | :--- | :--- | :--- | :--- |\n| w/ gate | 385 M | 100 K | 2.248 | 4.770 |\n| w/o gate | 379 M | 100 K | 2.263 | 4.820 |\n\nTable 6: Ablations on GLA activation functions. The results obtained from different activation functions were virtually identical. | GLA Act | Params | Updates | Loss | PPL |\n| :--- | :--- | :--- | :--- | :--- |\n| Swish | 385 M | 100 K | 2.248 | 4.770 |\n| No Act | 385 M | 100 K | 2.283 | 4.882 |\n| 1+elu | 385 M | 100 K | 2.252 | 4.767 |\n\nTable 7: Ablations on GLU activation functions. The exclusion of the activation function had no negative impact on the results. | GLU Act | Params | Updates | Loss | PPL |\n| :--- | :--- | :--- | :--- | :--- |\n| No Act | 385 M | 100 K | 2.248 | 4.770 |\n| Swish | 385 M | 100 K | 2.254 | 4.788 |\n\nTable 8: Normalization Functions. The deviation in results among the bellowing normalization functions is minimal. | Norm Type | Params | Updates | Loss | PPL |\n| :--- | :--- | :--- | :--- | :--- |\n| SRMSNorm | 385 M | 100 K | 2.248 | 4.770 |\n| RMSNorm | 385 M | 100 K | 2.247 | 4.766 |\n| LayerNorm | 385 M | 100 K | 2.247 | 4.765 |\n\n![](https://cdn.mathpix.com/cropped/2024_09_17_292835b4009c58e22eb5g-08.jpg?height=634&width=1250&top_left_y=272&top_left_x=427)\n\nFigure 2: Performance Evaluation of SRMSNorm Implementation.",
    "transnormerllm-8": "The upper figures exhibit the runtime comparison of the forward pass (left) and backward pass (right) for different sequence lengths, with a fixed feature dimension of 3072 . The lower two figures illustrate the runtime comparison for various feature dimensions, with a fixed sequence length of 4096. ![](https://cdn.mathpix.com/cropped/2024_09_17_292835b4009c58e22eb5g-08.jpg?height=341&width=1211&top_left_y=1098&top_left_x=465)\n\nFigure 3: Memory and speed comparison between linear attention and lightning attention. Left: runtime of forward + backward pass milliseconds for different sequence lengths, with a fixed feature dimension of 2048. Right: memory footprints of forward + backward pass for different sequence lengths, with a fixed feature dimension of 2048. ![](https://cdn.mathpix.com/cropped/2024_09_17_292835b4009c58e22eb5g-08.jpg?height=324&width=1246&top_left_y=1638&top_left_x=426)\n\nFigure 4: Inference Time and Memory Footprint. Left: inference runtime measured in milliseconds across different sequence lengths. Right: memory consumption during inference for varying sequence lengths. It is noteworthy that as the sequence length increases, TransNormerLLM demonstrates a consistent inference time and memory footprint. ### 4.2 BENCHMARKS\n\nIn order to validate the effectiveness of TransNormerLLM, we tested our 385M, 1B, and 7B models on Commonsense Reasoning Task, MMLU(Hendrycks et al., 2021), CMMLU(Li et al., 2023), and C-Eval(Huang et al., 2023).",
    "transnormerllm-9": "For comparison, we selected several open-source models as competitors, including Transformer-based models such as OPT (Zhang et al. 2022), Pythia (Biderman et al. 2023), BLOOM (Workshop et al., 2023), GPT-Neo (Black et al., 2022), GPT-J (Wang \\& Komatsuzaki, 2021), MPT (Team et al., 2023), Falcon (Almazrouei et al., 2023), LLaMA1/2 (Touvron et al., 2023a b), OpenLLAMA v1/v2 (Geng \\& Liu, 2023), Baichuan 1/2 (Baichuan, 2023), ChatGLM 1/2 (Zeng et al. 2022, Du et al., 2022), and non-Transformer model RWKV (Peng et al. 2023a). It can be observed that, compared to these models, TransNormerLLM remains highly competitive. Table 9: Performance Comparison on Commonsense Reasoning and Aggregated Benchmarks. For a fair comparison, we report competing methods' results reproduced by us using their released models. Official results are denoted in italics. PS: parameter size (billion). T: tokens (trillion).",
    "transnormerllm-10": "HS: HellaSwag. WG: WinoGrande. | Model | PS | T | BoolQ | PIQA | HS | WG | ARC-e | ARC-c | OBQA | MMLU | CMMLU | C-Eval |\n| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |\n| OPT | 0.35 | 0.30 | 57.74 | 64.58 | 36.69 | 52.49 | 44.02 | 23.89 | 28.20 | 26.02 | 25.34 | 25.71 |\n| Pythia | 0.40 | 0.30 | 60.40 | 67.08 | 40.52 | 53.59 | 51.81 | 24.15 | 29.40 | 25.99 | 25.16 | 24.81 |\n| BLOOM | 0.56 | 0.35 | 55.14 | 64.09 | 36.97 | 52.80 | 47.35 | 23.98 | 28.20 | 24.80 | 25.35 | 27.14 |\n| RWKV | 0.43 | - | - | 67.52 | 40.90 | 51.14 | 52.86 | 25.17 | 32.40 | 24.85 | - | - |\n| Ours | 0.39 | 1.0 | 62.14 | 66.70 | 46.27 | 54.46 | 55.43 | 27.99 | 32.40 | 25.90 | 25.05 | 25.24 |\n| GPT-Neo | 1.3 | 0.3 | 61.99 | 71.11 | 48.93 | 54.93 | 56.19 | 25.85 | 33.60 | 24.82 | 26.03 | 23.94 |\n| OPT | 1.3 | 0.3 | 57.77 | 71.71 | 53.70 | 59.35 | 57.24 | 29.69 | 33.20 | 24.96 | 24.97 | 25.32 |\n| Pythia | 1.4 | 0.3 | 60.73 | 70.67 | 47.18 | 53.51 | 56.99 | 26.88 | 31.40 | 26.55 | 25.13 | 24.25 |\n| BLOOM | 1.1 | 0.35 | 59.08 | 67.14 | 42.98 | 54.93 | 51.47 | 25.68 | 29.40 | 27.30 | 25.09 | 26.50 |\n| RWKV | 1.5 | - | - | 72.36 | 52.48 | 54.62 | 60.48 | 29.44 | 34.00 | 25.77 | - | - |\n| Falcon | 1.0 | 0.35 | 61.38 | 75.14 | 61.50 | 60.30 | 63.38 | 32.17 | 35.60 | 25.28 | 24.88 | 25.66 |\n| Ours | 1.0 | 1.2 | 63.27 | 72.09 | 56.49 | 60.38 | 63.68 | 35.24 | 36.60 | 27.10 | 25.88 | 26.01 |\n| GPT-J | 6.9 | 0.3 | 65.44 | 75.41 | 66.25 | 64.09 | 66.92 | 36.60 | 38.20 | 25.40 | 26.47 | 23.39 |\n| OPT | 6.7 | 0.3 | 66.18 | 76.22 | 67.21 | 65.19 | 65.66 | 34.64 | 37.20 | 24.57 | 25.36 | 25.32 |\n| Pythia | 6.9 | 0.3 | 63.46 | 75.14 | 63.92 | 60.77 | 67.34 | 35.41 | 37.00 | 24.64 | 25.56 | 26.40 |\n| BLOOM | 7.1 | 0.35 | 62.91 | 72.69 | 62.33 | 64.01 | 65.11 | 33.45 | 35.80 | 26.25 | 24.97 | 24.25 |\n| RWKV | 7.4 | - | - | 76.06 | 65.51 | 61.01 | 67.80 | 37.46 | 40.20 | 24.96 | - | - |\n| MPT | 6.9 | 1.0 | 73.88 | 79.43 | 76.25 | 68.27 | 74.79 | 41.72 | 42.20 | 30.80 | 25.99 | 24.06 |\n| Falcon | 7.2 | 1.5 | 73.73 | 79.38 | 76.3 | 67.17 | 74.62 | 43.60 | 43.80 | 27.79 | 25.73 | 22.92 |\n| Baichuan1 | 7.0 | 1.2 | 70.09 | 76.01 | 70.06 | 64.09 | 71.72 | 40.53 | 38.20 | 42.30 | 44.43 | 42.80 |\n| Baichuan2 | 7.0 | 2.6 | 72.72 | 76.50 | 72.17 | 68.35 | 75.17 | 42.32 | 39.60 | 54.16 | 57.07 | 54.00 |\n| ChatGLM1 | 6.7 | 1.0 | 74.74 | 68.88 | 45.57 | 52.25 | 48.78 | 31.66 | 36.80 | 40.63 | 37.48 | 40.23 |\n| ChatGLM2 | 7.1 | 1.4 | 77.65 | 69.37 | 50.51 | 57.62 | 59.13 | 34.30 | 37.00 | 45.46 | 48.80 | 52.55 |\n| OpenLLaMAv1 | 6.7 | 1.0 | 70.43 | 75.68 | 69.23 | 66.69 | 71.17 | 38.57 | 39.00 | 30.49 | 25.40 | 26.09 |\n| OpenLLaMAv2 | 6.7 | 1.0 | 72.20 | 78.84 | 74.51 | 65.67 | 72.39 | 41.30 | 41.00 | 41.29 | 29.58 | 30.01 |\n| LLaMA1 | 6.7 | 1.0 | 76.50 | 79.80 | 76.10 | 70.10 | 72.80 | 47.60 | 57.20 | 35.10 | 25.62 | 25.72 |\n| LLaMA2 | 6.7 | 2.0 | 77.68 | 78.07 | 76.02 | 68.98 | 76.30 | 46.33 | 44.20 | 45.30 | 32.96 | 33.20 |\n| Ours | 6.8 | 1.4 | 75.87 | 80.09 | 75.21 | 66.06 | 75.42 | 44.40 | 63.40 | 43.10 | 47.99 | 43.18 |\n\nCommonsense Reasoning We report BoolQ (Clark et al., 2019), PIQA (Bisk et al.",
    "transnormerllm-11": "2019), SIQA (Sap et al. 2019), HellaSwag (Zellers et al., 2019), WinoGrande (Sakaguchi et al., 2019), ARC easy and challenge (Clark et al., 2018), OpenBookQA (Mihaylov et al., 2018) and their average. We report 0 -shot results for all benchmarks using LM-Eval-Harness (Gao et al., 2021). All of our models achieve competitive performance compared to existing state-of-the-art LLMs, showcasing a remarkable ability to comprehend and apply commonsense reasoning. Aggregated Benchmarks We report the overall results for MMLU (Hendrycks et al., 2021), CMMLU (Li et al., 2023), C-Eval (Huang et al., 2023). Official scripts were used for evaluating MMLU, CMMLU, and C-Eval, with all evaluation results being conducted with a 5 -shot setup. In comparison to top-tier open-source models available in the industry, our models have demonstrated matched performance in both English and Chinese benchmarks. ### 4.3 SCALING TO 175B\n\nFurthermore, we have carried out a series of experiments to assess the efficacy of model parallelism as applied to the TransNormerLLM architecture. The comprehensive outcomes of these experiments have been thoughtfully presented in Appendix E. 1 Moreover, our research extends to the meticulous evaluation of various cutting-edge system optimization techniques. This evaluation encompasses their impact on both training speed and context length across models ranging from 7 B to 175 B in scale.",
    "transnormerllm-12": "We have thoughtfully documented the detailed results of these experiments in Appendix E. 2 . ## 5 CONCLUSION\n\nWe introduced TransNormerLLM in this paper, an improved TransNormer that is tailored for LLMs. Our TransNormerLLM consistently outperformed Transformers in both accuracy and efficiency. Extensive ablations demonstrate the effectiveness of our modifications and innovations in position encoding, gating mechanism, activation functions, normalization functions, and lightning attentions. These modifications collectively contribute to TransNormerLLM's outstanding performance, positioning it as a promising choice for state-of-the-art language models. The benchmark results for models with sizes of 385 million, 1 billion, and 7 billion parameters unequivocally demonstrate that TransNormerLLM not only matches the performance of current leading Transformer-based Large Language Models (LLMs) but also enjoys faster inference speeds. We will release our pre-trained TransNormerLLM models to foster community advancements in efficient LLM. ## REFERENCES\n\nEbtesam Almazrouei, Hamza Alobeidli, Abdulaziz Alshamsi, Alessandro Cappelli, Ruxandra Cojocaru, Merouane Debbah, Etienne Goffinet, Daniel Heslow, Julien Launay, Quentin Malartic, et al. Falcon-40b: an open large language model with state-of-the-art performance. Technical report, Technical report, Technology Innovation Institute, 2023. Baichuan. Baichuan 2: Open large-scale language models. arXiv preprint arXiv:2309.10305, 2023. URL https://arxiv.org/abs/2309.10305. Iz Beltagy, Matthew E. Peters, and Arman Cohan. Longformer: The long-document transformer, 2020. Stella Biderman, Hailey Schoelkopf, Quentin Anthony, Herbie Bradley, Kyle O\u2019Brien, Eric Hallahan, Mohammad Aflah Khan, Shivanshu Purohit, USVSN Sai Prashanth, Edward Raff, Aviya Skowron, Lintang Sutawika, and Oskar van der Wal. Pythia: A suite for analyzing large language models across training and scaling, 2023. Yonatan Bisk, Rowan Zellers, Ronan Le Bras, Jianfeng Gao, and Yejin Choi. Piqa: Reasoning about physical commonsense in natural language, 2019. Sid Black, Stella Biderman, Eric Hallahan, Quentin Anthony, Leo Gao, Laurence Golding, Horace He, Connor Leahy, Kyle McDonell, Jason Phang, et al. Gpt-neox-20b: An open-source autoregressive language model. arXiv preprint arXiv:2204.06745, 2022. Tom Brown, Benjamin Mann, Nick Ryder, Melanie Subbiah, Jared D Kaplan, Prafulla Dhariwal, Arvind Neelakantan, Pranav Shyam, Girish Sastry, Amanda Askell, et al. Language models are few-shot learners. Advances in neural information processing systems, 33:1877-1901, 2020. Rewon Child, Scott Gray, Alec Radford, and Ilya Sutskever. Generating long sequences with sparse transformers, 2019. Krzysztof Marcin Choromanski, Valerii Likhosherstov, David Dohan, Xingyou Song, Andreea Gane, Tamas Sarlos, Peter Hawkins, Jared Quincy Davis, Afroz Mohiuddin, Lukasz Kaiser, David Benjamin Belanger, Lucy J Colwell, and Adrian Weller. Rethinking attention with performers. In International Conference on Learning Representations, 2021. URL https: //openreview.net/forum?id=Ua6zuk0WRH\n\nAakanksha Chowdhery, Sharan Narang, Jacob Devlin, Maarten Bosma, Gaurav Mishra, Adam Roberts, Paul Barham, Hyung Won Chung, Charles Sutton, Sebastian Gehrmann, Parker Schuh, Kensen Shi, Sasha Tsvyashchenko, Joshua Maynez, Abhishek Rao, Parker Barnes, Yi Tay, Noam Shazeer, Vinodkumar Prabhakaran, Emily Reif, Nan Du, Ben Hutchinson, Reiner Pope, James Bradbury, Jacob Austin, Michael Isard, Guy Gur-Ari, Pengcheng Yin, Toju Duke, Anselm Levskaya, Sanjay Ghemawat, Sunipa Dev, Henryk Michalewski, Xavier Garcia, Vedant Misra, Kevin Robinson, Liam Fedus, Denny Zhou, Daphne Ippolito, David Luan, Hyeontaek Lim, Barret Zoph, Alexander Spiridonov, Ryan Sepassi, David Dohan, Shivani Agrawal, Mark Omernick, Andrew M. Dai, Thanumalayan Sankaranarayana Pillai, Marie Pellat, Aitor Lewkowycz, Erica Moreira, Rewon Child, Oleksandr Polozov, Katherine Lee, Zongwei Zhou, Xuezhi Wang, Brennan Saeta, Mark Diaz, Orhan Firat, Michele Catasta, Jason Wei, Kathy Meier-Hellstern, Douglas Eck, Jeff Dean, Slav Petrov, and Noah Fiedel. Palm: Scaling language modeling with pathways, 2022. Christopher Clark, Kenton Lee, Ming-Wei Chang, Tom Kwiatkowski, Michael Collins, and Kristina Toutanova. Boolq: Exploring the surprising difficulty of natural yes/no questions, 2019. Peter Clark, Isaac Cowhey, Oren Etzioni, Tushar Khot, Ashish Sabharwal, Carissa Schoenick, and Oyvind Tafjord. Think you have solved question answering? try arc, the ai2 reasoning challenge, 2018. Tri Dao. Flashattention-2: Faster attention with better parallelism and work partitioning. arXiv preprint arXiv:2307.08691, 2023.",
    "transnormerllm-13": "Tri Dao, Daniel Y. Fu, Stefano Ermon, Atri Rudra, and Christopher R\u00e9. FlashAttention: Fast and memory-efficient exact attention with IO-awareness.",
    "transnormerllm-14": "In Advances in Neural Information Processing Systems, 2022a. Tri Dao, Daniel Y. Fu, Khaled Kamal Saab, Armin W. Thomas, Atri Rudra, and Christopher R\u00e9. Hungry hungry hippos: Towards language modeling with state space models. CoRR, abs/2212.14052, 2022b. doi: 10.48550/arXiv.2212.14052. URL https://doi.org/10.48550/arXiv 2212.14052\n\nJacob Devlin, Ming-Wei Chang, Kenton Lee, and Kristina Toutanova. BERT: Pre-training of deep bidirectional transformers for language understanding.",
    "transnormerllm-15": "In Proceedings of the 2019 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies, Volume 1 (Long and Short Papers), pp. 4171-4186, Minneapolis, Minnesota, June 2019. Association for Computational Linguistics. doi: $10.18653 / \\mathrm{v} 1 / \\mathrm{N} 19-1423$. URL https: //aclanthology.org/N19-1423\n\nZhengxiao Du, Yujie Qian, Xiao Liu, Ming Ding, Jiezhong Qiu, Zhilin Yang, and Jie Tang. Glm: General language model pretraining with autoregressive blank infilling, 2022.",
    "transnormerllm-16": "Daniel Y. Fu, Elliot L. Epstein, Eric Nguyen, Armin W. Thomas, Michael Zhang, Tri Dao, Atri Rudra, and Christopher R\u00e9. Simple hardware-efficient long convolutions for sequence modeling. CoRR, abs/2302.06646, 2023. doi: 10.48550/arXiv.2302.06646. URL https://doi.org/10. $48550 / a r X i v .2302 .06646$\n\nLeo Gao, Jonathan Tow, Stella Biderman, Sid Black, Anthony DiPofi, Charles Foster, Laurence Golding, Jeffrey Hsu, Kyle McDonell, Niklas Muennighoff, et al. A framework for few-shot language model evaluation.",
    "transnormerllm-17": "Version v0. 0.1. Sept, 2021. Xinyang Geng and Hao Liu. Openllama: An open reproduction of llama. URL: https://github. com/openlm-research/open_llama, 2023. Albert Gu, Tri Dao, Stefano Ermon, Atri Rudra, and Christopher Re. Hippo: Recurrent memory with optimal polynomial projections, 2020. Albert Gu, Karan Goel, Ankit Gupta, and Christopher R\u00e9. On the parameterization and initialization of diagonal state space models. In NeurIPS, 2022a. URL http://papers.nips.cc/paper_files/paper/2022/hash/ e9a32fade47b906de908431991440f7c-Abstract-Conference.html. Albert Gu, Karan Goel, and Christopher R\u00e9. Efficiently modeling long sequences with structured state spaces. In The Tenth International Conference on Learning Representations, ICLR 2022, Virtual Event, April 25-29, 2022. OpenReview.net, 2022b. URL https://openreview. net/ forum?id=uYLFoz1vlAC\n\nAnkit Gupta, Albert Gu, and Jonathan Berant. Diagonal state spaces are as effective as structured state spaces. In NeurIPS, 2022. URL/http://papers.nips.cc/paper_files/paper/ 2022/hash/9156b0f6dfa9bbd18c79cc459ef5d61c-Abstract-Conference. html. Dan Hendrycks, Collin Burns, Steven Basart, Andy Zou, Mantas Mazeika, Dawn Song, and Jacob Steinhardt. Measuring massive multitask language understanding, 2021. Jordan Hoffmann, Sebastian Borgeaud, Arthur Mensch, Elena Buchatskaya, Trevor Cai, Eliza Rutherford, Diego de Las Casas, Lisa Anne Hendricks, Johannes Welbl, Aidan Clark, Tom Hennigan, Eric Noland, Katie Millican, George van den Driessche, Bogdan Damoc, Aurelia Guy, Simon Osindero, Karen Simonyan, Erich Elsen, Jack W. Rae, Oriol Vinyals, and Laurent Sifre. Training compute-optimal large language models, 2022. Weizhe Hua, Zihang Dai, Hanxiao Liu, and Quoc V Le. Transformer quality in linear time.",
    "transnormerllm-18": "arXiv preprint arXiv:2202.10447, 2022. Yuzhen Huang, Yuzhuo Bai, Zhihao Zhu, Junlei Zhang, Jinghan Zhang, Tangjun Su, Junteng Liu, Chuancheng Lv, Yikai Zhang, Jiayi Lei, Yao Fu, Maosong Sun, and Junxian He. C-eval: A multi-level multi-discipline chinese evaluation suite for foundation models, 2023. Dhiraj Kalamkar, Dheevatsa Mudigere, Naveen Mellempudi, Dipankar Das, Kunal Banerjee, Sasikanth Avancha, Dharma Teja Vooturi, Nataraj Jammalamadaka, Jianyu Huang, Hector Yuen, et al. A study of bfloat16 for deep learning training. arXiv preprint arXiv:1905.12322, 2019. Jared Kaplan, Sam McCandlish, Tom Henighan, Tom B. Brown, Benjamin Chess, Rewon Child, Scott Gray, Alec Radford, Jeffrey Wu, and Dario Amodei. Scaling laws for neural language models, 2020. Angelos Katharopoulos, Apoorv Vyas, Nikolaos Pappas, and Fran\u00e7ois Fleuret. Transformers are rnns: Fast autoregressive transformers with linear attention. In International Conference on Machine Learning, pp. 5156-5165. PMLR, 2020. Guolin Ke, Di He, and Tie-Yan Liu. Rethinking positional encoding in language pre-training. In International Conference on Learning Representations, 2021. URL https://openreview. net/forum?id=09-528y2Fgf\n\nDiederik P. Kingma and Jimmy Ba. Adam: A method for stochastic optimization, 2017. Mike Lewis, Yinhan Liu, Naman Goyal, Marjan Ghazvininejad, Abdelrahman Mohamed, Omer Levy, Ves Stoyanov, and Luke Zettlemoyer. Bart: Denoising sequence-to-sequence pre-training for natural language generation, translation, and comprehension, 2019. Haonan Li, Yixuan Zhang, Fajri Koto, Yifei Yang, Hai Zhao, Yeyun Gong, Nan Duan, and Timothy Baldwin. Cmmlu: Measuring massive multitask language understanding in chinese, 2023. Zexiang Liu, Dong Li, Kaiyue Lu, Zhen Qin, Weixuan Sun, Jiacheng Xu, and Yiran Zhong. Neural architecture search on efficient transformers and beyond. arXiv preprint arXiv:2207.13955, 2022. Paulius Micikevicius, Sharan Narang, Jonah Alben, Gregory Diamos, Erich Elsen, David Garcia, Boris Ginsburg, Michael Houston, Oleksii Kuchaiev, Ganesh Venkatesh, et al. Mixed precision training.",
    "transnormerllm-19": "arXiv preprint arXiv:1710.03740, 2017. Todor Mihaylov, Peter Clark, Tushar Khot, and Ashish Sabharwal. Can a suit of armor conduct electricity? a new dataset for open book question answering, 2018. Antonio Orvieto, Samuel L Smith, Albert Gu, Anushan Fernando, Caglar Gulcehre, Razvan Pascanu, and Soham De. Resurrecting recurrent neural networks for long sequences, 2023. Adam Paszke, Sam Gross, Francisco Massa, Adam Lerer, James Bradbury, Gregory Chanan, Trevor Killeen, Zeming Lin, Natalia Gimelshein, Luca Antiga, Alban Desmaison, Andreas Kopf, Edward Yang, Zachary DeVito, Martin Raison, Alykhan Tejani, Sasank Chilamkurthy, Benoit Steiner, Lu Fang, Junjie Bai, and Soumith Chintala. Pytorch: An imperative style, highperformance deep learning library. In Advances in Neural Information Processing Systems 32, pp. 8024-8035. Curran Associates, Inc., 2019. URL http://papers.neurips.cc/paper/ 9015-pytorch-an-imperative-style-high-performance-deep-learning-library. Guilherme Penedo, Quentin Malartic, Daniel Hesslow, Ruxandra Cojocaru, Alessandro Cappelli, Hamza Alobeidli, Baptiste Pannier, Ebtesam Almazrouei, and Julien Launay. The refinedweb dataset for falcon llm: Outperforming curated corpora with web data, and web data only, 2023. Bo Peng, Eric Alcaide, Quentin Anthony, Alon Albalak, Samuel Arcadinho, Huanqi Cao, Xin Cheng, Michael Chung, Matteo Grella, Kranthi Kiran GV, Xuzheng He, Haowen Hou, Przemyslaw Kazienko, Jan Kocon, Jiaming Kong, Bartlomiej Koptyra, Hayden Lau, Krishna Sri Ipsit Mantri, Ferdinand Mom, Atsushi Saito, Xiangru Tang, Bolun Wang, Johan S. Wind, Stansilaw Wozniak, Ruichong Zhang, Zhenyuan Zhang, Qihang Zhao, Peng Zhou, Jian Zhu, and Rui-Jie Zhu. Rwkv: Reinventing rnns for the transformer era, 2023a. Bo Peng, Eric Alcaide, Quentin Anthony, Alon Albalak, Samuel Arcadinho, Huanqi Cao, Xin Cheng, Michael Chung, Matteo Grella, Kranthi Kiran GV, Xuzheng He, Haowen Hou, Przemyslaw Kazienko, Jan Kocon, Jiaming Kong, Bartlomiej Koptyra, Hayden Lau, Krishna Sri Ipsit Mantri, Ferdinand Mom, Atsushi Saito, Xiangru Tang, Bolun Wang, Johan S. Wind, Stansilaw Wozniak, Ruichong Zhang, Zhenyuan Zhang, Qihang Zhao, Peng Zhou, Jian Zhu, and Rui-Jie Zhu. Rwkv: Reinventing rnns for the transformer era, 2023b. Ofir Press, Noah Smith, and Mike Lewis. Train short, test long: Attention with linear biases enables input length extrapolation. In International Conference on Learning Representations, 2022. URL https://openreview.net/forum?id=R8sQPpGCv0\n\nZhen Qin, Xiaodong Han, Weixuan Sun, Dongxu Li, Lingpeng Kong, Nick Barnes, and Yiran Zhong. The devil in linear transformer. In Proceedings of the 2022 Conference on Empirical Methods in Natural Language Processing, pp. 7025-7041, Abu Dhabi, United Arab Emirates, December 2022a. Association for Computational Linguistics. URL https://aclanthology.org/ 2022.emnlp-main. 473\n\nZhen Qin, Weixuan Sun, Hui Deng, Dongxu Li, Yunshen Wei, Baohong Lv, Junjie Yan, Lingpeng Kong, and Yiran Zhong. cosformer: Rethinking softmax in attention. In International Conference on Learning Representations, 2022b. URL https://openreview. net/forum?id= Bl8CQrx2Up4. Zhen Qin, Xiaodong Han, Weixuan Sun, Bowen He, Dong Li, Dongxu Li, Yuchao Dai, Lingpeng Kong, and Yiran Zhong. Toeplitz neural network for sequence modeling.",
    "transnormerllm-20": "In The Eleventh International Conference on Learning Representations, 2023a. URL https: / / openreview. net/forum?id=IxmWsm4xrua\n\nZhen Qin, Weixuan Sun, Kaiyue Lu, Hui Deng, Dongxu Li, Xiaodong Han, Yuchao Dai, Lingpeng Kong, and Yiran Zhong. Linearized relative positional encoding. Transactions on Machine Learning Research, 2023b. Zhen Qin, Yiran Zhong, and Hui Deng. Exploring transformer extrapolation, 2023c. Alec Radford, Karthik Narasimhan, Tim Salimans, and Ilya Sutskever. Improving language understanding by generative pre-training. https://s3-us-west-2.amazonaws.com/ openai-assets/research-covers/language-unsupervised/language_ understanding_paper.pdf, 2018. Alec Radford, Jeffrey Wu, Rewon Child, David Luan, Dario Amodei, Ilya Sutskever, et al. Language models are unsupervised multitask learners. OpenAI blog, 1(8):9, 2019. Jack W. Rae, Sebastian Borgeaud, Trevor Cai, Katie Millican, Jordan Hoffmann, Francis Song, John Aslanides, Sarah Henderson, Roman Ring, Susannah Young, Eliza Rutherford, Tom Hennigan, Jacob Menick, Albin Cassirer, Richard Powell, George van den Driessche, Lisa Anne Hendricks, Maribeth Rauh, Po-Sen Huang, Amelia Glaese, Johannes Welbl, Sumanth Dathathri, Saffron Huang, Jonathan Uesato, John Mellor, Irina Higgins, Antonia Creswell, Nat McAleese, Amy Wu, Erich Elsen, Siddhant Jayakumar, Elena Buchatskaya, David Budden, Esme Sutherland, Karen Simonyan, Michela Paganini, Laurent Sifre, Lena Martens, Xiang Lorraine Li, Adhiguna Kuncoro, Aida Nematzadeh, Elena Gribovskaya, Domenic Donato, Angeliki Lazaridou, Arthur Mensch, Jean-Baptiste Lespiau, Maria Tsimpoukelli, Nikolai Grigorev, Doug Fritz, Thibault Sottiaux, Mantas Pajarskas, Toby Pohlen, Zhitao Gong, Daniel Toyama, Cyprien de Masson d'Autume, Yujia Li, Tayfun Terzi, Vladimir Mikulik, Igor Babuschkin, Aidan Clark, Diego de Las Casas, Aurelia Guy, Chris Jones, James Bradbury, Matthew Johnson, Blake Hechtman, Laura Weidinger, Iason Gabriel, William Isaac, Ed Lockhart, Simon Osindero, Laura Rimell, Chris Dyer, Oriol Vinyals, Kareem Ayoub, Jeff Stanway, Lorrayne Bennett, Demis Hassabis, Koray Kavukcuoglu, and Geoffrey Irving. Scaling language models: Methods, analysis \\& insights from training gopher, 2022.",
    "transnormerllm-21": "Prajit Ramachandran, Barret Zoph, and Quoc V. Le. Searching for activation functions, 2017. Keisuke Sakaguchi, Ronan Le Bras, Chandra Bhagavatula, and Yejin Choi. Winogrande: An adversarial winograd schema challenge at scale, 2019. Maarten Sap, Hannah Rashkin, Derek Chen, Ronan LeBras, and Yejin Choi. Socialiqa: Commonsense reasoning about social interactions, 2019. Teven Le Scao, Thomas Wang, Daniel Hesslow, Lucile Saulnier, Stas Bekman, M Saiful Bari, Stella Biderman, Hady Elsahar, Niklas Muennighoff, Jason Phang, Ofir Press, Colin Raffel, Victor Sanh, Sheng Shen, Lintang Sutawika, Jaesung Tae, Zheng Xin Yong, Julien Launay, and Iz Beltagy. What language model to train if you have one million gpu hours?, 2022. Mohammad Shoeybi, Mostofa Patwary, Raul Puri, Patrick LeGresley, Jared Casper, and Bryan Catanzaro. Megatron-lm: Training multi-billion parameter language models using model parallelism. arXiv preprint arXiv:1909.08053, 2019. Ross Taylor, Marcin Kardas, Guillem Cucurull, Thomas Scialom, Anthony Hartshorn, Elvis Saravia, Andrew Poulton, Viktor Kerkez, and Robert Stojnic. Galactica: A large language model for science, 2022. MosaicML NLP Team et al. Introducing mpt-7b: A new standard for open-source, commercially usable llms, 2023. URL www. mosaicml. com/blog/mpt-7b.",
    "transnormerllm-22": "Accessed, pp. 05-05, 2023. Philippe Tillet, Hsiang-Tsung Kung, and David D. Cox. Triton: an intermediate language and compiler for tiled neural network computations. Proceedings of the 3rd ACM SIGPLAN International Workshop on Machine Learning and Programming Languages, 2019. Hugo Touvron, Thibaut Lavril, Gautier Izacard, Xavier Martinet, Marie-Anne Lachaux, Timoth\u00e9e Lacroix, Baptiste Rozi\u00e8re, Naman Goyal, Eric Hambro, Faisal Azhar, Aurelien Rodriguez, Armand Joulin, Edouard Grave, and Guillaume Lample. Llama: Open and efficient foundation language models. arXiv preprint arXiv:2302.13971, 2023a. Hugo Touvron, Louis Martin, Kevin Stone, Peter Albert, Amjad Almahairi, Yasmine Babaei, Nikolay Bashlykov, Soumya Batra, Prajjwal Bhargava, Shruti Bhosale, Dan Bikel, Lukas Blecher, Cristian Canton Ferrer, Moya Chen, Guillem Cucurull, David Esiobu, Jude Fernandes, Jeremy Fu, Wenyin Fu, Brian Fuller, Cynthia Gao, Vedanuj Goswami, Naman Goyal, Anthony Hartshorn, Saghar Hosseini, Rui Hou, Hakan Inan, Marcin Kardas, Viktor Kerkez, Madian Khabsa, Isabel Kloumann, Artem Korenev, Punit Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Jenya Lee, Diana Liskovich, Yinghai Lu, Yuning Mao, Xavier Martinet, Todor Mihaylov, Pushkar Mishra, Igor Molybog, Yixin Nie, Andrew Poulton, Jeremy Reizenstein, Rashi Rungta, Kalyan Saladi, Alan Schelten, Ruan Silva, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang, Ross Taylor, Adina Williams, Jian Xiang Kuan, Puxin Xu, Zheng Yan, Iliyan Zarov, Yuchen Zhang, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, Robert Stojnic, Sergey Edunov, and Thomas Scialom. Llama 2: Open foundation and fine-tuned chat models, 2023b. Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N Gomez, \u0141ukasz Kaiser, and Illia Polosukhin. Attention is all you need. Advances in neural information processing systems, 30, 2017. Ben Wang and Aran Komatsuzaki. Gpt-j-6b: A 6 billion parameter autoregressive language model, 2021. BigScience Workshop, :, Teven Le Scao, Angela Fan, Christopher Akiki, Ellie Pavlick, Suzana Ili\u0107, Daniel Hesslow, Roman Castagn\u00e9, Alexandra Sasha Luccioni, Fran\u00e7ois Yvon, Matthias Gall\u00e9, Jonathan Tow, Alexander M. Rush, Stella Biderman, Albert Webson, Pawan Sasanka Ammanamanchi, Thomas Wang, Beno\u00eet Sagot, Niklas Muennighoff, Albert Villanova del Moral, Olatunji Ruwase, Rachel Bawden, Stas Bekman, Angelina McMillan-Major, Iz Beltagy, Huu Nguyen, Lucile Saulnier, Samson Tan, Pedro Ortiz Suarez, Victor Sanh, Hugo Lauren\u00e7on, Yacine Jernite, Julien Launay, Margaret Mitchell, Colin Raffel, Aaron Gokaslan, Adi Simhi, Aitor Soroa, Alham Fikri Aji, Amit Alfassy, Anna Rogers, Ariel Kreisberg Nitzav, Canwen Xu, Chenghao Mou, Chris Emezue, Christopher Klamm, Colin Leong, Daniel van Strien, David Ifeoluwa Adelani, Dragomir Radev, Eduardo Gonz\u00e1lez Ponferrada, Efrat Levkovizh, Ethan Kim, Eyal Bar Natan, Francesco De Toni, G\u00e9rard Dupont, Germ\u00e1n Kruszewski, Giada Pistilli, Hady Elsahar, Hamza Benyamina, Hieu Tran, Ian Yu, Idris Abdulmumin, Isaac Johnson, Itziar Gonzalez-Dios, Javier de la Rosa, Jenny Chim, Jesse Dodge, Jian Zhu, Jonathan Chang, J\u00f6rg Frohberg, Joseph Tobing, Joydeep Bhattacharjee, Khalid Almubarak, Kimbo Chen, Kyle Lo, Leandro Von Werra, Leon Weber, Long Phan, Loubna Ben allal, Ludovic Tanguy, Manan Dey, Manuel Romero Mu\u00f1oz, Maraim Masoud, Mar\u00eda Grandury, Mario \u0160a\u0161ko, Max Huang, Maximin Coavoux, Mayank Singh, Mike Tian-Jian Jiang, Minh Chien Vu, Mohammad A. Jauhar, Mustafa Ghaleb, Nishant Subramani, Nora Kassner, Nurulaqilla Khamis, Olivier Nguyen, Omar Espejel, Ona de Gibert, Paulo Villegas, Peter Henderson, Pierre Colombo, Priscilla Amuok, Quentin Lhoest, Rheza Harliman, Rishi Bommasani, Roberto Luis L\u00f3pez, Rui Ribeiro, Salomey Osei, Sampo Pyysalo, Sebastian Nagel, Shamik Bose, Shamsuddeen Hassan Muhammad, Shanya Sharma, Shayne Longpre, Somaieh Nikpoor, Stanislav Silberberg, Suhas Pai, Sydney Zink, Tiago Timponi Torrent, Timo Schick, Tristan Thrush, Valentin Danchev, Vassilina Nikoulina, Veronika Laippala, Violette Lepercq, Vrinda Prabhu, Zaid Alyafeai, Zeerak Talat, Arun Raja, Benjamin Heinzerling, Chenglei Si, Davut Emre Ta\u015far,\n\nElizabeth Salesky, Sabrina J. Mielke, Wilson Y. Lee, Abheesht Sharma, Andrea Santilli, Antoine Chaffin, Arnaud Stiegler, Debajyoti Datta, Eliza Szczechla, Gunjan Chhablani, Han Wang, Harshit Pandey, Hendrik Strobelt, Jason Alan Fries, Jos Rozen, Leo Gao, Lintang Sutawika, M Saiful Bari, Maged S. Al-shaibani, Matteo Manica, Nihal Nayak, Ryan Teehan, Samuel Albanie, Sheng Shen, Srulik Ben-David, Stephen H. Bach, Taewoon Kim, Tali Bers, Thibault Fevry, Trishala Neeraj, Urmish Thakker, Vikas Raunak, Xiangru Tang, Zheng-Xin Yong, Zhiqing Sun, Shaked Brody, Yallow Uri, Hadar Tojarieh, Adam Roberts, Hyung Won Chung, Jaesung Tae, Jason Phang, Ofir Press, Conglong Li, Deepak Narayanan, Hatim Bourfoune, Jared Casper, Jeff Rasley, Max Ryabinin, Mayank Mishra, Minjia Zhang, Mohammad Shoeybi, Myriam Peyrounette, Nicolas Patry, Nouamane Tazi, Omar Sanseviero, Patrick von Platen, Pierre Cornette, Pierre Fran\u00e7ois Lavall\u00e9e, R\u00e9mi Lacroix, Samyam Rajbhandari, Sanchit Gandhi, Shaden Smith, St\u00e9phane Requena, Suraj Patil, Tim Dettmers, Ahmed Baruwa, Amanpreet Singh, Anastasia Cheveleva, Anne-Laure Ligozat, Arjun Subramonian, Aur\u00e9lie N\u00e9v\u00e9ol, Charles Lovering, Dan Garrette, Deepak Tunuguntla, Ehud Reiter, Ekaterina Taktasheva, Ekaterina Voloshina, Eli Bogdanov, Genta Indra Winata, Hailey Schoelkopf, Jan-Christoph Kalo, Jekaterina Novikova, Jessica Zosa Forde, Jordan Clive, Jungo Kasai, Ken Kawamura, Liam Hazan, Marine Carpuat, Miruna Clinciu, Najoung Kim, Newton Cheng, Oleg Serikov, Omer Antverg, Oskar van der Wal, Rui Zhang, Ruochen Zhang, Sebastian Gehrmann, Shachar Mirkin, Shani Pais, Tatiana Shavrina, Thomas Scialom, Tian Yun, Tomasz Limisiewicz, Verena Rieser, Vitaly Protasov, Vladislav Mikhailov, Yada Pruksachatkun, Yonatan Belinkov, Zachary Bamberger, Zden\u011bk Kasner, Alice Rueda, Amanda Pestana, Amir Feizpour, Ammar Khan, Amy Faranak, Ana Santos, Anthony Hevia, Antigona Unldreaj, Arash Aghagol, Arezoo Abdollahi, Aycha Tammour, Azadeh HajiHosseini, Bahareh Behroozi, Benjamin Ajibade, Bharat Saxena, Carlos Mu\u00f1oz Ferrandis, Daniel McDuff, Danish Contractor, David Lansky, Davis David, Douwe Kiela, Duong A. Nguyen, Edward Tan, Emi Baylor, Ezinwanne Ozoani, Fatima Mirza, Frankline Ononiwu, Habib Rezanejad, Hessie Jones, Indrani Bhattacharya, Irene Solaiman, Irina Sedenko, Isar Nejadgholi, Jesse Passmore, Josh Seltzer, Julio Bonis Sanz, Livia Dutra, Mairon Samagaio, Maraim Elbadri, Margot Mieskes, Marissa Gerchick, Martha Akinlolu, Michael McKenna, Mike Qiu, Muhammed Ghauri, Mykola Burynok, Nafis Abrar, Nazneen Rajani, Nour Elkott, Nour Fahmy, Olanrewaju Samuel, Ran An, Rasmus Kromann, Ryan Hao, Samira Alizadeh, Sarmad Shubber, Silas Wang, Sourav Roy, Sylvain Viguier, Thanh Le, Tobi Oyebade, Trieu Le, Yoyo Yang, Zach Nguyen, Abhinav Ramesh Kashyap, Alfredo Palasciano, Alison Callahan, Anima Shukla, Antonio Miranda-Escalada, Ayush Singh, Benjamin Beilharz, Bo Wang, Caio Brito, Chenxi Zhou, Chirag Jain, Chuxin Xu, Cl\u00e9mentine Fourrier, Daniel Le\u00f3n Peri\u00f1\u00e1n, Daniel Molano, Dian Yu, Enrique Manjavacas, Fabio Barth, Florian Fuhrimann, Gabriel Altay, Giyaseddin Bayrak, Gully Burns, Helena U. Vrabec, Imane Bello, Ishani Dash, Jihyun Kang, John Giorgi, Jonas Golde, Jose David Posada, Karthik Rangasai Sivaraman, Lokesh Bulchandani, Lu Liu, Luisa Shinzato, Madeleine Hahn de Bykhovetz, Maiko Takeuchi, Marc P\u00e0mies, Maria A Castillo, Marianna Nezhurina, Mario S\u00e4nger, Matthias Samwald, Michael Cullan, Michael Weinberg, Michiel De Wolf, Mina Mihaljcic, Minna Liu, Moritz Freidank, Myungsun Kang, Natasha Seelam, Nathan Dahlberg, Nicholas Michio Broad, Nikolaus Muellner, Pascale Fung, Patrick Haller, Ramya Chandrasekhar, Renata Eisenberg, Robert Martin, Rodrigo Canalli, Rosaline Su, Ruisi Su, Samuel Cahyawijaya, Samuele Garda, Shlok S Deshmukh, Shubhanshu Mishra, Sid Kiblawi, Simon Ott, Sinee Sang-aroonsiri, Srishti Kumar, Stefan Schweter, Sushil Bharati, Tanmay Laud, Th\u00e9o Gigant, Tomoya Kainuma, Wojciech Kusa, Yanis Labrak, Yash Shailesh Bajaj, Yash Venkatraman, Yifan Xu, Yingxin Xu, Yu Xu, Zhe Tan, Zhongli Xie, Zifan Ye, Mathilde Bras, Younes Belkada, and Thomas Wolf. Bloom: A 176b-parameter open-access multilingual language model, 2023. Rowan Zellers, Ari Holtzman, Yonatan Bisk, Ali Farhadi, and Yejin Choi. Hellaswag: Can a machine really finish your sentence?, 2019. Aohan Zeng, Xiao Liu, Zhengxiao Du, Zihan Wang, Hanyu Lai, Ming Ding, Zhuoyi Yang, Yifan Xu, Wendi Zheng, Xiao Xia, et al. Glm-130b: An open bilingual pre-trained model. arXiv preprint arXiv:2210.02414, 2022. Susan Zhang, Stephen Roller, Naman Goyal, Mikel Artetxe, Moya Chen, Shuohui Chen, Christopher Dewan, Mona Diab, Xian Li, Xi Victoria Lin, Todor Mihaylov, Myle Ott, Sam Shleifer, Kurt Shuster, Daniel Simig, Punit Singh Koura, Anjali Sridhar, Tianlu Wang, and Luke Zettlemoyer. Opt: Open pre-trained transformer language models, 2022. Yanli Zhao, Andrew Gu, Rohan Varma, Liang Luo, Chien-Chin Huang, Min Xu, Less Wright, Hamid Shojanazeri, Myle Ott, Sam Shleifer, et al. Pytorch fsdp: experiences on scaling fully sharded data parallel. arXiv preprint arXiv:2304.11277, 2023. Lin Zheng, Chong Wang, and Lingpeng Kong. Linear complexity randomized self-attention mechanism. In International Conference on Machine Learning, pp. 27011-27041. PMLR, 2022. Lin Zheng, Jianbo Yuan, Chong Wang, and Lingpeng Kong. Efficient attention via control variates. In International Conference on Learning Representations, 2023.",
    "transnormerllm-23": "URL https: / / openreview. net/forum?id=G-uNfHKrj46. ## Appendix\n\n## A MODEL\n\nWe present distinct model variants of the TransNormerLLM architecture, delineating their respective configurations with regard to parameters, layers, attention heads, and hidden dimensions. The detailed specifications are meticulously tabulated in Table 10\n\nTable 10: TransNormerLLM Model Variants. | Model Size | Non-Embedding Params | Layers | Hidden Dim | Heads | Equivalent Models |\n| :---: | :---: | :---: | :---: | :---: | :---: |\n| 385M | $384,974,848$ | 24 | 1024 | 8 | Pythia-410M |\n| 1B | $992,165,888$ | 16 | 2048 | 16 | Pythia-1B |\n| 3B | $2,876,006,400$ | 32 | 2560 | 20 | Pythia-2.8B |\n| 7B | $6,780,547,072$ | 30 | 4096 | 32 | LLAMA-6.7B |\n| 13B | $12,620,195,840$ | 36 | 5120 | 40 | LLAMA-13B |\n| 65B | $63,528,009,728$ | 72 | 8192 | 64 | LLAMA-65B |\n| 175B | $173,356,498,944$ | 88 | 12288 | 96 | GPT-3 |\n\n## B Lightning AtTEntion\n\nWe present the algorithm details of Lightning Attention includes forward pass and backward pass in Algorithm 3 and 4 respectively. ```\nAlgorithm 3 Lightning Attention Forward Pass\n    Input: \\(\\mathbf{Q}, \\mathbf{K}, \\mathbf{V} \\in \\mathbb{R}^{n \\times d}\\), attention mask \\(\\mathbf{M} \\in \\mathbb{R}^{n \\times n}\\), block sizes \\(B_{c}, B_{r}\\);\n    Initialize: \\(\\mathbf{O}=\\mathbf{0} \\in \\mathbb{R}^{n \\times d}\\);\n    Divide \\(\\mathbf{Q}\\) into \\(T_{r}=\\frac{n}{B_{r}}\\) blocks \\(\\mathbf{Q}_{1}, \\mathbf{Q}_{2}, \\ldots \\mathbf{Q}_{T_{r}}\\) of size \\(B_{r} \\times d\\) each.",
    "transnormerllm-24": "Divide \\(\\mathbf{K}, \\mathbf{V}\\) into \\(T_{c}=\\frac{n}{B_{c}}\\) blocks \\(\\mathbf{K}_{1}, \\mathbf{K}_{2}, \\ldots \\mathbf{K}_{T_{c}}, \\mathbf{V}_{1}, \\mathbf{V}_{2}, \\ldots \\mathbf{V}_{T_{c}}\\) of size \\(B_{c} \\times d\\) each. Divide \\(\\mathbf{O}\\) into \\(T_{r}=\\frac{n}{B_{r}}\\) blocks \\(\\mathbf{O}_{1}, \\mathbf{O}_{2}, \\ldots \\mathbf{O}_{T_{r}}\\) of size \\(B_{r} \\times d\\) each. Divide \\(\\mathbf{M}\\) into \\(T_{r} \\times T_{c}\\) blocks \\(\\mathbf{M}_{11}, \\mathbf{M}_{12}, \\ldots \\mathbf{M}_{T_{r}, T_{c}}\\) of size \\(B_{r} \\times B_{c}\\) each. for \\(1 \\leq i \\leq T_{r}\\) do\n        Load \\(\\mathbf{Q}_{i} \\in \\mathbb{R}^{B_{r} \\times d}\\) from HBM to on-chip SRAM. Initialize \\(\\mathbf{O}_{i}=\\mathbf{0} \\in \\mathbb{R}^{B_{r} \\times d}\\) on SRAM. for \\(1 \\leq j \\leq T_{c}\\) do\n            Load \\(\\mathbf{K}_{j}, \\mathbf{V}_{j} \\in \\mathbb{R}^{B_{c} \\times d}\\) from HBM to on-chip SRAM. Load \\(\\mathbf{M}_{i j} \\in \\mathbb{R}^{B_{c} \\times B_{c}}\\) from HBM to on-chip SRAM. On chip, compute \\(\\mathbf{A}_{i j}=\\left[\\mathbf{Q}_{i} \\mathbf{K}_{j}^{\\top}\\right] \\odot \\mathbf{M}_{i j} \\in \\mathbb{R}^{B_{r} \\times B_{c}}\\).",
    "transnormerllm-25": "On chip, compute \\(\\mathbf{O}_{i}=\\mathbf{O}_{i}+\\mathbf{A}_{i j} \\mathbf{V}_{j} \\in \\mathbb{R}^{B_{r} \\times d}\\). end for\n        Write \\(\\mathbf{O}_{i}\\) to HBM as the \\(i\\)-th block of \\(\\mathbf{O}\\). end for\n    return \\(\\mathbf{O}\\)\n```\n\n\n## C Proving Robust INFERENCE ALGORITHM\n\nWe will use induction to prove: $[\\mathbf{k v}]_{t}=\\lambda^{-t}[\\overline{\\mathbf{k v}}]_{t}$. Base Case $(n=1)$ :\n\n$$\n\\begin{aligned}\n{[\\mathbf{k v}]_{1} } & =\\left([\\mathbf{k v}]_{0}+\\mathbf{k}_{1} \\lambda^{-1} \\mathbf{v}_{1}^{\\top}\\right) \\\\\n& =\\lambda^{-1}\\left(\\mathbf{k}_{1} \\mathbf{v}_{1}^{\\top}\\right) \\\\\n& =\\lambda^{-1}[\\overline{\\mathbf{k v}}]_{1} . \\end{aligned}\n$$\n\n```\nAlgorithm 4 Lightning Attention Backward Pass\n    Input: \\(\\mathbf{Q}, \\mathbf{K}, \\mathbf{V}, \\mathbf{d O} \\in \\mathbb{R}^{n \\times d}\\), attention mask \\(\\mathbf{M} \\in \\mathbb{R}^{n \\times n}\\), on-chip SRAM of size \\(M\\), block sizes \\(B_{c}, B_{r}\\);\n    Initialize: \\(\\mathbf{d Q}=\\mathbf{d K}=\\mathbf{d V}=\\mathbf{0} \\in \\mathbb{R}^{n \\times d}\\);\n    Divide \\(\\mathbf{Q}\\) into \\(T_{r}=\\frac{n}{B_{r}}\\) blocks \\(\\mathbf{Q}_{1}, \\mathbf{Q}_{2}, \\ldots \\mathbf{Q}_{T_{r}}\\) of size \\(B_{r} \\times d\\) each.",
    "transnormerllm-26": "Divide \\(\\mathbf{K}, \\mathbf{V}\\) into \\(T_{c}=\\frac{n}{B_{c}}\\) blocks \\(\\mathbf{K}_{1}, \\mathbf{K}_{2}, \\ldots \\mathbf{K}_{T_{c}}, \\mathbf{V}_{1}, \\mathbf{V}_{2}, \\ldots \\mathbf{V}_{T_{c}}\\) of size \\(B_{c} \\times d\\) each. Divide \\(\\mathbf{O}, \\mathbf{d O}\\) into \\(T_{r}=\\frac{n}{B_{r}}\\) blocks \\(\\mathbf{O}_{1}, \\mathbf{O}_{2}, \\ldots \\mathbf{O}_{T_{r}}, \\mathbf{d O}_{\\mathbf{1}}, \\mathbf{d O}_{\\mathbf{2}}, \\ldots \\mathbf{d O}_{\\mathbf{T}_{\\mathbf{r}}}\\) of size \\(B_{r} \\times d\\) each\n    Divide \\(\\mathbf{M}\\) into \\(T_{r} \\times T_{c}\\) blocks \\(\\mathbf{M}_{11}, \\mathbf{M}_{12}, \\ldots \\mathbf{M}_{T_{r}, T_{c}}\\) of size \\(B_{r} \\times B_{c}\\) each. for \\(1 \\leq j \\leq T_{c}\\) do\n        Load \\(\\mathbf{K}_{j}, \\mathbf{V}_{j} \\in \\mathbb{R}^{B_{c} \\times d}\\) from HBM to on-chip SRAM. Initialize \\(\\mathbf{d K}_{j}=\\mathbf{d} \\mathbf{V}_{j}=\\mathbf{0} \\in \\mathbb{R}^{B_{c} \\times d}\\) on SRAM. for \\(1 \\leq i \\leq T_{r}\\) do\n            Load \\(\\mathbf{Q}_{i}, \\mathbf{O}_{i}, \\mathbf{d O}_{i} \\in \\mathbb{R}^{B_{r} \\times d}\\) from HBM to on-chip SRAM. Load \\(\\mathbf{M}_{i j} \\in \\mathbb{R}^{B_{c} \\times B_{c}}\\) from HBM to on-chip SRAM. Initialize \\(\\mathbf{d} \\mathbf{K}_{j}=\\mathbf{d} \\mathbf{V}_{j}=\\mathbf{0} \\in \\mathbb{R}^{B_{c} \\times d}\\) on SRAM. On chip, compute \\(\\mathbf{A}_{i j}=\\left[\\mathbf{Q}_{i} \\mathbf{K}_{j}^{\\top}\\right] \\odot \\mathbf{M}_{i j} \\in \\mathbb{R}^{B_{r} \\times B_{c}}\\). On chip, compute \\(\\mathbf{d} \\mathbf{V}_{j}=\\mathbf{d} \\mathbf{V}_{j}+\\mathbf{A}_{i j}^{\\top} \\mathbf{d} \\mathbf{O}_{i} \\in \\mathbb{R}^{B_{c} \\times d}\\). On chip, compute \\(\\mathbf{d A}_{i j}=\\left[\\mathbf{d} \\mathbf{O}_{i} \\mathbf{V}_{j}^{\\top}\\right] \\odot \\mathbf{M}_{i j} \\in \\mathbb{R}^{B_{r} \\times B_{c}}\\). On chip, compute \\(\\mathbf{d} \\mathbf{K}_{j}=\\mathbf{d} \\mathbf{k}_{j}+\\mathbf{d} \\mathbf{A}_{i j}^{\\top} \\mathbf{V}_{j} \\in \\mathbb{R}^{B_{c} \\times d}\\). Load \\(\\mathbf{d} \\mathbf{Q}_{i}\\) from HBM to SRAM, then on chip, compute \\(\\mathbf{d} \\mathbf{Q}_{i}=\\mathbf{d} \\mathbf{K}_{i}+\\mathbf{d} \\mathbf{A}_{i j} \\mathbf{K}_{j} \\in \\mathbb{R}^{B_{r} \\times d}\\),\n            write back to HBM. end for\n        Write \\(\\mathbf{d K}_{j}, \\mathbf{d V} V_{j}\\) to HBM as the \\(j\\)-th block of \\(\\mathbf{d K}, \\mathbf{d V}\\). end for\n    retun \\(\\mathrm{dQ}, \\mathrm{dK}, \\mathrm{dV}\\)\n```\n\nAssume the statement holds for $n=m-1$, i.e., $[\\mathbf{k v}]_{m-1}=\\lambda^{-(m-1)}[\\overline{\\mathbf{k v}}]_{m-1}$. Then, when $n=m$ :\n\n$$\n\\begin{aligned}\n{[\\mathbf{k v}]_{m} } & =[\\mathbf{k v}]_{m-1}+\\mathbf{k}_{\\mathbf{m}} \\lambda^{-m} \\mathbf{v}_{m}^{\\top} \\\\\n& =\\lambda^{-(m-1)}[\\overline{\\mathbf{k v}}]_{m-1}+\\mathbf{k}_{\\mathbf{m}} \\lambda^{-m} \\mathbf{v}_{m}^{\\top} \\\\\n& =\\lambda^{-m}\\left(\\lambda[\\overline{\\mathbf{k v}}]_{m-1}+\\mathbf{k}_{\\mathbf{m}} \\mathbf{v}_{m}^{\\top}\\right) \\\\\n& =\\lambda^{-m}[\\overline{\\mathbf{k v}}]_{m}\n\\end{aligned}\n$$\n\nthe statement holds.",
    "transnormerllm-27": "Therefore, by induction, the statement holds for all $n \\geq 1$. Thus, both the Origin Inference Algorithm and the Robust Inference Algorithm yield the same results. ## D CORPuS\n\nWe gather an extensive corpus of publicly accessible text from the internet, totaling over 7007B in size. The collected data are processed by our data preprocessing procedure as shown in Figure 5 leaving a 6 TB cleaned corpus with roughly 2 trillion tokens. We categorize our data sources to provide better transparency and understanding. The specifics of these categories are outlined in Table 11\n\n## D. 1 DATA PREPROCESSING\n\nOur data preprocessing procedure consists of three steps: 1). rule-based filtering, 2). deduplication, and 3). a self-cleaning scheme. Before being added to the training corpus, the cleaned corpus needs to be evaluated by humans. Rule-based filtering The rules we used to filter our collected data are listed as follows:\n\n- Removal of HTML Tags and URLs: The initial step in our process is the elimination of HTML tags and web URLs from the text. This is achieved through regular expression techniques that identify these patterns and remove them, ensuring the language model focuses on meaningful textual content. - Elimination of Useless or Abnormal Strings: Subsequently, the cleaned dataset undergoes a second layer of refinement where strings that do not provide value, such as aberrant strings\n\n![](https://cdn.mathpix.com/cropped/2024_09_17_292835b4009c58e22eb5g-19.jpg?height=619&width=1389&top_left_y=295&top_left_x=368)\n\nFigure 5: Data Preprocess Procedure. The collected data undergoes a process of rule-based filtering and deduplication, followed by our self-clean data processing strategy: model-based filtering, human evaluation, and evaluation model. After several iterations of the above cycle, we obtain high-quality training data at around 2 T tokens. or garbled text, are identified and excised. This process relies on predefined rules that categorize certain string patterns as non-contributing elements. - Deduplication of Punctuation Marks: We address the problem of redundant punctuation marks in the data. Multiple consecutive punctuation marks can distort the natural flow and structure of sentences when training the model. We employ a rule-based system that trims these duplications down to a single instance of each punctuation mark. - Handling Special Characters: Unusual or special characters that are not commonly part of the language's text corpus are identified and either removed or replaced with a standardized representation. - Number Standardization: Numerical figures may be presented in various formats across different texts. These numbers are standardized into a common format to maintain consistency. - Preservation of Markdown/LaTeX Formats: While removing non-textual elements, exceptions are made for texts in Markdown and LaTeX formats. Given their structured nature and ubiquitous use in academia and documentation, preserving these formats can enhance the model's ability to understand and generate similarly formatted text. Deduplication To ensure the uniqueness of our data and avert the risk of overfitting, we employ an efficient de-duplication strategy at the document or line level using MinHash and Locality-Sensitive Hashing (LSH) algorithms. This combination of MinHash and LSH ensures a balance between computational efficiency and accuracy in the deduplication process, providing a robust mechanism for data deduplication and text watermark removal. Self-cleaning scheme Our data self-cleaning process involves an iterative loop of the following three steps to continuously refine and enhance the quality of our dataset. An issue of using modelbased data filters is that the filtered data will have a similar distribution as the evaluation model, which may have a significant impact on the diversity of the training data. Assuming that the majority of the pre-processed data is of high quality, we can train an evaluation model on the entire set of pre-processed data, and the model will automatically smooth the data manifold distribution and outlet low-quality data while retaining the majority of the diversities. The self-cleaning scheme unfolds as follows:\n\n- Evaluation Model: We train a 385M model on the pre-processed corpus to act as a data quality filter. Table 11: Statistics of our corpus. For each category, we list the number of epochs performed on the subset when training on the 2 trillion tokens, as well as the number of tokens and disk sizes. We also list the table on the right according to the language distribution. | Dataset | Epochs | Tokens | Disk size | Language | Tokens | Disk size |\n| :---: | :---: | :---: | :---: | :---: | :---: | :---: |\n| Academic Writings | 1.53 | 200 B | 672 GB |  |  |  |\n| Books | 2.49 | 198 B | 723 GB | English | 743 B | 2.9 TB |\n| Code | 0.44 | 689 B | 1.4 TB | Chiese | 555 B | 1.7 TB |\n| Encyclopedia | 1.51 | 5 B | 18 GB | Code | 689 B | 1.4 TB |\n| Filtered Webpages | 1.00 | 882 B | 3.1 TB |  |  |  |\n| Others | 0.63 | 52 B | 154 GB | Others | 39 B | 89 GB |\n| Total | - | 2026 B | 6 TB | Total | 2026 B | 6 TB |\n\n- Model-Based Data Filtering: We use the evaluation model to assess each piece of data with perplexity.",
    "transnormerllm-28": "Only data achieving a score above a certain threshold is preserved for the next step. Low-quality data are weeded out at this stage. - Human Evaluation: We sample a small portion of the filtered data and manually evaluate the quality. These steps are repeated in cycles, with each iteration improving the overall quality of the data and ensuring the resulting model is trained on relevant, high-quality text. This self-cleaning process provides a robust mechanism for maintaining data integrity, thereby enhancing the performance of the resulting language model. ## D. 2 TOKENIZATION\n\nWe tokenize the data with the Byte-Pair Encoding (BPE) algorithm. Notably, to enhance compatibility with Chinese language content, a significant number of common and uncommon Chinese characters have been incorporated into our vocabulary. In cases where vocabulary items are not present in the dictionary, the words are broken down into their constituent UTF-8 characters. This strategy ensures comprehensive coverage and flexibility for diverse linguistic input during model training. ## E ADDITIONAL EXPERIMENTAL RESULTS\n\n## E. 1 MODEL ParalLELISM ON TRANSNORMERLLM\n\nWe conduct a series of experiments with a 7B TransNormerLLM model to investigate the performance of model parallelism on TransNormerLLM in terms of speed and memory. These tests are carried out on a single Nvidia DGX node that houses eight A100 80G GPUs linked by NVLink. In this experiment, FSDP is enabled and Flash Attention (Dao et al. 2022a) is used on the Transformer. Table 12 shows the results for training speed and memory consumption. It can be seen that model parallelism has a significant effect on memory conservation, as increasing the number of partitions for the model results in lower memory consumption per GPU. Due to NVLink constraints, we kept the dimension of model parallelism within 8 in all of our experiments. The TransNormerLLM-7B model requires only 24.1 GB of memory on a single GPU when the model parallel size is set to 8 , representing a significant memory reduction of $62.3 \\%$ when compared to the model parallel size of 1 . In comparison, the Transformer-7B model consumes 28.7 GB of memory under the same configuration. While model parallelism conserves memory, it is worth noting that training speed is only marginally reduced. TransNormerLLM consistently outperforms Transformer by a wide margin. ## E. 2 Stress Tests on Model SiZe and ConteXt LENGth\n\nA series of stress tests are performed to assess the efficacy of the designed system optimization strategy. The model is scaled up to 175B, which is the largest released version of the TransNormerLLM model.",
    "transnormerllm-29": "However, this augmentation poses significant training challenges. We use a wide range of distributed training techniques to effectively train such a large model, with the goal of reducing GPU memory consumption while increasing computational and communication efficiencies. To ensure the\n\nTable 12: Model Parallelism Performance. We compare the model parallelism performance of Transformer-7B with Flash Attention and TransNormerLLM-7B with Lightning Attention on a single A100 node with NVLink. All experiments use a batch size of 2 and a context length of 2048. | Model | Model Parallel Size | Tokens/s | Allocated Memory/GPU | Memory Saved |\n| :---: | :---: | :---: | :---: | :---: |\n| Transformer-7B | 1 | 26896.1 | 66.3 GB | - |\n|  | 2 | 24973.7 | 44.6 GB | $32.7 \\%$ |\n|  | 4 | 22375.8 | 40.2 GB | $39.4 \\%$ |\n| TransNormerLLM-7B | 8 | 19973.6 | 28.7 GB | $56.7 \\%$ |\n|  | 1 | 32048.6 | 64.0 GB | - |\n|  | 2 | 29750.4 | 41.0 GB | $35.9 \\%$ |\n\nfeasibility of training these massive TransNormerLLM models, Lightning Attention, FSDP, Model Parallelism, AMP, and Activation Checkpointing are used. For the Transformer models, we use Flash Attention (Dao et al. 2022a) in all experiments. Model Size We perform training experiments on variously sized Transformer and TransNormerLLM models using a large-scale A100 80G GPU cluster, as shown in Table 13 To achieve the maximum speed for various model sizes, we keep the context length constant at 2048 and increased the batch size until we reached the GPU memory limit. TransNormerLLMs consistently outperform their Transformer counterparts in terms of computation speed. This observation validates the TransNormerLLM model's advantageous linear computational complexity, reinforcing its efficacy. Table 13: Efficiency of training models with different sizes. For comparative purposes, we keep the context length fixed at 2048 and increased the batch size for both transformer and TransNormerLLM to achieve their maximum speeds without encountering out-of-memory issues. | Model | Model Size | Tokens/sec/GPU | Allocated Memory/GPU |\n| :---: | :---: | :---: | :---: |\n|  | 7B | 3362.7 | 72.5 GB |\n| Transformer | 13B | 1735.6 | 70.6 GB |\n|  | 65B | 318.2 | 73.2 GB |\n|  | 175 B | 106.2 | 69.5 GB |\n|  | 7B | 4081.0 | 71.9 GB |\n| TransNormerLLM | 13B | 2104.3 | 73.8 GB |\n|  | 65B | 406.9 | 69.4 GB |\n|  | 175B | 136.6 | 70.3 GB |\n\nContext Length One of the strengths of TransNormerLLM lies in its utilization of linear attention computation, which exhibits computational and storage complexities linearly correlated with the sequence length. To validate this outstanding characteristic of TransNormerLLM, we conduct training experiments on Transformer and TransNormerLLM models with varying parameter sizes. While maintaining a batch size of 1 , we aim to maximize the context length. All experiments run on a small cluster with 64 A100 GPUs. The results, as presented in Table 14, demonstrate the remarkable long context length training capability of TransNormerLLM. Under comparable computational resources, the TransNormerLLM model exhibits the ability to train with longer context lengths compared to conventional Transformer models and achieve higher computational speeds in the process. Table 14: Maximum context length for training Transformer and TransNormerLLM. We compare the maximum context lengths with different model sizes between Transformer and TransNormerLLM on 64 A100 80G GPUs. All experiments use a batch size of 1. | Model | Model Size | Context Length | Relative Speed | Allocated Memory/GPU |\n| :---: | :---: | :---: | :---: | :---: |\n|  | 7 B | 37 K | 1 | 71.1 GB |\n| Transformer | 13 B | 24 K | 1 | 68.0 GB |\n|  | 65 B | 19 K | 1 | 73.3 GB |\n|  | 175 B | 10 K | 1 | 66.9 GB |\n| TransNormerLLM | 7 B | 48 K | 1.21 | 65.8 GB |\n|  | 13 B | 35 K | 1.23 | 61.0 GB |\n|  | 65 B | 23 K | 1.29 | 68.2 GB |\n|  | 175 B | 12 K | 1.35 | 63.5 GB |\n\n\n[^0]:    *Yiran Zhong is the corresponding author.",
    "transnormerllm-30": "Email: zhongy iran@gmail.com.",
    "transnormerllm-31": "$\\sharp$ equal contribution. "
}